<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>DoubleHappy or Jepson</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="DoubleHappy or Jepson">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;page&#x2F;4&#x2F;index.html">
<meta property="og:site_name" content="DoubleHappy or Jepson">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="DoubleHappy or Jepson" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/default-avatar.jpg">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlight.css">
</head>

<body>
  <div id="fullpage" class="mobile-nav-right">
    
      <div id="wrapper" title="图片来自网络">
    
    
      <header id="header">
  <div id="nav-toggle" class="nav-toggle"></div>
  <div class="head-box global-width">
    <nav class="nav-box nav-right">
      
        <a class="nav-item" href="/archives" title
        
        >首页</a>
      
        <a class="nav-item" href="/archives" title
        
        >归档</a>
      
    </nav>
  </div>
</header>
      <div id="middlecontent" title class="global-width sidebar-right">
        <section id="main">
  
    <article id="post-Spark001-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/15/Spark001-double-happy/">Spark001--double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2018/01/15/Spark001-double-happy/" class="article-date">
  <time datetime="2018-01-15T11:57:42.000Z" itemprop="datePublished">2018-01-15</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="Speed"><a href="#Speed" class="headerlink" title="Speed"></a>Speed</h2><p>Spark是支持pipline操作的，根据Shufle进行切分的，中间的过程是不落地的。<br>运行的角度来说：<br>    线程的<br>    mapreduce是进程的   map task 、reduce task</p>
<h2 id="RDD"><a href="#RDD" class="headerlink" title="RDD"></a>RDD</h2><p>1.Represents an immutable,<br>   partitioned collection of elements that can be operated on in parallel.<br>2. </p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">5大特性： 弹性分布式数据集</span><br><span class="line">	1）一系列的partition     分区里是有index的</span><br><span class="line">      protected def getPartitions: Array[Partition]</span><br><span class="line"></span><br><span class="line">解释：</span><br><span class="line">	 *  - A list of partitions</span><br><span class="line">	 *  - A function for computing each split</span><br><span class="line"> scala中 List（1，2，3，4).map(_*2)   scala中的list是单机的</span><br><span class="line"> 而RDD中 数据是分区的，如果rdd.map(_*2)是对每个分区里的元素做计算 是 分布式的</span><br><span class="line"></span><br><span class="line">    2）针对RDD做操作其实就是针对RDD底层的partition进行操作</span><br><span class="line">    rdd.map(_*2)</span><br><span class="line">    def compute(split: Partition, context: TaskContext): Iterator[T]</span><br><span class="line"></span><br><span class="line">	3）rdd之间的依赖（血缘关系）</span><br><span class="line">      protected def getDependencies: Seq[Dependency[_]] = deps</span><br><span class="line"></span><br><span class="line">	4）partitioner（针对 kv类型的rdd）</span><br><span class="line">      @transient val partitioner: Option[Partitioner] = None</span><br><span class="line"></span><br><span class="line">	5）locations （优先把作业调度到数据所在节点）</span><br><span class="line">      protected def getPreferredLocations(split: Partition): Seq[String] = Nil</span><br><span class="line">	好处是 如果你的数据不在这个节点上 优先把作业调度到数据所在节点 好处是 直接本地读数据就可以了</span><br><span class="line">	理想化状态。</span><br><span class="line">	 也有 作业调度在别的节点上 数据在另一台节点上，那么 只能把数据通过网络把数据传到 作业调度的节点上去，进行计算。那么5这个特性就是减少网络数据传输。</span><br></pre></td></tr></table></figure></div>
<h2 id="程序开发入口"><a href="#程序开发入口" class="headerlink" title="程序开发入口"></a>程序开发入口</h2><p>开发Spark应用程序<br>    1）SparkConf<br>        appName<br>        master<br>    2）SparkContext(sparkConf)<br>    3）spark-shell –master local[2] 底层自动为我们创建了SparkContext sc</p>
<p><img src="https://img-blog.csdnimg.cn/2019092812275919.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20190928122827724.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="算子"><a href="#算子" class="headerlink" title="算子"></a>算子</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RDD:创建</span><br><span class="line"> parallelize :</span><br><span class="line"> 	sc.parallelize(List(1,2,3,4))</span><br><span class="line"> textFile:</span><br><span class="line"> 	sc.textFile(path)</span><br><span class="line"> 通过RDD转换生成的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val rdd = sc.parallelize(List(1,2,3,4))</span><br><span class="line">rdd: org.apache.spark.rdd.RDD[Int] = ParallelCollectionRDD[0] at parallelize at &lt;console&gt;:24</span><br><span class="line"></span><br><span class="line">scala&gt; rdd.collect</span><br><span class="line">collect   collectAsync</span><br><span class="line"></span><br><span class="line">scala&gt; rdd.collect</span><br><span class="line">res0: Array[Int] = Array(1, 2, 3, 4)                                            </span><br><span class="line"></span><br><span class="line">scala&gt; val rdd1 = sc.textFile(&quot;file:///home/sxwang/data&quot;)</span><br><span class="line">rdd1: org.apache.spark.rdd.RDD[String] = file:///home/sxwang/data MapPartitionsRDD[2] at textFile at &lt;console&gt;:24</span><br><span class="line"></span><br><span class="line">scala&gt; rdd1.collect</span><br><span class="line">res1: Array[String] = Array(spark       flink   hadoop, spark   kafka   scala)</span><br><span class="line"></span><br><span class="line">scala&gt; val rdd2 = rdd.map(_*2)</span><br><span class="line">rdd2: org.apache.spark.rdd.RDD[Int] = MapPartitionsRDD[3] at map at &lt;console&gt;:26</span><br><span class="line"></span><br><span class="line">scala&gt; rdd2.collect</span><br><span class="line">collect   collectAsync</span><br><span class="line"></span><br><span class="line">scala&gt; rdd2.collect</span><br><span class="line">res2: Array[Int] = Array(2, 4, 6, 8)</span><br><span class="line"></span><br><span class="line">scala&gt; rdd2.toDebugString</span><br><span class="line">res3: String =</span><br><span class="line">(2) MapPartitionsRDD[3] at map at &lt;console&gt;:26 []</span><br><span class="line"> |  ParallelCollectionRDD[0] at parallelize at &lt;console&gt;:24 []</span><br></pre></td></tr></table></figure></div>

<h2 id="并行度-–简单版"><a href="#并行度-–简单版" class="headerlink" title="并行度 –简单版"></a>并行度 –简单版</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; rdd</span><br><span class="line">res7: org.apache.spark.rdd.RDD[Int] = ParallelCollectionRDD[0] at parallelize at &lt;console&gt;:24</span><br><span class="line"></span><br><span class="line">scala&gt; rdd.collect</span><br><span class="line">res8: Array[Int] = Array(1, 2, 3, 4)</span><br></pre></td></tr></table></figure></div>
<p>产看ui界面：<br><img src="https://img-blog.csdnimg.cn/20190928124416679.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>为什么是2呢？<br>查看源码：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def parallelize[T: ClassTag](</span><br><span class="line">    seq: Seq[T],</span><br><span class="line">    numSlices: Int = defaultParallelism): RDD[T] = withScope &#123;</span><br><span class="line">  assertNotStopped()</span><br><span class="line">  new ParallelCollectionRDD[T](this, seq, numSlices, Map[Int, Seq[String]]())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">defaultParallelism：</span><br><span class="line">	</span><br><span class="line">	 /** Default level of parallelism to use when not given by user (e.g. parallelize and makeRDD). */</span><br><span class="line">  def defaultParallelism: Int = &#123;</span><br><span class="line">    assertNotStopped()</span><br><span class="line">    taskScheduler.defaultParallelism</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div>
<p>看他的实现的<br><img src="https://img-blog.csdnimg.cn/20190928124821226.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">taskScheduler.defaultParallelism：</span><br><span class="line">	override def defaultParallelism(): Int = backend.defaultParallelism()</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/2019092812500940.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">查看local的点进去：</span><br><span class="line">  override def defaultParallelism(): Int =</span><br><span class="line">    scheduler.conf.getInt(&quot;spark.default.parallelism&quot;, totalCores)</span><br><span class="line">默认从配置文件里去  ，但是我们没有设置，</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Used when running a local version of Spark where the executor, backend, and master all run in</span><br><span class="line"> * the same JVM. It sits behind a [[TaskSchedulerImpl]] and handles launching tasks on a single</span><br><span class="line"> * Executor (created by the [[LocalSchedulerBackend]]) running locally.</span><br><span class="line"> */</span><br><span class="line">private[spark] class LocalSchedulerBackend(</span><br><span class="line">    conf: SparkConf,</span><br><span class="line">    scheduler: TaskSchedulerImpl,</span><br><span class="line">    val totalCores: Int)</span><br><span class="line">  extends SchedulerBackend with ExecutorBackend with Logging &#123;</span><br><span class="line"></span><br><span class="line">totalCores 说明是我们构建的时候传进来的 </span><br><span class="line"></span><br><span class="line">可以看：</span><br><span class="line">	scala&gt; sc.parallelize(List(1,2,3,4),3).collect</span><br><span class="line">res9: Array[Int] = Array(1, 2, 3, 4)</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20190928125348377.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Hadoop项目流程：Hive2MySQL-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/03/Hadoop%E9%A1%B9%E7%9B%AE%E6%B5%81%E7%A8%8B%EF%BC%9AHive2MySQL-double-happy/">Hadoop项目流程：Hive2MySQL--double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2018/01/03/Hadoop%E9%A1%B9%E7%9B%AE%E6%B5%81%E7%A8%8B%EF%BC%9AHive2MySQL-double-happy/" class="article-date">
  <time datetime="2018-01-03T11:55:22.000Z" itemprop="datePublished">2018-01-03</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="Hive统计表"><a href="#Hive统计表" class="headerlink" title="Hive统计表"></a>Hive统计表</h2><p>不管使用Hive统计的结果是什么维度，统计的结果表选择：<br>    1.external<br>    2.partition<br>    就是分区+外部表</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">平台报表别人如何访问呢：</span><br><span class="line">	1.使用hiveservie2 使用jdbc方式去连接     可以    生产上不这么用</span><br><span class="line">	2.最好把数据倒入mysql里面   *****  那么下面就是基于这个思路进行讲解</span><br><span class="line"></span><br><span class="line">Hdfs --》Mysql  这里使用Sqoop     到Spark那块就不用Sqoop了 太low了</span><br></pre></td></tr></table></figure></div>
<h2 id="使用Sqoop把Hive里数据倒入MySQL-注意的点"><a href="#使用Sqoop把Hive里数据倒入MySQL-注意的点" class="headerlink" title="使用Sqoop把Hive里数据倒入MySQL 注意的点"></a>使用Sqoop把Hive里数据倒入MySQL 注意的点</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">Hive里表的设计 ：分区字段 要在Hive建表的时候 多一个字段 代表分区字段</span><br><span class="line">	hdfs上的数据是三个字段不算分区的 mySQL里面要对应上 </span><br><span class="line">	分区字段不能作为最终字段来使用的在mysql中（sqoop）</span><br><span class="line">	所以在Sqoop的时候要指定上字段而且还要指定分割符</span><br><span class="line">	</span><br><span class="line">	对于hive来讲默认的分割符是\001</span><br><span class="line">	不然会报错 如下：	</span><br><span class="line">	解决办法就是：</span><br><span class="line">		Hive表 + Sqoop  使用</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20190923164039631.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MySQL里表：需要Hive表里的哪几个字段就创建什么样的表</span><br><span class="line">create table  platform_stat(</span><br><span class="line">platform  varchar(20),</span><br><span class="line">cnt  int,</span><br><span class="line">d varchar(8)</span><br><span class="line">)engine=innodb default charset=utf8;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Hive里表设计：</span><br><span class="line">create table dwd_platform_stat_info(</span><br><span class="line">platform string,</span><br><span class="line">cnt int,</span><br><span class="line">d string</span><br><span class="line">) partitioned by(day string)</span><br><span class="line">location &apos;/hadoop/project/platform_stat&apos;;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Sqoop使用：Sqoop 在什么地方执行 那么 能够地方会有一个java文件生成</span><br><span class="line"></span><br><span class="line">sqoop export \</span><br><span class="line">--connect jdbc:mysql://localhost:3306/hive_dwd \</span><br><span class="line">--password wsx123$%^ \</span><br><span class="line">--username root \</span><br><span class="line">--mapreduce-job-name  Platform_info_Hive2MySQL \</span><br><span class="line">--columns &quot;platform,cnt,d&quot;   \</span><br><span class="line">--input-fields-terminated-by &apos;\001&apos; \</span><br><span class="line">--table platform_stat \</span><br><span class="line">--export-dir /hadoop/project/platform_stat/day=20190921</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看MySQL表结果：</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20190923164443832.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">脚本封装：</span><br><span class="line">	#!/bin/bash</span><br><span class="line"></span><br><span class="line">if [ $# -eq 1 ]; then</span><br><span class="line">    time=$1</span><br><span class="line">else</span><br><span class="line">    time=`date -d &quot;yesterday&quot; +%Y%m%d`</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">#platforma_state 数据统计</span><br><span class="line">hive -e &quot;</span><br><span class="line"></span><br><span class="line">use homework;</span><br><span class="line">insert overwrite table dwd_platform_stat_info partition(day=$&#123;time&#125;)</span><br><span class="line">select platform , count(1) ,day as d  from access_wide where day =&apos;$&#123;time&#125;&apos;  group by platform,day ;</span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line">#Sqoop platforma_state_Hive2MySQL </span><br><span class="line">sqoop export \</span><br><span class="line">--connect jdbc:mysql://localhost:3306/hive_dwd \</span><br><span class="line">--password wsx123$%^ \</span><br><span class="line">--username root \</span><br><span class="line">--mapreduce-job-name  Platform_info_Hive2MySQL \</span><br><span class="line">--columns &quot;platform,cnt,d&quot;   \</span><br><span class="line">--input-fields-terminated-by &apos;\001&apos; \ </span><br><span class="line">--table platform_stat \</span><br><span class="line">--export-dir /hadoop/project/platform_stat/day=$&#123;time&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">存在的问题：</span><br><span class="line">	按上面的脚本走 如果多次导入同一天的数据</span><br><span class="line">	MySQL里面会有重复数据的</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20190923165037161.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>数据是有重复的</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">解决MySQL数据重复：</span><br><span class="line">	这块只要把上次导入的日期数据删掉就可以了</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">脚本封装：</span><br><span class="line">	#!/bin/bash</span><br><span class="line"></span><br><span class="line">if [ $# -eq 1 ]; then</span><br><span class="line">    time=$1</span><br><span class="line">else</span><br><span class="line">    time=`date -d &quot;yesterday&quot; +%Y%m%d`</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">#platforma_state 数据统计</span><br><span class="line">echo &quot;-------------------------------------------------------------------------------------------&quot;</span><br><span class="line">echo &quot;step  : hive -e ---&gt;  insert data to platforma_state table&quot;</span><br><span class="line">echo &quot;-------------------------------------------------------------------------------------------&quot;</span><br><span class="line">hive -e &quot;</span><br><span class="line"></span><br><span class="line">use homework;</span><br><span class="line">insert overwrite table dwd_platform_stat_info partition(day=$&#123;time&#125;)</span><br><span class="line">select platform , count(1) ,day as d  from access_wide  where day =&apos;$&#123;time&#125;&apos; group by platform,day ;</span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line">#登陆MySQL 删除上次 处理日期 表中数据</span><br><span class="line">echo &quot;-------------------------------------------------------------------------------------------&quot;</span><br><span class="line">echo &quot;step : MySQL ---&gt; delete  last time process $&#123;time&#125; data&quot;</span><br><span class="line">echo &quot;-------------------------------------------------------------------------------------------&quot;</span><br><span class="line"></span><br><span class="line">MySQL_USER=&apos;root&apos;</span><br><span class="line">MySQL_PASSWD=&apos;wsx123$%^&apos;</span><br><span class="line"></span><br><span class="line">SQL_RESULT=`</span><br><span class="line">mysql \</span><br><span class="line">--user=&quot;$&#123;MySQL_USER&#125;&quot; \</span><br><span class="line">--password=&quot;$&#123;MySQL_PASSWD&#125;&quot;  \</span><br><span class="line">-e &quot;select count(1) as cnt from hive_dwd.platform_stat where d = $&#123;time&#125;;&quot; | tail -1</span><br><span class="line">`</span><br><span class="line">echo &quot;-------------------------------------------------------------------------------------------&quot;</span><br><span class="line">echo &quot;MySQL last time $&#123;time&#125; data size ：$&#123;SQL_RESULT&#125;&quot;</span><br><span class="line">echo &quot;-------------------------------------------------------------------------------------------&quot;</span><br><span class="line">if [ $&#123;SQL_RESULT&#125; -ne 0 ] ; then</span><br><span class="line">    mysql --user=&quot;$&#123;MySQL_USER&#125;&quot; --password=&quot;$&#123;MySQL_PASSWD&#125;&quot;  \</span><br><span class="line">    -e &quot;delete from hive_dwd.platform_stat where d = $&#123;time&#125;;&quot;</span><br><span class="line">    echo &quot;-------------------------------------------------------------------------------------------&quot;</span><br><span class="line">    echo &quot;Delete Mysql last time  $&#123;time&#125; data done ,next step do Sqoop : Hive 2 MySQL&quot;</span><br><span class="line">    echo &quot;-------------------------------------------------------------------------------------------&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#Sqoop platforma_state_Hive2MySQL </span><br><span class="line">echo &quot;-------------------------------------------------------------------------------------------&quot;</span><br><span class="line">echo &quot;step : sqoop --&gt; Hive 2 MySQL &quot;</span><br><span class="line">echo &quot;-------------------------------------------------------------------------------------------&quot;</span><br><span class="line">sqoop export \</span><br><span class="line">--connect jdbc:mysql://localhost:3306/hive_dwd \</span><br><span class="line">--password wsx123$%^ \</span><br><span class="line">--username root \</span><br><span class="line">--mapreduce-job-name  Platform_info_Hive2MySQL \</span><br><span class="line">--columns &quot;platform,cnt,d&quot;   \</span><br><span class="line">--input-fields-terminated-by &apos;\001&apos; \</span><br><span class="line">--table platform_stat \</span><br><span class="line">--export-dir /hadoop/project/platform_stat/day=$&#123;time&#125; </span><br><span class="line"></span><br><span class="line">error=$?</span><br><span class="line">if [ $error == 0 ] ; then</span><br><span class="line"> echo &quot;-------------------------------------------------------------------------------------------&quot;</span><br><span class="line"> echo &quot;$&#123;time&#125; work suceess&quot;</span><br><span class="line"> echo &quot;-------------------------------------------------------------------------------------------&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></div>
<h2 id="任务调度"><a href="#任务调度" class="headerlink" title="任务调度"></a>任务调度</h2><p>下一个博客Azkaban讲解</p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Hadoop压缩-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/01/Hadoop%E5%8E%8B%E7%BC%A9-double-happy/">Hadoop压缩---double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2018/01/01/Hadoop%E5%8E%8B%E7%BC%A9-double-happy/" class="article-date">
  <time datetime="2018-01-01T11:54:32.000Z" itemprop="datePublished">2018-01-01</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="调优点："><a href="#调优点：" class="headerlink" title="调优点："></a>调优点：</h2><p>为什么要使用压缩呢？</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.节省空间 （数据在hdfs上以3副本存储 如果采用压缩 占用空间会少一些）</span><br><span class="line">2.时间：网络io 和 磁盘io 会减少 </span><br><span class="line">  （mapreduce过程中 map端输出采用压缩和不采用压缩效果很明显）</span><br><span class="line">  2.1 map端到reduce端会经过shuffle 如果map端采用压缩那么 map端数据传到reduce端过程中</span><br><span class="line">     数据压缩后体积会变小，那么经过网络传输的数据会变少 减少网络io</span><br><span class="line">     因为要经过网络传输，需要从磁盘读到内存 磁盘上的数据压缩后 读取到内存的数据体积</span><br><span class="line">     也会变小  所以也减少磁盘io</span><br><span class="line">  这样传输的时间也会减少很多，所以有必要进行压缩。</span><br></pre></td></tr></table></figure></div>
<p>但是注意的是如果采用压缩，对机器的cpu的要求高，所以压缩的使用场景</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.存储数据的空间不够</span><br><span class="line">2.机器的core要足够</span><br></pre></td></tr></table></figure></div>
<p>如果core不够还采用压缩，那么还是别采用压缩啦。</p>
<h2 id="压缩的技术"><a href="#压缩的技术" class="headerlink" title="压缩的技术"></a>压缩的技术</h2><p>有损压缩(lossy compression) :  适用于图片和视频  允许丢失几帧<br>无损压缩(lossless compression):原始数据解压缩数据是没有丢失的</p>
<p>对称和非对称：就是压缩和解压的时间相同叫对称 ，反义。</p>
<h2 id="压缩的使用场景结合mapreduce"><a href="#压缩的使用场景结合mapreduce" class="headerlink" title="压缩的使用场景结合mapreduce"></a>压缩的使用场景结合mapreduce</h2><p>数据压缩  map端输出可以用，reduce端输出也可以使用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">input   </span><br><span class="line">  因为这块 map读取数据的时候的inputformat默认会识别数据输入采用什么格式的压缩获取codec（</span><br><span class="line">     textinputformat源码里有）</span><br><span class="line">map out         配个参数就可以</span><br><span class="line">reduce out    配个参数就可以</span><br></pre></td></tr></table></figure></div>
<p>spark、flink同样的</p>
<h2 id="凡事都有两面性"><a href="#凡事都有两面性" class="headerlink" title="凡事都有两面性"></a>凡事都有两面性</h2><p>空间和时间  ok<br>cpu   耗费     cpu的利用率会高  而且整个作业的处理时长会略微长一些</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">使用的压缩：</span><br><span class="line">	有个解压缩过程 所以整个作业时间会略微长</span><br><span class="line"></span><br><span class="line">所以为了减少空间和网络磁盘io传输时间 cpu的耗费以及作业的时长会变长</span><br></pre></td></tr></table></figure></div>
<h2 id="常见的压缩格式"><a href="#常见的压缩格式" class="headerlink" title="常见的压缩格式"></a>常见的压缩格式</h2><p><img src="https://img-blog.csdnimg.cn/20190923100126703.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>还有LZ4</p>
<h2 id="如何选择呢，这么多压缩的格式-压缩比和解压缩度"><a href="#如何选择呢，这么多压缩的格式-压缩比和解压缩度" class="headerlink" title="如何选择呢，这么多压缩的格式 压缩比和解压缩度"></a>如何选择呢，这么多压缩的格式 压缩比和解压缩度</h2><p><img src="https://img-blog.csdnimg.cn/20190923100600403.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>相同配置的机器测试看看 </p>
<p>压缩比：压缩前和压缩后的比值</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">压缩比    Bzip2 30%   Gzip (两者之间)  ,snappy \lzo50%</span><br><span class="line">解压速度    反过来</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/2019092310115462.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="压缩能否分片"><a href="#压缩能否分片" class="headerlink" title="压缩能否分片"></a>压缩能否分片</h2><p>hadoop作业是io密集型的，所以他的作业尽可能的采用压缩<br>spark、flink作业是pipline型的</p>
<p>注意：压缩又的是java写的，有的是native的，<br>所以你要在Hadoop里使用LZO(native的) 需要下载一些native的依赖</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Splitable：</span><br><span class="line">	一个文件相当于一个map task来处理，</span><br><span class="line">	1.假设一个5G的文件，不能使用分割的，也就意味着这个文件只能使用一个</span><br><span class="line">	maptask来处理，如果这个能分割，5G拆成10分 会采用10个maptask来处理</span><br><span class="line">	并行处理。5*1024/10 = 一个maptask处理的数据量。</span><br><span class="line"></span><br><span class="line">是否能够分割就决定了你的一个maptask处理的数据量有多少，</span><br><span class="line">如果能够分割就可以多个maptask并行处理</span><br></pre></td></tr></table></figure></div>

<h2 id="压缩是否支持分割"><a href="#压缩是否支持分割" class="headerlink" title="压缩是否支持分割"></a>压缩是否支持分割</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">分割：  注意是压缩过后的压缩文件是否支持分割的</span><br><span class="line">gzip    不可分割</span><br><span class="line">bzip2  可分割</span><br><span class="line">LZo    带索引可以分割（默认是不支持分割的）</span><br><span class="line">Snappy 不可分割</span><br></pre></td></tr></table></figure></div>
<p>是否能分割对使用哪个压缩有很大的影响意义</p>
<p><img src="https://img-blog.csdnimg.cn/20190923102928382.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>上图三个部分使用压缩：mapreduce的流程使用压缩的部分</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">input：</span><br><span class="line">map out</span><br><span class="line">reduce out</span><br></pre></td></tr></table></figure></div>

<p><img src="https://img-blog.csdnimg.cn/20190923103255281.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">三个地方使用的压缩推荐：</span><br><span class="line">	input：</span><br><span class="line">		Bzip2(支持分割 读一个文件 支持分割会多个并行的maptask进行处理) 数据量特别大 如果不支持压缩</span><br><span class="line">		就会有一个maptask进行处理，性能很低。</span><br><span class="line">	</span><br><span class="line">	mapout：</span><br><span class="line">		shuffle过程要选择一个解压速度更快的压缩</span><br><span class="line">		因为每个maptask输出数据写到磁盘上之后经过网络io</span><br><span class="line">		没有必要采用压缩比高的，之后到reducetask这过程中是采用分片和不分片这块不重要了已经</span><br><span class="line">		因为maptask进来之前是一个大文件拆成多个maptask来处理</span><br><span class="line">		到reduce这个过程中 难道你还需要拆么？不需要，所以这块最重要的是解压速度</span><br><span class="line">	reduceout：</span><br><span class="line">		1.高的压缩比节省空间（使用于归档文件）</span><br><span class="line">		2.作为下一个map的输入呢？应该采用什么压缩方式，我会选择Bzip2或者LZO带索引的(支持分片)</span><br></pre></td></tr></table></figure></div>
<h2 id="MapReduce作业使用压缩实战"><a href="#MapReduce作业使用压缩实战" class="headerlink" title="MapReduce作业使用压缩实战"></a>MapReduce作业使用压缩实战</h2><p>在Hadoop的core-site.xml里配置压缩 ，mapreduce-site.xml配置你采用压缩的位置(map的输出和reduce的输出)</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">core-site.xml:</span><br><span class="line"></span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;io.compression.codecs&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;</span><br><span class="line">  org.apache.hadoop.io.compress.GzipCodec,</span><br><span class="line">  org.apache.hadoop.io.compress.DefaultCodec,</span><br><span class="line">  org.apache.hadoop.io.compress.BZip2Codec,</span><br><span class="line">  org.apache.hadoop.io.compress.SnappyCodec,</span><br><span class="line">  com.hadoop.compression.lzo.LzoCodec,</span><br><span class="line">  com.hadoop.compression.lzo.LzopCodec</span><br><span class="line">  &lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mapreduce-site.xml:</span><br><span class="line">	 &lt;property&gt;</span><br><span class="line">    &lt;name&gt;mapreduce.output.fileoutputformat.compress&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;true&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;mapreduce.output.fileoutputformat.compress.codec&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;org.apache.hadoop.io.compress.BZip2Codec&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure></div>
<p>测试：<br>    wc<br>    hdfs最后生成的结果是以bzip结尾的</p>
<p><img src="https://img-blog.csdnimg.cn/20190923112832168.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="Hive的压缩使用"><a href="#Hive的压缩使用" class="headerlink" title="Hive的压缩使用"></a>Hive的压缩使用</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.创建表：</span><br><span class="line">CREATE EXTERNAL TABLE `ods_uid_pid_info_compression_test`(</span><br><span class="line">`uid` string, </span><br><span class="line">`pid` string</span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated by &apos;\t&apos;;</span><br><span class="line"></span><br><span class="line">load data local inpath &apos;/home/double_happy/data/user_pid.txt&apos; overwrite into table ods_uid_pid_info_compression_test;</span><br><span class="line"></span><br><span class="line">2.去hdfs上查看这数据</span><br></pre></td></tr></table></figure></div>

<p><img src="https://img-blog.csdnimg.cn/20190923113549154.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">使用压缩：</span><br><span class="line">	hive客户端里：</span><br><span class="line">	set hive.exec.compress.output=true;</span><br><span class="line">	set mapreduce.output.fileoutputformat.compress.codec=org.apache.hadoop.io.compress.BZip2Codec;</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20190923113944539.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>查看hdfs上数据大小：<br><img src="https://img-blog.csdnimg.cn/20190923114026402.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>可以对比一下 数据小了。</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">	hive里设置压缩不建议直接在hive-site.xml里面配置，那是全局的，</span><br><span class="line">	建议还是在使用的时候用命令的方式</span><br></pre></td></tr></table></figure></div>
      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-SQL-01" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/20/SQL-01/">SQL-01</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2017/12/20/SQL-01/" class="article-date">
  <time datetime="2017-12-20T11:53:13.000Z" itemprop="datePublished">2017-12-20</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="SQL-第一题：聚合函数形式的题"><a href="#SQL-第一题：聚合函数形式的题" class="headerlink" title="SQL-第一题：聚合函数形式的题"></a>SQL-第一题：聚合函数形式的题</h2><p>先讨论一下最基础的东西在hivesql里，比较晦涩，但是真的很好用哦。</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">谈谈个人理解：</span><br><span class="line"> 在sql里两个核心的东西：（1）group ：核心是聚合（2）join ：的核心是要join哪些列 </span><br><span class="line"> 注意：group by 和 over在一个select里不能同时使用的哈</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">我们为什么要聚合呢？</span><br><span class="line">eg：一个表 表示三个班级的学生，有名称，分数，班级，如果不聚合 </span><br><span class="line">我能不能这样写呢 </span><br><span class="line">select name , score from student group by class  </span><br><span class="line">不能 为什么不能？</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">首先我的name,score 在groupby的时候我不知道取哪一个，</span><br><span class="line">groupby class 就相当于在所有的列名里面取项，你不知道取哪个name，哪个score，</span><br><span class="line">所以取得项要么出现在groupby 后面，</span><br><span class="line">要么取得项是一个聚合列（eg：sum（score）代表每个班的所有得分数） ，</span><br><span class="line">这个聚合列就用到聚合函数udaf函数。</span><br></pre></td></tr></table></figure></div>
<p>案例1 ：【聚合函数形式的题】</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">eg:求每一个班级得分最高的学生得姓名+分数+班级？</span><br><span class="line"> 解决方法：</span><br><span class="line"> 1.sql -GroupBy +Join</span><br><span class="line"> 2.RDD</span><br><span class="line"> 3.sql -开窗</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">开窗函数：就是1对多 ，1就是partition by 谁 ,产生了多个数（产生了一个新列存这多个数） </span><br><span class="line">group by ：是多对1，把多个合并成一个</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.group by + join</span><br><span class="line">1）子表a ： select class,max(score)  score from student group by class </span><br><span class="line">    （1）中不能有name 想完成需求只能子表与原表join形成一个大表，利用大表添加name</span><br><span class="line">2）</span><br><span class="line">    select b.name, a.class,a.score from student b </span><br><span class="line">join </span><br><span class="line">    (select class,max(score) score from student group by class ) a</span><br><span class="line">on </span><br><span class="line"> b.class =a.class and a.score = b.score</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2.开窗函数 </span><br><span class="line">开窗函数：结合上面的问题，我在表后面再加一列，加什么列呢，首先第一个我是按照班级先分组，</span><br><span class="line">班级里的分数从高到低做一个排序，把排序的名次 作为要加的列。</span><br><span class="line">这样就不用像上面那样group by，直接select 那个列就能取到值。这个就叫开窗函数。</span><br><span class="line">   select name,class,score,rank() over(partition by class order by score desc)  rank from student </span><br><span class="line">这个语句就是为了产生最后一列 。 over就叫开窗函数 ，这个over里面怎么开的窗呢？</span><br><span class="line">partition by 就是先分组（就是以什么开窗，相当于 再某一个class里面我用一次rank()，在另一个class里面 </span><br><span class="line">我在用一次rank（）， rank()的应用前提是 order by 某个东西,rank()之后，这样就产生了最后一列 名字叫rank </span><br><span class="line">这个语句执行之后产生了一个新的表，这个表多了一列叫rank。假如这个表叫aa</span><br><span class="line">我产生完表aa之后，直接就</span><br><span class="line"> select name,class,score from aa where rank =1   就完成需求</span><br></pre></td></tr></table></figure></div>
<p>开窗函数里不止只有Rank()函数可用 ，它有很多哈<br><img src="https://img-blog.csdnimg.cn/20190917102337546.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTU1NzUxMg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="SQL题01"><a href="#SQL题01" class="headerlink" title="SQL题01"></a>SQL题01</h2><p>先讲思路–&gt;再演示结果</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SQL1： ods_domain_traffic_info这个表</span><br><span class="line">domain           time     traffic(T)</span><br><span class="line">gifshow.com   2019/01/01    5</span><br><span class="line">yy.com        2019/01/01    4</span><br><span class="line">huya.com      2019/01/01    1</span><br><span class="line">gifshow.com   2019/01/20    6</span><br><span class="line">gifshow.com   2019/02/01    8</span><br><span class="line">yy.com        2019/01/20    5</span><br><span class="line">gifshow.com   2019/02/02    7</span><br><span class="line">需求：统计每个用户的累计访问量   一个SQL搞定</span><br><span class="line">结果如下：</span><br><span class="line">domain          month     traffics   totals</span><br><span class="line">gifshow.com     2019-01      11         11</span><br><span class="line">gifshow.com     2019-02      15         26</span><br><span class="line">yy.com          2019-01       9         9</span><br><span class="line">huya.com        2019-01       1         1</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">思路：</span><br><span class="line">	结果要求的是 每个domain 每个月的 traffics  和 totals</span><br><span class="line">分两步：</span><br><span class="line">1.domain + month + traffics</span><br><span class="line">a.</span><br><span class="line">month : time 截取获得</span><br><span class="line">traffics : sum(traffic)</span><br><span class="line">b.</span><br><span class="line">group by(domain,month ) +sum(traffic) ===&gt; 拿到domain   month    traffics</span><br><span class="line"></span><br><span class="line">2.拿到domain   month    traffics 目的是 domain   month    traffics  totals</span><br><span class="line"></span><br><span class="line">a.新生成了一个列 totals  先想到 开窗函数 over()</span><br><span class="line">	partition by  谁呢？ order by 谁呢？</span><br><span class="line">	基于给的结果知道  partition by domain   order by  month     over()前面选择 sum(traffics) </span><br><span class="line">这样就ok了</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">我写sql思路过程：</span><br><span class="line">1.每个domain 每个month的总量  ==》    domain   month  traffics</span><br><span class="line">tmp :</span><br><span class="line">	select </span><br><span class="line">		domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, </span><br><span class="line">		sum(traffic) as traffics</span><br><span class="line">	from ods_domain_traffic_info</span><br><span class="line">	group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">	</span><br><span class="line">2.目的是totals 生成了一个新列（1对多） 用开窗函数 ，以domain分组以month排序 之后用sum</span><br><span class="line">result:</span><br><span class="line">	select</span><br><span class="line">		domain,month,traffics,</span><br><span class="line">		sum(traffics)over(partition by domain order by month) as totals</span><br><span class="line">	from  tmp;</span><br><span class="line"></span><br><span class="line">整合：</span><br><span class="line">	select</span><br><span class="line">		domain,month,traffics,</span><br><span class="line">		sum(traffics)over(partition by domain order by month) as totals</span><br><span class="line">	from(</span><br><span class="line">	select </span><br><span class="line">		domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, </span><br><span class="line">		sum(traffic) as traffics</span><br><span class="line">	from ods_domain_traffic_info</span><br><span class="line">	group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">	) as tmp;</span><br><span class="line"></span><br><span class="line">注意哈：我写博客为了好看 使用了 tab建 ，如何你想测试的话 把sql中的tab 地方去掉哈 。</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">结果演示：</span><br><span class="line">1. domain +time + traffic ---&gt; domain + month + traffics</span><br><span class="line">每个domain 每个month的总量  ==》    domain   month  traffics</span><br><span class="line">tmp :</span><br><span class="line">	select </span><br><span class="line">		domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, </span><br><span class="line">		sum(traffic) as traffics</span><br><span class="line">	from ods_domain_traffic_info</span><br><span class="line">	group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_domain_traffic_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7);</span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917140000_1dab3570-5d32-449f-ab8f-4c896be57622): select</span><br><span class="line">domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">from ods_domain_traffic_info</span><br><span class="line">group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:domain, type:string, comment:null), FieldSchema(name:month, type:string, comment:null), FieldSchema(name:traffics, type:bigint, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917140000_1dab3570-5d32-449f-ab8f-4c896be57622); Time taken: 0.498 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917140000_1dab3570-5d32-449f-ab8f-4c896be57622): select</span><br><span class="line">domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">from ods_domain_traffic_info</span><br><span class="line">group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">INFO  : Query ID = double_happy_20190917140000_1dab3570-5d32-449f-ab8f-4c896be57622</span><br><span class="line">INFO  : Total jobs = 1</span><br><span class="line">INFO  : Launching Job 1 out of 1</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0001, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0001/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0001</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:00:23,046 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:00:28,411 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.44 sec</span><br><span class="line">INFO  : 2019-09-17 14:00:34,894 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 3.51 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 3 seconds 510 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0001</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 3.51 sec   HDFS Read: 9195 HDFS Write: 82 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 3 seconds 510 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917140000_1dab3570-5d32-449f-ab8f-4c896be57622); Time taken: 23.04 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+--------------+----------+-----------+--+</span><br><span class="line">|    domain    |  month   | traffics  |</span><br><span class="line">+--------------+----------+-----------+--+</span><br><span class="line">| gifshow.com  | 2019-01  | 11        |</span><br><span class="line">| gifshow.com  | 2019-02  | 15        |</span><br><span class="line">| huya.com     | 2019-01  | 1         |</span><br><span class="line">| yy.com       | 2019-01  | 9         |</span><br><span class="line">+--------------+----------+-----------+--+</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.目的是totals 生成了一个新列（1对多） 用开窗函数 ，以domain分组以month排序 之后用sum</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; domain,month,traffics,</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; sum(traffics)over(partition by domain order by month) as totals</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from(</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; select </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_domain_traffic_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; ) as tmp;</span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917140202_f7fde489-9ae9-4ab5-85fd-591382b70891): select</span><br><span class="line">domain,month,traffics,</span><br><span class="line">sum(traffics)over(partition by domain order by month) as totals</span><br><span class="line">from(</span><br><span class="line">select</span><br><span class="line">domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">from ods_domain_traffic_info</span><br><span class="line">group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">) as tmp</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:domain, type:string, comment:null), FieldSchema(name:month, type:string, comment:null), FieldSchema(name:traffics, type:bigint, comment:null), FieldSchema(name:totals, type:bigint, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917140202_f7fde489-9ae9-4ab5-85fd-591382b70891); Time taken: 0.156 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917140202_f7fde489-9ae9-4ab5-85fd-591382b70891): select</span><br><span class="line">domain,month,traffics,</span><br><span class="line">sum(traffics)over(partition by domain order by month) as totals</span><br><span class="line">from(</span><br><span class="line">select</span><br><span class="line">domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">from ods_domain_traffic_info</span><br><span class="line">group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">) as tmp</span><br><span class="line">INFO  : Query ID = double_happy_20190917140202_f7fde489-9ae9-4ab5-85fd-591382b70891</span><br><span class="line">INFO  : Total jobs = 1</span><br><span class="line">INFO  : Launching Job 1 out of 1</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0002, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0002/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0002</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:02:38,123 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:02:44,384 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.64 sec</span><br><span class="line">INFO  : 2019-09-17 14:02:50,678 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 4.26 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 4 seconds 260 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0002</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 4.26 sec   HDFS Read: 11518 HDFS Write: 92 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 4 seconds 260 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917140202_f7fde489-9ae9-4ab5-85fd-591382b70891); Time taken: 21.812 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+--------------+----------+-----------+---------+--+</span><br><span class="line">|    domain    |  month   | traffics  | totals  |</span><br><span class="line">+--------------+----------+-----------+---------+--+</span><br><span class="line">| gifshow.com  | 2019-01  | 11        | 11      |</span><br><span class="line">| gifshow.com  | 2019-02  | 15        | 26      |</span><br><span class="line">| huya.com     | 2019-01  | 1         | 1       |</span><br><span class="line">| yy.com       | 2019-01  | 9         | 9       |</span><br><span class="line">+--------------+----------+-----------+---------+--+</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">也可以这样的 ：不生成新的列：</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; domain,month,</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; sum(traffics)over(partition by domain order by month) as traffics</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from(</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; select </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_domain_traffic_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; ) as tmp;</span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917140505_20c693e7-e3af-4233-966a-94cdfc50388d): select</span><br><span class="line">domain,month,</span><br><span class="line">sum(traffics)over(partition by domain order by month) as traffics</span><br><span class="line">from(</span><br><span class="line">select</span><br><span class="line">domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">from ods_domain_traffic_info</span><br><span class="line">group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">) as tmp</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:domain, type:string, comment:null), FieldSchema(name:month, type:string, comment:null), FieldSchema(name:traffics, type:bigint, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917140505_20c693e7-e3af-4233-966a-94cdfc50388d); Time taken: 0.05 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917140505_20c693e7-e3af-4233-966a-94cdfc50388d): select</span><br><span class="line">domain,month,</span><br><span class="line">sum(traffics)over(partition by domain order by month) as traffics</span><br><span class="line">from(</span><br><span class="line">select</span><br><span class="line">domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">from ods_domain_traffic_info</span><br><span class="line">group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">) as tmp</span><br><span class="line">INFO  : Query ID = double_happy_20190917140505_20c693e7-e3af-4233-966a-94cdfc50388d</span><br><span class="line">INFO  : Total jobs = 1</span><br><span class="line">INFO  : Launching Job 1 out of 1</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0003, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0003/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0003</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:05:17,501 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:05:22,722 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.47 sec</span><br><span class="line">INFO  : 2019-09-17 14:05:29,989 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 3.97 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 3 seconds 970 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0003</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 3.97 sec   HDFS Read: 11443 HDFS Write: 82 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 3 seconds 970 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917140505_20c693e7-e3af-4233-966a-94cdfc50388d); Time taken: 21.456 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+--------------+----------+-----------+--+</span><br><span class="line">|    domain    |  month   | traffics  |</span><br><span class="line">+--------------+----------+-----------+--+</span><br><span class="line">| gifshow.com  | 2019-01  | 11        |</span><br><span class="line">| gifshow.com  | 2019-02  | 26        |</span><br><span class="line">| huya.com     | 2019-01  | 1         |</span><br><span class="line">| yy.com       | 2019-01  | 9         |</span><br><span class="line">+--------------+----------+-----------+--+</span><br></pre></td></tr></table></figure></div>


<h2 id="SQL2"><a href="#SQL2" class="headerlink" title="SQL2"></a>SQL2</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL2:</span><br><span class="line">uid pid</span><br><span class="line">user1 a</span><br><span class="line">user2 b</span><br><span class="line">user1 c</span><br><span class="line">user2 c</span><br><span class="line">user3 c</span><br><span class="line">user3 c</span><br><span class="line">1）uv  ==&gt; uid cnt  应该是pid 有多少uid 访问 统计 uid个数  , 或者反过来？？</span><br><span class="line">2）统计每个产品top3的用户信息 ==&gt;  pid  uid  cnt</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">思路：</span><br><span class="line">（1）这块有歧义 那么两个都做一下</span><br><span class="line">	pid 有多少uid ？ 每个pid 有多少个 uid  ==》 pid + uid </span><br><span class="line">1. group by pid +count(distinct(uid))   要去重的 </span><br><span class="line">    uid访问pid的个数？  每个uid  + pid</span><br><span class="line"> a. group by uid  + count(distinct(pid))   要对pid去重</span><br><span class="line"></span><br><span class="line">这题比较简单 就是以谁分组 count 去重后的谁</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">结果展示： 因为我就造了3个pid  abc 100个user</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select uid ,count(distinct(pid)) as cnt</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_uid_pid_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by uid;</span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917141414_3c87306d-3ebd-49b1-9371-8fdba5629b97): select uid ,count(distinct(pid)) as cnt</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by uid</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:uid, type:string, comment:null), FieldSchema(name:cnt, type:bigint, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917141414_3c87306d-3ebd-49b1-9371-8fdba5629b97); Time taken: 0.055 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917141414_3c87306d-3ebd-49b1-9371-8fdba5629b97): select uid ,count(distinct(pid)) as cnt</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by uid</span><br><span class="line">INFO  : Query ID = double_happy_20190917141414_3c87306d-3ebd-49b1-9371-8fdba5629b97</span><br><span class="line">INFO  : Total jobs = 1</span><br><span class="line">INFO  : Launching Job 1 out of 1</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0004, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0004/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0004</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:14:52,471 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:14:57,670 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.05 sec</span><br><span class="line">INFO  : 2019-09-17 14:15:03,926 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 2.69 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 2 seconds 690 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0004</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 2.69 sec   HDFS Read: 17780 HDFS Write: 846 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 2 seconds 690 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917141414_3c87306d-3ebd-49b1-9371-8fdba5629b97); Time taken: 19.383 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+----------+------+--+</span><br><span class="line">|   uid    | cnt  |</span><br><span class="line">+----------+------+--+</span><br><span class="line">| user0    | 1    |</span><br><span class="line">| user1    | 3    |</span><br><span class="line">| user10   | 3    |</span><br><span class="line">| user100  | 3    |</span><br><span class="line">| user11   | 3    |</span><br><span class="line">| user12   | 3    |</span><br><span class="line">| user13   | 3    |</span><br><span class="line">| user14   | 3    |</span><br><span class="line">| user15   | 3    |</span><br><span class="line">| user16   | 3    |</span><br><span class="line">| user17   | 3    |</span><br><span class="line">| user18   | 1    |</span><br><span class="line">| user19   | 2    |</span><br><span class="line">| user2    | 3    |</span><br><span class="line">| user20   | 3    |</span><br><span class="line">| user21   | 3    |</span><br><span class="line">| user22   | 3    |</span><br><span class="line">| user24   | 3    |</span><br><span class="line">| user25   | 3    |</span><br><span class="line">| user26   | 3    |</span><br><span class="line">| user27   | 3    |</span><br><span class="line">| user28   | 3    |</span><br><span class="line">| user29   | 3    |</span><br><span class="line">| user3    | 3    |</span><br><span class="line">| user30   | 3    |</span><br><span class="line">| user31   | 2    |</span><br><span class="line">| user32   | 3    |</span><br><span class="line">| user33   | 3    |</span><br><span class="line">| user34   | 3    |</span><br><span class="line">| user36   | 2    |</span><br><span class="line">| user37   | 3    |</span><br><span class="line">| user38   | 3    |</span><br><span class="line">| user39   | 1    |</span><br><span class="line">| user4    | 3    |</span><br><span class="line">| user41   | 3    |</span><br><span class="line">| user42   | 1    |</span><br><span class="line">| user43   | 1    |</span><br><span class="line">| user44   | 3    |</span><br><span class="line">| user45   | 3    |</span><br><span class="line">| user46   | 3    |</span><br><span class="line">| user47   | 2    |</span><br><span class="line">| user48   | 3    |</span><br><span class="line">| user49   | 2    |</span><br><span class="line">| user5    | 3    |</span><br><span class="line">| user50   | 3    |</span><br><span class="line">| user51   | 3    |</span><br><span class="line">| user52   | 3    |</span><br><span class="line">| user54   | 3    |</span><br><span class="line">| user55   | 3    |</span><br><span class="line">| user57   | 1    |</span><br><span class="line">| user58   | 3    |</span><br><span class="line">| user59   | 2    |</span><br><span class="line">| user6    | 3    |</span><br><span class="line">| user60   | 1    |</span><br><span class="line">| user61   | 3    |</span><br><span class="line">| user62   | 3    |</span><br><span class="line">| user63   | 3    |</span><br><span class="line">| user64   | 3    |</span><br><span class="line">| user65   | 2    |</span><br><span class="line">| user66   | 3    |</span><br><span class="line">| user67   | 3    |</span><br><span class="line">| user68   | 1    |</span><br><span class="line">| user69   | 2    |</span><br><span class="line">| user7    | 3    |</span><br><span class="line">| user70   | 3    |</span><br><span class="line">| user71   | 3    |</span><br><span class="line">| user72   | 1    |</span><br><span class="line">| user73   | 3    |</span><br><span class="line">| user74   | 3    |</span><br><span class="line">| user75   | 3    |</span><br><span class="line">| user76   | 2    |</span><br><span class="line">| user77   | 3    |</span><br><span class="line">| user78   | 3    |</span><br><span class="line">| user79   | 3    |</span><br><span class="line">| user8    | 3    |</span><br><span class="line">| user80   | 3    |</span><br><span class="line">| user81   | 3    |</span><br><span class="line">| user82   | 1    |</span><br><span class="line">| user83   | 3    |</span><br><span class="line">| user84   | 1    |</span><br><span class="line">| user85   | 3    |</span><br><span class="line">| user86   | 3    |</span><br><span class="line">| user87   | 3    |</span><br><span class="line">| user88   | 3    |</span><br><span class="line">| user9    | 3    |</span><br><span class="line">| user90   | 3    |</span><br><span class="line">| user91   | 3    |</span><br><span class="line">| user92   | 3    |</span><br><span class="line">| user93   | 2    |</span><br><span class="line">| user94   | 3    |</span><br><span class="line">| user95   | 3    |</span><br><span class="line">| user96   | 3    |</span><br><span class="line">| user97   | 3    |</span><br><span class="line">| user98   | 3    |</span><br><span class="line">| user99   | 3    |</span><br><span class="line">+----------+------+--+</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">（2）统计每个产品top3的用户信息 ==&gt;  pid  uid  cnt</span><br><span class="line"></span><br><span class="line">思路：</span><br><span class="line">1.pid  uid  cnt  top3</span><br><span class="line">意思是 每个pid  每个uid 的  访问次数 并 取出 top3</span><br><span class="line">分两步：</span><br><span class="line"></span><br><span class="line">step1：每个pid  每个uid 的  访问次数</span><br><span class="line">step2：基于step1 取出 top3</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">step1：每个pid  每个uid 的  访问次数</span><br><span class="line">group by（pid + uid)  + count（uid）    (group by 是有去重的哈 不难理解吧)</span><br><span class="line"></span><br><span class="line">tmp:</span><br><span class="line">	select pid,uid,count(uid) as count </span><br><span class="line">	from ods_uid_pid_info</span><br><span class="line">	group by pid,uid</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">step2: 基于step1    pid,uid,count   取出 top3 </span><br><span class="line">目的 Top3 =》 基于1 要以pid进行分组以count 进行排序  生成新的列 rank （用开窗 1 对 多）</span><br><span class="line"></span><br><span class="line">这块用到开窗 rank() 或者 row_number(） + over</span><br><span class="line">paritition by 谁 ？order by 谁？</span><br><span class="line">要求的是每个产品top3的用户信息</span><br><span class="line">所以是 paritition by pid order by count    (注意哈 这个count 是step1 得到的 每个pid 每个uid 的 count)</span><br><span class="line"></span><br><span class="line">result_tmp:</span><br><span class="line">	select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">	from tmp;  //有并列的</span><br><span class="line"></span><br><span class="line">result_tmp:</span><br><span class="line">	select pid,uid,count, row_number()over(partition by pid order by count desc) as rank</span><br><span class="line">	from tmp;   //没有并列的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">step 3：基于2 进行where rank  &lt;= 3</span><br><span class="line"></span><br><span class="line">result: 两种</span><br><span class="line">	select pid,uid,count</span><br><span class="line">	from result_tmp</span><br><span class="line">	where  rank&lt;=3;</span><br></pre></td></tr></table></figure></div>


<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br></pre></td><td class="code"><pre><span class="line">step1 演示;   每个pid  每个uid 的  访问次数</span><br><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select pid,uid,count(uid) as count </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_uid_pid_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by pid,uid ;</span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917144747_4703dd87-bc51-4175-8551-b4ffcc78ed11): select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:pid, type:string, comment:null), FieldSchema(name:uid, type:string, comment:null), FieldSchema(name:count, type:bigint, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917144747_4703dd87-bc51-4175-8551-b4ffcc78ed11); Time taken: 0.046 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917144747_4703dd87-bc51-4175-8551-b4ffcc78ed11): select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">INFO  : Query ID = double_happy_20190917144747_4703dd87-bc51-4175-8551-b4ffcc78ed11</span><br><span class="line">INFO  : Total jobs = 1</span><br><span class="line">INFO  : Launching Job 1 out of 1</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0007, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0007/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0007</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:47:44,611 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:47:49,855 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.07 sec</span><br><span class="line">INFO  : 2019-09-17 14:47:56,080 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 2.46 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 2 seconds 460 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0007</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 2.46 sec   HDFS Read: 17957 HDFS Write: 2767 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 2 seconds 460 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917144747_4703dd87-bc51-4175-8551-b4ffcc78ed11); Time taken: 19.001 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+------+----------+--------+--+</span><br><span class="line">| pid  |   uid    | count  |</span><br><span class="line">+------+----------+--------+--+</span><br><span class="line">| a    | user1    | 4      |</span><br><span class="line">| a    | user10   | 2      |</span><br><span class="line">| a    | user100  | 5      |</span><br><span class="line">| a    | user11   | 8      |</span><br><span class="line">| a    | user12   | 4      |</span><br><span class="line">| a    | user13   | 3      |</span><br><span class="line">| a    | user14   | 6      |</span><br><span class="line">| a    | user15   | 11     |</span><br><span class="line">| a    | user16   | 6      |</span><br><span class="line">| a    | user17   | 5      |</span><br><span class="line">| a    | user19   | 2      |</span><br><span class="line">| a    | user2    | 2      |</span><br><span class="line">| a    | user20   | 3      |</span><br><span class="line">| a    | user21   | 1      |</span><br><span class="line">| a    | user22   | 5      |</span><br><span class="line">| a    | user24   | 7      |</span><br><span class="line">| a    | user25   | 4      |</span><br><span class="line">| a    | user26   | 6      |</span><br><span class="line">| a    | user27   | 2      |</span><br><span class="line">| a    | user28   | 1      |</span><br><span class="line">| a    | user29   | 4      |</span><br><span class="line">| a    | user3    | 3      |</span><br><span class="line">| a    | user30   | 4      |</span><br><span class="line">| a    | user31   | 5      |</span><br><span class="line">| a    | user32   | 4      |</span><br><span class="line">| a    | user33   | 2      |</span><br><span class="line">| a    | user34   | 1      |</span><br><span class="line">| a    | user36   | 1      |</span><br><span class="line">| a    | user37   | 7      |</span><br><span class="line">| a    | user38   | 5      |</span><br><span class="line">| a    | user4    | 3      |</span><br><span class="line">| a    | user41   | 1      |</span><br><span class="line">| a    | user43   | 1      |</span><br><span class="line">| a    | user44   | 2      |</span><br><span class="line">| a    | user45   | 3      |</span><br><span class="line">| a    | user46   | 2      |</span><br><span class="line">| a    | user47   | 2      |</span><br><span class="line">| a    | user48   | 2      |</span><br><span class="line">| a    | user49   | 3      |</span><br><span class="line">| a    | user5    | 10     |</span><br><span class="line">| a    | user50   | 3      |</span><br><span class="line">| a    | user51   | 4      |</span><br><span class="line">| a    | user52   | 1      |</span><br><span class="line">| a    | user54   | 9      |</span><br><span class="line">| a    | user55   | 6      |</span><br><span class="line">| a    | user58   | 1      |</span><br><span class="line">| a    | user59   | 3      |</span><br><span class="line">| a    | user6    | 3      |</span><br><span class="line">| a    | user61   | 2      |</span><br><span class="line">| a    | user62   | 11     |</span><br><span class="line">| a    | user63   | 3      |</span><br><span class="line">| a    | user64   | 4      |</span><br><span class="line">| a    | user65   | 2      |</span><br><span class="line">| a    | user66   | 3      |</span><br><span class="line">| a    | user67   | 2      |</span><br><span class="line">| a    | user69   | 2      |</span><br><span class="line">| a    | user7    | 4      |</span><br><span class="line">| a    | user70   | 3      |</span><br><span class="line">| a    | user71   | 6      |</span><br><span class="line">| a    | user72   | 2      |</span><br><span class="line">| a    | user73   | 6      |</span><br><span class="line">| a    | user74   | 2      |</span><br><span class="line">| a    | user75   | 2      |</span><br><span class="line">| a    | user76   | 2      |</span><br><span class="line">| a    | user77   | 3      |</span><br><span class="line">| a    | user78   | 7      |</span><br><span class="line">| a    | user79   | 7      |</span><br><span class="line">| a    | user8    | 1      |</span><br><span class="line">| a    | user80   | 2      |</span><br><span class="line">| a    | user81   | 6      |</span><br><span class="line">| a    | user82   | 1      |</span><br><span class="line">| a    | user83   | 5      |</span><br><span class="line">| a    | user85   | 3      |</span><br><span class="line">| a    | user86   | 5      |</span><br><span class="line">| a    | user87   | 8      |</span><br><span class="line">| a    | user88   | 5      |</span><br><span class="line">| a    | user9    | 1      |</span><br><span class="line">| a    | user90   | 2      |</span><br><span class="line">| a    | user91   | 4      |</span><br><span class="line">| a    | user92   | 2      |</span><br><span class="line">| a    | user93   | 1      |</span><br><span class="line">| a    | user94   | 6      |</span><br><span class="line">| a    | user95   | 2      |</span><br><span class="line">| a    | user96   | 6      |</span><br><span class="line">| a    | user97   | 6      |</span><br><span class="line">| a    | user98   | 3      |</span><br><span class="line">| a    | user99   | 4      |</span><br><span class="line">| b    | user0    | 2      |</span><br><span class="line">| b    | user1    | 7      |</span><br><span class="line">| b    | user10   | 1      |</span><br><span class="line">| b    | user100  | 4      |</span><br><span class="line">| b    | user11   | 6      |</span><br><span class="line">| b    | user12   | 3      |</span><br><span class="line">| b    | user13   | 4      |</span><br><span class="line">| b    | user14   | 4      |</span><br><span class="line">| b    | user15   | 9      |</span><br><span class="line">| b    | user16   | 6      |</span><br><span class="line">| b    | user17   | 4      |</span><br><span class="line">| b    | user19   | 6      |</span><br><span class="line">| b    | user2    | 5      |</span><br><span class="line">+------+----------+--------+--+</span><br><span class="line">| pid  |   uid    | count  |</span><br><span class="line">+------+----------+--------+--+</span><br><span class="line">| b    | user20   | 1      |</span><br><span class="line">| b    | user21   | 8      |</span><br><span class="line">| b    | user22   | 8      |</span><br><span class="line">| b    | user24   | 2      |</span><br><span class="line">| b    | user25   | 1      |</span><br><span class="line">| b    | user26   | 7      |</span><br><span class="line">| b    | user27   | 2      |</span><br><span class="line">| b    | user28   | 2      |</span><br><span class="line">| b    | user29   | 4      |</span><br><span class="line">| b    | user3    | 8      |</span><br><span class="line">| b    | user30   | 3      |</span><br><span class="line">| b    | user32   | 3      |</span><br><span class="line">| b    | user33   | 2      |</span><br><span class="line">| b    | user34   | 4      |</span><br><span class="line">| b    | user36   | 1      |</span><br><span class="line">| b    | user37   | 10     |</span><br><span class="line">| b    | user38   | 3      |</span><br><span class="line">| b    | user4    | 5      |</span><br><span class="line">| b    | user41   | 1      |</span><br><span class="line">| b    | user44   | 1      |</span><br><span class="line">| b    | user45   | 1      |</span><br><span class="line">| b    | user46   | 2      |</span><br><span class="line">| b    | user47   | 1      |</span><br><span class="line">| b    | user48   | 7      |</span><br><span class="line">| b    | user49   | 2      |</span><br><span class="line">| b    | user5    | 8      |</span><br><span class="line">| b    | user50   | 6      |</span><br><span class="line">| b    | user51   | 7      |</span><br><span class="line">| b    | user52   | 3      |</span><br><span class="line">| b    | user54   | 2      |</span><br><span class="line">| b    | user55   | 1      |</span><br><span class="line">| b    | user58   | 5      |</span><br><span class="line">| b    | user59   | 1      |</span><br><span class="line">| b    | user6    | 1      |</span><br><span class="line">| b    | user60   | 4      |</span><br><span class="line">| b    | user61   | 10     |</span><br><span class="line">| b    | user62   | 4      |</span><br><span class="line">| b    | user63   | 4      |</span><br><span class="line">| b    | user64   | 1      |</span><br><span class="line">| b    | user65   | 1      |</span><br><span class="line">| b    | user66   | 7      |</span><br><span class="line">| b    | user67   | 1      |</span><br><span class="line">| b    | user68   | 1      |</span><br><span class="line">| b    | user69   | 8      |</span><br><span class="line">| b    | user7    | 8      |</span><br><span class="line">| b    | user70   | 3      |</span><br><span class="line">| b    | user71   | 4      |</span><br><span class="line">| b    | user73   | 5      |</span><br><span class="line">| b    | user74   | 1      |</span><br><span class="line">| b    | user75   | 3      |</span><br><span class="line">| b    | user77   | 8      |</span><br><span class="line">| b    | user78   | 2      |</span><br><span class="line">| b    | user79   | 9      |</span><br><span class="line">| b    | user8    | 1      |</span><br><span class="line">| b    | user80   | 6      |</span><br><span class="line">| b    | user81   | 6      |</span><br><span class="line">| b    | user83   | 3      |</span><br><span class="line">| b    | user84   | 4      |</span><br><span class="line">| b    | user85   | 6      |</span><br><span class="line">| b    | user86   | 5      |</span><br><span class="line">| b    | user87   | 6      |</span><br><span class="line">| b    | user88   | 4      |</span><br><span class="line">| b    | user9    | 1      |</span><br><span class="line">| b    | user90   | 4      |</span><br><span class="line">| b    | user91   | 2      |</span><br><span class="line">| b    | user92   | 5      |</span><br><span class="line">| b    | user94   | 3      |</span><br><span class="line">| b    | user95   | 3      |</span><br><span class="line">| b    | user96   | 4      |</span><br><span class="line">| b    | user97   | 7      |</span><br><span class="line">| b    | user98   | 3      |</span><br><span class="line">| b    | user99   | 3      |</span><br><span class="line">| c    | user1    | 5      |</span><br><span class="line">| c    | user10   | 7      |</span><br><span class="line">| c    | user100  | 2      |</span><br><span class="line">| c    | user11   | 4      |</span><br><span class="line">| c    | user12   | 5      |</span><br><span class="line">| c    | user13   | 3      |</span><br><span class="line">| c    | user14   | 2      |</span><br><span class="line">| c    | user15   | 6      |</span><br><span class="line">| c    | user16   | 3      |</span><br><span class="line">| c    | user17   | 3      |</span><br><span class="line">| c    | user18   | 1      |</span><br><span class="line">| c    | user2    | 2      |</span><br><span class="line">| c    | user20   | 2      |</span><br><span class="line">| c    | user21   | 4      |</span><br><span class="line">| c    | user22   | 4      |</span><br><span class="line">| c    | user24   | 4      |</span><br><span class="line">| c    | user25   | 4      |</span><br><span class="line">| c    | user26   | 6      |</span><br><span class="line">| c    | user27   | 4      |</span><br><span class="line">| c    | user28   | 1      |</span><br><span class="line">| c    | user29   | 7      |</span><br><span class="line">| c    | user3    | 3      |</span><br><span class="line">| c    | user30   | 1      |</span><br><span class="line">| c    | user31   | 1      |</span><br><span class="line">| c    | user32   | 3      |</span><br><span class="line">| c    | user33   | 1      |</span><br><span class="line">| c    | user34   | 2      |</span><br><span class="line">| c    | user37   | 6      |</span><br><span class="line">+------+----------+--------+--+</span><br><span class="line">| pid  |   uid    | count  |</span><br><span class="line">+------+----------+--------+--+</span><br><span class="line">| c    | user38   | 6      |</span><br><span class="line">| c    | user39   | 2      |</span><br><span class="line">| c    | user4    | 9      |</span><br><span class="line">| c    | user41   | 2      |</span><br><span class="line">| c    | user42   | 2      |</span><br><span class="line">| c    | user44   | 1      |</span><br><span class="line">| c    | user45   | 3      |</span><br><span class="line">| c    | user46   | 3      |</span><br><span class="line">| c    | user48   | 6      |</span><br><span class="line">| c    | user5    | 9      |</span><br><span class="line">| c    | user50   | 6      |</span><br><span class="line">| c    | user51   | 8      |</span><br><span class="line">| c    | user52   | 4      |</span><br><span class="line">| c    | user54   | 3      |</span><br><span class="line">| c    | user55   | 2      |</span><br><span class="line">| c    | user57   | 1      |</span><br><span class="line">| c    | user58   | 2      |</span><br><span class="line">| c    | user6    | 1      |</span><br><span class="line">| c    | user61   | 6      |</span><br><span class="line">| c    | user62   | 4      |</span><br><span class="line">| c    | user63   | 3      |</span><br><span class="line">| c    | user64   | 2      |</span><br><span class="line">| c    | user66   | 13     |</span><br><span class="line">| c    | user67   | 4      |</span><br><span class="line">| c    | user7    | 10     |</span><br><span class="line">| c    | user70   | 5      |</span><br><span class="line">| c    | user71   | 6      |</span><br><span class="line">| c    | user73   | 7      |</span><br><span class="line">| c    | user74   | 4      |</span><br><span class="line">| c    | user75   | 4      |</span><br><span class="line">| c    | user76   | 1      |</span><br><span class="line">| c    | user77   | 6      |</span><br><span class="line">| c    | user78   | 3      |</span><br><span class="line">| c    | user79   | 7      |</span><br><span class="line">| c    | user8    | 2      |</span><br><span class="line">| c    | user80   | 2      |</span><br><span class="line">| c    | user81   | 11     |</span><br><span class="line">| c    | user83   | 2      |</span><br><span class="line">| c    | user85   | 2      |</span><br><span class="line">| c    | user86   | 5      |</span><br><span class="line">| c    | user87   | 4      |</span><br><span class="line">| c    | user88   | 4      |</span><br><span class="line">| c    | user9    | 1      |</span><br><span class="line">| c    | user90   | 4      |</span><br><span class="line">| c    | user91   | 2      |</span><br><span class="line">| c    | user92   | 4      |</span><br><span class="line">| c    | user93   | 1      |</span><br><span class="line">| c    | user94   | 12     |</span><br><span class="line">| c    | user95   | 3      |</span><br><span class="line">| c    | user96   | 4      |</span><br><span class="line">| c    | user97   | 6      |</span><br><span class="line">| c    | user98   | 3      |</span><br><span class="line">| c    | user99   | 5      |</span><br><span class="line">+------+----------+--------+--+</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br></pre></td><td class="code"><pre><span class="line">step2:目的 Top3 =》 基于1 要以pid进行分组以count 进行排序  生成新的列 rank</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from(</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; select pid,uid,count(uid) as count </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_uid_pid_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by pid,uid </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; )as tmp;  </span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917144949_8fd22282-a9be-4e95-aa2a-b98121f6354d): select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">)as tmp</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:pid, type:string, comment:null), FieldSchema(name:uid, type:string, comment:null), FieldSchema(name:count, type:bigint, comment:null), FieldSchema(name:rank, type:int, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917144949_8fd22282-a9be-4e95-aa2a-b98121f6354d); Time taken: 0.054 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917144949_8fd22282-a9be-4e95-aa2a-b98121f6354d): select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">)as tmp</span><br><span class="line">INFO  : Query ID = double_happy_20190917144949_8fd22282-a9be-4e95-aa2a-b98121f6354d</span><br><span class="line">INFO  : Total jobs = 2</span><br><span class="line">INFO  : Launching Job 1 out of 2</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0008, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0008/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0008</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:49:58,539 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:50:03,879 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.05 sec</span><br><span class="line">INFO  : 2019-09-17 14:50:10,134 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 2.98 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 2 seconds 980 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0008</span><br><span class="line">INFO  : Launching Job 2 out of 2</span><br><span class="line">INFO  : Starting task [Stage-2:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0009, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0009/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0009</span><br><span class="line">INFO  : Hadoop job information for Stage-2: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:50:17,507 Stage-2 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:50:23,732 Stage-2 map = 100%,  reduce = 0%, Cumulative CPU 0.94 sec</span><br><span class="line">INFO  : 2019-09-17 14:50:29,976 Stage-2 map = 100%,  reduce = 100%, Cumulative CPU 3.39 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 3 seconds 390 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0009</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 2.98 sec   HDFS Read: 17068 HDFS Write: 6962 SUCCESS</span><br><span class="line">INFO  : Stage-Stage-2: Map: 1  Reduce: 1   Cumulative CPU: 3.39 sec   HDFS Read: 14419 HDFS Write: 3494 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 6 seconds 370 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917144949_8fd22282-a9be-4e95-aa2a-b98121f6354d); Time taken: 39.409 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+------+----------+--------+-------+--+</span><br><span class="line">| pid  |   uid    | count  | rank  |</span><br><span class="line">+------+----------+--------+-------+--+</span><br><span class="line">| a    | user15   | 11     | 1     |</span><br><span class="line">| a    | user62   | 11     | 1     |</span><br><span class="line">| a    | user5    | 10     | 3     |</span><br><span class="line">| a    | user54   | 9      | 4     |</span><br><span class="line">| a    | user87   | 8      | 5     |</span><br><span class="line">| a    | user11   | 8      | 5     |</span><br><span class="line">| a    | user37   | 7      | 7     |</span><br><span class="line">| a    | user24   | 7      | 7     |</span><br><span class="line">| a    | user78   | 7      | 7     |</span><br><span class="line">| a    | user79   | 7      | 7     |</span><br><span class="line">| a    | user55   | 6      | 11    |</span><br><span class="line">| a    | user96   | 6      | 11    |</span><br><span class="line">| a    | user94   | 6      | 11    |</span><br><span class="line">| a    | user16   | 6      | 11    |</span><br><span class="line">| a    | user81   | 6      | 11    |</span><br><span class="line">| a    | user26   | 6      | 11    |</span><br><span class="line">| a    | user97   | 6      | 11    |</span><br><span class="line">| a    | user71   | 6      | 11    |</span><br><span class="line">| a    | user14   | 6      | 11    |</span><br><span class="line">| a    | user73   | 6      | 11    |</span><br><span class="line">| a    | user86   | 5      | 21    |</span><br><span class="line">| a    | user38   | 5      | 21    |</span><br><span class="line">| a    | user88   | 5      | 21    |</span><br><span class="line">| a    | user22   | 5      | 21    |</span><br><span class="line">| a    | user83   | 5      | 21    |</span><br><span class="line">| a    | user31   | 5      | 21    |</span><br><span class="line">| a    | user100  | 5      | 21    |</span><br><span class="line">| a    | user17   | 5      | 21    |</span><br><span class="line">| a    | user12   | 4      | 29    |</span><br><span class="line">| a    | user7    | 4      | 29    |</span><br><span class="line">| a    | user25   | 4      | 29    |</span><br><span class="line">| a    | user29   | 4      | 29    |</span><br><span class="line">| a    | user30   | 4      | 29    |</span><br><span class="line">| a    | user32   | 4      | 29    |</span><br><span class="line">| a    | user99   | 4      | 29    |</span><br><span class="line">| a    | user91   | 4      | 29    |</span><br><span class="line">| a    | user51   | 4      | 29    |</span><br><span class="line">| a    | user64   | 4      | 29    |</span><br><span class="line">| a    | user1    | 4      | 29    |</span><br><span class="line">| a    | user4    | 3      | 40    |</span><br><span class="line">| a    | user50   | 3      | 40    |</span><br><span class="line">| a    | user66   | 3      | 40    |</span><br><span class="line">| a    | user3    | 3      | 40    |</span><br><span class="line">| a    | user85   | 3      | 40    |</span><br><span class="line">| a    | user77   | 3      | 40    |</span><br><span class="line">| a    | user98   | 3      | 40    |</span><br><span class="line">| a    | user59   | 3      | 40    |</span><br><span class="line">| a    | user6    | 3      | 40    |</span><br><span class="line">| a    | user20   | 3      | 40    |</span><br><span class="line">| a    | user70   | 3      | 40    |</span><br><span class="line">| a    | user63   | 3      | 40    |</span><br><span class="line">| a    | user45   | 3      | 40    |</span><br><span class="line">| a    | user13   | 3      | 40    |</span><br><span class="line">| a    | user49   | 3      | 40    |</span><br><span class="line">| a    | user65   | 2      | 55    |</span><br><span class="line">| a    | user19   | 2      | 55    |</span><br><span class="line">| a    | user2    | 2      | 55    |</span><br><span class="line">| a    | user27   | 2      | 55    |</span><br><span class="line">| a    | user33   | 2      | 55    |</span><br><span class="line">| a    | user44   | 2      | 55    |</span><br><span class="line">| a    | user46   | 2      | 55    |</span><br><span class="line">| a    | user47   | 2      | 55    |</span><br><span class="line">| a    | user48   | 2      | 55    |</span><br><span class="line">| a    | user61   | 2      | 55    |</span><br><span class="line">| a    | user67   | 2      | 55    |</span><br><span class="line">| a    | user69   | 2      | 55    |</span><br><span class="line">| a    | user72   | 2      | 55    |</span><br><span class="line">| a    | user74   | 2      | 55    |</span><br><span class="line">| a    | user75   | 2      | 55    |</span><br><span class="line">| a    | user76   | 2      | 55    |</span><br><span class="line">| a    | user80   | 2      | 55    |</span><br><span class="line">| a    | user90   | 2      | 55    |</span><br><span class="line">| a    | user92   | 2      | 55    |</span><br><span class="line">| a    | user95   | 2      | 55    |</span><br><span class="line">| a    | user10   | 2      | 55    |</span><br><span class="line">| a    | user52   | 1      | 76    |</span><br><span class="line">| a    | user9    | 1      | 76    |</span><br><span class="line">| a    | user41   | 1      | 76    |</span><br><span class="line">| a    | user93   | 1      | 76    |</span><br><span class="line">| a    | user36   | 1      | 76    |</span><br><span class="line">| a    | user34   | 1      | 76    |</span><br><span class="line">| a    | user28   | 1      | 76    |</span><br><span class="line">| a    | user21   | 1      | 76    |</span><br><span class="line">| a    | user43   | 1      | 76    |</span><br><span class="line">| a    | user82   | 1      | 76    |</span><br><span class="line">| a    | user8    | 1      | 76    |</span><br><span class="line">| a    | user58   | 1      | 76    |</span><br><span class="line">| b    | user37   | 10     | 1     |</span><br><span class="line">| b    | user61   | 10     | 1     |</span><br><span class="line">| b    | user15   | 9      | 3     |</span><br><span class="line">| b    | user79   | 9      | 3     |</span><br><span class="line">| b    | user7    | 8      | 5     |</span><br><span class="line">| b    | user21   | 8      | 5     |</span><br><span class="line">| b    | user22   | 8      | 5     |</span><br><span class="line">| b    | user69   | 8      | 5     |</span><br><span class="line">| b    | user5    | 8      | 5     |</span><br><span class="line">| b    | user3    | 8      | 5     |</span><br><span class="line">| b    | user77   | 8      | 5     |</span><br><span class="line">| b    | user51   | 7      | 12    |</span><br><span class="line">| b    | user48   | 7      | 12    |</span><br><span class="line">+------+----------+--------+-------+--+</span><br><span class="line">| pid  |   uid    | count  | rank  |</span><br><span class="line">+------+----------+--------+-------+--+</span><br><span class="line">| b    | user26   | 7      | 12    |</span><br><span class="line">| b    | user97   | 7      | 12    |</span><br><span class="line">| b    | user66   | 7      | 12    |</span><br><span class="line">| b    | user1    | 7      | 12    |</span><br><span class="line">| b    | user50   | 6      | 18    |</span><br><span class="line">| b    | user87   | 6      | 18    |</span><br><span class="line">| b    | user85   | 6      | 18    |</span><br><span class="line">| b    | user81   | 6      | 18    |</span><br><span class="line">| b    | user80   | 6      | 18    |</span><br><span class="line">| b    | user19   | 6      | 18    |</span><br><span class="line">| b    | user16   | 6      | 18    |</span><br><span class="line">| b    | user11   | 6      | 18    |</span><br><span class="line">| b    | user2    | 5      | 26    |</span><br><span class="line">| b    | user92   | 5      | 26    |</span><br><span class="line">| b    | user58   | 5      | 26    |</span><br><span class="line">| b    | user73   | 5      | 26    |</span><br><span class="line">| b    | user4    | 5      | 26    |</span><br><span class="line">| b    | user86   | 5      | 26    |</span><br><span class="line">| b    | user88   | 4      | 32    |</span><br><span class="line">| b    | user71   | 4      | 32    |</span><br><span class="line">| b    | user29   | 4      | 32    |</span><br><span class="line">| b    | user84   | 4      | 32    |</span><br><span class="line">| b    | user13   | 4      | 32    |</span><br><span class="line">| b    | user17   | 4      | 32    |</span><br><span class="line">| b    | user100  | 4      | 32    |</span><br><span class="line">| b    | user34   | 4      | 32    |</span><br><span class="line">| b    | user14   | 4      | 32    |</span><br><span class="line">| b    | user96   | 4      | 32    |</span><br><span class="line">| b    | user90   | 4      | 32    |</span><br><span class="line">| b    | user63   | 4      | 32    |</span><br><span class="line">| b    | user62   | 4      | 32    |</span><br><span class="line">| b    | user60   | 4      | 32    |</span><br><span class="line">| b    | user12   | 3      | 46    |</span><br><span class="line">| b    | user99   | 3      | 46    |</span><br><span class="line">| b    | user94   | 3      | 46    |</span><br><span class="line">| b    | user95   | 3      | 46    |</span><br><span class="line">| b    | user98   | 3      | 46    |</span><br><span class="line">| b    | user75   | 3      | 46    |</span><br><span class="line">| b    | user83   | 3      | 46    |</span><br><span class="line">| b    | user52   | 3      | 46    |</span><br><span class="line">| b    | user32   | 3      | 46    |</span><br><span class="line">| b    | user30   | 3      | 46    |</span><br><span class="line">| b    | user70   | 3      | 46    |</span><br><span class="line">| b    | user38   | 3      | 46    |</span><br><span class="line">| b    | user54   | 2      | 58    |</span><br><span class="line">| b    | user28   | 2      | 58    |</span><br><span class="line">| b    | user27   | 2      | 58    |</span><br><span class="line">| b    | user49   | 2      | 58    |</span><br><span class="line">| b    | user46   | 2      | 58    |</span><br><span class="line">| b    | user24   | 2      | 58    |</span><br><span class="line">| b    | user33   | 2      | 58    |</span><br><span class="line">| b    | user0    | 2      | 58    |</span><br><span class="line">| b    | user91   | 2      | 58    |</span><br><span class="line">| b    | user78   | 2      | 58    |</span><br><span class="line">| b    | user67   | 1      | 68    |</span><br><span class="line">| b    | user65   | 1      | 68    |</span><br><span class="line">| b    | user64   | 1      | 68    |</span><br><span class="line">| b    | user6    | 1      | 68    |</span><br><span class="line">| b    | user59   | 1      | 68    |</span><br><span class="line">| b    | user55   | 1      | 68    |</span><br><span class="line">| b    | user74   | 1      | 68    |</span><br><span class="line">| b    | user8    | 1      | 68    |</span><br><span class="line">| b    | user47   | 1      | 68    |</span><br><span class="line">| b    | user45   | 1      | 68    |</span><br><span class="line">| b    | user44   | 1      | 68    |</span><br><span class="line">| b    | user41   | 1      | 68    |</span><br><span class="line">| b    | user36   | 1      | 68    |</span><br><span class="line">| b    | user25   | 1      | 68    |</span><br><span class="line">| b    | user9    | 1      | 68    |</span><br><span class="line">| b    | user20   | 1      | 68    |</span><br><span class="line">| b    | user10   | 1      | 68    |</span><br><span class="line">| b    | user68   | 1      | 68    |</span><br><span class="line">| c    | user66   | 13     | 1     |</span><br><span class="line">| c    | user94   | 12     | 2     |</span><br><span class="line">| c    | user81   | 11     | 3     |</span><br><span class="line">| c    | user7    | 10     | 4     |</span><br><span class="line">| c    | user5    | 9      | 5     |</span><br><span class="line">| c    | user4    | 9      | 5     |</span><br><span class="line">| c    | user51   | 8      | 7     |</span><br><span class="line">| c    | user79   | 7      | 8     |</span><br><span class="line">| c    | user10   | 7      | 8     |</span><br><span class="line">| c    | user73   | 7      | 8     |</span><br><span class="line">| c    | user29   | 7      | 8     |</span><br><span class="line">| c    | user38   | 6      | 12    |</span><br><span class="line">| c    | user37   | 6      | 12    |</span><br><span class="line">| c    | user97   | 6      | 12    |</span><br><span class="line">| c    | user15   | 6      | 12    |</span><br><span class="line">| c    | user77   | 6      | 12    |</span><br><span class="line">| c    | user61   | 6      | 12    |</span><br><span class="line">| c    | user50   | 6      | 12    |</span><br><span class="line">| c    | user26   | 6      | 12    |</span><br><span class="line">| c    | user48   | 6      | 12    |</span><br><span class="line">| c    | user71   | 6      | 12    |</span><br><span class="line">| c    | user99   | 5      | 22    |</span><br><span class="line">| c    | user12   | 5      | 22    |</span><br><span class="line">| c    | user1    | 5      | 22    |</span><br><span class="line">| c    | user70   | 5      | 22    |</span><br><span class="line">| c    | user86   | 5      | 22    |</span><br><span class="line">| c    | user75   | 4      | 27    |</span><br><span class="line">| c    | user87   | 4      | 27    |</span><br><span class="line">+------+----------+--------+-------+--+</span><br><span class="line">| pid  |   uid    | count  | rank  |</span><br><span class="line">+------+----------+--------+-------+--+</span><br><span class="line">| c    | user74   | 4      | 27    |</span><br><span class="line">| c    | user67   | 4      | 27    |</span><br><span class="line">| c    | user21   | 4      | 27    |</span><br><span class="line">| c    | user62   | 4      | 27    |</span><br><span class="line">| c    | user88   | 4      | 27    |</span><br><span class="line">| c    | user96   | 4      | 27    |</span><br><span class="line">| c    | user92   | 4      | 27    |</span><br><span class="line">| c    | user90   | 4      | 27    |</span><br><span class="line">| c    | user27   | 4      | 27    |</span><br><span class="line">| c    | user25   | 4      | 27    |</span><br><span class="line">| c    | user24   | 4      | 27    |</span><br><span class="line">| c    | user22   | 4      | 27    |</span><br><span class="line">| c    | user52   | 4      | 27    |</span><br><span class="line">| c    | user11   | 4      | 27    |</span><br><span class="line">| c    | user63   | 3      | 43    |</span><br><span class="line">| c    | user45   | 3      | 43    |</span><br><span class="line">| c    | user95   | 3      | 43    |</span><br><span class="line">| c    | user46   | 3      | 43    |</span><br><span class="line">| c    | user32   | 3      | 43    |</span><br><span class="line">| c    | user54   | 3      | 43    |</span><br><span class="line">| c    | user3    | 3      | 43    |</span><br><span class="line">| c    | user98   | 3      | 43    |</span><br><span class="line">| c    | user17   | 3      | 43    |</span><br><span class="line">| c    | user16   | 3      | 43    |</span><br><span class="line">| c    | user78   | 3      | 43    |</span><br><span class="line">| c    | user13   | 3      | 43    |</span><br><span class="line">| c    | user83   | 2      | 55    |</span><br><span class="line">| c    | user85   | 2      | 55    |</span><br><span class="line">| c    | user58   | 2      | 55    |</span><br><span class="line">| c    | user55   | 2      | 55    |</span><br><span class="line">| c    | user42   | 2      | 55    |</span><br><span class="line">| c    | user100  | 2      | 55    |</span><br><span class="line">| c    | user91   | 2      | 55    |</span><br><span class="line">| c    | user14   | 2      | 55    |</span><br><span class="line">| c    | user8    | 2      | 55    |</span><br><span class="line">| c    | user80   | 2      | 55    |</span><br><span class="line">| c    | user39   | 2      | 55    |</span><br><span class="line">| c    | user64   | 2      | 55    |</span><br><span class="line">| c    | user20   | 2      | 55    |</span><br><span class="line">| c    | user41   | 2      | 55    |</span><br><span class="line">| c    | user2    | 2      | 55    |</span><br><span class="line">| c    | user34   | 2      | 55    |</span><br><span class="line">| c    | user18   | 1      | 71    |</span><br><span class="line">| c    | user30   | 1      | 71    |</span><br><span class="line">| c    | user28   | 1      | 71    |</span><br><span class="line">| c    | user44   | 1      | 71    |</span><br><span class="line">| c    | user57   | 1      | 71    |</span><br><span class="line">| c    | user6    | 1      | 71    |</span><br><span class="line">| c    | user76   | 1      | 71    |</span><br><span class="line">| c    | user9    | 1      | 71    |</span><br><span class="line">| c    | user93   | 1      | 71    |</span><br><span class="line">| c    | user31   | 1      | 71    |</span><br><span class="line">| c    | user33   | 1      | 71    |</span><br><span class="line">+------+----------+--------+-------+--+</span><br></pre></td></tr></table></figure></div>


<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">step3   基于2 进行where rank  &lt;= 3</span><br><span class="line"></span><br><span class="line">整合：</span><br><span class="line">result: 两种</span><br><span class="line">	select pid,uid,count</span><br><span class="line">	from(</span><br><span class="line">	select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">	from(</span><br><span class="line">	select pid,uid,count(uid) as count </span><br><span class="line">	from ods_uid_pid_info</span><br><span class="line">	group by pid,uid </span><br><span class="line">	)as tmp</span><br><span class="line">	)as result_tmp</span><br><span class="line">	where  rank&lt;=3;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">结果：</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select pid,uid,count</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from(</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from(</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; select pid,uid,count(uid) as count </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_uid_pid_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by pid,uid </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; )as tmp</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; )as result_tmp</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; where  rank&lt;=3;</span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917143131_3e5d7235-f034-4022-bea0-b86d6464a437): select pid,uid,count</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">)as tmp</span><br><span class="line">)as result_tmp</span><br><span class="line">where  rank&lt;=3</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:pid, type:string, comment:null), FieldSchema(name:uid, type:string, comment:null), FieldSchema(name:count, type:bigint, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917143131_3e5d7235-f034-4022-bea0-b86d6464a437); Time taken: 0.096 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917143131_3e5d7235-f034-4022-bea0-b86d6464a437): select pid,uid,count</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">)as tmp</span><br><span class="line">)as result_tmp</span><br><span class="line">where  rank&lt;=3</span><br><span class="line">INFO  : Query ID = double_happy_20190917143131_3e5d7235-f034-4022-bea0-b86d6464a437</span><br><span class="line">INFO  : Total jobs = 2</span><br><span class="line">INFO  : Launching Job 1 out of 2</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0005, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0005/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0005</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:31:30,465 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:31:34,683 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.17 sec</span><br><span class="line">INFO  : 2019-09-17 14:31:40,960 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 2.51 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 2 seconds 510 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0005</span><br><span class="line">INFO  : Launching Job 2 out of 2</span><br><span class="line">INFO  : Starting task [Stage-2:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0006, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0006/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0006</span><br><span class="line">INFO  : Hadoop job information for Stage-2: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:31:49,210 Stage-2 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:31:54,497 Stage-2 map = 100%,  reduce = 0%, Cumulative CPU 1.17 sec</span><br><span class="line">INFO  : 2019-09-17 14:32:00,785 Stage-2 map = 100%,  reduce = 100%, Cumulative CPU 3.48 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 3 seconds 480 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0006</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 2.51 sec   HDFS Read: 17079 HDFS Write: 6962 SUCCESS</span><br><span class="line">INFO  : Stage-Stage-2: Map: 1  Reduce: 1   Cumulative CPU: 3.48 sec   HDFS Read: 14767 HDFS Write: 117 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 5 seconds 990 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917143131_3e5d7235-f034-4022-bea0-b86d6464a437); Time taken: 37.896 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+------+---------+--------+--+</span><br><span class="line">| pid  |   uid   | count  |</span><br><span class="line">+------+---------+--------+--+</span><br><span class="line">| a    | user15  | 11     |</span><br><span class="line">| a    | user62  | 11     |</span><br><span class="line">| a    | user5   | 10     |</span><br><span class="line">| b    | user37  | 10     |</span><br><span class="line">| b    | user61  | 10     |</span><br><span class="line">| b    | user15  | 9      |</span><br><span class="line">| b    | user79  | 9      |</span><br><span class="line">| c    | user66  | 13     |</span><br><span class="line">| c    | user94  | 12     |</span><br><span class="line">| c    | user81  | 11     |</span><br><span class="line">+------+---------+--------+--+</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">带上排名 看的更清楚：</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select pid,uid,count,rank</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from(</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from(</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; select pid,uid,count(uid) as count </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_uid_pid_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by pid,uid </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; )as tmp</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; )as result_tmp</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; where  rank&lt;=3;</span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917145252_c7075e67-87d3-4c1d-9d14-0944dfcdbdca): select pid,uid,count,rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">)as tmp</span><br><span class="line">)as result_tmp</span><br><span class="line">where  rank&lt;=3</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:pid, type:string, comment:null), FieldSchema(name:uid, type:string, comment:null), FieldSchema(name:count, type:bigint, comment:null), FieldSchema(name:rank, type:int, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917145252_c7075e67-87d3-4c1d-9d14-0944dfcdbdca); Time taken: 0.047 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917145252_c7075e67-87d3-4c1d-9d14-0944dfcdbdca): select pid,uid,count,rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">)as tmp</span><br><span class="line">)as result_tmp</span><br><span class="line">where  rank&lt;=3</span><br><span class="line">INFO  : Query ID = double_happy_20190917145252_c7075e67-87d3-4c1d-9d14-0944dfcdbdca</span><br><span class="line">INFO  : Total jobs = 2</span><br><span class="line">INFO  : Launching Job 1 out of 2</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0010, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0010/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0010</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:52:46,500 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:52:50,688 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.06 sec</span><br><span class="line">INFO  : 2019-09-17 14:52:55,872 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 2.8 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 2 seconds 800 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0010</span><br><span class="line">INFO  : Launching Job 2 out of 2</span><br><span class="line">INFO  : Starting task [Stage-2:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0011, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0011/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0011</span><br><span class="line">INFO  : Hadoop job information for Stage-2: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:53:03,511 Stage-2 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:53:09,752 Stage-2 map = 100%,  reduce = 0%, Cumulative CPU 0.89 sec</span><br><span class="line">INFO  : 2019-09-17 14:53:15,983 Stage-2 map = 100%,  reduce = 100%, Cumulative CPU 3.4 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 3 seconds 400 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0011</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 2.8 sec   HDFS Read: 17080 HDFS Write: 6962 SUCCESS</span><br><span class="line">INFO  : Stage-Stage-2: Map: 1  Reduce: 1   Cumulative CPU: 3.4 sec   HDFS Read: 14832 HDFS Write: 137 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 6 seconds 200 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917145252_c7075e67-87d3-4c1d-9d14-0944dfcdbdca); Time taken: 36.913 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+------+---------+--------+-------+--+</span><br><span class="line">| pid  |   uid   | count  | rank  |</span><br><span class="line">+------+---------+--------+-------+--+</span><br><span class="line">| a    | user15  | 11     | 1     |</span><br><span class="line">| a    | user62  | 11     | 1     |</span><br><span class="line">| a    | user5   | 10     | 3     |</span><br><span class="line">| b    | user37  | 10     | 1     |</span><br><span class="line">| b    | user61  | 10     | 1     |</span><br><span class="line">| b    | user15  | 9      | 3     |</span><br><span class="line">| b    | user79  | 9      | 3     |</span><br><span class="line">| c    | user66  | 13     | 1     |</span><br><span class="line">| c    | user94  | 12     | 2     |</span><br><span class="line">| c    | user81  | 11     | 3     |</span><br><span class="line">+------+---------+--------+-------+--+</span><br></pre></td></tr></table></figure></div>
      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Scala06-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/17/Scala06-double-happy/">Scala06--double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2017/12/17/Scala06-double-happy/" class="article-date">
  <time datetime="2017-12-17T11:52:21.000Z" itemprop="datePublished">2017-12-17</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="隐式转换"><a href="#隐式转换" class="headerlink" title="隐式转换"></a>隐式转换</h2><p>存在的目的：增强</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scala里有三种：</span><br><span class="line">	隐式参数</span><br><span class="line">	隐式类型转换</span><br><span class="line">	隐式类</span><br></pre></td></tr></table></figure></div>
<p>隐式类型转换：****</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">eg：</span><br><span class="line">	A类型 ==》B类型 B对A已有的东西 进行增强（是感知不到的）</span><br><span class="line">scala中 File这个类原声的并没有类似与count，read方法   但是</span><br><span class="line">我们是可以通过隐式转换来增强File中并没有提供的方法</span><br></pre></td></tr></table></figure></div>
<p>这个东西是双刃剑 用不好 代码流程你可能都看不明白</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">需求：如何为一个已存在的类添加一个新方法？</span><br><span class="line"></span><br><span class="line">Java：使用代理</span><br><span class="line">scala：使用Implicit</span><br><span class="line"></span><br><span class="line">1.定义隐式转换函数</span><br><span class="line"></span><br><span class="line">implict def man2superman（man:Man）:Surperman = new Superman(man.name)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">代码：</span><br><span class="line">object ImplicitApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line">    val bfx = new Surperman(&quot;bfx&quot;)</span><br><span class="line"></span><br><span class="line">    bfx.fly()</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">      *隐式类型转换</span><br><span class="line">      * 1。定义隐式转换函数</span><br><span class="line">      *</span><br><span class="line">      */</span><br><span class="line"></span><br><span class="line">    //1。</span><br><span class="line">    implicit def man2surperman(man:Man):Surperman= &#123;</span><br><span class="line">      new Surperman(man.name)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    val double_happy = new Man(&quot;double_happy&quot;)</span><br><span class="line">    double_happy.fly()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  class Man(val name:String)</span><br><span class="line"></span><br><span class="line">  class Surperman(val name : String)&#123;</span><br><span class="line"></span><br><span class="line">    def fly(): Unit =&#123;</span><br><span class="line">      println(s&quot;$name can fly...&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需求二：scala中 File这个类原声的并没有类似与count，read方法   但是</span><br><span class="line">我们是可以通过隐式转换来增强File中并没有提供的方法</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">代码：</span><br><span class="line">	object ImplicitApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line">    val bfx = new Surperman(&quot;bfx&quot;)</span><br><span class="line"></span><br><span class="line">    bfx.fly()</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">      *隐式类型转换</span><br><span class="line">      * 1。定义隐式转换函数</span><br><span class="line">      *</span><br><span class="line">      */</span><br><span class="line"></span><br><span class="line">    //1。</span><br><span class="line">    implicit def man2surperman(man:Man):Surperman= &#123;</span><br><span class="line">      new Surperman(man.name)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    val double_happy = new Man(&quot;double_happy&quot;)</span><br><span class="line">    double_happy.fly()</span><br><span class="line"></span><br><span class="line">    //1.2 File 增强</span><br><span class="line">    implicit def file2RichFile(file: File)=new RichFile(file)</span><br><span class="line"></span><br><span class="line">    val file = new File(&quot;/Users/double_happy/zz/G7-03/工程/scala-flink/doc/implicit/file.txt&quot;)</span><br><span class="line"></span><br><span class="line">    println(file.read())</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  class Man(val name:String)</span><br><span class="line"></span><br><span class="line">  class Surperman(val name : String)&#123;</span><br><span class="line"></span><br><span class="line">    def fly(): Unit =&#123;</span><br><span class="line">      println(s&quot;$name can fly...&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  //2.增强File</span><br><span class="line"></span><br><span class="line">  class RichFile(file:File)&#123;</span><br><span class="line"></span><br><span class="line">    def read() =&#123;</span><br><span class="line"></span><br><span class="line">      //文件的路径+文件名字</span><br><span class="line">       Source.fromFile(file.getPath).mkString</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>这样写 代码里全是implicit 比较乱 最好把他们抽取出来放到一个Obeject里面</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">隐式类型转换   在spark-core RDD里面有很多，</span><br><span class="line">其中，RDD obeject里面就是把大部分的implicit放到这里面的</span><br><span class="line">eg：</span><br><span class="line">object RDD &#123;</span><br><span class="line"></span><br><span class="line">  private[spark] val CHECKPOINT_ALL_MARKED_ANCESTORS =</span><br><span class="line">    &quot;spark.checkpoint.checkpointAllMarkedAncestors&quot;</span><br><span class="line"></span><br><span class="line">  // The following implicit functions were in SparkContext before 1.3 and users had to</span><br><span class="line">  // `import SparkContext._` to enable them. Now we move them here to make the compiler find</span><br><span class="line">  // them automatically. However, we still keep the old functions in SparkContext for backward</span><br><span class="line">  // compatibility and forward to the following functions directly.</span><br><span class="line"></span><br><span class="line">  implicit def rddToPairRDDFunctions[K, V](rdd: RDD[(K, V)])</span><br><span class="line">    (implicit kt: ClassTag[K], vt: ClassTag[V], ord: Ordering[K] = null): PairRDDFunctions[K, V] = &#123;</span><br><span class="line">    new PairRDDFunctions(rdd)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  implicit def rddToAsyncRDDActions[T: ClassTag](rdd: RDD[T]): AsyncRDDActions[T] = &#123;</span><br><span class="line">    new AsyncRDDActions(rdd)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div>
<p>隐式参数转换</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">隐式参数</span><br><span class="line">	方法/函数的参数可以使用implicit修饰</span><br><span class="line">	效果就是：</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">eg：</span><br><span class="line">  //Int 类型就具有 add方法了 是不是很神奇</span><br><span class="line">  implicit class Cal(x :Int)&#123;</span><br><span class="line"></span><br><span class="line">    def add(a:Int) = a+x</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //File类增强</span><br><span class="line">  implicit class FileEnhance(file: File)&#123;</span><br><span class="line"></span><br><span class="line">    def read2() = Source.fromFile(file.getPath).mkString</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">      * 隐式类：</span><br><span class="line">      *</span><br><span class="line">      */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val file2 = new File(&quot;/Users/double_happy/zz/G7-03/工程/scala-flink/doc/implicit/file.txt&quot;)</span><br><span class="line">    </span><br><span class="line">    println(file2.read2())</span><br><span class="line"></span><br><span class="line">    println(4.add(2))</span><br></pre></td></tr></table></figure></div>

<h2 id="Scala泛型"><a href="#Scala泛型" class="headerlink" title="Scala泛型"></a>Scala泛型</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">  * scala的泛型 ： 类型的约束</span><br><span class="line">  */</span><br><span class="line">object GeneticApp &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val mm1 = new MM[Int,CupEnum,Int](90,CupEnum.A,175)</span><br><span class="line">    val mm2 = new MM[Int,CupEnum,Int](10,CupEnum.F,150)</span><br><span class="line">    val mm3 = new MM[Int,CupEnum,Int](80,CupEnum.B,165)</span><br><span class="line"></span><br><span class="line">    println(mm1)</span><br><span class="line">    println(mm2)</span><br><span class="line">    println(mm3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">abstract class Msg[T](content:T)</span><br><span class="line"></span><br><span class="line">class WeChatMsg(content:String) extends Msg(content)</span><br><span class="line"></span><br><span class="line">class DigitMsg[Int](content:Int) extends Msg(content)</span><br><span class="line"></span><br><span class="line">class MM [A,B,C](val faceValue:A,val cap:B,val height:C)&#123;</span><br><span class="line"></span><br><span class="line">  override def toString: String = faceValue +&quot;\t&quot;+cap+&quot;\t&quot;+height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//scala中枚举的使用  固定写法</span><br><span class="line"></span><br><span class="line">object CupEnum extends Enumeration &#123;</span><br><span class="line"></span><br><span class="line">  type  CupEnum = Value</span><br><span class="line"></span><br><span class="line">  val A,B,C,D,E,F = Value</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="Scala中的排序"><a href="#Scala中的排序" class="headerlink" title="Scala中的排序"></a>Scala中的排序</h2><p>对比java</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">两种：</span><br><span class="line">1.sort里的 Comparator</span><br><span class="line">2.实现 Comparable</span><br><span class="line"></span><br><span class="line">public class MM  implements Comparable&lt;MM&gt;&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        MM mm1 = new MM(&quot;mm1&quot;, 32);</span><br><span class="line">        MM mm2 = new MM(&quot;mm2&quot;, 34);</span><br><span class="line">        MM mm3 = new MM(&quot;mm3&quot;, 31);</span><br><span class="line"></span><br><span class="line">        List&lt;MM&gt; mms = new ArrayList&lt;&gt;();</span><br><span class="line">        mms.add(mm1);</span><br><span class="line">        mms.add(mm2);</span><br><span class="line">        mms.add(mm3);</span><br><span class="line">        // 1. 第一种方式 排序cpm01(mms);</span><br><span class="line">        //2。第二种方式 排序</span><br><span class="line"></span><br><span class="line">        cmp02(mms);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void cmp02(List&lt;MM&gt; mms) &#123;</span><br><span class="line">        Collections.sort(mms);</span><br><span class="line">        for (MM mm : mms) &#123;</span><br><span class="line">            System.out.println(mm);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void cpm01(List&lt;MM&gt; mms) &#123;</span><br><span class="line">        //排序</span><br><span class="line">        Collections.sort(mms, new Comparator&lt;MM&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public int compare(MM o1, MM o2) &#123;</span><br><span class="line">                return o1.cup - o2.cup;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        for (MM mm : mms) &#123;</span><br><span class="line">            System.out.println(mm);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    private int cup;</span><br><span class="line"></span><br><span class="line">    public MM() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public MM(String name, int cup) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.cup = cup;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getCup() &#123;</span><br><span class="line">        return cup;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCup(int cup) &#123;</span><br><span class="line">        this.cup = cup;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;MM&#123;&quot; +</span><br><span class="line">                &quot;name=&apos;&quot; + name + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, cup=&quot; + cup +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int compareTo(MM o) &#123;</span><br><span class="line">        return -(this.cup - o.cup);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scala排序与java相对应的：</span><br><span class="line">	1. Ordering  ==&gt;comparator</span><br><span class="line">	2. Ordered ==&gt;comparable</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">java里的上下界</span><br><span class="line">	上界（upper bounds）&lt;T extends Test &gt; T 可以是Test的子类型   &lt;? extends Test&gt;</span><br><span class="line">	下界(lower bounds)   &lt; T super Test &gt; T可以是Test的父类型			&lt;? super Test &gt;</span><br><span class="line"></span><br><span class="line">Scala 里的上下界</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">object UpperLowerBountsApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //3.Man 排序</span><br><span class="line"></span><br><span class="line">//    val man1 = new Man(&quot;double&quot;,24)</span><br><span class="line">//    val man2 = new Man(&quot;xiao fang&quot;,18)</span><br><span class="line">//</span><br><span class="line">//    println(new MaxValue(man1,man2).compare)</span><br><span class="line">//    println(new MaxValue2(man1,man2).compare)</span><br><span class="line"></span><br><span class="line">    //3.2</span><br><span class="line"></span><br><span class="line">    val man3 = new Man2(&quot;double&quot;,24)</span><br><span class="line">    val man4 = new Man2(&quot;xiao fang&quot;,18)</span><br><span class="line"></span><br><span class="line">   // println(new MaxValue2(man3,man4).compare)  //是不行的 Man2需要隐式转换 或者 实现compareble接口 或者 extends  Ordered[Man2]</span><br><span class="line"></span><br><span class="line">    implicit def man2ToOrderedMan2(man2: Man2) = new Ordered[Man2] &#123;</span><br><span class="line">      override def compare(that: Man2): Int = that.age - man2.age</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(new MaxValue2(man3,man4).compare)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //3.3 上下文界定</span><br><span class="line"></span><br><span class="line">    implicit val cpmtor = new Ordering[Man2] &#123;</span><br><span class="line">      override def compare(x: Man2, y: Man2): Int = -(x.age -y.age)</span><br><span class="line">    &#125;</span><br><span class="line">    println(new MaxValue3(man3,man4).compare())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //0。。</span><br><span class="line"></span><br><span class="line">    val maxInt = new MaxInt(3,6)</span><br><span class="line"></span><br><span class="line">    println(maxInt.compare())</span><br><span class="line"></span><br><span class="line">    //1。需要需要写泛型 如果实现compareble接口 就不用写</span><br><span class="line">    val maxValue = new MaxValue[Integer](6,10) //Int 没有实现compareble接口</span><br><span class="line"></span><br><span class="line">    println(maxValue.compare)</span><br><span class="line"></span><br><span class="line">    //2。使用视图界定 不用写泛型</span><br><span class="line">    val maxValue2 = new MaxValue2(13,15)</span><br><span class="line"></span><br><span class="line">    println(maxValue2.compare)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//求最大值  Int 类型的</span><br><span class="line">class  MaxInt(x :Int , y:Int)&#123;</span><br><span class="line"></span><br><span class="line">  def compare()=&#123;</span><br><span class="line">    if(x &gt; y) x else y</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class  MaxLong(x :Long , y:Long)&#123;</span><br><span class="line"></span><br><span class="line">  def compare()=&#123;</span><br><span class="line">    if(x &gt; y) x else y</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//引入 scala里的上界  这里是表示 T是Comparable[T]的子类型</span><br><span class="line">class  MaxValue[T &lt;: Comparable[T]] (x:T,y:T)&#123;</span><br><span class="line"></span><br><span class="line">  def compare = if(x.compareTo(y) &gt;0)  x else  y</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//视图界定 ： 底层是使用隐式转换的</span><br><span class="line">class  MaxValue2[T &lt;% Comparable[T]] (x:T,y:T)&#123;</span><br><span class="line"></span><br><span class="line">  def compare = if(x.compareTo(y) &gt;0)  x else  y</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//上下文界定</span><br><span class="line">class  MaxValue3[T : Ordering](x : T,y:T)(implicit cpmtor:Ordering[T])&#123;</span><br><span class="line"></span><br><span class="line">  def compare() =if(cpmtor.compare(x,y) &gt; 0) x else y</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Man(val name :String , val age : Int) extends  Ordered[Man]&#123;</span><br><span class="line"></span><br><span class="line">  override def compare(that: Man): Int = that.age - age</span><br><span class="line"></span><br><span class="line">  override def toString: String = name + &quot;\t&quot; + age</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Man2(val name :String , val age : Int) &#123;</span><br><span class="line"></span><br><span class="line">  override def toString: String = name + &quot;\t&quot; + age</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">总结下来 scala里排序：  那些界定 能看懂即可 </span><br><span class="line">	不管你使用什么界定 ，转换的类不用说 里面是一定有compare的</span><br><span class="line">	bean类 不管是隐式转换也好 还是继承或实现 ordered ，最终 bean类 和转换类 结合使用的时候 他们都存在</span><br><span class="line">	类似compare的东西 才不会报错！！！</span><br></pre></td></tr></table></figure></div>




<h2 id="逆变和协变"><a href="#逆变和协变" class="headerlink" title="逆变和协变"></a>逆变和协变</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">scala里 泛型类型是不可变的  本意  但是人为的让他可以</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">  * scala的泛型 ： 类型的约束</span><br><span class="line">  */</span><br><span class="line">object GeneticApp &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //1. 泛型</span><br><span class="line">    val mm1 = new MM[Int,CupEnum,Int](90,CupEnum.A,175)</span><br><span class="line">    val mm2 = new MM[Int,CupEnum,Int](10,CupEnum.F,150)</span><br><span class="line">    val mm3 = new MM[Int,CupEnum,Int](80,CupEnum.B,165)</span><br><span class="line"></span><br><span class="line">    println(mm1)</span><br><span class="line">    println(mm2)</span><br><span class="line">    println(mm3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //2.nb  xb</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">      * 泛型类型是不可变的</span><br><span class="line">      *</span><br><span class="line">      *  [UserA] 能不能放 Child</span><br><span class="line">      *  eg：val test: Test[UserA] = new Test[Child]     //默认是不行的哈 泛型类型是不可变的</span><br><span class="line">      *</span><br><span class="line">      *  UserA ==》 Child  协变   补充增强    在Test里属性参数 加一个+ 号即可实现</span><br><span class="line">      *</span><br><span class="line">      *  UserA ==》Person 逆变   减少    在Test里属性参数 加一个- 号即可实现</span><br><span class="line">      *</span><br><span class="line">      */</span><br><span class="line">    val test: Test[UserA] = new Test[UserA]</span><br><span class="line">    val test1: Test[UserA] = new Test[Child]</span><br><span class="line">    println(test)</span><br><span class="line">    println(test1)</span><br><span class="line"></span><br><span class="line">//    val test3: Test[UserA] = new Test[Person]</span><br><span class="line">    println(test)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //使用场景</span><br><span class="line">    val list = List(1,2,3,4,5)</span><br><span class="line">   // list.reduceLeft[UserA]()  点开看一下 就知道  这是一个下界 返回值类型 就是 UserA</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def test[T](t:T)=println(t)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Person</span><br><span class="line"></span><br><span class="line">class  UserA extends  Person</span><br><span class="line"></span><br><span class="line">class Child extends  UserA</span><br><span class="line"></span><br><span class="line">class Test[+UserA]</span><br><span class="line"></span><br><span class="line">abstract class Msg[T](content:T)</span><br><span class="line"></span><br><span class="line">class WeChatMsg(content:String) extends Msg(content)</span><br><span class="line"></span><br><span class="line">class DigitMsg[Int](content:Int) extends Msg(content)</span><br><span class="line"></span><br><span class="line">class MM [A,B,C](val faceValue:A,val cap:B,val height:C)&#123;</span><br><span class="line"></span><br><span class="line">  override def toString: String = faceValue +&quot;\t&quot;+cap+&quot;\t&quot;+height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//scala中枚举的使用  固定写法</span><br><span class="line"></span><br><span class="line">object CupEnum extends Enumeration &#123;</span><br><span class="line"></span><br><span class="line">  type  CupEnum = Value</span><br><span class="line"></span><br><span class="line">  val A,B,C,D,E,F = Value</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="Scala操作JDBC"><a href="#Scala操作JDBC" class="headerlink" title="Scala操作JDBC"></a>Scala操作JDBC</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.pom.xml  添加jdbc</span><br><span class="line">2.开发</span><br><span class="line">	最基础的方法</span><br><span class="line">	2.使用scalikejdbc</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">object ScalalikJDBCAPP &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def  insert()=&#123;</span><br><span class="line">    DB.autoCommit(&#123;</span><br><span class="line">      implicit session =&gt;&#123;</span><br><span class="line">        SQL(&quot;insert into tmp(topic,groupid,partititions,offset) values(?,?,?,?)&quot;)</span><br><span class="line">          .bind(&quot;happy&quot;,&quot;test-happy-group&quot;,3,8)    //插入具体的值</span><br><span class="line">          .update().apply()  //执行</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def update(): Unit = &#123;</span><br><span class="line">    DB.autoCommit(&#123;</span><br><span class="line">      implicit session =&gt;&#123;</span><br><span class="line">        SQL(&quot;update  tmp(topic,groupid,partititions,offset) set offset=? where topic=? and groupid=? and partititions=? and offset=? &quot;)</span><br><span class="line">          .bind(18,&quot;happy&quot;,&quot;test-happy-group&quot;,3)    //修改具体的值</span><br><span class="line">          .update().apply()  //执行</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def query(): Unit = &#123;</span><br><span class="line">    val queryresult = DB.readOnly(&#123;</span><br><span class="line">      implicit session =&gt; &#123;</span><br><span class="line">        SQL(&quot;select * from tmp &quot;).map(rs =&gt; &#123;</span><br><span class="line"></span><br><span class="line">          tmp(</span><br><span class="line">            rs.string(&quot;topic&quot;),</span><br><span class="line">            rs.string(&quot;groupid&quot;),</span><br><span class="line">            rs.int(&quot;partitions&quot;),</span><br><span class="line">            rs.long(&quot;offset&quot;)</span><br><span class="line">          )</span><br><span class="line">        &#125;).list().apply() //执行</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    queryresult.foreach(println(_))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  case class tmp(topic:String,groupid:String,partitions:Int,offset:Long)</span><br><span class="line"></span><br><span class="line">  def delete(): Unit = &#123;</span><br><span class="line">    DB.autoCommit(&#123;</span><br><span class="line">      implicit session =&gt;&#123;</span><br><span class="line">        SQL(&quot;delete from tmp where partition=? &quot;)</span><br><span class="line">          .bind(3)    //删除具体的值</span><br><span class="line">          .update().apply()  //执行</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def transaction(): Unit = &#123;</span><br><span class="line">    DB.localTx(&#123;</span><br><span class="line">      implicit session =&gt;&#123;</span><br><span class="line">        SQL(&quot;delete from tmp where partition=? &quot;)</span><br><span class="line">          .bind(3)    //删除具体的值</span><br><span class="line">          .update().apply()  //执行</span><br><span class="line"></span><br><span class="line">        //1/0   测试用  加上即  3删除了2没有删除 如果事务保证 那么谁都不会删除 ***</span><br><span class="line"></span><br><span class="line">        SQL(&quot;delete from tmp where partition=? &quot;)</span><br><span class="line">          .bind(2)    //删除具体的值</span><br><span class="line">          .update().apply()  //执行</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line">    //1.解析配置文件</span><br><span class="line">    DBs.setupAll()</span><br><span class="line"></span><br><span class="line">    //插入</span><br><span class="line">    insert()</span><br><span class="line"></span><br><span class="line">    //修改</span><br><span class="line">    update()</span><br><span class="line"></span><br><span class="line">    //查询</span><br><span class="line">    query()</span><br><span class="line"></span><br><span class="line">    //删除</span><br><span class="line">    delete()</span><br><span class="line"></span><br><span class="line">    //事务</span><br><span class="line">    transaction()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Flume03-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/13/Flume03-double-happy/">Flume03--double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2017/12/13/Flume03-double-happy/" class="article-date">
  <time datetime="2017-12-13T11:51:37.000Z" itemprop="datePublished">2017-12-13</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="Flume核心组件"><a href="#Flume核心组件" class="headerlink" title="Flume核心组件"></a>Flume核心组件</h2><p>六大组件：Source、Interceptors、 Channel Selectors、channel、Sink、Sink Processors<br>事务  三大核心组件自定义开发 这些是必须要掌握的重点</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如果整个流程的事务不能保证好的话 会产生两个问题？</span><br><span class="line">1.数据丢失   </span><br><span class="line">2.数据会重复</span><br><span class="line">为什么丢失？为什么重复？ 之后章节演示</span><br></pre></td></tr></table></figure></div>
<h2 id="多Agent"><a href="#多Agent" class="headerlink" title="多Agent"></a>多Agent</h2><p>Flume：Agent的技术选型 没有对与错只有合适不合适</p>
<p>案例1</p>
<p><img src="https://img-blog.csdnimg.cn/2019091023540096.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTU1NzUxMg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">三个 agent 配置</span><br><span class="line">    待续。。。。</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">总结：</span><br><span class="line">	1.多个Agent进行传输 选择</span><br><span class="line">			nc：avro sink</span><br><span class="line">			taildir：avro sink</span><br><span class="line">			source: avro source</span><br><span class="line">	2.A1 和A2可能是不同业务的数据 格式也可能是不一样的 可以按这个图接 ，接到A3之后是要加一些标识的，明确知道日志是什么类型的，</span><br><span class="line">	通过event进来之后进过一系列拦截器链可以设置header信息来区别日志</span><br></pre></td></tr></table></figure></div>
<h2 id="优化上面的图"><a href="#优化上面的图" class="headerlink" title="优化上面的图"></a>优化上面的图</h2><p>A3数据从channel出来直接写道一个sink里去的，工作当中肯定是不行的，sink挂掉就gg了。</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Sink Processors：</span><br><span class="line">	1.load balance</span><br><span class="line">	2.failover</span><br></pre></td></tr></table></figure></div>
<p><strong>Sink Processors：</strong><br><img src="https://img-blog.csdnimg.cn/2019091100054664.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTU1NzUxMg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>load balance</strong><br>        一个sink发一些数据，另外sink发送一些数据（轮询 和随机）<img src="https://img-blog.csdnimg.cn/20190911000928562.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTU1NzUxMg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>案例2：</p>
<p><img src="https://img-blog.csdnimg.cn/20190911001420721.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTU1NzUxMg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">配置待续。。。</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">总结：</span><br><span class="line">	1.A0需要sink组</span><br></pre></td></tr></table></figure></div>

<p><strong>failover</strong><br><img src="https://img-blog.csdnimg.cn/2019091100164313.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTU1NzUxMg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">总结：</span><br><span class="line">	1.优先级高的sink发送数据 另一个sink是不发送数据的      值越大的优先级越大</span><br><span class="line">		优先级高的sink挂掉之后会走优先级低的sink</span><br></pre></td></tr></table></figure></div>


<h2 id="Flume优化的东西要注意的"><a href="#Flume优化的东西要注意的" class="headerlink" title="Flume优化的东西要注意的"></a>Flume优化的东西要注意的</h2><p>面试题：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">QA1：谈谈你在工作中针对Flume的调优有哪些</span><br><span class="line">	Source：</span><br><span class="line">		文件：TailDir   注意 默认是不支持递归的     </span><br><span class="line">		     </span><br><span class="line">		网络：avro</span><br><span class="line">	Channel：</span><br><span class="line">		Memory</span><br><span class="line">		File</span><br><span class="line">		capacity</span><br><span class="line">		transactionCapacity</span><br><span class="line">		source/sink: batchSize</span><br><span class="line">		</span><br><span class="line">	Sink：配置sink的个数多和少  吞吐量的问题 </span><br><span class="line">	不是越多越好 每一个sink都是jvm进程 </span><br><span class="line">	sink的batchsize决定出来多少数据</span><br><span class="line">	</span><br><span class="line">	Flume Agent架构 ：</span><br><span class="line">		failover和load balance  什么场景可用性最高 </span><br><span class="line">		一起用可以 但是对机器要求也高 ，退而求其次 ，但是failover是一定要配置的</span><br><span class="line"></span><br><span class="line">QA2：谈谈你们使用Flume过程中时如何监控的</span><br><span class="line">    主要是监控 channel    如果channle数据多了 说明数据挤压 sink说明出问题了</span><br><span class="line">    如果sink出现问题了，意味着source 疯狂的往channle里入数据，但是这时候没有sink消费channel数据 </span><br><span class="line">    那么 channle早晚会爆掉，随之 source也写不进去了。</span><br><span class="line">Ganglia，json-》es-&gt;kabanna展示 都可以做监控</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. TailDir   Source：</span><br><span class="line">	注意：</span><br><span class="line">	如果某一个目录下面或者某几个目录下面的数据文件非常非常多，</span><br><span class="line">	1.最好增加filegroups的个数，这样吞吐量肯定能上去 因为你处理的是不同的文件</span><br><span class="line">     2.对于source 来讲里面是有一个 batchsize的 （参考值 10000-50000）</span><br><span class="line">         Max number of lines to read and send to the channel at a time.</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2. channel</span><br><span class="line">      选择memory 和file 看你能不能接受丢少量数据 mem达到99.99%才会丢</span><br><span class="line">      不要采用kafka channel 一个flume框架就可以了 模型当中你又引用一个kafka进来，出问题的可能性成指数增长 </span><br><span class="line">      </span><br><span class="line">      capacity（channel里能存多少个event）</span><br><span class="line">      		The maximum number of events stored in the channel</span><br><span class="line">	  transactionCapacity（souce往channle里塞多少数据 和 sink从channle里取多少数据  事务的时候）</span><br><span class="line">	  		The maximum number of events the channel will take from a source or give to a sink per transaction</span><br><span class="line"></span><br><span class="line">transactionCapacity  是大于capacity</span><br></pre></td></tr></table></figure></div>
      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Flume02-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/11/Flume02-double-happy/">Flume02--double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2017/12/11/Flume02-double-happy/" class="article-date">
  <time datetime="2017-12-11T11:50:48.000Z" itemprop="datePublished">2017-12-11</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="Flume的agent配置模板"><a href="#Flume的agent配置模板" class="headerlink" title="Flume的agent配置模板"></a>Flume的agent配置模板</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">agent_name: 配置的agent的名称</span><br><span class="line">a1：就是agent的名称（名字随便起的哈）</span><br><span class="line"></span><br><span class="line"># Name the components on this agent</span><br><span class="line">&lt;agent_name&gt;.sources = &lt;source_name&gt;</span><br><span class="line">&lt;agent_name&gt;.sinks = &lt;sink_name&gt;</span><br><span class="line">&lt;agent_name&gt;.channels = &lt;channel_name&gt;</span><br><span class="line"></span><br><span class="line">&lt;agent_name&gt;.sources.&lt;source_name&gt;.type = xx</span><br><span class="line">&lt;agent_name&gt;.sinks.&lt;sink_name&gt;.type = yyy</span><br><span class="line">&lt;agent_name&gt;.channels.&lt;channel_name&gt;.type = zzz</span><br><span class="line"></span><br><span class="line">&lt;agent_name&gt;.sources.&lt;source_name&gt;.channels = &lt;channel_name&gt;</span><br><span class="line">&lt;agent_name&gt;.sinks.&lt;sink_name&gt;.channel = &lt;channel_name&gt;</span><br></pre></td></tr></table></figure></div>
<p>基于上一篇文章末尾引出一个，</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从指定的网络端口上采集日志到控制台输出</span><br></pre></td></tr></table></figure></div>
<p>那么Flume支持的source、channel、sink有哪些呢？</p>
<h2 id="2-Flume支持的source、channel、sink有哪些呢？"><a href="#2-Flume支持的source、channel、sink有哪些呢？" class="headerlink" title="2.Flume支持的source、channel、sink有哪些呢？"></a>2.Flume支持的source、channel、sink有哪些呢？</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">source：</span><br><span class="line">	avro（是rpc服务框架）</span><br><span class="line">	exec （是监控一个文件） ： tail -F  xx.log（大F和小f有区别）后面只能接一个文件(小f是动态的)</span><br><span class="line">	Spooling Directory: 能监控一个文件夹（文件夹下不能有子文件夹的）</span><br><span class="line">	Taildir（是既能监控文件又能监控文件夹）**</span><br><span class="line">	netcat</span><br><span class="line">sink：</span><br><span class="line">	HDFS</span><br><span class="line">	logger（写到控制台）</span><br><span class="line">	avro : 配合avro source使用</span><br><span class="line">	kafka	</span><br><span class="line">channel：只是数据的存储不涉及到数据的缓存</span><br><span class="line">	memory</span><br><span class="line">	file</span><br><span class="line">Agent：各种组合source、channel、sink之间的关系</span><br></pre></td></tr></table></figure></div>
<h2 id="3-案例分析"><a href="#3-案例分析" class="headerlink" title="3.案例分析"></a>3.案例分析</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">eg：为了学习   这个思路可以借鉴      生产上直接用 Taildir</span><br><span class="line">   把一个文件中新增的内容收集到HDFS上去</span><br><span class="line">	exec - memory - hdfs</span><br><span class="line">    一个文件夹</span><br><span class="line">	spooling - memory - hdfs</span><br><span class="line">    文件数据写入kafka</span><br><span class="line">	exec - memory - kafka</span><br></pre></td></tr></table></figure></div>
<h2 id="4-实战"><a href="#4-实战" class="headerlink" title="4.实战"></a>4.实战</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需求1：采集指定文件的内容到HDFS</span><br><span class="line">技术选型：exec - memory - hdfs</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">agent  待续。。</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">需求1总结：</span><br><span class="line">batchSize :积累多少个event 刷到hdfs上去</span><br><span class="line">fileType：默认是secqueceFile   ,DataStream可以理解为文本（没有压缩的）</span><br><span class="line">writeFormat:默认是Writable</span><br><span class="line"></span><br><span class="line">hdfs上一个128m的文件和1kb文件都各自占用一个block，而一个block有一个元数据信息，</span><br><span class="line">元数据多了会占用namenode的内存，元数据过多会导致namenode挂掉 （所以注意 设置文件多大合适呢？）</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需求2：采集指定文件夹的内容到控制台</span><br><span class="line">选型：spooling - memory - logger</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">agent  待续。。</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">需求2总结：</span><br><span class="line">如果监控的文件夹下进来一个文件，那个文件处理完以后，会在那个文件后面加一个COMPLETED标识 ，</span><br><span class="line">但是为什么同一个文件进去两次flume就挂掉了呢 ， 在spooling监控的文件夹下的文件如果被处理过以后，</span><br><span class="line">再给这个文件内容追加写或者改就会报错，如果处理过后的文件的文件名在后面又被用到了，也会报错。</span><br><span class="line">也就是文件名不能有重复的</span><br><span class="line">如果agent里fileHeader参数设置为true，默认event 里的header的key就是文件路径+文件名</span><br></pre></td></tr></table></figure></div>
      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Flume01-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/10/Flume01-double-happy/">Flume01--double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2017/12/10/Flume01-double-happy/" class="article-date">
  <time datetime="2017-12-10T11:49:48.000Z" itemprop="datePublished">2017-12-10</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><pre><code>我使用的是flume1.6.0-cdh5.15.1版本的，flume的agent配置 实际上就是查字典 不同的版本去不同的官网去查
那么给出flume1.6.0-cdh5.15.1的官网[flume1.6.0-cdh5.15.1](http://archive.cloudera.com/cdh5/cdh/5/flume-ng-1.6.0-cdh5.15.1/FlumeUserGuide.html)
下载地址：[cdh下载地址](http://archive.cloudera.com/cdh5/cdh/5/)</code></pre><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.搭建</span><br><span class="line">	三步：下载、解压、配置环境变量</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">2.下面基于官网进行Flume的学习</span><br><span class="line"></span><br><span class="line">Flume：</span><br><span class="line">	RDBMS ==&gt; Sqoop ==&gt; Hadoop    使用FS可以 </span><br><span class="line">	日志：分散在各个服务器上  ??? ===&gt; Hadoop    这里就引出Flume</span><br><span class="line">	</span><br><span class="line">Flume is a distributed（分布式的）, reliable（可靠）, and available service （高可用）</span><br><span class="line">for efficiently *****collecting, aggregating, and moving***** large amounts of log data. </span><br><span class="line">It has a simple and flexible architecture based on streaming data flows.</span><br><span class="line"></span><br><span class="line">collecting	   采集   source</span><br><span class="line">aggregating    聚合   channel （找个地方把采集过来的数据暂存下）</span><br><span class="line">moving         移动   sink</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Flume： 就是编写配置文件，组合source、channel、sink三者之间的关系</span><br><span class="line">Agent：就是由source、channel、sink组成</span><br><span class="line">编写flume的配置文件其实就是配置agent的构成</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20190909152131576.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTU1NzUxMg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Flume就是一个框架：针对日志数据进行采集汇总，把日志从A地方搬运到B地方去</span><br><span class="line">注意：</span><br><span class="line">	1.flume支持配置 采集的文件进行压缩 以及存储格式 </span><br><span class="line">    2.flume的监控</span><br><span class="line">flume把数据写到hdfs要注意有读写权限</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3.如何使用Flume？</span><br><span class="line">		就是配置agent</span><br><span class="line">		flume 的agent 就是本地的一个配置文件</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@ruozedata001 flume]$ flume-ng</span><br><span class="line">Error: Unknown or unspecified command &apos;&apos;</span><br><span class="line"></span><br><span class="line">Usage: /home/hadoop/app/flume/bin/flume-ng &lt;command&gt; [options]...</span><br><span class="line"></span><br><span class="line">commands:</span><br><span class="line">  help                      display this help text</span><br><span class="line">  agent                     run a Flume agent</span><br><span class="line">  avro-client               run an avro Flume client</span><br><span class="line">  version                   show Flume version info</span><br><span class="line"></span><br><span class="line">global options:</span><br><span class="line">  --conf,-c &lt;conf&gt;          use configs in &lt;conf&gt; directory</span><br><span class="line">  --classpath,-C &lt;cp&gt;       append to the classpath</span><br><span class="line">  --dryrun,-d               do not actually start Flume, just print the command</span><br><span class="line">  --plugins-path &lt;dirs&gt;     colon-separated list of plugins.d directories. See the</span><br><span class="line">                            plugins.d section in the user guide for more details.</span><br><span class="line">                            Default: $FLUME_HOME/plugins.d</span><br><span class="line">  -Dproperty=value          sets a Java system property value</span><br><span class="line">  -Xproperty=value          sets a Java -X option</span><br><span class="line"></span><br><span class="line">agent options:</span><br><span class="line">  --name,-n &lt;name&gt;          the name of this agent (required)</span><br><span class="line">  --conf-file,-f &lt;file&gt;     specify a config file (required if -z missing)</span><br><span class="line">  --zkConnString,-z &lt;str&gt;   specify the ZooKeeper connection to use (required if -f missing)</span><br><span class="line">  --zkBasePath,-p &lt;path&gt;    specify the base path in ZooKeeper for agent configs</span><br><span class="line">  --no-reload-conf          do not reload config file if changed</span><br><span class="line">  --help,-h                 display help text</span><br><span class="line"></span><br><span class="line">avro-client options:</span><br><span class="line">  --rpcProps,-P &lt;file&gt;   RPC client properties file with server connection params</span><br><span class="line">  --host,-H &lt;host&gt;       hostname to which events will be sent</span><br><span class="line">  --port,-p &lt;port&gt;       port of the avro source</span><br><span class="line">  --dirname &lt;dir&gt;        directory to stream to avro source</span><br><span class="line">  --filename,-F &lt;file&gt;   text file to stream to avro source (default: std input)</span><br><span class="line">  --headerFile,-R &lt;file&gt; File containing event headers as key/value pairs on each new line</span><br><span class="line">  --help,-h              display help text</span><br><span class="line"></span><br><span class="line">  Either --rpcProps or both --host and --port must be specified.</span><br><span class="line"></span><br><span class="line">Note that if &lt;conf&gt; directory is specified, then it is always included first</span><br><span class="line">in the classpath.</span><br></pre></td></tr></table></figure></div>
<p>尖括号是一定要有的 []可有可无的选项</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">4.实战进行简单的学习  ---引出</span><br><span class="line">	这个需求1 看不懂没有关系 下面会有具体的知识讲解  </span><br><span class="line">	</span><br><span class="line">需求1：使用Flume从指定的端口中获取数据，输出到控制台</span><br><span class="line">分析：Agent的选型问题</span><br><span class="line">	Source： nc</span><br><span class="line">	Channel: memory</span><br><span class="line">	Sink:    logger</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 定义Agent</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line"># 定义Source</span><br><span class="line">a1.sources.r1.type = netcat</span><br><span class="line">a1.sources.r1.bind = ruozedata001</span><br><span class="line">a1.sources.r1.port = 44445</span><br><span class="line"></span><br><span class="line"># 定义Channel</span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line"></span><br><span class="line"># 定义Sink</span><br><span class="line">a1.sinks.k1.type = logger</span><br><span class="line"></span><br><span class="line"># 定义配置关系</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line">a1.sources.r1.channels = c1</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">命令解释：可以再上面的flume-ng 查看具体的意思</span><br><span class="line"></span><br><span class="line">flume-ng agent \</span><br><span class="line">--name a1 \</span><br><span class="line">--conf $FLUME_HOME/conf \</span><br><span class="line">--conf-file /home/hadoop/script/flume/nc-mem-logger.conf\（就是编写agent的一个配置文件）</span><br><span class="line">-Dflume.root.logger=INFO,console \      **打印日志到控制台</span><br><span class="line">-Dflume.monitoring.type=http \</span><br><span class="line">-Dflume.monitoring.port=34343    **在本机加上这个端口号可以查看一些东西（metrics）为之后监控做准备。</span><br><span class="line"></span><br><span class="line">启动之后看生成的日志里有 reloading 它代表不需要重启（就是你改了flume的agent内容，它会重加载不需要kill掉重启flume）</span><br><span class="line"></span><br><span class="line">日志里面会有event</span><br><span class="line">Event: 就是一条数据  是数据传输的最小单元 event从source到channel到sink</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">执行顺序： 先开启flume的哈 </span><br><span class="line">1.执行命令：</span><br><span class="line">	flume-ng agent \</span><br><span class="line">	--name a1 \</span><br><span class="line">	--conf-file /home/hadoop/script/flume/nc-mem-logger.conf \</span><br><span class="line">	--conf $FLUME_HOME/conf \</span><br><span class="line">	-Dflume.root.logger=INFO,console \</span><br><span class="line">	-Dflume.monitoring.type=http \</span><br><span class="line">	-Dflume.monitoring.port=34343</span><br><span class="line">2.开启telnet </span><br><span class="line">telnet ruozedata001 44445</span><br></pre></td></tr></table></figure></div>
<p>结果：<br><img src="https://img-blog.csdnimg.cn/20190909160931296.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTU1NzUxMg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eg：</span><br><span class="line">Event: &#123; headers:&#123;&#125; body: 72 75 6F 7A 65 64 61 74 61 0D                   ruozedata. &#125;</span><br><span class="line">Event：headers + body(字节数组))(存的是真正的数据）</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">未完待续。。。下一节介绍Flume的使用</span><br></pre></td></tr></table></figure></div>
      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Scala语法细节05-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/08/Scala%E8%AF%AD%E6%B3%95%E7%BB%86%E8%8A%8205-double-happy/">Scala语法细节05--double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2017/12/08/Scala%E8%AF%AD%E6%B3%95%E7%BB%86%E8%8A%8205-double-happy/" class="article-date">
  <time datetime="2017-12-08T11:49:04.000Z" itemprop="datePublished">2017-12-08</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="Case-Class"><a href="#Case-Class" class="headerlink" title="Case Class"></a>Case Class</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line">  *   </span><br><span class="line">  * case class 样例类  必须要有参数列表</span><br><span class="line">  * case object 样例对象  必须不能加参数列表</span><br><span class="line">  *</span><br><span class="line">  * interview： class 和 case class的区别</span><br><span class="line">  *</span><br><span class="line">  * case class 重写了toString， equals  hashCode</span><br><span class="line">  * case class 默认就实现了序列化</span><br><span class="line">  * case class 不用new</span><br><span class="line">  */</span><br><span class="line">object CaseClassApp &#123;</span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    println(Dog(&quot;旺财&quot;).name)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case class Dog(name:String)</span><br></pre></td></tr></table></figure></div>
<p>测试上面的结论：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">class :</span><br><span class="line">	scala&gt; class person(val name :String , val age : Int)</span><br><span class="line">	defined class person</span><br><span class="line">	</span><br><span class="line">	scala&gt; val p1 = new person(&quot;sx&quot;,24)</span><br><span class="line">	p1: person = person@38f796a5</span><br><span class="line">	</span><br><span class="line">	scala&gt; val p2 = new person(&quot;sx&quot;,24)</span><br><span class="line">	p2: person = person@1d04ef4f</span><br><span class="line">	</span><br><span class="line">	scala&gt; p1 ==p2</span><br><span class="line">	res37: Boolean = false</span><br><span class="line">case class :</span><br><span class="line">	scala&gt; case class Person(name : String ,age : Int)</span><br><span class="line">	defined class Person</span><br><span class="line"></span><br><span class="line">	scala&gt; val p3 = Person(&quot;sx&quot;,30)</span><br><span class="line">	p3: Person = Person(sx,30)</span><br><span class="line">	</span><br><span class="line">	scala&gt; val p4 = Person(&quot;sx&quot;,30)</span><br><span class="line">	p4: Person = Person(sx,30)</span><br><span class="line">	</span><br><span class="line">	scala&gt; p3 ==p4</span><br><span class="line">	res38: Boolean = true</span><br><span class="line"></span><br><span class="line">这里为什么 case  class 的就相等呢？</span><br><span class="line">	case class 重写了toString， equals  hashCode</span><br></pre></td></tr></table></figure></div>
<h2 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">**</span><br><span class="line">  *</span><br><span class="line">  * 模式匹配</span><br><span class="line">  * 身高</span><br><span class="line">  * 腿</span><br><span class="line">  * 脸</span><br><span class="line">  * 胸</span><br><span class="line">  *</span><br><span class="line">  *  变量  match &#123;</span><br><span class="line">  *     case 颜值 =&gt; code</span><br><span class="line">  *     case 腿  =&gt; code</span><br><span class="line">  *     case 身高 =&gt; code</span><br><span class="line">  *     case 脸   =&gt;  code</span><br><span class="line">  *     case _  =&gt; 凤姐 芙蓉姐姐</span><br><span class="line">  *  &#125;</span><br><span class="line">  *</span><br><span class="line">  * 匹配内容、匹配类型、匹配集合、匹配case</span><br><span class="line">  */</span><br><span class="line">object MatchApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">      * 匹配内容</span><br><span class="line">      */</span><br><span class="line"></span><br><span class="line">    val teachers = Array(&quot;Aoi Sola&quot;, &quot;YuiHatano&quot;, &quot;Akiho Yoshizawa&quot;)</span><br><span class="line">    val name = teachers(Random.nextInt(teachers.length))</span><br><span class="line"></span><br><span class="line">    name match &#123;</span><br><span class="line">      case &quot;YuiHatano&quot; =&gt; println(&quot;波老师&quot;)</span><br><span class="line">      case &quot;Akiho Yoshizawa&quot; =&gt; println(&quot;吉老师&quot;)</span><br><span class="line">      case _ =&gt; println(&quot;真不知道这位老师是谁&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">//    println(name)</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">      * 类型匹配</span><br><span class="line">      */</span><br><span class="line"></span><br><span class="line">    def matchType(obj:Any) = obj match &#123;</span><br><span class="line">      case x:Int =&gt; println(&quot;Int&quot;)</span><br><span class="line">      case s:String =&gt; println(&quot;String&quot;)</span><br><span class="line">      case m:Map[_,_] =&gt; println(&quot;Map&quot;)</span><br><span class="line">      case _ =&gt; println(&quot;Other Type...&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">//    matchType(1)</span><br><span class="line">//    matchType(&quot;若泽&quot;)</span><br><span class="line">//    matchType(Map(&quot;ruoze&quot;-&gt;30))</span><br><span class="line">//    matchType(10L)</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">      * 匹配集合</span><br><span class="line">      */</span><br><span class="line">    def matchList(list:List[String]): Unit = &#123;</span><br><span class="line">      list match &#123;</span><br><span class="line">        case &quot;ruoze&quot;::Nil =&gt; println(&quot;Hello: ruoze&quot;) // 只能匹配只有若泽一个元素</span><br><span class="line">        case x::y::Nil =&gt; println(s&quot;Hi: $x , $y&quot;) // 能匹配集合中有两个元素的</span><br><span class="line">        case &quot;jepson&quot;::tail =&gt; println(&quot;HI:jepson and others&quot;) // 匹配jepson开头的</span><br><span class="line">        case _ =&gt; println(&quot;......&quot;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">//    matchList(List(&quot;ruoze&quot;))</span><br><span class="line">//    matchList(List(&quot;苍老师&quot;,&quot;泷老师&quot;))</span><br><span class="line">//    matchList(List(&quot;jepson&quot;,&quot;苍老师&quot;,&quot;泷老师&quot;,&quot;波老师&quot;))</span><br><span class="line">//    matchList(List(&quot;苍老师&quot;,&quot;泷老师&quot;,&quot;波老师&quot;,&quot;jepson&quot;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">      * case class匹配</span><br><span class="line">      */</span><br><span class="line">    val caseclasses = Array(CheckTimeOutTask,HeartBeat(3000),SubmitTask(&quot;100&quot;,&quot;task100&quot;))</span><br><span class="line"></span><br><span class="line">    caseclasses(Random.nextInt(caseclasses.length)) match &#123;</span><br><span class="line">      case CheckTimeOutTask =&gt; println(&quot;CheckTimeOutTask&quot;)</span><br><span class="line">      case HeartBeat(time) =&gt; println(&quot;HeartBeat&quot;)</span><br><span class="line">      case SubmitTask(id,name) =&gt; println(&quot;SubmitTask&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">//涉及到流的方式 </span><br><span class="line">    val file = &quot;xx.txt&quot;</span><br><span class="line">    try&#123;</span><br><span class="line">      //TODO... 业务逻辑处理</span><br><span class="line">      // open file</span><br><span class="line">      1/0</span><br><span class="line">    &#125; catch &#123;</span><br><span class="line">      case e:ArithmeticException =&gt; println(&quot;除数不能为0...&quot;)</span><br><span class="line">      case e:Exception =&gt; e.printStackTrace()</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">      // 资源释放的</span><br><span class="line">      // close</span><br><span class="line">      println(&quot;一定会执行....&quot;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case class SubmitTask(id:String,name:String)</span><br><span class="line">case class HeartBeat(time:Long)</span><br><span class="line">case object CheckTimeOutTask</span><br></pre></td></tr></table></figure></div>
<h2 id="柯里化与偏函数"><a href="#柯里化与偏函数" class="headerlink" title="柯里化与偏函数"></a>柯里化与偏函数</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">object OtherFunctionApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    // currying</span><br><span class="line">    def sum(a:Int,b:Int) = a + b</span><br><span class="line"></span><br><span class="line">    //println(sum(3,5))</span><br><span class="line"></span><br><span class="line">    // Spark源码  Spark SQL UDF</span><br><span class="line">    def sum2(a:Int)(b:Int) = a + b</span><br><span class="line">    //println(sum2(4)(6))</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">      * 偏函数  PartialFunction</span><br><span class="line">      * A: 输入参数类型</span><br><span class="line">      * B：输出参数类型</span><br><span class="line">      *</span><br><span class="line">      * 包在花括号内没有match的一组case语句</span><br><span class="line">      */</span><br><span class="line">    val teachers = Array(&quot;Aoi Sola&quot;, &quot;YuiHatano&quot;, &quot;Akiho Yoshizawa&quot;)</span><br><span class="line">    val name = teachers(Random.nextInt(teachers.length))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def say:PartialFunction[String,String] = &#123;</span><br><span class="line">      case &quot;YuiHatano&quot; =&gt; &quot;波老师&quot;</span><br><span class="line">      case &quot;Akiho Yoshizawa&quot; =&gt; &quot;吉老师&quot;</span><br><span class="line">      case _ =&gt; &quot;真不知道这位老师是谁&quot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(say(name))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">object FileApp &#123;</span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val content = Source.fromFile(&quot;E:\\ruozedata_workspace\\ruozedata-spark\\data\\file.txt&quot;)</span><br><span class="line">//    println(content)</span><br><span class="line"></span><br><span class="line">    def read(): Unit =&#123;</span><br><span class="line">      for(line &lt;- content.getLines())&#123;  //</span><br><span class="line">        println(line)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    read()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Scala语法细节04-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/07/Scala%E8%AF%AD%E6%B3%95%E7%BB%86%E8%8A%8204-double-happy/">Scala语法细节04--double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2017/12/07/Scala%E8%AF%AD%E6%B3%95%E7%BB%86%E8%8A%8204-double-happy/" class="article-date">
  <time datetime="2017-12-07T11:48:16.000Z" itemprop="datePublished">2017-12-07</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="1-字符串插值"><a href="#1-字符串插值" class="headerlink" title="1.字符串插值"></a>1.字符串插值</h2><p>spark源码里有很多这个  如果遇到object调用方法要放入字符串里面 记得加上{}</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">object StringApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line">    val greeting = &quot;Hello:Ruozedata....&quot;</span><br><span class="line">    println(greeting)</span><br><span class="line"></span><br><span class="line">    val name = &quot;若泽数据&quot;</span><br><span class="line">    val welcome = &quot;Hello:&quot; + name</span><br><span class="line">    println(welcome)</span><br><span class="line"></span><br><span class="line">    // String interpolation</span><br><span class="line">    println(s&quot;Hello:$name&quot;)        //这块</span><br><span class="line"></span><br><span class="line">    val msg =</span><br><span class="line">      &quot;&quot;&quot;</span><br><span class="line">        |这是一个多行字符串</span><br><span class="line">        |hello</span><br><span class="line">        |若泽数据</span><br><span class="line">      &quot;&quot;&quot;.stripMargin</span><br><span class="line">    println(msg)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="List-（有序可重复的）"><a href="#List-（有序可重复的）" class="headerlink" title="List  （有序可重复的）"></a>List  （有序可重复的）</h2><p>集合里一定要记住 不适用new 方式创建的集合  都是调用object里的apply方法 </p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.长度不可变</span><br><span class="line">2.长度可变</span><br></pre></td></tr></table></figure></div>
<p>1.长度不可变</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Nil是什么？ 不可变的  空的List</span><br><span class="line">	scala&gt; Nil</span><br><span class="line">	res0: scala.collection.immutable.Nil.type = List()</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">head 和 tail    头是一个  尾是除了第一个剩下的</span><br><span class="line">     scala&gt; val l1 = List(1,2,3,4,5)</span><br><span class="line">	l1: List[Int] = List(1, 2, 3, 4, 5)</span><br><span class="line"></span><br><span class="line">	scala&gt; l1.head</span><br><span class="line">	res1: Int = 1</span><br><span class="line"></span><br><span class="line">	scala&gt; l1.tail</span><br><span class="line">	tail   tails</span><br><span class="line">	</span><br><span class="line">	scala&gt; l1.tail</span><br><span class="line">	res2: List[Int] = List(2, 3, 4, 5)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">结合上面头和尾 不适用List如何创建一个list呢？</span><br><span class="line">	::  使用它    前面放头（可以这么理解） 后面放尾</span><br><span class="line">	 </span><br><span class="line">	 scala&gt; val l2 = 1 :: Nil</span><br><span class="line">	l2: List[Int] = List(1)</span><br><span class="line"></span><br><span class="line">	scala&gt; val l3 = 2 :: l2</span><br><span class="line">	l3: List[Int] = List(2, 1)</span><br><span class="line">	</span><br><span class="line">	scala&gt; val l4 = 1 :: 2 :: 3 :: l3</span><br><span class="line">	l4: List[Int] = List(1, 2, 3, 2, 1)</span><br></pre></td></tr></table></figure></div>
<p>2.长度可变</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val l1 = scala.collection.mutable.ListBuffer[Int]()</span><br><span class="line">l1: scala.collection.mutable.ListBuffer[Int] = ListBuffer()</span><br><span class="line"></span><br><span class="line">scala&gt; l1 +=1</span><br><span class="line">res3: l1.type = ListBuffer(1)</span><br><span class="line"></span><br><span class="line">scala&gt; l1 += 2</span><br><span class="line">res4: l1.type = ListBuffer(1, 2)</span><br><span class="line"></span><br><span class="line">scala&gt; l1 += (3,4,5)</span><br><span class="line">res5: l1.type = ListBuffer(1, 2, 3, 4, 5)</span><br><span class="line"></span><br><span class="line">scala&gt; l1 ++= List(6,7,6,8)</span><br><span class="line">res6: l1.type = ListBuffer(1, 2, 3, 4, 5, 6, 7, 6, 8)</span><br><span class="line"></span><br><span class="line">scala&gt; l1 -=2</span><br><span class="line">res7: l1.type = ListBuffer(1, 3, 4, 5, 6, 7, 6, 8)</span><br><span class="line"></span><br><span class="line">scala&gt; l1 -=4</span><br><span class="line">res8: l1.type = ListBuffer(1, 3, 5, 6, 7, 6, 8)</span><br><span class="line"></span><br><span class="line">scala&gt; l1 -=(1,3,4)</span><br><span class="line">res9: l1.type = ListBuffer(5, 6, 7, 6, 8)</span><br><span class="line"></span><br><span class="line">scala&gt; l1 --=List(5,6,7)</span><br><span class="line">res10: l1.type = ListBuffer(6, 8)</span><br><span class="line"></span><br><span class="line">scala&gt; l1.toList()</span><br><span class="line">&lt;console&gt;:13: error: not enough arguments for method apply: (n: Int)Int in trait LinearSeqOptimized.</span><br><span class="line">Unspecified value parameter n.</span><br><span class="line">       l1.toList()</span><br><span class="line">                ^</span><br><span class="line"></span><br><span class="line">scala&gt; l1.toList</span><br><span class="line">res12: List[Int] = List(6, 8)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">递归实现求和 ：别的太low 哈  面试掉价</span><br><span class="line">  //递归方法要求是一定有返回值的</span><br><span class="line">    def sum(nums : Int*) : Int = &#123;</span><br><span class="line"></span><br><span class="line">      if(nums.length == 0) 0</span><br><span class="line"></span><br><span class="line">      else nums.head + sum(nums.tail : _*)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(sum(1,2,3,5,6))</span><br></pre></td></tr></table></figure></div>
<h2 id="zipwithIndex"><a href="#zipwithIndex" class="headerlink" title="zipwithIndex"></a>zipwithIndex</h2><p>是将结果加上index</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val names = List(&quot;cxk&quot;,&quot;oyll&quot;,&quot;ailics&quot;)</span><br><span class="line">names: List[String] = List(cxk, oyll, ailics)</span><br><span class="line"></span><br><span class="line">scala&gt; val score = List(4,6,10)</span><br><span class="line">score: List[Int] = List(4, 6, 10)</span><br><span class="line"></span><br><span class="line">scala&gt; val result: List[(Int, String)] = score.zip(names)</span><br><span class="line">result: List[(Int, String)] = List((4,cxk), (6,oyll), (10,ailics))</span><br><span class="line"></span><br><span class="line">scala&gt; result.zip</span><br><span class="line">zip   zipAll   zipWithIndex</span><br><span class="line"></span><br><span class="line">scala&gt; result.zipWithIndex</span><br><span class="line">res13: List[((Int, String), Int)] = List(((4,cxk),0), ((6,oyll),1), ((10,ailics),2))</span><br><span class="line"></span><br><span class="line">scala&gt; result.zipWithIndex.zipWithIndex</span><br><span class="line">res14: List[(((Int, String), Int), Int)] = List((((4,cxk),0),0), (((6,oyll),1),1), (((10,ailics),2),2))</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">那么要求取出上面结果的 蔡徐坤 怎么取呢？  最好是filter一下 这里是写死的 </span><br><span class="line">	</span><br><span class="line">scala&gt; result.zipWithIndex.zipWithIndex</span><br><span class="line">res14: List[(((Int, String), Int), Int)] = List((((4,cxk),0),0), (((6,oyll),1),1), (((10,ailics),2),2))</span><br><span class="line"></span><br><span class="line">scala&gt; res1</span><br><span class="line">res1   res10   res12   res13   res14</span><br><span class="line"></span><br><span class="line">scala&gt; res14(0)._1._1._2</span><br><span class="line">res15: String = cxk</span><br></pre></td></tr></table></figure></div>
<h2 id="Set（无序不可重复）可以去重"><a href="#Set（无序不可重复）可以去重" class="headerlink" title="Set（无序不可重复）可以去重"></a>Set（无序不可重复）可以去重</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val list = List(1,2,3,4,4,4,5)</span><br><span class="line">list: List[Int] = List(1, 2, 3, 4, 4, 4, 5)</span><br><span class="line"></span><br><span class="line">scala&gt; val set = Set(1,2,3,4,4,4,5)</span><br><span class="line">set: scala.collection.immutable.Set[Int] = Set(5, 1, 2, 3, 4)</span><br></pre></td></tr></table></figure></div>
<h2 id="Map-k-v"><a href="#Map-k-v" class="headerlink" title="Map(k-v)"></a>Map(k-v)</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.值不可变</span><br><span class="line">2.值可变</span><br></pre></td></tr></table></figure></div>
<p>1.值不可变</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val mp = Map(&quot;sx&quot;-&gt;24,&quot;dou_hap&quot;-&gt;18)</span><br><span class="line">mp: scala.collection.immutable.Map[String,Int] = Map(sx -&gt; 24, dou_hap -&gt; 18)</span><br><span class="line"></span><br><span class="line">scala&gt; mp(&quot;sx&quot;)</span><br><span class="line">res16: Int = 24</span><br><span class="line"></span><br><span class="line">scala&gt; mp(&quot;cangjk&quot;)</span><br><span class="line">java.util.NoSuchElementException: key not found: cangjk</span><br><span class="line">  at scala.collection.MapLike$class.default(MapLike.scala:228)</span><br><span class="line">  at scala.collection.AbstractMap.default(Map.scala:59)</span><br><span class="line">  at scala.collection.MapLike$class.apply(MapLike.scala:141)</span><br><span class="line">  at scala.collection.AbstractMap.apply(Map.scala:59)</span><br><span class="line">  ... 32 elided</span><br><span class="line"></span><br><span class="line">scala&gt; mp(&quot;sx&quot;)=20</span><br><span class="line">&lt;console&gt;:13: error: value update is not a member of scala.collection.immutable.Map[String,Int]</span><br><span class="line">       mp(&quot;sx&quot;)=20</span><br><span class="line">       ^</span><br></pre></td></tr></table></figure></div>
<p>2.值可变（工作中要用这种的）</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val m = scala.collection.mutable.Map(&quot;ruoze&quot;-&gt;20,&quot;jepson&quot;-&gt; 18)</span><br><span class="line">m: scala.collection.mutable.Map[String,Int] = Map(ruoze -&gt; 20, jepson -&gt; 18)</span><br><span class="line"></span><br><span class="line">scala&gt; m(&quot;canglaoshi&quot;)=38</span><br><span class="line"></span><br><span class="line">scala&gt; m</span><br><span class="line">res20: scala.collection.mutable.Map[String,Int] = Map(ruoze -&gt; 20, jepson -&gt; 18, canglaoshi -&gt; 38)</span><br><span class="line"></span><br><span class="line">scala&gt; m(&quot;canglaoshi&quot;)=35</span><br><span class="line"></span><br><span class="line">scala&gt; m</span><br><span class="line">res22: scala.collection.mutable.Map[String,Int] = Map(ruoze -&gt; 20, jepson -&gt; 18, canglaoshi -&gt; 35)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">优化娶不到的人 不让他报错  getOrElse</span><br><span class="line">	scala&gt; m</span><br><span class="line">res22: scala.collection.mutable.Map[String,Int] = Map(ruoze -&gt; 20, jepson -&gt; 18, canglaoshi -&gt; 35)</span><br><span class="line"></span><br><span class="line">scala&gt; m(&quot;longlaoshi&quot;)</span><br><span class="line">java.util.NoSuchElementException: key not found: longlaoshi</span><br><span class="line">  at scala.collection.MapLike$class.default(MapLike.scala:228)</span><br><span class="line">  at scala.collection.AbstractMap.default(Map.scala:59)</span><br><span class="line">  at scala.collection.mutable.HashMap.apply(HashMap.scala:65)</span><br><span class="line">  ... 32 elided</span><br><span class="line"></span><br><span class="line">scala&gt; m.getOrElse(&quot;longlaoshi&quot;,27)</span><br><span class="line">res24: Int = 27</span><br><span class="line"></span><br><span class="line">scala&gt; m.getOrElse(&quot;canglaoshi&quot;,27)</span><br><span class="line">res25: Int = 35</span><br></pre></td></tr></table></figure></div>
<p>spark源码里有很多 getOrElse </p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; m</span><br><span class="line">res26: scala.collection.mutable.Map[String,Int] = Map(ruoze -&gt; 20, jepson -&gt; 18, canglaoshi -&gt; 35)</span><br><span class="line"></span><br><span class="line">scala&gt; m +=(&quot;longlaoshi&quot;-&gt;27,&quot;bolaoshi&quot;-&gt;31)</span><br><span class="line">res27: m.type = Map(longlaoshi -&gt; 27, bolaoshi -&gt; 31, ruoze -&gt; 20, jepson -&gt; 18, canglaoshi -&gt; 35)</span><br><span class="line"></span><br><span class="line">scala&gt; m -=&quot;ruoze&quot;</span><br><span class="line">res28: m.type = Map(longlaoshi -&gt; 27, bolaoshi -&gt; 31, jepson -&gt; 18, canglaoshi -&gt; 35)</span><br><span class="line"></span><br><span class="line">scala&gt; m.contains(&quot;ruoze&quot;)</span><br><span class="line">res29: Boolean = false</span><br><span class="line"></span><br><span class="line">scala&gt; m.contains(&quot;jepson&quot;)</span><br><span class="line">res30: Boolean = true</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">遍历Map;</span><br><span class="line">val map = scala.collection.mutable.Map(&quot;longlaoshi&quot; -&gt; 27, &quot;bolaoshi&quot; -&gt; 31, &quot;jepson&quot; -&gt; 18, &quot;canglaoshi&quot; -&gt; 35)</span><br><span class="line"></span><br><span class="line">    for((k,v) &lt;- map) &#123;</span><br><span class="line"></span><br><span class="line">      println(k +&quot;--&gt;&quot; + v)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(&quot;---------------&quot;)</span><br><span class="line">    for((k,_) &lt;- map) &#123;</span><br><span class="line"></span><br><span class="line">      println(k +&quot;--&gt;&quot; +map.getOrElse(k,-99))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(&quot;---------------&quot;)</span><br><span class="line"></span><br><span class="line">    for(k &lt;- map.keySet) &#123;</span><br><span class="line">      println(k +&quot;--&gt;&quot; + map.getOrElse(k,-99))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(&quot;---------------&quot;)</span><br><span class="line"></span><br><span class="line">    for(v &lt;- map.values) &#123;</span><br><span class="line">      println(v)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">longlaoshi--&gt;27</span><br><span class="line">bolaoshi--&gt;31</span><br><span class="line">jepson--&gt;18</span><br><span class="line">canglaoshi--&gt;35</span><br><span class="line">---------------</span><br><span class="line">longlaoshi--&gt;27</span><br><span class="line">bolaoshi--&gt;31</span><br><span class="line">jepson--&gt;18</span><br><span class="line">canglaoshi--&gt;35</span><br><span class="line">---------------</span><br><span class="line">longlaoshi--&gt;27</span><br><span class="line">bolaoshi--&gt;31</span><br><span class="line">jepson--&gt;18</span><br><span class="line">canglaoshi--&gt;35</span><br><span class="line">---------------</span><br><span class="line">27</span><br><span class="line">31</span><br><span class="line">18</span><br><span class="line">35</span><br></pre></td></tr></table></figure></div>
<p>这种map是不能排序的 </p>
<p>能排序的 sortedMap , LinkedHashMap</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val m = Map(1-&gt;2)</span><br><span class="line">m: scala.collection.immutable.Map[Int,Int] = Map(1 -&gt; 2)</span><br><span class="line"></span><br><span class="line">scala&gt; m.get(1)</span><br><span class="line">res31: Option[Int] = Some(2)</span><br><span class="line"></span><br><span class="line">scala&gt; m.get(2)</span><br><span class="line">res32: Option[Int] = None</span><br><span class="line"></span><br><span class="line">scala&gt; m.get(1).get</span><br><span class="line">res33: Int = 2</span><br><span class="line"></span><br><span class="line">scala&gt; m.get(2).get</span><br><span class="line">java.util.NoSuchElementException: None.get</span><br><span class="line">  at scala.None$.get(Option.scala:347)</span><br><span class="line">  at scala.None$.get(Option.scala:345)</span><br><span class="line">  ... 32 elided</span><br><span class="line"></span><br><span class="line">scala&gt; m.get(1).getOrElse(&quot;None&quot;)</span><br><span class="line">res35: Any = 2</span><br><span class="line"></span><br><span class="line">scala&gt; m.get(2).getOrElse(&quot;None&quot;)</span><br><span class="line">res36: Any = None</span><br></pre></td></tr></table></figure></div>
      
    </div>
    
  </div>
  
  
</article>

  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/">Next &amp;raquo;</a>
  </nav>


</section>
        <aside id="sidebar">
  
    <div class="widget-box">
  <div class="avatar-box">
    <img class="avatar" src="/images/default-avatar.jpg" title="图片来自网络"></img>
    <h3 class="avatar-name">
      
        DoubleHappy
      
    </h3>
    <p class="avatar-slogan">
      特别耐撕的大数据，资深的打酱油攻城狮。
    </p>
  </div>
</div>


  
    

  
    

  
    
  
    
  <div class="widget-box">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li></ul>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/04/27/k8s-Spark-doublehappy/">k8s-Spark-doublehappy</a>
          </li>
        
          <li>
            <a href="/2020/01/05/Kudu-Impala%E6%95%85%E9%9A%9C%E6%A1%88%E4%BE%8B01-double-happy/">Kudu+Impala故障案例01--double_happy</a>
          </li>
        
          <li>
            <a href="/2020/01/05/Flink04-double-happy/">Flink04--double_happy</a>
          </li>
        
          <li>
            <a href="/2020/01/05/Flink03-double-happy/">Flink03--double_happy</a>
          </li>
        
          <li>
            <a href="/2020/01/05/Flink02-double-happy/">Flink02--double_happy</a>
          </li>
        
      </ul>
    </div>
  </div>

  
      <div class="widget-box">
    <h3 class="widget-title">友链</h3>
    <div class="widget">
      
        <a style="display: block;" href="https://liverrrr.fun/archives" title target='_blank'
        >一路眼瞎</a>
      
    </div>
  </div>

  
</aside>
      </div>
      <footer id="footer">
  <div class="foot-box global-width">
    &copy; 2020 DoubleHappy &nbsp;&nbsp;
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    &nbsp;|&nbsp;主题 <a href="https://github.com/yiluyanxia/hexo-theme-antiquity" target="_blank" rel="noopener">antiquity</a>
    <br>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">不蒜子告之   阁下是第<span id="busuanzi_value_site_pv"></span>个访客</span>
  </div>
</footer>
      <script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
<script>
if (!window.jQuery) {
var script = document.createElement('script');
script.src = "/js/jquery-2.0.3.min.js";
document.body.write(script);
}
</script>


<script src="/js/script.js"></script>



    </div>
    <nav id="mobile-nav" class="mobile-nav-box">
  <div class="mobile-nav-img mobile-nav-top"></div>
  
    <a href="/archives" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
  <div class="mobile-nav-img  mobile-nav-bottom"></div>
</nav>    
  </div>
</body>
</html>