<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>SQL-01 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta name="description" content="SQL-第一题：聚合函数形式的题先讨论一下最基础的东西在hivesql里，比较晦涩，但是真的很好用哦。 123谈谈个人理解： 在sql里两个核心的东西：（1）group ：核心是聚合（2）join ：的核心是要join哪些列  注意：group by 和 over在一个select里不能同时使用的哈  12345我们为什么要聚合呢？eg：一个表 表示三个班级的学生，有名称，分数，班级，如果不聚合">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL-01">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2017&#x2F;12&#x2F;20&#x2F;SQL-01&#x2F;index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="SQL-第一题：聚合函数形式的题先讨论一下最基础的东西在hivesql里，比较晦涩，但是真的很好用哦。 123谈谈个人理解： 在sql里两个核心的东西：（1）group ：核心是聚合（2）join ：的核心是要join哪些列  注意：group by 和 over在一个select里不能同时使用的哈  12345我们为什么要聚合呢？eg：一个表 表示三个班级的学生，有名称，分数，班级，如果不聚合">
<meta property="og:locale" content="en">
<meta property="og:image" content="https:&#x2F;&#x2F;img-blog.csdnimg.cn&#x2F;20190917102337546.png?x-oss-process=image&#x2F;watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTU1NzUxMg==,size_16,color_FFFFFF,t_70">
<meta property="og:updated_time" content="2019-11-17T11:53:45.958Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;img-blog.csdnimg.cn&#x2F;20190917102337546.png?x-oss-process=image&#x2F;watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTU1NzUxMg==,size_16,color_FFFFFF,t_70">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/default-avatar.jpg">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlight.css">
</head>

<body>
  <div id="fullpage" class="mobile-nav-right">
    
      <div id="wrapper" title="图片来自网络">
    
    
      <header id="header">
  <div id="nav-toggle" class="nav-toggle"></div>
  <div class="head-box global-width">
    <nav class="nav-box nav-right">
      
        <a class="nav-item" href="/" title
        
        >首页</a>
      
        <a class="nav-item" href="/archives" title
        
        >归档</a>
      
    </nav>
  </div>
</header>
      <div id="middlecontent" title class="global-width sidebar-right">
        <section id="main"><article id="post-SQL-01" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 class="article-title" itemprop="name">
      SQL-01
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2017/12/20/SQL-01/" class="article-date">
  <time datetime="2017-12-20T11:53:13.000Z" itemprop="datePublished">2017-12-20</time>
</a>
    
    
  </div>
  
    <span id="busuanzi_container_page_pv">
      本文总阅读量<span id="busuanzi_value_page_pv"></span>次
    </span>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="SQL-第一题：聚合函数形式的题"><a href="#SQL-第一题：聚合函数形式的题" class="headerlink" title="SQL-第一题：聚合函数形式的题"></a>SQL-第一题：聚合函数形式的题</h2><p>先讨论一下最基础的东西在hivesql里，比较晦涩，但是真的很好用哦。</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">谈谈个人理解：</span><br><span class="line"> 在sql里两个核心的东西：（1）group ：核心是聚合（2）join ：的核心是要join哪些列 </span><br><span class="line"> 注意：group by 和 over在一个select里不能同时使用的哈</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">我们为什么要聚合呢？</span><br><span class="line">eg：一个表 表示三个班级的学生，有名称，分数，班级，如果不聚合 </span><br><span class="line">我能不能这样写呢 </span><br><span class="line">select name , score from student group by class  </span><br><span class="line">不能 为什么不能？</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">首先我的name,score 在groupby的时候我不知道取哪一个，</span><br><span class="line">groupby class 就相当于在所有的列名里面取项，你不知道取哪个name，哪个score，</span><br><span class="line">所以取得项要么出现在groupby 后面，</span><br><span class="line">要么取得项是一个聚合列（eg：sum（score）代表每个班的所有得分数） ，</span><br><span class="line">这个聚合列就用到聚合函数udaf函数。</span><br></pre></td></tr></table></figure></div>
<p>案例1 ：【聚合函数形式的题】</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">eg:求每一个班级得分最高的学生得姓名+分数+班级？</span><br><span class="line"> 解决方法：</span><br><span class="line"> 1.sql -GroupBy +Join</span><br><span class="line"> 2.RDD</span><br><span class="line"> 3.sql -开窗</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">开窗函数：就是1对多 ，1就是partition by 谁 ,产生了多个数（产生了一个新列存这多个数） </span><br><span class="line">group by ：是多对1，把多个合并成一个</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.group by + join</span><br><span class="line">1）子表a ： select class,max(score)  score from student group by class </span><br><span class="line">    （1）中不能有name 想完成需求只能子表与原表join形成一个大表，利用大表添加name</span><br><span class="line">2）</span><br><span class="line">    select b.name, a.class,a.score from student b </span><br><span class="line">join </span><br><span class="line">    (select class,max(score) score from student group by class ) a</span><br><span class="line">on </span><br><span class="line"> b.class =a.class and a.score = b.score</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2.开窗函数 </span><br><span class="line">开窗函数：结合上面的问题，我在表后面再加一列，加什么列呢，首先第一个我是按照班级先分组，</span><br><span class="line">班级里的分数从高到低做一个排序，把排序的名次 作为要加的列。</span><br><span class="line">这样就不用像上面那样group by，直接select 那个列就能取到值。这个就叫开窗函数。</span><br><span class="line">   select name,class,score,rank() over(partition by class order by score desc)  rank from student </span><br><span class="line">这个语句就是为了产生最后一列 。 over就叫开窗函数 ，这个over里面怎么开的窗呢？</span><br><span class="line">partition by 就是先分组（就是以什么开窗，相当于 再某一个class里面我用一次rank()，在另一个class里面 </span><br><span class="line">我在用一次rank（）， rank()的应用前提是 order by 某个东西,rank()之后，这样就产生了最后一列 名字叫rank </span><br><span class="line">这个语句执行之后产生了一个新的表，这个表多了一列叫rank。假如这个表叫aa</span><br><span class="line">我产生完表aa之后，直接就</span><br><span class="line"> select name,class,score from aa where rank =1   就完成需求</span><br></pre></td></tr></table></figure></div>
<p>开窗函数里不止只有Rank()函数可用 ，它有很多哈<br><img src="https://img-blog.csdnimg.cn/20190917102337546.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTU1NzUxMg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="SQL题01"><a href="#SQL题01" class="headerlink" title="SQL题01"></a>SQL题01</h2><p>先讲思路–&gt;再演示结果</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SQL1： ods_domain_traffic_info这个表</span><br><span class="line">domain           time     traffic(T)</span><br><span class="line">gifshow.com   2019/01/01    5</span><br><span class="line">yy.com        2019/01/01    4</span><br><span class="line">huya.com      2019/01/01    1</span><br><span class="line">gifshow.com   2019/01/20    6</span><br><span class="line">gifshow.com   2019/02/01    8</span><br><span class="line">yy.com        2019/01/20    5</span><br><span class="line">gifshow.com   2019/02/02    7</span><br><span class="line">需求：统计每个用户的累计访问量   一个SQL搞定</span><br><span class="line">结果如下：</span><br><span class="line">domain          month     traffics   totals</span><br><span class="line">gifshow.com     2019-01      11         11</span><br><span class="line">gifshow.com     2019-02      15         26</span><br><span class="line">yy.com          2019-01       9         9</span><br><span class="line">huya.com        2019-01       1         1</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">思路：</span><br><span class="line">	结果要求的是 每个domain 每个月的 traffics  和 totals</span><br><span class="line">分两步：</span><br><span class="line">1.domain + month + traffics</span><br><span class="line">a.</span><br><span class="line">month : time 截取获得</span><br><span class="line">traffics : sum(traffic)</span><br><span class="line">b.</span><br><span class="line">group by(domain,month ) +sum(traffic) ===&gt; 拿到domain   month    traffics</span><br><span class="line"></span><br><span class="line">2.拿到domain   month    traffics 目的是 domain   month    traffics  totals</span><br><span class="line"></span><br><span class="line">a.新生成了一个列 totals  先想到 开窗函数 over()</span><br><span class="line">	partition by  谁呢？ order by 谁呢？</span><br><span class="line">	基于给的结果知道  partition by domain   order by  month     over()前面选择 sum(traffics) </span><br><span class="line">这样就ok了</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">我写sql思路过程：</span><br><span class="line">1.每个domain 每个month的总量  ==》    domain   month  traffics</span><br><span class="line">tmp :</span><br><span class="line">	select </span><br><span class="line">		domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, </span><br><span class="line">		sum(traffic) as traffics</span><br><span class="line">	from ods_domain_traffic_info</span><br><span class="line">	group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">	</span><br><span class="line">2.目的是totals 生成了一个新列（1对多） 用开窗函数 ，以domain分组以month排序 之后用sum</span><br><span class="line">result:</span><br><span class="line">	select</span><br><span class="line">		domain,month,traffics,</span><br><span class="line">		sum(traffics)over(partition by domain order by month) as totals</span><br><span class="line">	from  tmp;</span><br><span class="line"></span><br><span class="line">整合：</span><br><span class="line">	select</span><br><span class="line">		domain,month,traffics,</span><br><span class="line">		sum(traffics)over(partition by domain order by month) as totals</span><br><span class="line">	from(</span><br><span class="line">	select </span><br><span class="line">		domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, </span><br><span class="line">		sum(traffic) as traffics</span><br><span class="line">	from ods_domain_traffic_info</span><br><span class="line">	group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">	) as tmp;</span><br><span class="line"></span><br><span class="line">注意哈：我写博客为了好看 使用了 tab建 ，如何你想测试的话 把sql中的tab 地方去掉哈 。</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">结果演示：</span><br><span class="line">1. domain +time + traffic ---&gt; domain + month + traffics</span><br><span class="line">每个domain 每个month的总量  ==》    domain   month  traffics</span><br><span class="line">tmp :</span><br><span class="line">	select </span><br><span class="line">		domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, </span><br><span class="line">		sum(traffic) as traffics</span><br><span class="line">	from ods_domain_traffic_info</span><br><span class="line">	group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_domain_traffic_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7);</span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917140000_1dab3570-5d32-449f-ab8f-4c896be57622): select</span><br><span class="line">domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">from ods_domain_traffic_info</span><br><span class="line">group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:domain, type:string, comment:null), FieldSchema(name:month, type:string, comment:null), FieldSchema(name:traffics, type:bigint, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917140000_1dab3570-5d32-449f-ab8f-4c896be57622); Time taken: 0.498 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917140000_1dab3570-5d32-449f-ab8f-4c896be57622): select</span><br><span class="line">domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">from ods_domain_traffic_info</span><br><span class="line">group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">INFO  : Query ID = double_happy_20190917140000_1dab3570-5d32-449f-ab8f-4c896be57622</span><br><span class="line">INFO  : Total jobs = 1</span><br><span class="line">INFO  : Launching Job 1 out of 1</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0001, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0001/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0001</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:00:23,046 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:00:28,411 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.44 sec</span><br><span class="line">INFO  : 2019-09-17 14:00:34,894 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 3.51 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 3 seconds 510 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0001</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 3.51 sec   HDFS Read: 9195 HDFS Write: 82 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 3 seconds 510 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917140000_1dab3570-5d32-449f-ab8f-4c896be57622); Time taken: 23.04 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+--------------+----------+-----------+--+</span><br><span class="line">|    domain    |  month   | traffics  |</span><br><span class="line">+--------------+----------+-----------+--+</span><br><span class="line">| gifshow.com  | 2019-01  | 11        |</span><br><span class="line">| gifshow.com  | 2019-02  | 15        |</span><br><span class="line">| huya.com     | 2019-01  | 1         |</span><br><span class="line">| yy.com       | 2019-01  | 9         |</span><br><span class="line">+--------------+----------+-----------+--+</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.目的是totals 生成了一个新列（1对多） 用开窗函数 ，以domain分组以month排序 之后用sum</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; domain,month,traffics,</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; sum(traffics)over(partition by domain order by month) as totals</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from(</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; select </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_domain_traffic_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; ) as tmp;</span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917140202_f7fde489-9ae9-4ab5-85fd-591382b70891): select</span><br><span class="line">domain,month,traffics,</span><br><span class="line">sum(traffics)over(partition by domain order by month) as totals</span><br><span class="line">from(</span><br><span class="line">select</span><br><span class="line">domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">from ods_domain_traffic_info</span><br><span class="line">group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">) as tmp</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:domain, type:string, comment:null), FieldSchema(name:month, type:string, comment:null), FieldSchema(name:traffics, type:bigint, comment:null), FieldSchema(name:totals, type:bigint, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917140202_f7fde489-9ae9-4ab5-85fd-591382b70891); Time taken: 0.156 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917140202_f7fde489-9ae9-4ab5-85fd-591382b70891): select</span><br><span class="line">domain,month,traffics,</span><br><span class="line">sum(traffics)over(partition by domain order by month) as totals</span><br><span class="line">from(</span><br><span class="line">select</span><br><span class="line">domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">from ods_domain_traffic_info</span><br><span class="line">group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">) as tmp</span><br><span class="line">INFO  : Query ID = double_happy_20190917140202_f7fde489-9ae9-4ab5-85fd-591382b70891</span><br><span class="line">INFO  : Total jobs = 1</span><br><span class="line">INFO  : Launching Job 1 out of 1</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0002, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0002/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0002</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:02:38,123 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:02:44,384 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.64 sec</span><br><span class="line">INFO  : 2019-09-17 14:02:50,678 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 4.26 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 4 seconds 260 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0002</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 4.26 sec   HDFS Read: 11518 HDFS Write: 92 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 4 seconds 260 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917140202_f7fde489-9ae9-4ab5-85fd-591382b70891); Time taken: 21.812 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+--------------+----------+-----------+---------+--+</span><br><span class="line">|    domain    |  month   | traffics  | totals  |</span><br><span class="line">+--------------+----------+-----------+---------+--+</span><br><span class="line">| gifshow.com  | 2019-01  | 11        | 11      |</span><br><span class="line">| gifshow.com  | 2019-02  | 15        | 26      |</span><br><span class="line">| huya.com     | 2019-01  | 1         | 1       |</span><br><span class="line">| yy.com       | 2019-01  | 9         | 9       |</span><br><span class="line">+--------------+----------+-----------+---------+--+</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">也可以这样的 ：不生成新的列：</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; domain,month,</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; sum(traffics)over(partition by domain order by month) as traffics</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from(</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; select </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_domain_traffic_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; ) as tmp;</span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917140505_20c693e7-e3af-4233-966a-94cdfc50388d): select</span><br><span class="line">domain,month,</span><br><span class="line">sum(traffics)over(partition by domain order by month) as traffics</span><br><span class="line">from(</span><br><span class="line">select</span><br><span class="line">domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">from ods_domain_traffic_info</span><br><span class="line">group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">) as tmp</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:domain, type:string, comment:null), FieldSchema(name:month, type:string, comment:null), FieldSchema(name:traffics, type:bigint, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917140505_20c693e7-e3af-4233-966a-94cdfc50388d); Time taken: 0.05 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917140505_20c693e7-e3af-4233-966a-94cdfc50388d): select</span><br><span class="line">domain,month,</span><br><span class="line">sum(traffics)over(partition by domain order by month) as traffics</span><br><span class="line">from(</span><br><span class="line">select</span><br><span class="line">domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7) as month, sum(traffic) as traffics</span><br><span class="line">from ods_domain_traffic_info</span><br><span class="line">group by domain,substr(regexp_replace(time,&quot;/&quot;,&quot;-&quot;),1,7)</span><br><span class="line">) as tmp</span><br><span class="line">INFO  : Query ID = double_happy_20190917140505_20c693e7-e3af-4233-966a-94cdfc50388d</span><br><span class="line">INFO  : Total jobs = 1</span><br><span class="line">INFO  : Launching Job 1 out of 1</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0003, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0003/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0003</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:05:17,501 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:05:22,722 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.47 sec</span><br><span class="line">INFO  : 2019-09-17 14:05:29,989 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 3.97 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 3 seconds 970 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0003</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 3.97 sec   HDFS Read: 11443 HDFS Write: 82 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 3 seconds 970 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917140505_20c693e7-e3af-4233-966a-94cdfc50388d); Time taken: 21.456 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+--------------+----------+-----------+--+</span><br><span class="line">|    domain    |  month   | traffics  |</span><br><span class="line">+--------------+----------+-----------+--+</span><br><span class="line">| gifshow.com  | 2019-01  | 11        |</span><br><span class="line">| gifshow.com  | 2019-02  | 26        |</span><br><span class="line">| huya.com     | 2019-01  | 1         |</span><br><span class="line">| yy.com       | 2019-01  | 9         |</span><br><span class="line">+--------------+----------+-----------+--+</span><br></pre></td></tr></table></figure></div>


<h2 id="SQL2"><a href="#SQL2" class="headerlink" title="SQL2"></a>SQL2</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL2:</span><br><span class="line">uid pid</span><br><span class="line">user1 a</span><br><span class="line">user2 b</span><br><span class="line">user1 c</span><br><span class="line">user2 c</span><br><span class="line">user3 c</span><br><span class="line">user3 c</span><br><span class="line">1）uv  ==&gt; uid cnt  应该是pid 有多少uid 访问 统计 uid个数  , 或者反过来？？</span><br><span class="line">2）统计每个产品top3的用户信息 ==&gt;  pid  uid  cnt</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">思路：</span><br><span class="line">（1）这块有歧义 那么两个都做一下</span><br><span class="line">	pid 有多少uid ？ 每个pid 有多少个 uid  ==》 pid + uid </span><br><span class="line">1. group by pid +count(distinct(uid))   要去重的 </span><br><span class="line">    uid访问pid的个数？  每个uid  + pid</span><br><span class="line"> a. group by uid  + count(distinct(pid))   要对pid去重</span><br><span class="line"></span><br><span class="line">这题比较简单 就是以谁分组 count 去重后的谁</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">结果展示： 因为我就造了3个pid  abc 100个user</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select uid ,count(distinct(pid)) as cnt</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_uid_pid_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by uid;</span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917141414_3c87306d-3ebd-49b1-9371-8fdba5629b97): select uid ,count(distinct(pid)) as cnt</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by uid</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:uid, type:string, comment:null), FieldSchema(name:cnt, type:bigint, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917141414_3c87306d-3ebd-49b1-9371-8fdba5629b97); Time taken: 0.055 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917141414_3c87306d-3ebd-49b1-9371-8fdba5629b97): select uid ,count(distinct(pid)) as cnt</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by uid</span><br><span class="line">INFO  : Query ID = double_happy_20190917141414_3c87306d-3ebd-49b1-9371-8fdba5629b97</span><br><span class="line">INFO  : Total jobs = 1</span><br><span class="line">INFO  : Launching Job 1 out of 1</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0004, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0004/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0004</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:14:52,471 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:14:57,670 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.05 sec</span><br><span class="line">INFO  : 2019-09-17 14:15:03,926 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 2.69 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 2 seconds 690 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0004</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 2.69 sec   HDFS Read: 17780 HDFS Write: 846 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 2 seconds 690 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917141414_3c87306d-3ebd-49b1-9371-8fdba5629b97); Time taken: 19.383 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+----------+------+--+</span><br><span class="line">|   uid    | cnt  |</span><br><span class="line">+----------+------+--+</span><br><span class="line">| user0    | 1    |</span><br><span class="line">| user1    | 3    |</span><br><span class="line">| user10   | 3    |</span><br><span class="line">| user100  | 3    |</span><br><span class="line">| user11   | 3    |</span><br><span class="line">| user12   | 3    |</span><br><span class="line">| user13   | 3    |</span><br><span class="line">| user14   | 3    |</span><br><span class="line">| user15   | 3    |</span><br><span class="line">| user16   | 3    |</span><br><span class="line">| user17   | 3    |</span><br><span class="line">| user18   | 1    |</span><br><span class="line">| user19   | 2    |</span><br><span class="line">| user2    | 3    |</span><br><span class="line">| user20   | 3    |</span><br><span class="line">| user21   | 3    |</span><br><span class="line">| user22   | 3    |</span><br><span class="line">| user24   | 3    |</span><br><span class="line">| user25   | 3    |</span><br><span class="line">| user26   | 3    |</span><br><span class="line">| user27   | 3    |</span><br><span class="line">| user28   | 3    |</span><br><span class="line">| user29   | 3    |</span><br><span class="line">| user3    | 3    |</span><br><span class="line">| user30   | 3    |</span><br><span class="line">| user31   | 2    |</span><br><span class="line">| user32   | 3    |</span><br><span class="line">| user33   | 3    |</span><br><span class="line">| user34   | 3    |</span><br><span class="line">| user36   | 2    |</span><br><span class="line">| user37   | 3    |</span><br><span class="line">| user38   | 3    |</span><br><span class="line">| user39   | 1    |</span><br><span class="line">| user4    | 3    |</span><br><span class="line">| user41   | 3    |</span><br><span class="line">| user42   | 1    |</span><br><span class="line">| user43   | 1    |</span><br><span class="line">| user44   | 3    |</span><br><span class="line">| user45   | 3    |</span><br><span class="line">| user46   | 3    |</span><br><span class="line">| user47   | 2    |</span><br><span class="line">| user48   | 3    |</span><br><span class="line">| user49   | 2    |</span><br><span class="line">| user5    | 3    |</span><br><span class="line">| user50   | 3    |</span><br><span class="line">| user51   | 3    |</span><br><span class="line">| user52   | 3    |</span><br><span class="line">| user54   | 3    |</span><br><span class="line">| user55   | 3    |</span><br><span class="line">| user57   | 1    |</span><br><span class="line">| user58   | 3    |</span><br><span class="line">| user59   | 2    |</span><br><span class="line">| user6    | 3    |</span><br><span class="line">| user60   | 1    |</span><br><span class="line">| user61   | 3    |</span><br><span class="line">| user62   | 3    |</span><br><span class="line">| user63   | 3    |</span><br><span class="line">| user64   | 3    |</span><br><span class="line">| user65   | 2    |</span><br><span class="line">| user66   | 3    |</span><br><span class="line">| user67   | 3    |</span><br><span class="line">| user68   | 1    |</span><br><span class="line">| user69   | 2    |</span><br><span class="line">| user7    | 3    |</span><br><span class="line">| user70   | 3    |</span><br><span class="line">| user71   | 3    |</span><br><span class="line">| user72   | 1    |</span><br><span class="line">| user73   | 3    |</span><br><span class="line">| user74   | 3    |</span><br><span class="line">| user75   | 3    |</span><br><span class="line">| user76   | 2    |</span><br><span class="line">| user77   | 3    |</span><br><span class="line">| user78   | 3    |</span><br><span class="line">| user79   | 3    |</span><br><span class="line">| user8    | 3    |</span><br><span class="line">| user80   | 3    |</span><br><span class="line">| user81   | 3    |</span><br><span class="line">| user82   | 1    |</span><br><span class="line">| user83   | 3    |</span><br><span class="line">| user84   | 1    |</span><br><span class="line">| user85   | 3    |</span><br><span class="line">| user86   | 3    |</span><br><span class="line">| user87   | 3    |</span><br><span class="line">| user88   | 3    |</span><br><span class="line">| user9    | 3    |</span><br><span class="line">| user90   | 3    |</span><br><span class="line">| user91   | 3    |</span><br><span class="line">| user92   | 3    |</span><br><span class="line">| user93   | 2    |</span><br><span class="line">| user94   | 3    |</span><br><span class="line">| user95   | 3    |</span><br><span class="line">| user96   | 3    |</span><br><span class="line">| user97   | 3    |</span><br><span class="line">| user98   | 3    |</span><br><span class="line">| user99   | 3    |</span><br><span class="line">+----------+------+--+</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">（2）统计每个产品top3的用户信息 ==&gt;  pid  uid  cnt</span><br><span class="line"></span><br><span class="line">思路：</span><br><span class="line">1.pid  uid  cnt  top3</span><br><span class="line">意思是 每个pid  每个uid 的  访问次数 并 取出 top3</span><br><span class="line">分两步：</span><br><span class="line"></span><br><span class="line">step1：每个pid  每个uid 的  访问次数</span><br><span class="line">step2：基于step1 取出 top3</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">step1：每个pid  每个uid 的  访问次数</span><br><span class="line">group by（pid + uid)  + count（uid）    (group by 是有去重的哈 不难理解吧)</span><br><span class="line"></span><br><span class="line">tmp:</span><br><span class="line">	select pid,uid,count(uid) as count </span><br><span class="line">	from ods_uid_pid_info</span><br><span class="line">	group by pid,uid</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">step2: 基于step1    pid,uid,count   取出 top3 </span><br><span class="line">目的 Top3 =》 基于1 要以pid进行分组以count 进行排序  生成新的列 rank （用开窗 1 对 多）</span><br><span class="line"></span><br><span class="line">这块用到开窗 rank() 或者 row_number(） + over</span><br><span class="line">paritition by 谁 ？order by 谁？</span><br><span class="line">要求的是每个产品top3的用户信息</span><br><span class="line">所以是 paritition by pid order by count    (注意哈 这个count 是step1 得到的 每个pid 每个uid 的 count)</span><br><span class="line"></span><br><span class="line">result_tmp:</span><br><span class="line">	select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">	from tmp;  //有并列的</span><br><span class="line"></span><br><span class="line">result_tmp:</span><br><span class="line">	select pid,uid,count, row_number()over(partition by pid order by count desc) as rank</span><br><span class="line">	from tmp;   //没有并列的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">step 3：基于2 进行where rank  &lt;= 3</span><br><span class="line"></span><br><span class="line">result: 两种</span><br><span class="line">	select pid,uid,count</span><br><span class="line">	from result_tmp</span><br><span class="line">	where  rank&lt;=3;</span><br></pre></td></tr></table></figure></div>


<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br></pre></td><td class="code"><pre><span class="line">step1 演示;   每个pid  每个uid 的  访问次数</span><br><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select pid,uid,count(uid) as count </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_uid_pid_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by pid,uid ;</span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917144747_4703dd87-bc51-4175-8551-b4ffcc78ed11): select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:pid, type:string, comment:null), FieldSchema(name:uid, type:string, comment:null), FieldSchema(name:count, type:bigint, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917144747_4703dd87-bc51-4175-8551-b4ffcc78ed11); Time taken: 0.046 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917144747_4703dd87-bc51-4175-8551-b4ffcc78ed11): select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">INFO  : Query ID = double_happy_20190917144747_4703dd87-bc51-4175-8551-b4ffcc78ed11</span><br><span class="line">INFO  : Total jobs = 1</span><br><span class="line">INFO  : Launching Job 1 out of 1</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0007, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0007/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0007</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:47:44,611 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:47:49,855 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.07 sec</span><br><span class="line">INFO  : 2019-09-17 14:47:56,080 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 2.46 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 2 seconds 460 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0007</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 2.46 sec   HDFS Read: 17957 HDFS Write: 2767 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 2 seconds 460 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917144747_4703dd87-bc51-4175-8551-b4ffcc78ed11); Time taken: 19.001 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+------+----------+--------+--+</span><br><span class="line">| pid  |   uid    | count  |</span><br><span class="line">+------+----------+--------+--+</span><br><span class="line">| a    | user1    | 4      |</span><br><span class="line">| a    | user10   | 2      |</span><br><span class="line">| a    | user100  | 5      |</span><br><span class="line">| a    | user11   | 8      |</span><br><span class="line">| a    | user12   | 4      |</span><br><span class="line">| a    | user13   | 3      |</span><br><span class="line">| a    | user14   | 6      |</span><br><span class="line">| a    | user15   | 11     |</span><br><span class="line">| a    | user16   | 6      |</span><br><span class="line">| a    | user17   | 5      |</span><br><span class="line">| a    | user19   | 2      |</span><br><span class="line">| a    | user2    | 2      |</span><br><span class="line">| a    | user20   | 3      |</span><br><span class="line">| a    | user21   | 1      |</span><br><span class="line">| a    | user22   | 5      |</span><br><span class="line">| a    | user24   | 7      |</span><br><span class="line">| a    | user25   | 4      |</span><br><span class="line">| a    | user26   | 6      |</span><br><span class="line">| a    | user27   | 2      |</span><br><span class="line">| a    | user28   | 1      |</span><br><span class="line">| a    | user29   | 4      |</span><br><span class="line">| a    | user3    | 3      |</span><br><span class="line">| a    | user30   | 4      |</span><br><span class="line">| a    | user31   | 5      |</span><br><span class="line">| a    | user32   | 4      |</span><br><span class="line">| a    | user33   | 2      |</span><br><span class="line">| a    | user34   | 1      |</span><br><span class="line">| a    | user36   | 1      |</span><br><span class="line">| a    | user37   | 7      |</span><br><span class="line">| a    | user38   | 5      |</span><br><span class="line">| a    | user4    | 3      |</span><br><span class="line">| a    | user41   | 1      |</span><br><span class="line">| a    | user43   | 1      |</span><br><span class="line">| a    | user44   | 2      |</span><br><span class="line">| a    | user45   | 3      |</span><br><span class="line">| a    | user46   | 2      |</span><br><span class="line">| a    | user47   | 2      |</span><br><span class="line">| a    | user48   | 2      |</span><br><span class="line">| a    | user49   | 3      |</span><br><span class="line">| a    | user5    | 10     |</span><br><span class="line">| a    | user50   | 3      |</span><br><span class="line">| a    | user51   | 4      |</span><br><span class="line">| a    | user52   | 1      |</span><br><span class="line">| a    | user54   | 9      |</span><br><span class="line">| a    | user55   | 6      |</span><br><span class="line">| a    | user58   | 1      |</span><br><span class="line">| a    | user59   | 3      |</span><br><span class="line">| a    | user6    | 3      |</span><br><span class="line">| a    | user61   | 2      |</span><br><span class="line">| a    | user62   | 11     |</span><br><span class="line">| a    | user63   | 3      |</span><br><span class="line">| a    | user64   | 4      |</span><br><span class="line">| a    | user65   | 2      |</span><br><span class="line">| a    | user66   | 3      |</span><br><span class="line">| a    | user67   | 2      |</span><br><span class="line">| a    | user69   | 2      |</span><br><span class="line">| a    | user7    | 4      |</span><br><span class="line">| a    | user70   | 3      |</span><br><span class="line">| a    | user71   | 6      |</span><br><span class="line">| a    | user72   | 2      |</span><br><span class="line">| a    | user73   | 6      |</span><br><span class="line">| a    | user74   | 2      |</span><br><span class="line">| a    | user75   | 2      |</span><br><span class="line">| a    | user76   | 2      |</span><br><span class="line">| a    | user77   | 3      |</span><br><span class="line">| a    | user78   | 7      |</span><br><span class="line">| a    | user79   | 7      |</span><br><span class="line">| a    | user8    | 1      |</span><br><span class="line">| a    | user80   | 2      |</span><br><span class="line">| a    | user81   | 6      |</span><br><span class="line">| a    | user82   | 1      |</span><br><span class="line">| a    | user83   | 5      |</span><br><span class="line">| a    | user85   | 3      |</span><br><span class="line">| a    | user86   | 5      |</span><br><span class="line">| a    | user87   | 8      |</span><br><span class="line">| a    | user88   | 5      |</span><br><span class="line">| a    | user9    | 1      |</span><br><span class="line">| a    | user90   | 2      |</span><br><span class="line">| a    | user91   | 4      |</span><br><span class="line">| a    | user92   | 2      |</span><br><span class="line">| a    | user93   | 1      |</span><br><span class="line">| a    | user94   | 6      |</span><br><span class="line">| a    | user95   | 2      |</span><br><span class="line">| a    | user96   | 6      |</span><br><span class="line">| a    | user97   | 6      |</span><br><span class="line">| a    | user98   | 3      |</span><br><span class="line">| a    | user99   | 4      |</span><br><span class="line">| b    | user0    | 2      |</span><br><span class="line">| b    | user1    | 7      |</span><br><span class="line">| b    | user10   | 1      |</span><br><span class="line">| b    | user100  | 4      |</span><br><span class="line">| b    | user11   | 6      |</span><br><span class="line">| b    | user12   | 3      |</span><br><span class="line">| b    | user13   | 4      |</span><br><span class="line">| b    | user14   | 4      |</span><br><span class="line">| b    | user15   | 9      |</span><br><span class="line">| b    | user16   | 6      |</span><br><span class="line">| b    | user17   | 4      |</span><br><span class="line">| b    | user19   | 6      |</span><br><span class="line">| b    | user2    | 5      |</span><br><span class="line">+------+----------+--------+--+</span><br><span class="line">| pid  |   uid    | count  |</span><br><span class="line">+------+----------+--------+--+</span><br><span class="line">| b    | user20   | 1      |</span><br><span class="line">| b    | user21   | 8      |</span><br><span class="line">| b    | user22   | 8      |</span><br><span class="line">| b    | user24   | 2      |</span><br><span class="line">| b    | user25   | 1      |</span><br><span class="line">| b    | user26   | 7      |</span><br><span class="line">| b    | user27   | 2      |</span><br><span class="line">| b    | user28   | 2      |</span><br><span class="line">| b    | user29   | 4      |</span><br><span class="line">| b    | user3    | 8      |</span><br><span class="line">| b    | user30   | 3      |</span><br><span class="line">| b    | user32   | 3      |</span><br><span class="line">| b    | user33   | 2      |</span><br><span class="line">| b    | user34   | 4      |</span><br><span class="line">| b    | user36   | 1      |</span><br><span class="line">| b    | user37   | 10     |</span><br><span class="line">| b    | user38   | 3      |</span><br><span class="line">| b    | user4    | 5      |</span><br><span class="line">| b    | user41   | 1      |</span><br><span class="line">| b    | user44   | 1      |</span><br><span class="line">| b    | user45   | 1      |</span><br><span class="line">| b    | user46   | 2      |</span><br><span class="line">| b    | user47   | 1      |</span><br><span class="line">| b    | user48   | 7      |</span><br><span class="line">| b    | user49   | 2      |</span><br><span class="line">| b    | user5    | 8      |</span><br><span class="line">| b    | user50   | 6      |</span><br><span class="line">| b    | user51   | 7      |</span><br><span class="line">| b    | user52   | 3      |</span><br><span class="line">| b    | user54   | 2      |</span><br><span class="line">| b    | user55   | 1      |</span><br><span class="line">| b    | user58   | 5      |</span><br><span class="line">| b    | user59   | 1      |</span><br><span class="line">| b    | user6    | 1      |</span><br><span class="line">| b    | user60   | 4      |</span><br><span class="line">| b    | user61   | 10     |</span><br><span class="line">| b    | user62   | 4      |</span><br><span class="line">| b    | user63   | 4      |</span><br><span class="line">| b    | user64   | 1      |</span><br><span class="line">| b    | user65   | 1      |</span><br><span class="line">| b    | user66   | 7      |</span><br><span class="line">| b    | user67   | 1      |</span><br><span class="line">| b    | user68   | 1      |</span><br><span class="line">| b    | user69   | 8      |</span><br><span class="line">| b    | user7    | 8      |</span><br><span class="line">| b    | user70   | 3      |</span><br><span class="line">| b    | user71   | 4      |</span><br><span class="line">| b    | user73   | 5      |</span><br><span class="line">| b    | user74   | 1      |</span><br><span class="line">| b    | user75   | 3      |</span><br><span class="line">| b    | user77   | 8      |</span><br><span class="line">| b    | user78   | 2      |</span><br><span class="line">| b    | user79   | 9      |</span><br><span class="line">| b    | user8    | 1      |</span><br><span class="line">| b    | user80   | 6      |</span><br><span class="line">| b    | user81   | 6      |</span><br><span class="line">| b    | user83   | 3      |</span><br><span class="line">| b    | user84   | 4      |</span><br><span class="line">| b    | user85   | 6      |</span><br><span class="line">| b    | user86   | 5      |</span><br><span class="line">| b    | user87   | 6      |</span><br><span class="line">| b    | user88   | 4      |</span><br><span class="line">| b    | user9    | 1      |</span><br><span class="line">| b    | user90   | 4      |</span><br><span class="line">| b    | user91   | 2      |</span><br><span class="line">| b    | user92   | 5      |</span><br><span class="line">| b    | user94   | 3      |</span><br><span class="line">| b    | user95   | 3      |</span><br><span class="line">| b    | user96   | 4      |</span><br><span class="line">| b    | user97   | 7      |</span><br><span class="line">| b    | user98   | 3      |</span><br><span class="line">| b    | user99   | 3      |</span><br><span class="line">| c    | user1    | 5      |</span><br><span class="line">| c    | user10   | 7      |</span><br><span class="line">| c    | user100  | 2      |</span><br><span class="line">| c    | user11   | 4      |</span><br><span class="line">| c    | user12   | 5      |</span><br><span class="line">| c    | user13   | 3      |</span><br><span class="line">| c    | user14   | 2      |</span><br><span class="line">| c    | user15   | 6      |</span><br><span class="line">| c    | user16   | 3      |</span><br><span class="line">| c    | user17   | 3      |</span><br><span class="line">| c    | user18   | 1      |</span><br><span class="line">| c    | user2    | 2      |</span><br><span class="line">| c    | user20   | 2      |</span><br><span class="line">| c    | user21   | 4      |</span><br><span class="line">| c    | user22   | 4      |</span><br><span class="line">| c    | user24   | 4      |</span><br><span class="line">| c    | user25   | 4      |</span><br><span class="line">| c    | user26   | 6      |</span><br><span class="line">| c    | user27   | 4      |</span><br><span class="line">| c    | user28   | 1      |</span><br><span class="line">| c    | user29   | 7      |</span><br><span class="line">| c    | user3    | 3      |</span><br><span class="line">| c    | user30   | 1      |</span><br><span class="line">| c    | user31   | 1      |</span><br><span class="line">| c    | user32   | 3      |</span><br><span class="line">| c    | user33   | 1      |</span><br><span class="line">| c    | user34   | 2      |</span><br><span class="line">| c    | user37   | 6      |</span><br><span class="line">+------+----------+--------+--+</span><br><span class="line">| pid  |   uid    | count  |</span><br><span class="line">+------+----------+--------+--+</span><br><span class="line">| c    | user38   | 6      |</span><br><span class="line">| c    | user39   | 2      |</span><br><span class="line">| c    | user4    | 9      |</span><br><span class="line">| c    | user41   | 2      |</span><br><span class="line">| c    | user42   | 2      |</span><br><span class="line">| c    | user44   | 1      |</span><br><span class="line">| c    | user45   | 3      |</span><br><span class="line">| c    | user46   | 3      |</span><br><span class="line">| c    | user48   | 6      |</span><br><span class="line">| c    | user5    | 9      |</span><br><span class="line">| c    | user50   | 6      |</span><br><span class="line">| c    | user51   | 8      |</span><br><span class="line">| c    | user52   | 4      |</span><br><span class="line">| c    | user54   | 3      |</span><br><span class="line">| c    | user55   | 2      |</span><br><span class="line">| c    | user57   | 1      |</span><br><span class="line">| c    | user58   | 2      |</span><br><span class="line">| c    | user6    | 1      |</span><br><span class="line">| c    | user61   | 6      |</span><br><span class="line">| c    | user62   | 4      |</span><br><span class="line">| c    | user63   | 3      |</span><br><span class="line">| c    | user64   | 2      |</span><br><span class="line">| c    | user66   | 13     |</span><br><span class="line">| c    | user67   | 4      |</span><br><span class="line">| c    | user7    | 10     |</span><br><span class="line">| c    | user70   | 5      |</span><br><span class="line">| c    | user71   | 6      |</span><br><span class="line">| c    | user73   | 7      |</span><br><span class="line">| c    | user74   | 4      |</span><br><span class="line">| c    | user75   | 4      |</span><br><span class="line">| c    | user76   | 1      |</span><br><span class="line">| c    | user77   | 6      |</span><br><span class="line">| c    | user78   | 3      |</span><br><span class="line">| c    | user79   | 7      |</span><br><span class="line">| c    | user8    | 2      |</span><br><span class="line">| c    | user80   | 2      |</span><br><span class="line">| c    | user81   | 11     |</span><br><span class="line">| c    | user83   | 2      |</span><br><span class="line">| c    | user85   | 2      |</span><br><span class="line">| c    | user86   | 5      |</span><br><span class="line">| c    | user87   | 4      |</span><br><span class="line">| c    | user88   | 4      |</span><br><span class="line">| c    | user9    | 1      |</span><br><span class="line">| c    | user90   | 4      |</span><br><span class="line">| c    | user91   | 2      |</span><br><span class="line">| c    | user92   | 4      |</span><br><span class="line">| c    | user93   | 1      |</span><br><span class="line">| c    | user94   | 12     |</span><br><span class="line">| c    | user95   | 3      |</span><br><span class="line">| c    | user96   | 4      |</span><br><span class="line">| c    | user97   | 6      |</span><br><span class="line">| c    | user98   | 3      |</span><br><span class="line">| c    | user99   | 5      |</span><br><span class="line">+------+----------+--------+--+</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br></pre></td><td class="code"><pre><span class="line">step2:目的 Top3 =》 基于1 要以pid进行分组以count 进行排序  生成新的列 rank</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from(</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; select pid,uid,count(uid) as count </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_uid_pid_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by pid,uid </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; )as tmp;  </span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917144949_8fd22282-a9be-4e95-aa2a-b98121f6354d): select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">)as tmp</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:pid, type:string, comment:null), FieldSchema(name:uid, type:string, comment:null), FieldSchema(name:count, type:bigint, comment:null), FieldSchema(name:rank, type:int, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917144949_8fd22282-a9be-4e95-aa2a-b98121f6354d); Time taken: 0.054 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917144949_8fd22282-a9be-4e95-aa2a-b98121f6354d): select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">)as tmp</span><br><span class="line">INFO  : Query ID = double_happy_20190917144949_8fd22282-a9be-4e95-aa2a-b98121f6354d</span><br><span class="line">INFO  : Total jobs = 2</span><br><span class="line">INFO  : Launching Job 1 out of 2</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0008, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0008/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0008</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:49:58,539 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:50:03,879 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.05 sec</span><br><span class="line">INFO  : 2019-09-17 14:50:10,134 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 2.98 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 2 seconds 980 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0008</span><br><span class="line">INFO  : Launching Job 2 out of 2</span><br><span class="line">INFO  : Starting task [Stage-2:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0009, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0009/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0009</span><br><span class="line">INFO  : Hadoop job information for Stage-2: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:50:17,507 Stage-2 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:50:23,732 Stage-2 map = 100%,  reduce = 0%, Cumulative CPU 0.94 sec</span><br><span class="line">INFO  : 2019-09-17 14:50:29,976 Stage-2 map = 100%,  reduce = 100%, Cumulative CPU 3.39 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 3 seconds 390 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0009</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 2.98 sec   HDFS Read: 17068 HDFS Write: 6962 SUCCESS</span><br><span class="line">INFO  : Stage-Stage-2: Map: 1  Reduce: 1   Cumulative CPU: 3.39 sec   HDFS Read: 14419 HDFS Write: 3494 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 6 seconds 370 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917144949_8fd22282-a9be-4e95-aa2a-b98121f6354d); Time taken: 39.409 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+------+----------+--------+-------+--+</span><br><span class="line">| pid  |   uid    | count  | rank  |</span><br><span class="line">+------+----------+--------+-------+--+</span><br><span class="line">| a    | user15   | 11     | 1     |</span><br><span class="line">| a    | user62   | 11     | 1     |</span><br><span class="line">| a    | user5    | 10     | 3     |</span><br><span class="line">| a    | user54   | 9      | 4     |</span><br><span class="line">| a    | user87   | 8      | 5     |</span><br><span class="line">| a    | user11   | 8      | 5     |</span><br><span class="line">| a    | user37   | 7      | 7     |</span><br><span class="line">| a    | user24   | 7      | 7     |</span><br><span class="line">| a    | user78   | 7      | 7     |</span><br><span class="line">| a    | user79   | 7      | 7     |</span><br><span class="line">| a    | user55   | 6      | 11    |</span><br><span class="line">| a    | user96   | 6      | 11    |</span><br><span class="line">| a    | user94   | 6      | 11    |</span><br><span class="line">| a    | user16   | 6      | 11    |</span><br><span class="line">| a    | user81   | 6      | 11    |</span><br><span class="line">| a    | user26   | 6      | 11    |</span><br><span class="line">| a    | user97   | 6      | 11    |</span><br><span class="line">| a    | user71   | 6      | 11    |</span><br><span class="line">| a    | user14   | 6      | 11    |</span><br><span class="line">| a    | user73   | 6      | 11    |</span><br><span class="line">| a    | user86   | 5      | 21    |</span><br><span class="line">| a    | user38   | 5      | 21    |</span><br><span class="line">| a    | user88   | 5      | 21    |</span><br><span class="line">| a    | user22   | 5      | 21    |</span><br><span class="line">| a    | user83   | 5      | 21    |</span><br><span class="line">| a    | user31   | 5      | 21    |</span><br><span class="line">| a    | user100  | 5      | 21    |</span><br><span class="line">| a    | user17   | 5      | 21    |</span><br><span class="line">| a    | user12   | 4      | 29    |</span><br><span class="line">| a    | user7    | 4      | 29    |</span><br><span class="line">| a    | user25   | 4      | 29    |</span><br><span class="line">| a    | user29   | 4      | 29    |</span><br><span class="line">| a    | user30   | 4      | 29    |</span><br><span class="line">| a    | user32   | 4      | 29    |</span><br><span class="line">| a    | user99   | 4      | 29    |</span><br><span class="line">| a    | user91   | 4      | 29    |</span><br><span class="line">| a    | user51   | 4      | 29    |</span><br><span class="line">| a    | user64   | 4      | 29    |</span><br><span class="line">| a    | user1    | 4      | 29    |</span><br><span class="line">| a    | user4    | 3      | 40    |</span><br><span class="line">| a    | user50   | 3      | 40    |</span><br><span class="line">| a    | user66   | 3      | 40    |</span><br><span class="line">| a    | user3    | 3      | 40    |</span><br><span class="line">| a    | user85   | 3      | 40    |</span><br><span class="line">| a    | user77   | 3      | 40    |</span><br><span class="line">| a    | user98   | 3      | 40    |</span><br><span class="line">| a    | user59   | 3      | 40    |</span><br><span class="line">| a    | user6    | 3      | 40    |</span><br><span class="line">| a    | user20   | 3      | 40    |</span><br><span class="line">| a    | user70   | 3      | 40    |</span><br><span class="line">| a    | user63   | 3      | 40    |</span><br><span class="line">| a    | user45   | 3      | 40    |</span><br><span class="line">| a    | user13   | 3      | 40    |</span><br><span class="line">| a    | user49   | 3      | 40    |</span><br><span class="line">| a    | user65   | 2      | 55    |</span><br><span class="line">| a    | user19   | 2      | 55    |</span><br><span class="line">| a    | user2    | 2      | 55    |</span><br><span class="line">| a    | user27   | 2      | 55    |</span><br><span class="line">| a    | user33   | 2      | 55    |</span><br><span class="line">| a    | user44   | 2      | 55    |</span><br><span class="line">| a    | user46   | 2      | 55    |</span><br><span class="line">| a    | user47   | 2      | 55    |</span><br><span class="line">| a    | user48   | 2      | 55    |</span><br><span class="line">| a    | user61   | 2      | 55    |</span><br><span class="line">| a    | user67   | 2      | 55    |</span><br><span class="line">| a    | user69   | 2      | 55    |</span><br><span class="line">| a    | user72   | 2      | 55    |</span><br><span class="line">| a    | user74   | 2      | 55    |</span><br><span class="line">| a    | user75   | 2      | 55    |</span><br><span class="line">| a    | user76   | 2      | 55    |</span><br><span class="line">| a    | user80   | 2      | 55    |</span><br><span class="line">| a    | user90   | 2      | 55    |</span><br><span class="line">| a    | user92   | 2      | 55    |</span><br><span class="line">| a    | user95   | 2      | 55    |</span><br><span class="line">| a    | user10   | 2      | 55    |</span><br><span class="line">| a    | user52   | 1      | 76    |</span><br><span class="line">| a    | user9    | 1      | 76    |</span><br><span class="line">| a    | user41   | 1      | 76    |</span><br><span class="line">| a    | user93   | 1      | 76    |</span><br><span class="line">| a    | user36   | 1      | 76    |</span><br><span class="line">| a    | user34   | 1      | 76    |</span><br><span class="line">| a    | user28   | 1      | 76    |</span><br><span class="line">| a    | user21   | 1      | 76    |</span><br><span class="line">| a    | user43   | 1      | 76    |</span><br><span class="line">| a    | user82   | 1      | 76    |</span><br><span class="line">| a    | user8    | 1      | 76    |</span><br><span class="line">| a    | user58   | 1      | 76    |</span><br><span class="line">| b    | user37   | 10     | 1     |</span><br><span class="line">| b    | user61   | 10     | 1     |</span><br><span class="line">| b    | user15   | 9      | 3     |</span><br><span class="line">| b    | user79   | 9      | 3     |</span><br><span class="line">| b    | user7    | 8      | 5     |</span><br><span class="line">| b    | user21   | 8      | 5     |</span><br><span class="line">| b    | user22   | 8      | 5     |</span><br><span class="line">| b    | user69   | 8      | 5     |</span><br><span class="line">| b    | user5    | 8      | 5     |</span><br><span class="line">| b    | user3    | 8      | 5     |</span><br><span class="line">| b    | user77   | 8      | 5     |</span><br><span class="line">| b    | user51   | 7      | 12    |</span><br><span class="line">| b    | user48   | 7      | 12    |</span><br><span class="line">+------+----------+--------+-------+--+</span><br><span class="line">| pid  |   uid    | count  | rank  |</span><br><span class="line">+------+----------+--------+-------+--+</span><br><span class="line">| b    | user26   | 7      | 12    |</span><br><span class="line">| b    | user97   | 7      | 12    |</span><br><span class="line">| b    | user66   | 7      | 12    |</span><br><span class="line">| b    | user1    | 7      | 12    |</span><br><span class="line">| b    | user50   | 6      | 18    |</span><br><span class="line">| b    | user87   | 6      | 18    |</span><br><span class="line">| b    | user85   | 6      | 18    |</span><br><span class="line">| b    | user81   | 6      | 18    |</span><br><span class="line">| b    | user80   | 6      | 18    |</span><br><span class="line">| b    | user19   | 6      | 18    |</span><br><span class="line">| b    | user16   | 6      | 18    |</span><br><span class="line">| b    | user11   | 6      | 18    |</span><br><span class="line">| b    | user2    | 5      | 26    |</span><br><span class="line">| b    | user92   | 5      | 26    |</span><br><span class="line">| b    | user58   | 5      | 26    |</span><br><span class="line">| b    | user73   | 5      | 26    |</span><br><span class="line">| b    | user4    | 5      | 26    |</span><br><span class="line">| b    | user86   | 5      | 26    |</span><br><span class="line">| b    | user88   | 4      | 32    |</span><br><span class="line">| b    | user71   | 4      | 32    |</span><br><span class="line">| b    | user29   | 4      | 32    |</span><br><span class="line">| b    | user84   | 4      | 32    |</span><br><span class="line">| b    | user13   | 4      | 32    |</span><br><span class="line">| b    | user17   | 4      | 32    |</span><br><span class="line">| b    | user100  | 4      | 32    |</span><br><span class="line">| b    | user34   | 4      | 32    |</span><br><span class="line">| b    | user14   | 4      | 32    |</span><br><span class="line">| b    | user96   | 4      | 32    |</span><br><span class="line">| b    | user90   | 4      | 32    |</span><br><span class="line">| b    | user63   | 4      | 32    |</span><br><span class="line">| b    | user62   | 4      | 32    |</span><br><span class="line">| b    | user60   | 4      | 32    |</span><br><span class="line">| b    | user12   | 3      | 46    |</span><br><span class="line">| b    | user99   | 3      | 46    |</span><br><span class="line">| b    | user94   | 3      | 46    |</span><br><span class="line">| b    | user95   | 3      | 46    |</span><br><span class="line">| b    | user98   | 3      | 46    |</span><br><span class="line">| b    | user75   | 3      | 46    |</span><br><span class="line">| b    | user83   | 3      | 46    |</span><br><span class="line">| b    | user52   | 3      | 46    |</span><br><span class="line">| b    | user32   | 3      | 46    |</span><br><span class="line">| b    | user30   | 3      | 46    |</span><br><span class="line">| b    | user70   | 3      | 46    |</span><br><span class="line">| b    | user38   | 3      | 46    |</span><br><span class="line">| b    | user54   | 2      | 58    |</span><br><span class="line">| b    | user28   | 2      | 58    |</span><br><span class="line">| b    | user27   | 2      | 58    |</span><br><span class="line">| b    | user49   | 2      | 58    |</span><br><span class="line">| b    | user46   | 2      | 58    |</span><br><span class="line">| b    | user24   | 2      | 58    |</span><br><span class="line">| b    | user33   | 2      | 58    |</span><br><span class="line">| b    | user0    | 2      | 58    |</span><br><span class="line">| b    | user91   | 2      | 58    |</span><br><span class="line">| b    | user78   | 2      | 58    |</span><br><span class="line">| b    | user67   | 1      | 68    |</span><br><span class="line">| b    | user65   | 1      | 68    |</span><br><span class="line">| b    | user64   | 1      | 68    |</span><br><span class="line">| b    | user6    | 1      | 68    |</span><br><span class="line">| b    | user59   | 1      | 68    |</span><br><span class="line">| b    | user55   | 1      | 68    |</span><br><span class="line">| b    | user74   | 1      | 68    |</span><br><span class="line">| b    | user8    | 1      | 68    |</span><br><span class="line">| b    | user47   | 1      | 68    |</span><br><span class="line">| b    | user45   | 1      | 68    |</span><br><span class="line">| b    | user44   | 1      | 68    |</span><br><span class="line">| b    | user41   | 1      | 68    |</span><br><span class="line">| b    | user36   | 1      | 68    |</span><br><span class="line">| b    | user25   | 1      | 68    |</span><br><span class="line">| b    | user9    | 1      | 68    |</span><br><span class="line">| b    | user20   | 1      | 68    |</span><br><span class="line">| b    | user10   | 1      | 68    |</span><br><span class="line">| b    | user68   | 1      | 68    |</span><br><span class="line">| c    | user66   | 13     | 1     |</span><br><span class="line">| c    | user94   | 12     | 2     |</span><br><span class="line">| c    | user81   | 11     | 3     |</span><br><span class="line">| c    | user7    | 10     | 4     |</span><br><span class="line">| c    | user5    | 9      | 5     |</span><br><span class="line">| c    | user4    | 9      | 5     |</span><br><span class="line">| c    | user51   | 8      | 7     |</span><br><span class="line">| c    | user79   | 7      | 8     |</span><br><span class="line">| c    | user10   | 7      | 8     |</span><br><span class="line">| c    | user73   | 7      | 8     |</span><br><span class="line">| c    | user29   | 7      | 8     |</span><br><span class="line">| c    | user38   | 6      | 12    |</span><br><span class="line">| c    | user37   | 6      | 12    |</span><br><span class="line">| c    | user97   | 6      | 12    |</span><br><span class="line">| c    | user15   | 6      | 12    |</span><br><span class="line">| c    | user77   | 6      | 12    |</span><br><span class="line">| c    | user61   | 6      | 12    |</span><br><span class="line">| c    | user50   | 6      | 12    |</span><br><span class="line">| c    | user26   | 6      | 12    |</span><br><span class="line">| c    | user48   | 6      | 12    |</span><br><span class="line">| c    | user71   | 6      | 12    |</span><br><span class="line">| c    | user99   | 5      | 22    |</span><br><span class="line">| c    | user12   | 5      | 22    |</span><br><span class="line">| c    | user1    | 5      | 22    |</span><br><span class="line">| c    | user70   | 5      | 22    |</span><br><span class="line">| c    | user86   | 5      | 22    |</span><br><span class="line">| c    | user75   | 4      | 27    |</span><br><span class="line">| c    | user87   | 4      | 27    |</span><br><span class="line">+------+----------+--------+-------+--+</span><br><span class="line">| pid  |   uid    | count  | rank  |</span><br><span class="line">+------+----------+--------+-------+--+</span><br><span class="line">| c    | user74   | 4      | 27    |</span><br><span class="line">| c    | user67   | 4      | 27    |</span><br><span class="line">| c    | user21   | 4      | 27    |</span><br><span class="line">| c    | user62   | 4      | 27    |</span><br><span class="line">| c    | user88   | 4      | 27    |</span><br><span class="line">| c    | user96   | 4      | 27    |</span><br><span class="line">| c    | user92   | 4      | 27    |</span><br><span class="line">| c    | user90   | 4      | 27    |</span><br><span class="line">| c    | user27   | 4      | 27    |</span><br><span class="line">| c    | user25   | 4      | 27    |</span><br><span class="line">| c    | user24   | 4      | 27    |</span><br><span class="line">| c    | user22   | 4      | 27    |</span><br><span class="line">| c    | user52   | 4      | 27    |</span><br><span class="line">| c    | user11   | 4      | 27    |</span><br><span class="line">| c    | user63   | 3      | 43    |</span><br><span class="line">| c    | user45   | 3      | 43    |</span><br><span class="line">| c    | user95   | 3      | 43    |</span><br><span class="line">| c    | user46   | 3      | 43    |</span><br><span class="line">| c    | user32   | 3      | 43    |</span><br><span class="line">| c    | user54   | 3      | 43    |</span><br><span class="line">| c    | user3    | 3      | 43    |</span><br><span class="line">| c    | user98   | 3      | 43    |</span><br><span class="line">| c    | user17   | 3      | 43    |</span><br><span class="line">| c    | user16   | 3      | 43    |</span><br><span class="line">| c    | user78   | 3      | 43    |</span><br><span class="line">| c    | user13   | 3      | 43    |</span><br><span class="line">| c    | user83   | 2      | 55    |</span><br><span class="line">| c    | user85   | 2      | 55    |</span><br><span class="line">| c    | user58   | 2      | 55    |</span><br><span class="line">| c    | user55   | 2      | 55    |</span><br><span class="line">| c    | user42   | 2      | 55    |</span><br><span class="line">| c    | user100  | 2      | 55    |</span><br><span class="line">| c    | user91   | 2      | 55    |</span><br><span class="line">| c    | user14   | 2      | 55    |</span><br><span class="line">| c    | user8    | 2      | 55    |</span><br><span class="line">| c    | user80   | 2      | 55    |</span><br><span class="line">| c    | user39   | 2      | 55    |</span><br><span class="line">| c    | user64   | 2      | 55    |</span><br><span class="line">| c    | user20   | 2      | 55    |</span><br><span class="line">| c    | user41   | 2      | 55    |</span><br><span class="line">| c    | user2    | 2      | 55    |</span><br><span class="line">| c    | user34   | 2      | 55    |</span><br><span class="line">| c    | user18   | 1      | 71    |</span><br><span class="line">| c    | user30   | 1      | 71    |</span><br><span class="line">| c    | user28   | 1      | 71    |</span><br><span class="line">| c    | user44   | 1      | 71    |</span><br><span class="line">| c    | user57   | 1      | 71    |</span><br><span class="line">| c    | user6    | 1      | 71    |</span><br><span class="line">| c    | user76   | 1      | 71    |</span><br><span class="line">| c    | user9    | 1      | 71    |</span><br><span class="line">| c    | user93   | 1      | 71    |</span><br><span class="line">| c    | user31   | 1      | 71    |</span><br><span class="line">| c    | user33   | 1      | 71    |</span><br><span class="line">+------+----------+--------+-------+--+</span><br></pre></td></tr></table></figure></div>


<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">step3   基于2 进行where rank  &lt;= 3</span><br><span class="line"></span><br><span class="line">整合：</span><br><span class="line">result: 两种</span><br><span class="line">	select pid,uid,count</span><br><span class="line">	from(</span><br><span class="line">	select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">	from(</span><br><span class="line">	select pid,uid,count(uid) as count </span><br><span class="line">	from ods_uid_pid_info</span><br><span class="line">	group by pid,uid </span><br><span class="line">	)as tmp</span><br><span class="line">	)as result_tmp</span><br><span class="line">	where  rank&lt;=3;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">结果：</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select pid,uid,count</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from(</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from(</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; select pid,uid,count(uid) as count </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_uid_pid_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by pid,uid </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; )as tmp</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; )as result_tmp</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; where  rank&lt;=3;</span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917143131_3e5d7235-f034-4022-bea0-b86d6464a437): select pid,uid,count</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">)as tmp</span><br><span class="line">)as result_tmp</span><br><span class="line">where  rank&lt;=3</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:pid, type:string, comment:null), FieldSchema(name:uid, type:string, comment:null), FieldSchema(name:count, type:bigint, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917143131_3e5d7235-f034-4022-bea0-b86d6464a437); Time taken: 0.096 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917143131_3e5d7235-f034-4022-bea0-b86d6464a437): select pid,uid,count</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">)as tmp</span><br><span class="line">)as result_tmp</span><br><span class="line">where  rank&lt;=3</span><br><span class="line">INFO  : Query ID = double_happy_20190917143131_3e5d7235-f034-4022-bea0-b86d6464a437</span><br><span class="line">INFO  : Total jobs = 2</span><br><span class="line">INFO  : Launching Job 1 out of 2</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0005, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0005/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0005</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:31:30,465 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:31:34,683 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.17 sec</span><br><span class="line">INFO  : 2019-09-17 14:31:40,960 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 2.51 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 2 seconds 510 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0005</span><br><span class="line">INFO  : Launching Job 2 out of 2</span><br><span class="line">INFO  : Starting task [Stage-2:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0006, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0006/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0006</span><br><span class="line">INFO  : Hadoop job information for Stage-2: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:31:49,210 Stage-2 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:31:54,497 Stage-2 map = 100%,  reduce = 0%, Cumulative CPU 1.17 sec</span><br><span class="line">INFO  : 2019-09-17 14:32:00,785 Stage-2 map = 100%,  reduce = 100%, Cumulative CPU 3.48 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 3 seconds 480 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0006</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 2.51 sec   HDFS Read: 17079 HDFS Write: 6962 SUCCESS</span><br><span class="line">INFO  : Stage-Stage-2: Map: 1  Reduce: 1   Cumulative CPU: 3.48 sec   HDFS Read: 14767 HDFS Write: 117 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 5 seconds 990 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917143131_3e5d7235-f034-4022-bea0-b86d6464a437); Time taken: 37.896 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+------+---------+--------+--+</span><br><span class="line">| pid  |   uid   | count  |</span><br><span class="line">+------+---------+--------+--+</span><br><span class="line">| a    | user15  | 11     |</span><br><span class="line">| a    | user62  | 11     |</span><br><span class="line">| a    | user5   | 10     |</span><br><span class="line">| b    | user37  | 10     |</span><br><span class="line">| b    | user61  | 10     |</span><br><span class="line">| b    | user15  | 9      |</span><br><span class="line">| b    | user79  | 9      |</span><br><span class="line">| c    | user66  | 13     |</span><br><span class="line">| c    | user94  | 12     |</span><br><span class="line">| c    | user81  | 11     |</span><br><span class="line">+------+---------+--------+--+</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">带上排名 看的更清楚：</span><br><span class="line"></span><br><span class="line">0: jdbc:hive2://hadoop101:10000&gt; select pid,uid,count,rank</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from(</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from(</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; select pid,uid,count(uid) as count </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; from ods_uid_pid_info</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; group by pid,uid </span><br><span class="line">. . . . . . . . . . . . . . . .&gt; )as tmp</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; )as result_tmp</span><br><span class="line">. . . . . . . . . . . . . . . .&gt; where  rank&lt;=3;</span><br><span class="line">INFO  : Compiling command(queryId=double_happy_20190917145252_c7075e67-87d3-4c1d-9d14-0944dfcdbdca): select pid,uid,count,rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">)as tmp</span><br><span class="line">)as result_tmp</span><br><span class="line">where  rank&lt;=3</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : Returning Hive schema: Schema(fieldSchemas:[FieldSchema(name:pid, type:string, comment:null), FieldSchema(name:uid, type:string, comment:null), FieldSchema(name:count, type:bigint, comment:null), FieldSchema(name:rank, type:int, comment:null)], properties:null)</span><br><span class="line">INFO  : Completed compiling command(queryId=double_happy_20190917145252_c7075e67-87d3-4c1d-9d14-0944dfcdbdca); Time taken: 0.047 seconds</span><br><span class="line">INFO  : Concurrency mode is disabled, not creating a lock manager</span><br><span class="line">INFO  : Executing command(queryId=double_happy_20190917145252_c7075e67-87d3-4c1d-9d14-0944dfcdbdca): select pid,uid,count,rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count, rank()over(partition by pid order by count desc) as rank</span><br><span class="line">from(</span><br><span class="line">select pid,uid,count(uid) as count</span><br><span class="line">from ods_uid_pid_info</span><br><span class="line">group by pid,uid</span><br><span class="line">)as tmp</span><br><span class="line">)as result_tmp</span><br><span class="line">where  rank&lt;=3</span><br><span class="line">INFO  : Query ID = double_happy_20190917145252_c7075e67-87d3-4c1d-9d14-0944dfcdbdca</span><br><span class="line">INFO  : Total jobs = 2</span><br><span class="line">INFO  : Launching Job 1 out of 2</span><br><span class="line">INFO  : Starting task [Stage-1:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0010, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0010/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0010</span><br><span class="line">INFO  : Hadoop job information for Stage-1: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:52:46,500 Stage-1 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:52:50,688 Stage-1 map = 100%,  reduce = 0%, Cumulative CPU 1.06 sec</span><br><span class="line">INFO  : 2019-09-17 14:52:55,872 Stage-1 map = 100%,  reduce = 100%, Cumulative CPU 2.8 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 2 seconds 800 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0010</span><br><span class="line">INFO  : Launching Job 2 out of 2</span><br><span class="line">INFO  : Starting task [Stage-2:MAPRED] in serial mode</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to change the average load for a reducer (in bytes):</span><br><span class="line">INFO  :   set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;</span><br><span class="line">INFO  : In order to limit the maximum number of reducers:</span><br><span class="line">INFO  :   set hive.exec.reducers.max=&lt;number&gt;</span><br><span class="line">INFO  : In order to set a constant number of reducers:</span><br><span class="line">INFO  :   set mapreduce.job.reduces=&lt;number&gt;</span><br><span class="line">INFO  : Starting Job = job_1568699800773_0011, Tracking URL = http://hadoop101:8088/proxy/application_1568699800773_0011/</span><br><span class="line">INFO  : Kill Command = /home/double_happy/app/hadoop/bin/hadoop job  -kill job_1568699800773_0011</span><br><span class="line">INFO  : Hadoop job information for Stage-2: number of mappers: 1; number of reducers: 1</span><br><span class="line">INFO  : 2019-09-17 14:53:03,511 Stage-2 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2019-09-17 14:53:09,752 Stage-2 map = 100%,  reduce = 0%, Cumulative CPU 0.89 sec</span><br><span class="line">INFO  : 2019-09-17 14:53:15,983 Stage-2 map = 100%,  reduce = 100%, Cumulative CPU 3.4 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 3 seconds 400 msec</span><br><span class="line">INFO  : Ended Job = job_1568699800773_0011</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-1: Map: 1  Reduce: 1   Cumulative CPU: 2.8 sec   HDFS Read: 17080 HDFS Write: 6962 SUCCESS</span><br><span class="line">INFO  : Stage-Stage-2: Map: 1  Reduce: 1   Cumulative CPU: 3.4 sec   HDFS Read: 14832 HDFS Write: 137 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 6 seconds 200 msec</span><br><span class="line">INFO  : Completed executing command(queryId=double_happy_20190917145252_c7075e67-87d3-4c1d-9d14-0944dfcdbdca); Time taken: 36.913 seconds</span><br><span class="line">INFO  : OK</span><br><span class="line">+------+---------+--------+-------+--+</span><br><span class="line">| pid  |   uid   | count  | rank  |</span><br><span class="line">+------+---------+--------+-------+--+</span><br><span class="line">| a    | user15  | 11     | 1     |</span><br><span class="line">| a    | user62  | 11     | 1     |</span><br><span class="line">| a    | user5   | 10     | 3     |</span><br><span class="line">| b    | user37  | 10     | 1     |</span><br><span class="line">| b    | user61  | 10     | 1     |</span><br><span class="line">| b    | user15  | 9      | 3     |</span><br><span class="line">| b    | user79  | 9      | 3     |</span><br><span class="line">| c    | user66  | 13     | 1     |</span><br><span class="line">| c    | user94  | 12     | 2     |</span><br><span class="line">| c    | user81  | 11     | 3     |</span><br><span class="line">+------+---------+--------+-------+--+</span><br></pre></td></tr></table></figure></div>
      
    </div>
    
      <footer class="article-footer">
        完
      </footer>
    
  </div>
  
    
<nav id="article-nav">
  <div class="article-nav-block">
    
      <a href="/2018/01/01/Hadoop%E5%8E%8B%E7%BC%A9-double-happy/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption"></strong>
        <div class="article-nav-title">
          
            Hadoop压缩---double_happy
          
        </div>
      </a>
    
  </div>
  <div class="article-nav-block">
    
      <a href="/2017/12/17/Scala06-double-happy/" id="article-nav-older" class="article-nav-link-wrap">
        <div class="article-nav-title">Scala06--double_happy</div>
        <strong class="article-nav-caption"></strong>
      </a>
    
  </div>
</nav>

    <link rel="stylesheet" href="/css/gitment.css"> 
<script src="/js/gitment.js"></script>

<div id="gitmentContainer"></div>

<script>
var gitment = new Gitment({
  owner: '',
  repo: '',
  oauth: {
    client_id: '',
    client_secret: '',
  },
})
gitment.render('gitmentContainer')
</script>

  
  
</article>
</section>
        <aside id="sidebar">
  
    <div class="widget-box">
  <div class="avatar-box">
    <img class="avatar" src="/images/default-avatar.jpg" title="图片来自网络"></img>
    <h3 class="avatar-name">
      
        DoubleHappy
      
    </h3>
    <p class="avatar-slogan">
      特别耐撕的大数据，资深的打酱油攻城狮。
    </p>
  </div>
</div>


  
    

  
    

  
    
  
    
  <div class="widget-box">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li></ul>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/01/05/Azkaban%E8%B0%83%E5%BA%A6-double-happy/">Azkaban调度--double_happy</a>
          </li>
        
          <li>
            <a href="/2019/01/04/Zookeeper%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E4%B8%8E%E7%9B%91%E6%8E%A7-Curator/">Zookeeper基本使用与监控(Curator)</a>
          </li>
        
          <li>
            <a href="/2018/04/17/SparkSQL-TextFile%E8%BE%93%E5%87%BA%E5%A4%9A%E5%88%97/">SparkSQL--TextFile输出多列</a>
          </li>
        
          <li>
            <a href="/2018/03/17/%E9%9B%85%E6%81%A9%E8%B5%84%E6%BA%90%E8%B0%83%E4%BC%98-double-happy/">雅恩资源调优---double_happy</a>
          </li>
        
          <li>
            <a href="/2018/02/22/SS04/">SS04</a>
          </li>
        
      </ul>
    </div>
  </div>

  
      <div class="widget-box">
    <h3 class="widget-title">友链</h3>
    <div class="widget">
      
        <a style="display: block;" href="https://sxwanggit126.github.io/" title target='_blank'
        >一路眼瞎</a>
      
    </div>
  </div>

  
</aside>
      </div>
      <footer id="footer">
  <div class="foot-box global-width">
    &copy; 2019 DoubleHappy &nbsp;&nbsp;
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    &nbsp;|&nbsp;主题 <a href="https://github.com/yiluyanxia/hexo-theme-antiquity" target="_blank" rel="noopener">antiquity</a>
    <br>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">不蒜子告之   阁下是第<span id="busuanzi_value_site_pv"></span>个访客</span>
  </div>
</footer>
      <script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
<script>
if (!window.jQuery) {
var script = document.createElement('script');
script.src = "/js/jquery-2.0.3.min.js";
document.body.write(script);
}
</script>


<script src="/js/script.js"></script>



    </div>
    <nav id="mobile-nav" class="mobile-nav-box">
  <div class="mobile-nav-img mobile-nav-top"></div>
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
  <div class="mobile-nav-img  mobile-nav-bottom"></div>
</nav>    
  </div>
</body>
</html>