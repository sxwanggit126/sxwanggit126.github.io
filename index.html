<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>DoubleHappy or Jepson</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="DoubleHappy or Jepson">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="DoubleHappy or Jepson">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="DoubleHappy or Jepson" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/default-avatar.jpg">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlight.css">
</head>

<body>
  <div id="fullpage" class="mobile-nav-right">
    
      <div id="wrapper" title="图片来自网络">
    
    
      <header id="header">
  <div id="nav-toggle" class="nav-toggle"></div>
  <div class="head-box global-width">
    <nav class="nav-box nav-right">
      
        <a class="nav-item" href="/archives" title
        
        >首页</a>
      
        <a class="nav-item" href="/archives" title
        
        >归档</a>
      
    </nav>
  </div>
</header>
      <div id="middlecontent" title class="global-width sidebar-right">
        <section id="main">
  
    <article id="post-Kudu-Impala故障案例01-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/05/Kudu-Impala%E6%95%85%E9%9A%9C%E6%A1%88%E4%BE%8B01-double-happy/">Kudu+Impala故障案例01--double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2020/01/05/Kudu-Impala%E6%95%85%E9%9A%9C%E6%A1%88%E4%BE%8B01-double-happy/" class="article-date">
  <time datetime="2020-01-05T15:47:59.000Z" itemprop="datePublished">2020-01-05</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <p><strong>背景</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Flink消费数据 最终写入Kudu里面进行存储，</span><br><span class="line">impala通过创建外部表的方式，关联kudu里的数据 进行后续的指标计算</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">   1.Flink -&gt;Sink kudu </span><br><span class="line">   2.Impala -&gt;关联kudu</span><br></pre></td></tr></table></figure></div>
<p><strong>故障</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.Flink sink kudu  表的名字 </span><br><span class="line"> eg： kudu01.test01  这个表 </span><br><span class="line"> Impala关联 kudu 之后 impala里的表是 kudu_test01</span><br><span class="line"></span><br><span class="line">即：</span><br><span class="line">  kudu01.test01 --&gt;  kudu_test01</span><br><span class="line"></span><br><span class="line">故障：</span><br><span class="line">	当把kudu01.test01 表删掉  (通过kudu api 删掉表)  </span><br><span class="line">	重新创建的 kudu01.test01 	</span><br><span class="line">删掉kudu表直接重建 但是 impala没有重新关联 会造成 出现 null</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[vm24:21000] &gt; select * from kudu_access08 limit 100;</span><br><span class="line">Query: select * from kudu_access08 limit 100</span><br><span class="line">Query submitted at: 2019-12-31 11:31:55 (Coordinator: http://vm24:25000)</span><br><span class="line">Query progress can be monitored at: http://vm24:25000/query_plan?query_id=f24990121ccc11cb:91d30b3d00000000</span><br><span class="line">+-------------+---------------+---------+---------------+</span><br><span class="line">| id          | domain        | traffic | time          |</span><br><span class="line">+-------------+---------------+---------+---------------+</span><br><span class="line">| 0_0_3_4_4_9 | NULL          | NULL    | NULL          |</span><br><span class="line">| 0_0_3_9_7_7 | NULL          | NULL    | 1577763046142 |</span><br><span class="line">| 0_0_5_1_2_3 | zhibo8.cc     | 632     | NULL          |</span><br><span class="line">| 0_0_8_3_3_0 | zhibo8.cc     | 349     | 1577763045141 |</span><br><span class="line">| 0_0_8_8_0_2 | NULL          | NULL    | 1577763046142 |</span><br><span class="line">| 0_1_5_8_6_8 | NULL          | 256     | NULL          |</span><br><span class="line">| 0_1_9_0_6_1 | ruozedata.com | 513     | 1577763045141 |</span><br><span class="line">| 0_1_9_3_7_8 | dongqiudi.com | NULL    | NULL          |</span><br><span class="line">| 0_2_0_0_2_1 | NULL          | 1212    | NULL          |</span><br><span class="line">| 0_2_0_7_7_8 | NULL          | 1323    | 1577763045141 |</span><br><span class="line">| 0_2_3_1_3_9 | ruozedata.com | NULL    | NULL          |</span><br><span class="line">| 0_2_6_2_9_3 | ruozedata.com | NULL    | 1577763043139 |</span><br><span class="line">| 0_2_6_8_8_9 | NULL          | 956     | 1577763046142 |</span><br><span class="line">| 0_2_7_2_2_7 | NULL          | NULL    | NULL          |</span><br><span class="line">| 0_2_7_7_4_2 | zhibo8.cc     | NULL    | 1577763046142 |</span><br><span class="line">| 0_3_2_3_2_2 | dongqiudi.com | 309     | NULL          |</span><br><span class="line">| 0_3_2_6_5_6 | NULL          | NULL    | NULL          |</span><br><span class="line">| 0_3_8_9_8_0 | NULL          | NULL    | 1577763043139 |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">删掉kudu表直接重建 但是 impala没有重新关联 会造成 出现 null</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">目前解决办法就是 ：</span><br><span class="line">	通过impala把 impala关联的kudu表删掉  + 再把kudu里的表删掉 两个都重新创建 </span><br><span class="line"></span><br><span class="line">因为kudu+impala 刚刚接触 慢慢摸索当中</span><br></pre></td></tr></table></figure></div>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Flink04-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/05/Flink04-double-happy/">Flink04--double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2020/01/05/Flink04-double-happy/" class="article-date">
  <time datetime="2020-01-05T15:47:43.000Z" itemprop="datePublished">2020-01-05</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">面试题：谈谈你对Flink ON YARN执行流程的理解</span><br><span class="line"></span><br><span class="line">acks=all 数据一定不会丢失吗</span><br><span class="line">如何保证Kafka消费者数据全局有序？ 伪命题</span><br><span class="line">    producer</span><br><span class="line">    storage</span><br><span class="line">    consumer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">10分区 3个消费者</span><br><span class="line">    哪个分区被谁消费</span><br><span class="line"></span><br><span class="line">C0</span><br><span class="line">C1</span><br><span class="line"></span><br><span class="line">T0</span><br><span class="line">    0 1 2</span><br><span class="line">T1</span><br><span class="line">    0 1 2</span><br><span class="line"></span><br><span class="line">6/2</span><br><span class="line">We then divide the number of partitions by the total number of</span><br><span class="line">consumers to determine the number of partitions to assign to each consumer. If it does not evenly</span><br><span class="line">divide, then the first few consumers will have one extra partition.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t0p0, t1p0, t1p1, t2p0, t2p1, t2p2</span><br><span class="line"></span><br><span class="line">C0 is subscribed to t0;           t0p0</span><br><span class="line">C1 is subscribed to t0, t1;       t0p0, t1p0, t1p1</span><br><span class="line">C2 is subscribed to t0, t1, t2.   t0p0, t1p0, t1p1, t2p0, t2p1, t2p2</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Sinl 到 HBase：</span><br><span class="line">	1种.自定义 RichSinkFunction  或者 带并行的</span><br><span class="line">	2种 .  Hadoop Compatibility Beta</span><br><span class="line">			You can:</span><br><span class="line">			use Hadoop’s Writable data types in Flink programs.</span><br><span class="line">			use any Hadoop InputFormat as a DataSource.</span><br><span class="line">			use any Hadoop OutputFormat as a DataSink.</span><br><span class="line">			use a Hadoop Mapper as FlatMapFunction.</span><br><span class="line">			use a Hadoop Reducer as GroupReduceFunction.</span><br></pre></td></tr></table></figure></div>
<p><strong>Hadoop Compatibility Beta</strong><br><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/dev/batch/hadoop_compatibility.html#hadoop-compatibility-beta" target="_blank" rel="noopener">Hadoop Compatibility Beta</a></p>
<p><img src="https://img-blog.csdnimg.cn/20200105201512668.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">也就是说  ：</span><br><span class="line">	写入HBase 有两种方式</span><br><span class="line">		1.自定义 Sink</span><br><span class="line">		2.Flink-Hadoop 的Api</span><br></pre></td></tr></table></figure></div>

<p><strong>环境部署</strong><br><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/flinkDev/building.html#building-flink-from-source" target="_blank" rel="noopener">Building Flink from Source</a></p>
<p>部署：<br><img src="https://img-blog.csdnimg.cn/20200105202554890.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">部署：</span><br><span class="line">	1.本地的 </span><br><span class="line">	2.yarn</span><br><span class="line">作为重点。</span><br></pre></td></tr></table></figure></div>
<p><strong>Local</strong><br><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/getting-started/tutorials/local_setup.html#local-setup-tutorial" target="_blank" rel="noopener">Local Setup Tutorial</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1.启动集群：</span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 flink]$ bin/start-cluster.sh </span><br><span class="line">Starting cluster.</span><br><span class="line">Starting standalonesession daemon on host hadoop101.</span><br><span class="line">Starting taskexecutor daemon on host hadoop101.</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	1.Starting standalonesession </span><br><span class="line">	2.Starting taskexecutor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 flink]$ jps</span><br><span class="line">4688 TaskManagerRunner</span><br><span class="line">4722 Jps</span><br><span class="line">4258 StandaloneSessionClusterEntrypoint</span><br><span class="line">[double_happy@hadoop101 flink]$ </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.看页面 端口 8081</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20200105203620172.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20200105203915909.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">按照官网给的案例：</span><br><span class="line"></span><br><span class="line">object SocketWindowWordCount &#123;</span><br><span class="line">  def main(args: Array[String]) : Unit = &#123;</span><br><span class="line">    val port: Int = try &#123;</span><br><span class="line">      ParameterTool.fromArgs(args).getInt(&quot;port&quot;)</span><br><span class="line">    &#125; catch &#123;</span><br><span class="line">      case e: Exception =&gt; &#123;</span><br><span class="line">        System.err.println(&quot;No port specified. Please run &apos;SocketWindowWordCount --host &lt;host&gt; --port &lt;port&gt;&apos;&quot;)</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    val host: String = try &#123;</span><br><span class="line">      ParameterTool.fromArgs(args).get(&quot;host&quot;)</span><br><span class="line">    &#125; catch &#123;</span><br><span class="line">      case e: Exception =&gt; &#123;</span><br><span class="line">        System.err.println(&quot;No port specified. Please run &apos;SocketWindowWordCount --host &lt;host&gt; --port &lt;port&gt;&apos;&quot;)</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line">    val text = env.socketTextStream(host, port)</span><br><span class="line">    val windowCounts = text</span><br><span class="line">      .flatMap &#123; w =&gt; w.split(&quot;,&quot;) &#125;</span><br><span class="line">      .map &#123; w =&gt; WordWithCount(w, 1) &#125;</span><br><span class="line">      .keyBy(&quot;word&quot;)</span><br><span class="line">      .sum(&quot;count&quot;)</span><br><span class="line"></span><br><span class="line">    windowCounts.print().setParallelism(1)</span><br><span class="line"></span><br><span class="line">    env.execute(&quot;Socket Window WordCount&quot;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  case class WordWithCount(word: String, count: Long)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	打包上传到本地</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.启动 端口 nc ：nc -lk 9998</span><br><span class="line"></span><br><span class="line">2.提交flink jar 包</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><span class="line">[double_happy@hadoop101 bin]$ ./flink</span><br><span class="line">2020-01-05 23:20:00,751 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - Found Yarn properties file under /tmp/.yarn-properties-double_happy.</span><br><span class="line">2020-01-05 23:20:00,751 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - Found Yarn properties file under /tmp/.yarn-properties-double_happy.</span><br><span class="line">./flink &lt;ACTION&gt; [OPTIONS] [ARGUMENTS]</span><br><span class="line"></span><br><span class="line">The following actions are available:</span><br><span class="line"></span><br><span class="line">Action &quot;run&quot; compiles and runs a program.</span><br><span class="line"></span><br><span class="line">  Syntax: run [OPTIONS] &lt;jar-file&gt; &lt;arguments&gt;</span><br><span class="line">  &quot;run&quot; action options:</span><br><span class="line">     -c,--class &lt;classname&gt;               Class with the program entry point</span><br><span class="line">                                          (&quot;main()&quot; method or &quot;getPlan()&quot;</span><br><span class="line">                                          method). Only needed if the JAR file</span><br><span class="line">                                          does not specify the class in its</span><br><span class="line">                                          manifest.</span><br><span class="line">     -C,--classpath &lt;url&gt;                 Adds a URL to each user code</span><br><span class="line">                                          classloader  on all nodes in the</span><br><span class="line">                                          cluster. The paths must specify a</span><br><span class="line">                                          protocol (e.g. file://) and be</span><br><span class="line">                                          accessible on all nodes (e.g. by means</span><br><span class="line">                                          of a NFS share). You can use this</span><br><span class="line">                                          option multiple times for specifying</span><br><span class="line">                                          more than one URL. The protocol must</span><br><span class="line">                                          be supported by the &#123;@link</span><br><span class="line">                                          java.net.URLClassLoader&#125;.</span><br><span class="line">     -d,--detached                        If present, runs the job in detached</span><br><span class="line">                                          mode</span><br><span class="line">     -n,--allowNonRestoredState           Allow to skip savepoint state that</span><br><span class="line">                                          cannot be restored. You need to allow</span><br><span class="line">                                          this if you removed an operator from</span><br><span class="line">                                          your program that was part of the</span><br><span class="line">                                          program when the savepoint was</span><br><span class="line">                                          triggered.</span><br><span class="line">     -p,--parallelism &lt;parallelism&gt;       The parallelism with which to run the</span><br><span class="line">                                          program. Optional flag to override the</span><br><span class="line">                                          default value specified in the</span><br><span class="line">                                          configuration.</span><br><span class="line">     -py,--python &lt;python&gt;                Python script with the program entry</span><br><span class="line">                                          point. The dependent resources can be</span><br><span class="line">                                          configured with the `--pyFiles`</span><br><span class="line">                                          option.</span><br><span class="line">     -pyfs,--pyFiles &lt;pyFiles&gt;            Attach custom python files for job.</span><br><span class="line">                                          Comma can be used as the separator to</span><br><span class="line">                                          specify multiple files. The standard</span><br><span class="line">                                          python resource file suffixes such as</span><br><span class="line">                                          .py/.egg/.zip are all supported.(eg:</span><br><span class="line">                                          --pyFiles</span><br><span class="line">                                          file:///tmp/myresource.zip,hdfs:///$na</span><br><span class="line">                                          menode_address/myresource2.zip)</span><br><span class="line">     -pym,--pyModule &lt;pyModule&gt;           Python module with the program entry</span><br><span class="line">                                          point. This option must be used in</span><br><span class="line">                                          conjunction with `--pyFiles`.</span><br><span class="line">     -q,--sysoutLogging                   If present, suppress logging output to</span><br><span class="line">                                          standard out.</span><br><span class="line">     -s,--fromSavepoint &lt;savepointPath&gt;   Path to a savepoint to restore the job</span><br><span class="line">                                          from (for example</span><br><span class="line">                                          hdfs:///flink/savepoint-1537).</span><br><span class="line">     -sae,--shutdownOnAttachedExit        If the job is submitted in attached</span><br><span class="line">                                          mode, perform a best-effort cluster</span><br><span class="line">                                          shutdown when the CLI is terminated</span><br><span class="line">                                          abruptly, e.g., in response to a user</span><br><span class="line">                                          interrupt, such as typing Ctrl + C.</span><br><span class="line">  Options for yarn-cluster mode:</span><br><span class="line">     -d,--detached                        If present, runs the job in detached</span><br><span class="line">                                          mode</span><br><span class="line">     -m,--jobmanager &lt;arg&gt;                Address of the JobManager (master) to</span><br><span class="line">                                          which to connect. Use this flag to</span><br><span class="line">                                          connect to a different JobManager than</span><br><span class="line">                                          the one specified in the</span><br><span class="line">                                          configuration.</span><br><span class="line">     -sae,--shutdownOnAttachedExit        If the job is submitted in attached</span><br><span class="line">                                          mode, perform a best-effort cluster</span><br><span class="line">                                          shutdown when the CLI is terminated</span><br><span class="line">                                          abruptly, e.g., in response to a user</span><br><span class="line">                                          interrupt, such as typing Ctrl + C.</span><br><span class="line">     -yat,--yarnapplicationType &lt;arg&gt;     Set a custom application type for the</span><br><span class="line">                                          application on YARN</span><br><span class="line">     -yD &lt;property=value&gt;                 use value for given property</span><br><span class="line">     -yd,--yarndetached                   If present, runs the job in detached</span><br><span class="line">                                          mode (deprecated; use non-YARN</span><br><span class="line">                                          specific option instead)</span><br><span class="line">     -yh,--yarnhelp                       Help for the Yarn session CLI.</span><br><span class="line">     -yid,--yarnapplicationId &lt;arg&gt;       Attach to running YARN session</span><br><span class="line">     -yj,--yarnjar &lt;arg&gt;                  Path to Flink jar file</span><br><span class="line">     -yjm,--yarnjobManagerMemory &lt;arg&gt;    Memory for JobManager Container with</span><br><span class="line">                                          optional unit (default: MB)</span><br><span class="line">     -yn,--yarncontainer &lt;arg&gt;            Number of YARN container to allocate</span><br><span class="line">                                          (=Number of Task Managers)</span><br><span class="line">     -ynl,--yarnnodeLabel &lt;arg&gt;           Specify YARN node label for the YARN</span><br><span class="line">                                          application</span><br><span class="line">     -ynm,--yarnname &lt;arg&gt;                Set a custom name for the application</span><br><span class="line">                                          on YARN</span><br><span class="line">     -yq,--yarnquery                      Display available YARN resources</span><br><span class="line">                                          (memory, cores)</span><br><span class="line">     -yqu,--yarnqueue &lt;arg&gt;               Specify YARN queue.</span><br><span class="line">     -ys,--yarnslots &lt;arg&gt;                Number of slots per TaskManager</span><br><span class="line">     -yst,--yarnstreaming                 Start Flink in streaming mode</span><br><span class="line">     -yt,--yarnship &lt;arg&gt;                 Ship files in the specified directory</span><br><span class="line">                                          (t for transfer)</span><br><span class="line">     -ytm,--yarntaskManagerMemory &lt;arg&gt;   Memory per TaskManager Container with</span><br><span class="line">                                          optional unit (default: MB)</span><br><span class="line">     -yz,--yarnzookeeperNamespace &lt;arg&gt;   Namespace to create the Zookeeper</span><br><span class="line">                                          sub-paths for high availability mode</span><br><span class="line">     -z,--zookeeperNamespace &lt;arg&gt;        Namespace to create the Zookeeper</span><br><span class="line">                                          sub-paths for high availability mode</span><br><span class="line"></span><br><span class="line">  Options for default mode:</span><br><span class="line">     -m,--jobmanager &lt;arg&gt;           Address of the JobManager (master) to which</span><br><span class="line">                                     to connect. Use this flag to connect to a</span><br><span class="line">                                     different JobManager than the one specified</span><br><span class="line">                                     in the configuration.</span><br><span class="line">     -z,--zookeeperNamespace &lt;arg&gt;   Namespace to create the Zookeeper sub-paths</span><br><span class="line">                                     for high availability mode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Action &quot;info&quot; shows the optimized execution plan of the program (JSON).</span><br><span class="line"></span><br><span class="line">  Syntax: info [OPTIONS] &lt;jar-file&gt; &lt;arguments&gt;</span><br><span class="line">  &quot;info&quot; action options:</span><br><span class="line">     -c,--class &lt;classname&gt;           Class with the program entry point</span><br><span class="line">                                      (&quot;main()&quot; method or &quot;getPlan()&quot; method).</span><br><span class="line">                                      Only needed if the JAR file does not</span><br><span class="line">                                      specify the class in its manifest.</span><br><span class="line">     -p,--parallelism &lt;parallelism&gt;   The parallelism with which to run the</span><br><span class="line">                                      program. Optional flag to override the</span><br><span class="line">                                      default value specified in the</span><br><span class="line">                                      configuration.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Action &quot;list&quot; lists running and scheduled programs.</span><br><span class="line"></span><br><span class="line">  Syntax: list [OPTIONS]</span><br><span class="line">  &quot;list&quot; action options:</span><br><span class="line">     -r,--running     Show only running programs and their JobIDs</span><br><span class="line">     -s,--scheduled   Show only scheduled programs and their JobIDs</span><br><span class="line">  Options for yarn-cluster mode:</span><br><span class="line">     -m,--jobmanager &lt;arg&gt;            Address of the JobManager (master) to</span><br><span class="line">                                      which to connect. Use this flag to connect</span><br><span class="line">                                      to a different JobManager than the one</span><br><span class="line">                                      specified in the configuration.</span><br><span class="line">     -yid,--yarnapplicationId &lt;arg&gt;   Attach to running YARN session</span><br><span class="line">     -z,--zookeeperNamespace &lt;arg&gt;    Namespace to create the Zookeeper</span><br><span class="line">                                      sub-paths for high availability mode</span><br><span class="line"></span><br><span class="line">  Options for default mode:</span><br><span class="line">     -m,--jobmanager &lt;arg&gt;           Address of the JobManager (master) to which</span><br><span class="line">                                     to connect. Use this flag to connect to a</span><br><span class="line">                                     different JobManager than the one specified</span><br><span class="line">                                     in the configuration.</span><br><span class="line">     -z,--zookeeperNamespace &lt;arg&gt;   Namespace to create the Zookeeper sub-paths</span><br><span class="line">                                     for high availability mode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Action &quot;stop&quot; stops a running program with a savepoint (streaming jobs only).</span><br><span class="line"></span><br><span class="line">  Syntax: stop [OPTIONS] &lt;Job ID&gt;</span><br><span class="line">  &quot;stop&quot; action options:</span><br><span class="line">     -d,--drain                           Send MAX_WATERMARK before taking the</span><br><span class="line">                                          savepoint and stopping the pipelne.</span><br><span class="line">     -p,--savepointPath &lt;savepointPath&gt;   Path to the savepoint (for example</span><br><span class="line">                                          hdfs:///flink/savepoint-1537). If no</span><br><span class="line">                                          directory is specified, the configured</span><br><span class="line">                                          default will be used</span><br><span class="line">                                          (&quot;state.savepoints.dir&quot;).</span><br><span class="line">  Options for yarn-cluster mode:</span><br><span class="line">     -m,--jobmanager &lt;arg&gt;            Address of the JobManager (master) to</span><br><span class="line">                                      which to connect. Use this flag to connect</span><br><span class="line">                                      to a different JobManager than the one</span><br><span class="line">                                      specified in the configuration.</span><br><span class="line">     -yid,--yarnapplicationId &lt;arg&gt;   Attach to running YARN session</span><br><span class="line">     -z,--zookeeperNamespace &lt;arg&gt;    Namespace to create the Zookeeper</span><br><span class="line">                                      sub-paths for high availability mode</span><br><span class="line"></span><br><span class="line">  Options for default mode:</span><br><span class="line">     -m,--jobmanager &lt;arg&gt;           Address of the JobManager (master) to which</span><br><span class="line">                                     to connect. Use this flag to connect to a</span><br><span class="line">                                     different JobManager than the one specified</span><br><span class="line">                                     in the configuration.</span><br><span class="line">     -z,--zookeeperNamespace &lt;arg&gt;   Namespace to create the Zookeeper sub-paths</span><br><span class="line">                                     for high availability mode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Action &quot;cancel&quot; cancels a running program.</span><br><span class="line"></span><br><span class="line">  Syntax: cancel [OPTIONS] &lt;Job ID&gt;</span><br><span class="line">  &quot;cancel&quot; action options:</span><br><span class="line">     -s,--withSavepoint &lt;targetDirectory&gt;   **DEPRECATION WARNING**: Cancelling</span><br><span class="line">                                            a job with savepoint is deprecated.</span><br><span class="line">                                            Use &quot;stop&quot; instead.</span><br><span class="line">                                            Trigger savepoint and cancel job.</span><br><span class="line">                                            The target directory is optional. If</span><br><span class="line">                                            no directory is specified, the</span><br><span class="line">                                            configured default directory</span><br><span class="line">                                            (state.savepoints.dir) is used.</span><br><span class="line">  Options for yarn-cluster mode:</span><br><span class="line">     -m,--jobmanager &lt;arg&gt;            Address of the JobManager (master) to</span><br><span class="line">                                      which to connect. Use this flag to connect</span><br><span class="line">                                      to a different JobManager than the one</span><br><span class="line">                                      specified in the configuration.</span><br><span class="line">     -yid,--yarnapplicationId &lt;arg&gt;   Attach to running YARN session</span><br><span class="line">     -z,--zookeeperNamespace &lt;arg&gt;    Namespace to create the Zookeeper</span><br><span class="line">                                      sub-paths for high availability mode</span><br><span class="line"></span><br><span class="line">  Options for default mode:</span><br><span class="line">     -m,--jobmanager &lt;arg&gt;           Address of the JobManager (master) to which</span><br><span class="line">                                     to connect. Use this flag to connect to a</span><br><span class="line">                                     different JobManager than the one specified</span><br><span class="line">                                     in the configuration.</span><br><span class="line">     -z,--zookeeperNamespace &lt;arg&gt;   Namespace to create the Zookeeper sub-paths</span><br><span class="line">                                     for high availability mode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Action &quot;savepoint&quot; triggers savepoints for a running job or disposes existing ones.</span><br><span class="line"></span><br><span class="line">  Syntax: savepoint [OPTIONS] &lt;Job ID&gt; [&lt;target directory&gt;]</span><br><span class="line">  &quot;savepoint&quot; action options:</span><br><span class="line">     -d,--dispose &lt;arg&gt;       Path of savepoint to dispose.</span><br><span class="line">     -j,--jarfile &lt;jarfile&gt;   Flink program JAR file.</span><br><span class="line">  Options for yarn-cluster mode:</span><br><span class="line">     -m,--jobmanager &lt;arg&gt;            Address of the JobManager (master) to</span><br><span class="line">                                      which to connect. Use this flag to connect</span><br><span class="line">                                      to a different JobManager than the one</span><br><span class="line">                                      specified in the configuration.</span><br><span class="line">     -yid,--yarnapplicationId &lt;arg&gt;   Attach to running YARN session</span><br><span class="line">     -z,--zookeeperNamespace &lt;arg&gt;    Namespace to create the Zookeeper</span><br><span class="line">                                      sub-paths for high availability mode</span><br><span class="line"></span><br><span class="line">  Options for default mode:</span><br><span class="line">     -m,--jobmanager &lt;arg&gt;           Address of the JobManager (master) to which</span><br><span class="line">                                     to connect. Use this flag to connect to a</span><br><span class="line">                                     different JobManager than the one specified</span><br><span class="line">                                     in the configuration.</span><br><span class="line">     -z,--zookeeperNamespace &lt;arg&gt;   Namespace to create the Zookeeper sub-paths</span><br><span class="line">                                     for high availability mode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Please specify an action.</span><br><span class="line">[double_happy@hadoop101 bin]$</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./flink  run [OPTIONS] &lt;jar-file&gt; &lt;arguments&gt; </span><br><span class="line"></span><br><span class="line">注意：  提交jar  运行 命令</span><br><span class="line"></span><br><span class="line">./flink run \</span><br><span class="line">--class com.sx.flink04.SocketWindowWordCount \</span><br><span class="line">/home/double_happy/lib/Flink-1.0.jar \</span><br><span class="line">--port 9998 \</span><br><span class="line">--host hadoop101</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">提交结果：</span><br><span class="line">[double_happy@hadoop101 bin]$ ./flink run \</span><br><span class="line">&gt; --class com.sx.flink04.SocketWindowWordCount \</span><br><span class="line">&gt; /home/double_happy/lib/Flink-1.0.jar \</span><br><span class="line">&gt; --port 9998 \</span><br><span class="line">&gt; --host hadoop101</span><br><span class="line">Starting execution of program</span><br></pre></td></tr></table></figure></div>

<p><img src="https://img-blog.csdnimg.cn/20200105210441990.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>点进去</strong><br><img src="https://img-blog.csdnimg.cn/20200105210608282.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nc 生产一些数据：</span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 ~]$ nc -lk 9998</span><br><span class="line">a,a,a,a,bb,c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">那么这些数据在Flink 哪里呢？</span><br><span class="line"></span><br><span class="line">点击 Task Managers： 能看到很多参数的 ***</span><br><span class="line">	1.能看到 jvm的 参数 </span><br><span class="line">	2.Network 相关的</span><br></pre></td></tr></table></figure></div>

<p><img src="https://img-blog.csdnimg.cn/20200105210959821.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这些日志哪里来的？</span><br><span class="line">	就是从文件系统读进来的</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20200105211034704.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">结果：</span><br><span class="line">	1.通过 页面可以看的到的 （就是从本地结果 传到页面上的 ）</span><br><span class="line">	2.通过本地也能看到</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">本地查看：</span><br><span class="line">	[double_happy@hadoop101 log]$ tail -200f flink-double_happy-taskexecutor-1-hadoop101.out</span><br><span class="line">	WordWithCount(a,1)</span><br><span class="line">	WordWithCount(a,2)</span><br><span class="line">	WordWithCount(a,3)</span><br><span class="line">	WordWithCount(a,4)</span><br><span class="line">	WordWithCount(bb,1)</span><br><span class="line">	WordWithCount(c,1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	$ tail -f log/flink-*-taskexecutor-*.out  </span><br><span class="line">就可以看到本地 结果</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如何停止这个作业：</span><br><span class="line">	1.页面 上 running jos 点进去 </span><br><span class="line">	2.本地命令</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20200105211557264.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">本地命令：</span><br><span class="line">	 ./flink  cancel [OPTIONS] &lt;Job ID&gt;</span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 bin]$ ./flink cancel 710a899ba9589d6a688c14931f7ef6cd</span><br><span class="line">Cancelling job 710a899ba9589d6a688c14931f7ef6cd.</span><br><span class="line">Cancelled job 710a899ba9589d6a688c14931f7ef6cd.</span><br><span class="line">[double_happy@hadoop101 bin]$</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20200105212016595.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">关闭集群：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 bin]$ jps</span><br><span class="line">4688 TaskManagerRunner</span><br><span class="line">4258 StandaloneSessionClusterEntrypoint</span><br><span class="line">9444 Jps</span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 bin]$ ./stop-cluster.sh </span><br><span class="line">Stopping taskexecutor daemon (pid: 4688) on host hadoop101.</span><br><span class="line">Stopping standalonesession daemon (pid: 4258) on host hadoop101.</span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 bin]$ jps</span><br><span class="line">10457 Jps</span><br><span class="line">[double_happy@hadoop101 bin]$</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	页面也就打不开了</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">以上：</span><br><span class="line">	就是最简单的local模式 运行jar  job</span><br></pre></td></tr></table></figure></div>

<h2 id="对比Spark-shell"><a href="#对比Spark-shell" class="headerlink" title="对比Spark-shell"></a>对比Spark-shell</h2><p><strong>start-scala-shell.sh</strong> </p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[double_happy@hadoop101 bin]$ ./start-scala-shell.sh </span><br><span class="line">Starting Flink Shell:</span><br><span class="line">log4j:WARN No appenders could be found for logger (org.apache.flink.configuration.GlobalConfiguration).</span><br><span class="line">log4j:WARN Please initialize the log4j system properly.</span><br><span class="line">log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.</span><br><span class="line">Error: please specify execution mode:</span><br><span class="line">[local | remote &lt;host&gt; &lt;port&gt; | yarn]</span><br><span class="line">[double_happy@hadoop101 bin]$ </span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	Error: please specify execution mode: 指定跑在什么模式下 </span><br><span class="line">	Spark和Flink都可以跑在多个模式上的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">[double_happy@hadoop101 bin]$ ./start-scala-shell.sh local</span><br><span class="line">Starting Flink Shell:</span><br><span class="line"></span><br><span class="line">Starting local Flink cluster (host: localhost, port: 8081).</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Connecting to Flink cluster (host: localhost, port: 8081).</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                         ▒▓██▓██▒</span><br><span class="line">                     ▓████▒▒█▓▒▓███▓▒</span><br><span class="line">                  ▓███▓░░        ▒▒▒▓██▒  ▒</span><br><span class="line">                ░██▒   ▒▒▓▓█▓▓▒░      ▒████</span><br><span class="line">                ██▒         ░▒▓███▒    ▒█▒█▒</span><br><span class="line">                  ░▓█            ███   ▓░▒██</span><br><span class="line">                    ▓█       ▒▒▒▒▒▓██▓░▒░▓▓█</span><br><span class="line">                  █░ █   ▒▒░       ███▓▓█ ▒█▒▒▒</span><br><span class="line">                  ████░   ▒▓█▓      ██▒▒▒ ▓███▒</span><br><span class="line">               ░▒█▓▓██       ▓█▒    ▓█▒▓██▓ ░█░</span><br><span class="line">         ▓░▒▓████▒ ██         ▒█    █▓░▒█▒░▒█▒</span><br><span class="line">        ███▓░██▓  ▓█           █   █▓ ▒▓█▓▓█▒</span><br><span class="line">      ░██▓  ░█░            █  █▒ ▒█████▓▒ ██▓░▒</span><br><span class="line">     ███░ ░ █░          ▓ ░█ █████▒░░    ░█░▓  ▓░</span><br><span class="line">    ██▓█ ▒▒▓▒          ▓███████▓░       ▒█▒ ▒▓ ▓██▓</span><br><span class="line"> ▒██▓ ▓█ █▓█       ░▒█████▓▓▒░         ██▒▒  █ ▒  ▓█▒</span><br><span class="line"> ▓█▓  ▓█ ██▓ ░▓▓▓▓▓▓▓▒              ▒██▓           ░█▒</span><br><span class="line"> ▓█    █ ▓███▓▒░              ░▓▓▓███▓          ░▒░ ▓█</span><br><span class="line"> ██▓    ██▒    ░▒▓▓███▓▓▓▓▓██████▓▒            ▓███  █</span><br><span class="line">▓███▒ ███   ░▓▓▒░░   ░▓████▓░                  ░▒▓▒  █▓</span><br><span class="line">█▓▒▒▓▓██  ░▒▒░░░▒▒▒▒▓██▓░                            █▓</span><br><span class="line">██ ▓░▒█   ▓▓▓▓▒░░  ▒█▓       ▒▓▓██▓    ▓▒          ▒▒▓</span><br><span class="line">▓█▓ ▓▒█  █▓░  ░▒▓▓██▒            ░▓█▒   ▒▒▒░▒▒▓█████▒</span><br><span class="line"> ██░ ▓█▒█▒  ▒▓▓▒  ▓█                █░      ░░░░   ░█▒</span><br><span class="line"> ▓█   ▒█▓   ░     █░                ▒█              █▓</span><br><span class="line">  █▓   ██         █░                 ▓▓        ▒█▓▓▓▒█░</span><br><span class="line">   █▓ ░▓██░       ▓▒                  ▓█▓▒░░░▒▓█░    ▒█</span><br><span class="line">    ██   ▓█▓░      ▒                    ░▒█▒██▒      ▓▓</span><br><span class="line">     ▓█▒   ▒█▓▒░                         ▒▒ █▒█▓▒▒░░▒██</span><br><span class="line">      ░██▒    ▒▓▓▒                     ▓██▓▒█▒ ░▓▓▓▓▒█▓</span><br><span class="line">        ░▓██▒                          ▓░  ▒█▓█  ░░▒▒▒</span><br><span class="line">            ▒▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░▓▓  ▓░▒█░</span><br><span class="line"></span><br><span class="line">              F L I N K - S C A L A - S H E L L</span><br><span class="line"></span><br><span class="line">NOTE: Use the prebound Execution Environments and Table Environment to implement batch or streaming programs.</span><br><span class="line"></span><br><span class="line">  Batch - Use the &apos;benv&apos; and &apos;btenv&apos; variable</span><br><span class="line"></span><br><span class="line">    * val dataSet = benv.readTextFile(&quot;/path/to/data&quot;)</span><br><span class="line">    * dataSet.writeAsText(&quot;/path/to/output&quot;)</span><br><span class="line">    * benv.execute(&quot;My batch program&quot;)</span><br><span class="line">    *</span><br><span class="line">    * val batchTable = btenv.fromDataSet(dataSet)</span><br><span class="line">    * btenv.registerTable(&quot;tableName&quot;, batchTable)</span><br><span class="line">    * val result = btenv.sqlQuery(&quot;SELECT * FROM tableName&quot;).collect</span><br><span class="line">    HINT: You can use print() on a DataSet to print the contents or collect()</span><br><span class="line">    a sql query result back to the shell.</span><br><span class="line"></span><br><span class="line">  Streaming - Use the &apos;senv&apos; and &apos;stenv&apos; variable</span><br><span class="line"></span><br><span class="line">    * val dataStream = senv.fromElements(1, 2, 3, 4)</span><br><span class="line">    * dataStream.countWindowAll(2).sum(0).print()</span><br><span class="line">    *</span><br><span class="line">    * val streamTable = stenv.fromDataStream(dataStream, &apos;num)</span><br><span class="line">    * val resultTable = streamTable.select(&apos;num).where(&apos;num % 2 === 1 )</span><br><span class="line">    * resultTable.toAppendStream[Row].print()</span><br><span class="line">    * senv.execute(&quot;My streaming program&quot;)</span><br><span class="line">    HINT: You can only print a DataStream to the shell in local mode.</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">scala&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">	  Batch - Use the &apos;benv&apos; and &apos;btenv&apos; variable</span><br><span class="line">	  Streaming - Use the &apos;senv&apos; and &apos;stenv&apos; variable</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">批处理：</span><br><span class="line">scala&gt; val text = benv.fromElements(&quot;kairis,kairis,kairis&quot;,&quot;double_happy,sxwang&quot;)</span><br><span class="line">text: org.apache.flink.api.scala.DataSet[String] = org.apache.flink.api.scala.DataSet@26a004ed</span><br><span class="line"></span><br><span class="line">scala&gt; text.flatMap(_.split(&quot;,&quot;)).map((_,1)).groupBy(0).sum(1).print</span><br><span class="line">(double_happy,1)</span><br><span class="line">(kairis,3)</span><br><span class="line">(sxwang,1)</span><br><span class="line"></span><br><span class="line">scala&gt;</span><br></pre></td></tr></table></figure></div>
<h2 id="跑在Yarn上"><a href="#跑在Yarn上" class="headerlink" title="跑在Yarn上 ***"></a>跑在Yarn上 ***</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">面试题：谈谈你对Flink ON YARN执行流程的理解？</span><br><span class="line"></span><br><span class="line">	和Spark mr 都差不多 只是 ApplicaitonMaster 名字变了</span><br></pre></td></tr></table></figure></div>
<p><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/ops/deployment/yarn_setup.html#yarn-setup" target="_blank" rel="noopener">YARN Setup</a><br><img src="https://img-blog.csdnimg.cn/20200105214018381.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/ops/deployment/yarn_setup.html#background--internals" target="_blank" rel="noopener">Background / Internals</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">The YARN client needs to access the Hadoop configuration to connect to the YARN resource manager and HDFS</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	YARN client 要配置gateway</span><br><span class="line"></span><br><span class="line">但是：</span><br><span class="line">	Flink跑yarn 跟Spark 跑yarn 有点区别</span><br><span class="line"></span><br><span class="line">为什么呢？</span><br><span class="line">	Flink有两种模式跑yarn</span><br><span class="line">		1.Start a long-running Flink cluster on YARN</span><br><span class="line">			启动一个长服务</span><br><span class="line">		2.Run a Flink job on YARN</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20200105215637367.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Spark里面 就是 右边这种  </span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	Spark申请资源是耗时的 还记得吗 依赖的 jar包需要传到hdfs上 也不然每次都要传 还记得么</span><br><span class="line"></span><br><span class="line">这两种方式会带来什么好处：</span><br><span class="line">	1.长服务 </span><br><span class="line">			省资源申请的时间</span><br></pre></td></tr></table></figure></div>
<p><strong>两种方式分别演示</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"> ./yarn-session.sh  运行的时候有坑的 ：</span><br><span class="line"> 	1.你自己源码编译好的是没有问题的</span><br><span class="line"> 	2.不是编译的 要在flink lib包下面 加一个 lib哦</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 bin]$ ./yarn-session.sh --help</span><br><span class="line">2020-01-05 22:32:14,068 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.rpc.address, hadoop101</span><br><span class="line">2020-01-05 22:32:14,070 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.rpc.port, 6123</span><br><span class="line">2020-01-05 22:32:14,070 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.heap.size, 1024m</span><br><span class="line">2020-01-05 22:32:14,070 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: taskmanager.heap.size, 1024m</span><br><span class="line">2020-01-05 22:32:14,070 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: taskmanager.numberOfTaskSlots, 1</span><br><span class="line">2020-01-05 22:32:14,070 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: parallelism.default, 1</span><br><span class="line">2020-01-05 22:32:14,071 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.execution.failover-strategy, region</span><br><span class="line">2020-01-05 22:32:14,071 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: rest.port, 8081</span><br><span class="line">2020-01-05 22:32:14,667 WARN  org.apache.hadoop.util.NativeCodeLoader                       - Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br><span class="line">2020-01-05 22:32:14,923 INFO  org.apache.flink.runtime.security.modules.HadoopModule        - Hadoop user set to double_happy (auth:SIMPLE)</span><br><span class="line">Usage:</span><br><span class="line">   Required</span><br><span class="line">     -n,--container &lt;arg&gt;   Number of YARN container to allocate (=Number of Task Managers)</span><br><span class="line">   Optional</span><br><span class="line">     -at,--applicationType &lt;arg&gt;     Set a custom application type for the application on YARN</span><br><span class="line">     -D &lt;property=value&gt;             use value for given property</span><br><span class="line">     -d,--detached                   If present, runs the job in detached mode</span><br><span class="line">     -h,--help                       Help for the Yarn session CLI.</span><br><span class="line">     -id,--applicationId &lt;arg&gt;       Attach to running YARN session</span><br><span class="line">     -j,--jar &lt;arg&gt;                  Path to Flink jar file</span><br><span class="line">     -jm,--jobManagerMemory &lt;arg&gt;    Memory for JobManager Container with optional unit (default: MB)</span><br><span class="line">     -m,--jobmanager &lt;arg&gt;           Address of the JobManager (master) to which to connect. Use this flag to connect to a different JobManager than the one specified in the configuration.</span><br><span class="line">     -n,--container &lt;arg&gt;            Number of YARN container to allocate (=Number of Task Managers)</span><br><span class="line">     -nl,--nodeLabel &lt;arg&gt;           Specify YARN node label for the YARN application</span><br><span class="line">     -nm,--name &lt;arg&gt;                Set a custom name for the application on YARN</span><br><span class="line">     -q,--query                      Display available YARN resources (memory, cores)</span><br><span class="line">     -qu,--queue &lt;arg&gt;               Specify YARN queue.</span><br><span class="line">     -s,--slots &lt;arg&gt;                Number of slots per TaskManager</span><br><span class="line">     -sae,--shutdownOnAttachedExit   If the job is submitted in attached mode, perform a best-effort cluster shutdown when the CLI is terminated abruptly, e.g., in response to a user interrupt, such</span><br><span class="line">                                     as typing Ctrl + C.</span><br><span class="line">     -st,--streaming                 Start Flink in streaming mode</span><br><span class="line">     -t,--ship &lt;arg&gt;                 Ship files in the specified directory (t for transfer)</span><br><span class="line">     -tm,--taskManagerMemory &lt;arg&gt;   Memory per TaskManager Container with optional unit (default: MB)</span><br><span class="line">     -yd,--yarndetached              If present, runs the job in detached mode (deprecated; use non-YARN specific option instead)</span><br><span class="line">     -z,--zookeeperNamespace &lt;arg&gt;   Namespace to create the Zookeeper sub-paths for high availability mode</span><br><span class="line">[double_happy@hadoop101 bin]$</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  Required</span><br><span class="line">     -n,--container &lt;arg&gt;   Number of YARN container to allocate (=Number of Task Managers)</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	必填的 </span><br><span class="line">	-n   就是 container   =  Number of Task Managers </span><br><span class="line"></span><br><span class="line">不是必填的：</span><br><span class="line">  -jm,--jobManagerMemory &lt;arg&gt;    Memory for JobManager Container with optional unit (default: MB)</span><br><span class="line"> -tm,--taskManagerMemory &lt;arg&gt;   Memory per TaskManager Container with optional unit (default: MB)</span><br><span class="line">    -d,--detached                   If present, runs the job in detached mode     运行你的job 以什么方式</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">运行起来：</span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 bin]$ ./yarn-session.sh -n 2 -jm 1024 -tm 1024 -d </span><br><span class="line"></span><br><span class="line">2020-01-05 22:37:43,651 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.rpc.address, hadoop101</span><br><span class="line">2020-01-05 22:37:43,656 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.rpc.port, 6123</span><br><span class="line">2020-01-05 22:37:43,656 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.heap.size, 1024m</span><br><span class="line">2020-01-05 22:37:43,657 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: taskmanager.heap.size, 1024m</span><br><span class="line">2020-01-05 22:37:43,657 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: taskmanager.numberOfTaskSlots, 1</span><br><span class="line">2020-01-05 22:37:43,657 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: parallelism.default, 1</span><br><span class="line">2020-01-05 22:37:43,658 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: jobmanager.execution.failover-strategy, region</span><br><span class="line">2020-01-05 22:37:43,658 INFO  org.apache.flink.configuration.GlobalConfiguration            - Loading configuration property: rest.port, 8081</span><br><span class="line">2020-01-05 22:37:44,328 WARN  org.apache.hadoop.util.NativeCodeLoader                       - Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br><span class="line">2020-01-05 22:37:44,505 INFO  org.apache.flink.runtime.security.modules.HadoopModule        - Hadoop user set to double_happy (auth:SIMPLE)</span><br><span class="line">2020-01-05 22:37:44,611 INFO  org.apache.hadoop.yarn.client.RMProxy                         - Connecting to ResourceManager at /0.0.0.0:8032</span><br><span class="line">2020-01-05 22:37:44,761 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - The argument n is deprecated in will be ignored.</span><br><span class="line">2020-01-05 22:37:44,930 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - Cluster specification: ClusterSpecification&#123;masterMemoryMB=1024, taskManagerMemoryMB=1024, numberTaskManagers=2, slotsPerTaskManager=1&#125;</span><br><span class="line">2020-01-05 22:37:45,573 WARN  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - The configuration directory (&apos;/home/double_happy/app/flink-1.9.1/conf&apos;) contains both LOG4J and Logback configuration files. Please delete or rename one of them.</span><br><span class="line">2020-01-05 22:37:47,853 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - Submitting application master application_1578233120766_0002</span><br><span class="line">2020-01-05 22:37:48,255 INFO  org.apache.hadoop.yarn.client.api.impl.YarnClientImpl         - Submitted application application_1578233120766_0002</span><br><span class="line">2020-01-05 22:37:48,255 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - Waiting for the cluster to be allocated</span><br><span class="line">2020-01-05 22:37:48,257 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - Deploying cluster, current state ACCEPTED</span><br><span class="line">2020-01-05 22:37:58,915 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - YARN application has been deployed successfully.</span><br><span class="line">2020-01-05 22:37:58,915 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - The Flink YARN client has been started in detached mode. In order to stop Flink on YARN, use the following command or a YARN web interface to stop it:</span><br><span class="line">yarn application -kill application_1578233120766_0002</span><br><span class="line">Please also note that the temporary files of the YARN session in the home directory will not be removed.</span><br><span class="line">2020-01-05 22:37:59,734 INFO  org.apache.flink.runtime.rest.RestClient                      - Rest client endpoint started.</span><br><span class="line">Flink JobManager is now running on hadoop101:8081 with leader id 00000000-0000-0000-0000-000000000000.</span><br><span class="line">JobManager Web Interface: http://hadoop101:8081</span><br><span class="line">2020-01-05 22:37:59,757 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - The Flink YARN client has been started in detached mode. In order to stop Flink on YARN, use the following command or a YARN web interface to stop it:</span><br><span class="line">yarn application -kill application_1578233120766_0002</span><br><span class="line">[double_happy@hadoop101 bin]$</span><br></pre></td></tr></table></figure></div>
<p>去yarn 上查看：<br><img src="https://img-blog.csdnimg.cn/20200105223922233.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">运行一个 例子试试：</span><br><span class="line">	Example</span><br><span class="line"></span><br><span class="line">wget -O LICENSE-2.0.txt http://www.apache.org/licenses/LICENSE-2.0.txt</span><br><span class="line">hadoop fs -copyFromLocal LICENSE-2.0.txt hdfs:/// ...</span><br><span class="line">./bin/flink run ./examples/batch/WordCount.jar \</span><br><span class="line">       --input hdfs:///..../LICENSE-2.0.txt --output hdfs:///.../wordcount-result.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	这是啥意思呀：</span><br><span class="line">		就是把数据 上传到hdfs上 然后运行</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[double_happy@hadoop101 data]$ hadoop fs -put ./LICENSE-2.0.txt /flink/input/</span><br><span class="line">put: `/flink/input/&apos;: No such file or directory</span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 data]$ hadoop fs -mkdir -p  /flink/input/</span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 data]$ hadoop fs -put ./LICENSE-2.0.txt /flink/input/    </span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 data]$ hadoop fs -ls /flink/input/</span><br><span class="line">Found 1 items</span><br><span class="line">-rw-r--r--   1 double_happy supergroup      11358 2020-01-05 22:43 /flink/input/LICENSE-2.0.txt</span><br><span class="line">[double_happy@hadoop101 data]$</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">运行：</span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 flink]$ ./bin/flink run ./examples/batch/WordCount.jar \</span><br><span class="line">&gt; --input hdfs://hadoop101:8020/flink/input/LICENSE-2.0.txt \</span><br><span class="line">&gt; --output hdfs://hadoop101:8020/flink/output</span><br><span class="line">2020-01-05 22:46:46,517 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - Found Yarn properties file under /tmp/.yarn-properties-double_happy.</span><br><span class="line">2020-01-05 22:46:46,517 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - Found Yarn properties file under /tmp/.yarn-properties-double_happy.</span><br><span class="line">2020-01-05 22:46:47,119 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - YARN properties set default parallelism to 2</span><br><span class="line">2020-01-05 22:46:47,119 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - YARN properties set default parallelism to 2</span><br><span class="line">YARN properties set default parallelism to 2</span><br><span class="line">2020-01-05 22:46:47,238 INFO  org.apache.hadoop.yarn.client.RMProxy                         - Connecting to ResourceManager at /0.0.0.0:8032</span><br><span class="line">2020-01-05 22:46:47,449 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - No path for the flink jar passed. Using the location of class org.apache.flink.yarn.YarnClusterDescriptor to locate the jar</span><br><span class="line">2020-01-05 22:46:47,449 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - No path for the flink jar passed. Using the location of class org.apache.flink.yarn.YarnClusterDescriptor to locate the jar</span><br><span class="line">2020-01-05 22:46:47,650 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - Found application JobManager host name &apos;hadoop101&apos; and port &apos;8081&apos; from supplied application id &apos;application_1578233120766_0002&apos;</span><br><span class="line">Starting execution of program</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">结果：</span><br><span class="line">[double_happy@hadoop101 flink]$ hadoop fs -ls /flink/output</span><br><span class="line">-rw-r--r--   1 double_happy supergroup       4499 2020-01-05 22:47 /flink/output</span><br><span class="line">[double_happy@hadoop101 flink]$ hadoop fs -text /flink/output</span><br><span class="line">0 3</span><br><span class="line">1 2</span><br><span class="line">2 4</span><br><span class="line">2004 1</span><br><span class="line">3 1</span><br><span class="line">4 1</span><br><span class="line">5 1</span><br><span class="line">50 1</span><br><span class="line">6 1</span><br><span class="line">7 1</span><br><span class="line">8 1</span><br><span class="line">9 2</span><br><span class="line">a 22</span><br><span class="line">above 1</span><br><span class="line">acceptance 1</span><br><span class="line">accepting 3</span><br><span class="line">act 1</span><br><span class="line">acting 1</span><br><span class="line">acts 1</span><br><span class="line">add 2</span><br><span class="line">addendum 1</span><br><span class="line">additional 5</span><br><span class="line">additions 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	Flink输出的 是文件 </span><br><span class="line">	Spark是文件夹</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">	这个模式 他怎么知道是提交到 哪个session上去呢？</span><br><span class="line"></span><br><span class="line">看控制台log：</span><br><span class="line">2020-01-05 22:46:46,517 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli              </span><br><span class="line">   - Found Yarn properties file under /tmp/.yarn-properties-double_happy.</span><br><span class="line"></span><br><span class="line">打开： /tmp/.yarn-properties-double_happy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 flink]$ cat /tmp/.yarn-properties-double_happy</span><br><span class="line">#Generated YARN properties file</span><br><span class="line">#Sun Jan 05 22:37:59 CST 2020</span><br><span class="line">parallelism=2</span><br><span class="line">dynamicPropertiesString=</span><br><span class="line">applicationID=application_1578233120766_0002     //yarn 的 application的 id</span><br><span class="line">[double_happy@hadoop101 flink]$</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	这块 如果你已经使用了 这个模式跑 之后 还想使用 local跑 </span><br><span class="line">	需要把/tmp/.yarn-properties-double_happy  这个 干掉 也不然 本地模式会 跑到yarn上 报错</span><br></pre></td></tr></table></figure></div>
<p><strong>Run a single Flink job on YARN</strong><br><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/ops/deployment/yarn_setup.html#run-a-single-flink-job-on-yarn" target="_blank" rel="noopener">Run a single Flink job on YARN</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line">官方案例：</span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 flink]$ ./bin/flink run -m yarn-cluster ./examples/batch/WordCount.jar</span><br><span class="line">2020-01-05 23:06:06,559 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - Found Yarn properties file under /tmp/.yarn-properties-double_happy.</span><br><span class="line">2020-01-05 23:06:06,559 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - Found Yarn properties file under /tmp/.yarn-properties-double_happy.</span><br><span class="line">2020-01-05 23:06:07,151 INFO  org.apache.hadoop.yarn.client.RMProxy                         - Connecting to ResourceManager at /0.0.0.0:8032</span><br><span class="line">2020-01-05 23:06:07,324 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - No path for the flink jar passed. Using the location of class org.apache.flink.yarn.YarnClusterDescriptor to locate the jar</span><br><span class="line">2020-01-05 23:06:07,324 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - No path for the flink jar passed. Using the location of class org.apache.flink.yarn.YarnClusterDescriptor to locate the jar</span><br><span class="line">2020-01-05 23:06:07,520 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - Cluster specification: ClusterSpecification&#123;masterMemoryMB=1024, taskManagerMemoryMB=1024, numberTaskManagers=1, slotsPerTaskManager=1&#125;</span><br><span class="line">2020-01-05 23:06:08,127 WARN  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - The configuration directory (&apos;/home/double_happy/app/flink-1.9.1/conf&apos;) contains both LOG4J and Logback configuration files. Please delete or rename one of them.</span><br><span class="line">2020-01-05 23:06:10,927 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - Submitting application master application_1578233120766_0003</span><br><span class="line">2020-01-05 23:06:10,965 INFO  org.apache.hadoop.yarn.client.api.impl.YarnClientImpl         - Submitted application application_1578233120766_0003</span><br><span class="line">2020-01-05 23:06:10,966 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - Waiting for the cluster to be allocated</span><br><span class="line">2020-01-05 23:06:10,971 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - Deploying cluster, current state ACCEPTED</span><br><span class="line">2020-01-05 23:06:18,402 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - YARN application has been deployed successfully.</span><br><span class="line">Starting execution of program</span><br><span class="line">Executing WordCount example with default input data set.</span><br><span class="line">Use --input to specify file input.</span><br><span class="line">Printing result to stdout. Use --output to specify output path.</span><br><span class="line">(a,5)</span><br><span class="line">(action,1)</span><br><span class="line">(after,1)</span><br><span class="line">(against,1)</span><br><span class="line">(all,2)</span><br><span class="line">(and,12)</span><br><span class="line">(arms,1)</span><br><span class="line">(arrows,1)</span><br><span class="line">(awry,1)</span><br><span class="line">(ay,1)</span><br><span class="line">(bare,1)</span><br><span class="line">(be,4)</span><br><span class="line">(bear,3)</span><br><span class="line">(bodkin,1)</span><br><span class="line">(bourn,1)</span><br><span class="line">(but,1)</span><br><span class="line">(by,2)</span><br><span class="line">(calamity,1)</span><br><span class="line">(cast,1)</span><br><span class="line">(coil,1)</span><br><span class="line">(come,1)</span><br><span class="line">(conscience,1)</span><br><span class="line">(consummation,1)</span><br><span class="line">(contumely,1)</span><br><span class="line">(country,1)</span><br><span class="line">(cowards,1)</span><br><span class="line">(currents,1)</span><br><span class="line">(d,4)</span><br><span class="line">(death,2)</span><br><span class="line">(delay,1)</span><br><span class="line">(despis,1)</span><br><span class="line">(devoutly,1)</span><br><span class="line">(die,2)</span><br><span class="line">(does,1)</span><br><span class="line">(dread,1)</span><br><span class="line">(dream,1)</span><br><span class="line">(dreams,1)</span><br><span class="line">(end,2)</span><br><span class="line">(enterprises,1)</span><br><span class="line">(er,1)</span><br><span class="line">(fair,1)</span><br><span class="line">(fardels,1)</span><br><span class="line">(flesh,1)</span><br><span class="line">(fly,1)</span><br><span class="line">(for,2)</span><br><span class="line">(fortune,1)</span><br><span class="line">(from,1)</span><br><span class="line">(give,1)</span><br><span class="line">(great,1)</span><br><span class="line">(grunt,1)</span><br><span class="line">(have,2)</span><br><span class="line">(he,1)</span><br><span class="line">(heartache,1)</span><br><span class="line">(heir,1)</span><br><span class="line">(himself,1)</span><br><span class="line">(his,1)</span><br><span class="line">(hue,1)</span><br><span class="line">(ills,1)</span><br><span class="line">(in,3)</span><br><span class="line">(insolence,1)</span><br><span class="line">(is,3)</span><br><span class="line">(know,1)</span><br><span class="line">(law,1)</span><br><span class="line">(life,2)</span><br><span class="line">(long,1)</span><br><span class="line">(lose,1)</span><br><span class="line">(love,1)</span><br><span class="line">(make,2)</span><br><span class="line">(makes,2)</span><br><span class="line">(man,1)</span><br><span class="line">(may,1)</span><br><span class="line">(merit,1)</span><br><span class="line">(might,1)</span><br><span class="line">(mind,1)</span><br><span class="line">(moment,1)</span><br><span class="line">(more,1)</span><br><span class="line">(mortal,1)</span><br><span class="line">(must,1)</span><br><span class="line">(my,1)</span><br><span class="line">(name,1)</span><br><span class="line">(native,1)</span><br><span class="line">(natural,1)</span><br><span class="line">(no,2)</span><br><span class="line">(nobler,1)</span><br><span class="line">(not,2)</span><br><span class="line">(now,1)</span><br><span class="line">(nymph,1)</span><br><span class="line">(o,1)</span><br><span class="line">(of,15)</span><br><span class="line">(off,1)</span><br><span class="line">(office,1)</span><br><span class="line">(ophelia,1)</span><br><span class="line">(opposing,1)</span><br><span class="line">(oppressor,1)</span><br><span class="line">(or,2)</span><br><span class="line">(orisons,1)</span><br><span class="line">(others,1)</span><br><span class="line">(outrageous,1)</span><br><span class="line">(pale,1)</span><br><span class="line">(pangs,1)</span><br><span class="line">(patient,1)</span><br><span class="line">(pause,1)</span><br><span class="line">(perchance,1)</span><br><span class="line">(pith,1)</span><br><span class="line">(proud,1)</span><br><span class="line">(puzzles,1)</span><br><span class="line">(question,1)</span><br><span class="line">(quietus,1)</span><br><span class="line">(rather,1)</span><br><span class="line">(regard,1)</span><br><span class="line">(remember,1)</span><br><span class="line">(resolution,1)</span><br><span class="line">(respect,1)</span><br><span class="line">(returns,1)</span><br><span class="line">(rub,1)</span><br><span class="line">(s,5)</span><br><span class="line">(say,1)</span><br><span class="line">(scorns,1)</span><br><span class="line">(sea,1)</span><br><span class="line">(shocks,1)</span><br><span class="line">(shuffled,1)</span><br><span class="line">(sicklied,1)</span><br><span class="line">(sins,1)</span><br><span class="line">(sleep,5)</span><br><span class="line">(slings,1)</span><br><span class="line">(so,1)</span><br><span class="line">(soft,1)</span><br><span class="line">(something,1)</span><br><span class="line">(spurns,1)</span><br><span class="line">(suffer,1)</span><br><span class="line">(sweat,1)</span><br><span class="line">(take,1)</span><br><span class="line">(takes,1)</span><br><span class="line">(than,1)</span><br><span class="line">(that,7)</span><br><span class="line">(the,22)</span><br><span class="line">(their,1)</span><br><span class="line">(them,1)</span><br><span class="line">(there,2)</span><br><span class="line">(these,1)</span><br><span class="line">(this,2)</span><br><span class="line">(those,1)</span><br><span class="line">(thought,1)</span><br><span class="line">(thousand,1)</span><br><span class="line">(thus,2)</span><br><span class="line">(thy,1)</span><br><span class="line">(time,1)</span><br><span class="line">(tis,2)</span><br><span class="line">(to,15)</span><br><span class="line">(traveller,1)</span><br><span class="line">(troubles,1)</span><br><span class="line">(turn,1)</span><br><span class="line">(under,1)</span><br><span class="line">(undiscover,1)</span><br><span class="line">(unworthy,1)</span><br><span class="line">(us,3)</span><br><span class="line">(we,4)</span><br><span class="line">(weary,1)</span><br><span class="line">(what,1)</span><br><span class="line">(when,2)</span><br><span class="line">(whether,1)</span><br><span class="line">(whips,1)</span><br><span class="line">(who,2)</span><br><span class="line">(whose,1)</span><br><span class="line">(will,1)</span><br><span class="line">(wish,1)</span><br><span class="line">(with,3)</span><br><span class="line">(would,2)</span><br><span class="line">(wrong,1)</span><br><span class="line">(you,1)</span><br><span class="line">Program execution finished</span><br><span class="line">Job with JobID 0af373b2d338811166328e7e1fca1fe1 has finished.</span><br><span class="line">Job Runtime: 10995 ms</span><br><span class="line">Accumulator Results: </span><br><span class="line">- fed80ecbe6107c17759a1be247abbdd4 (java.util.ArrayList) [170 elements]</span><br><span class="line"></span><br><span class="line">[double_happy@hadoop101 flink]$</span><br></pre></td></tr></table></figure></div>
<p><strong>运行一下 之前的local的 程序：</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">运行一下 之前的local的 程序：</span><br><span class="line">[double_happy@hadoop101 flink]$ ./bin/flink run \</span><br><span class="line">&gt; --class com.sx.flink04.SocketWindowWordCount \</span><br><span class="line">&gt; -m yarn-cluster \</span><br><span class="line">&gt; /home/double_happy/lib/Flink-1.0.jar \</span><br><span class="line">&gt; --port 9998 \</span><br><span class="line">&gt; --host hadoop101</span><br><span class="line">2020-01-05 23:08:37,619 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - Found Yarn properties file under /tmp/.yarn-properties-double_happy.</span><br><span class="line">2020-01-05 23:08:37,619 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - Found Yarn properties file under /tmp/.yarn-properties-double_happy.</span><br><span class="line">2020-01-05 23:08:38,076 INFO  org.apache.hadoop.yarn.client.RMProxy                         - Connecting to ResourceManager at /0.0.0.0:8032</span><br><span class="line">2020-01-05 23:08:38,294 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - No path for the flink jar passed. Using the location of class org.apache.flink.yarn.YarnClusterDescriptor to locate the jar</span><br><span class="line">2020-01-05 23:08:38,294 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                 - No path for the flink jar passed. Using the location of class org.apache.flink.yarn.YarnClusterDescriptor to locate the jar</span><br><span class="line">2020-01-05 23:08:38,467 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - Cluster specification: ClusterSpecification&#123;masterMemoryMB=1024, taskManagerMemoryMB=1024, numberTaskManagers=1, slotsPerTaskManager=1&#125;</span><br><span class="line">2020-01-05 23:08:39,079 WARN  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - The configuration directory (&apos;/home/double_happy/app/flink-1.9.1/conf&apos;) contains both LOG4J and Logback configuration files. Please delete or rename one of them.</span><br><span class="line">2020-01-05 23:08:40,769 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - Submitting application master application_1578233120766_0004</span><br><span class="line">2020-01-05 23:08:41,006 INFO  org.apache.hadoop.yarn.client.api.impl.YarnClientImpl         - Submitted application application_1578233120766_0004</span><br><span class="line">2020-01-05 23:08:41,007 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - Waiting for the cluster to be allocated</span><br><span class="line">2020-01-05 23:08:41,010 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - Deploying cluster, current state ACCEPTED</span><br><span class="line">2020-01-05 23:08:46,914 INFO  org.apache.flink.yarn.AbstractYarnClusterDescriptor           - YARN application has been deployed successfully.</span><br><span class="line">Starting execution of program</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/2020010523100919.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">输入数据：</span><br><span class="line">[double_happy@hadoop101 data]$ nc -lk 9998</span><br><span class="line">啊，a,a,a,v,b,c</span><br><span class="line">c,c,d,d,,b,b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看结果：</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20200105231116600.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">这是yarn的两种方式：</span><br><span class="line"></span><br><span class="line">我使用的是第二种方式 ：</span><br><span class="line">	如果需要一个MySQL jar包该怎么传？</span><br><span class="line">		我接触flink 时间很短  我身边同事也不知道 他们经常搞Flink的 竟然不知道？ 就知道打胖包？ 绝对是不可以的</span><br></pre></td></tr></table></figure></div>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Flink03-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/05/Flink03-double-happy/">Flink03--double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2020/01/05/Flink03-double-happy/" class="article-date">
  <time datetime="2020-01-05T15:47:23.000Z" itemprop="datePublished">2020-01-05</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="记录"><a href="#记录" class="headerlink" title="记录"></a>记录</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">写东西 还是要有通用的思想</span><br><span class="line"></span><br><span class="line">通用的！！！ 与底层的执行引擎是没关系的  Beam</span><br><span class="line">    Spark</span><br><span class="line">        1.6</span><br><span class="line">        2.x</span><br><span class="line">    Flink</span><br><span class="line"></span><br><span class="line">    你的API上一定不能出现底层执行引擎的API</span><br><span class="line"></span><br><span class="line">    适配 ==&gt; Spark/Flink</span><br></pre></td></tr></table></figure></div>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">上一篇文章 ：</span><br><span class="line">MySQLSource：</span><br><span class="line">class MySQLSource extends RichSourceFunction[Student]&#123;</span><br><span class="line"></span><br><span class="line">  var connection:Connection = _</span><br><span class="line">  var pstmt:PreparedStatement = _</span><br><span class="line"></span><br><span class="line">  // 在open方法中建立连接</span><br><span class="line">  override def open(parameters: Configuration): Unit = &#123;</span><br><span class="line">    super.open(parameters)</span><br><span class="line"></span><br><span class="line">    connection = MySQLUtils.getConnection(&quot;hadoop101&quot;,&quot;3306&quot;,&quot;test&quot;,&quot;root&quot;, &quot;wsx123$%^&quot;)</span><br><span class="line">    pstmt = connection.prepareStatement(&quot;select * from student&quot;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 释放</span><br><span class="line">  override def close(): Unit = &#123;</span><br><span class="line">    super.close()</span><br><span class="line">    MySQLUtils.closeConnection(connection, pstmt)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def cancel(): Unit = &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def run(ctx: SourceFunction.SourceContext[Student]): Unit = &#123;</span><br><span class="line"></span><br><span class="line">    println(&quot;~~~~run~~~~~~&quot;)</span><br><span class="line">    val rs = pstmt.executeQuery()</span><br><span class="line">    while(rs.next())&#123;</span><br><span class="line">      val student = Student(rs.getInt(&quot;id&quot;), rs.getString(&quot;name&quot;), rs.getString(&quot;password&quot;),rs.getInt(&quot;age&quot;))</span><br><span class="line">      ctx.collect(student)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">class MySQLSource extends RichSourceFunction[Student]</span><br><span class="line"></span><br><span class="line">RichSourceFunction：</span><br><span class="line">这个东西 并不是 上一篇文章的三个Function 中的一个 </span><br><span class="line"></span><br><span class="line">那么 RichSourceFunction 的并行度是多少？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">源码：</span><br><span class="line">public abstract class RichSourceFunction&lt;OUT&gt; extends AbstractRichFunction implements SourceFunction&lt;OUT&gt; &#123;</span><br><span class="line"></span><br><span class="line">	private static final long serialVersionUID = 1L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">我当时测试的时候 设置并行度为3的时候 报错的 </span><br><span class="line"></span><br><span class="line">源码里是继承SourceFunction的 </span><br><span class="line">所以并行度是1</span><br><span class="line"></span><br><span class="line">那么就有一个问题？</span><br><span class="line"> 有两个流：</span><br><span class="line"> </span><br><span class="line">	stream1  4并行度  emp表  log里      domain</span><br><span class="line">	stream2  1并行度  dept表  MySQL里    user_id</span><br><span class="line">这两个流进行 </span><br><span class="line">stream1.connect(stream2).map(x=&gt;&#123;&#125;)</span><br><span class="line"></span><br><span class="line">即：</span><br><span class="line">	logStream emp: deptno empno ename</span><br><span class="line">	mysqlStream dept: deptno dname</span><br><span class="line">	</span><br><span class="line">	outputStream empno,ename,deptno,dname</span><br><span class="line">	</span><br><span class="line">	数据清洗/ETL</span><br><span class="line">	outputStream = stream1.connect(stream2).map(x=&gt;&#123;</span><br><span class="line">	    ....</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">那么connect会成功么？？</span><br><span class="line">	4并行度的流 里面有写task 的deptno 关联 </span><br><span class="line">	1并行度的流 拿取dname 是拿不到的 </span><br><span class="line">那么这个问题该怎么解决呢？之后再说</span><br><span class="line"></span><br><span class="line">先解决并行度为1的问题 下面</span><br><span class="line"> 变为：RichParallelSourceFunction</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class ScalikeJDBCMySQLSource extends RichParallelSourceFunction[Student]&#123;</span><br><span class="line"></span><br><span class="line">  override def cancel(): Unit = &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def run(ctx: SourceFunction.SourceContext[Student]): Unit = &#123;</span><br><span class="line">    println(&quot;~~~run~~~~&quot;)</span><br><span class="line">    DBs.setupAll()  // parse configuration file</span><br><span class="line"></span><br><span class="line">    DB.readOnly&#123; implicit session =&gt; &#123;</span><br><span class="line">      SQL(&quot;select * from student&quot;).map(rs =&gt; &#123;</span><br><span class="line">        val student = Student(rs.int(&quot;id&quot;),rs.string(&quot;name&quot;),rs.string(&quot;password&quot;),rs.int(&quot;age&quot;))</span><br><span class="line">        ctx.collect(student)</span><br><span class="line">      &#125;).list().apply()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">     env.addSource(new ScalikeJDBCMySQLSource).setParallelism(2).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">~~~run~~~~</span><br><span class="line">~~~run~~~~</span><br><span class="line">6&gt; Student(1,kairis,wsx111,17)</span><br><span class="line">1&gt; Student(4,happy,11,48)</span><br><span class="line">8&gt; Student(3,double,44,12)</span><br><span class="line">7&gt; Student(2,dbh,11,90)</span><br><span class="line">7&gt; Student(3,double,44,12)</span><br><span class="line">5&gt; Student(1,kairis,wsx111,17)</span><br><span class="line">6&gt; Student(2,dbh,11,90)</span><br><span class="line">8&gt; Student(4,happy,11,48)</span><br><span class="line"></span><br><span class="line">2并行度 也就是结果会拿取两份</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">第二个问题：</span><br><span class="line">接着最开始流connect的问题 </span><br><span class="line"></span><br><span class="line">1.log流 的并行度是4   （100w条）</span><br><span class="line">那么 MySQL里的并行度是否有必要也是4呢？ （MySQl 1w条）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line"> 是不是 没有这个必要呀 </span><br><span class="line"> 1个并行度能处理过来的 就可以了 </span><br><span class="line"> 但是1个并行度 也log流4个并行度 connect的时候还会出问题</span><br><span class="line">那么该怎么办呢？之后说</span><br></pre></td></tr></table></figure></div>
<h2 id="Data-Sinks"><a href="#Data-Sinks" class="headerlink" title="Data Sinks"></a>Data Sinks</h2><p><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/dev/datastream_api.html#data-sinks" target="_blank" rel="noopener">Data Sinks</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">输出对比：</span><br><span class="line">Spark读写：外部数据源</span><br><span class="line">    spark.read.format(&quot;&quot;).option(&quot;&quot;,&quot;).load</span><br><span class="line">    spark.write.format(&quot;&quot;)....save</span><br><span class="line"></span><br><span class="line">Flink读写</span><br><span class="line">    addSource(new XXXSourceFunction)</span><br><span class="line">    addSink(new XXXSinkFunction)</span><br><span class="line"></span><br><span class="line">   都是  可插拔的  Spark 自定义外部数据源 </span><br><span class="line">还是Spark好用呀</span><br></pre></td></tr></table></figure></div>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p><strong>Sink kafka</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Flink的角色是Producer：</span><br><span class="line"></span><br><span class="line">object SinkApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">        val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;).map(x =&gt; &#123;</span><br><span class="line">          val splits = x.split(&quot;,&quot;)</span><br><span class="line">          Access(splits(0).toLong, splits(1), splits(2).toLong).toString</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        val producer = new FlinkKafkaProducer[String](</span><br><span class="line">          &quot;hadoop101:9092,hadoop101:9093,hadoop101:9094&quot;,         // broker list</span><br><span class="line">          &quot;double_happy_offset&quot;,               // target topic</span><br><span class="line">          new SimpleStringSchema)   // serialization schema</span><br><span class="line"></span><br><span class="line">        stream.addSink(producer)  // 2Kafka</span><br><span class="line">        stream.print() // 2Local</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">结果是：</span><br><span class="line">[double_happy@hadoop101 kafka]$ bin/kafka-console-consumer.sh \</span><br><span class="line">&gt; --bootstrap-server hadoop101:9092,hadoop101:9093,hadoop101:9094 \</span><br><span class="line">&gt; --topic double_happy_offset </span><br><span class="line">Access(201912120010,ruozedata.com,2000)</span><br><span class="line">Access(201912120010,ruozedata.com,4000)</span><br><span class="line">Access(201912120010,dongqiudi.com,1000)</span><br><span class="line">Access(201912120010,dongqiudi.com,6000)</span><br><span class="line">Access(201912120010,zhibo8.com,5000)</span><br></pre></td></tr></table></figure></div>
<p><strong>Kafak 2 Kafka</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">object SinkApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    val properties = new Properties()</span><br><span class="line">    properties.setProperty(&quot;bootstrap.servers&quot;,  &quot;hadoop101:9092,hadoop101:9093,hadoop101:9094&quot;)</span><br><span class="line">    properties.setProperty(&quot;group.id&quot;, &quot;sxwang&quot;)</span><br><span class="line">    </span><br><span class="line">    val consumer = new FlinkKafkaConsumer[String](&quot;double_happy_offset&quot;, new SimpleStringSchema(), properties)</span><br><span class="line">    </span><br><span class="line">    val stream = env.addSource(consumer)</span><br><span class="line"></span><br><span class="line">    // TODO... Kafka2Kafka  double_happy_offset ==&gt; double_happy_offset_test</span><br><span class="line">    </span><br><span class="line">    val producer = new FlinkKafkaProducer[String](</span><br><span class="line">      &quot;hadoop101:9092,hadoop101:9093,hadoop101:9094&quot;, // broker list</span><br><span class="line">      &quot;double_happy_offset_test&quot;, // target topic</span><br><span class="line">      new SimpleStringSchema) // serialization schema</span><br><span class="line"></span><br><span class="line">    stream.addSink(producer) // 2Kafka</span><br><span class="line">    stream.print() // 2Local</span><br><span class="line">    </span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">[double_happy@hadoop101 kafka]$ bin/kafka-console-consumer.sh \</span><br><span class="line">&gt; --bootstrap-server hadoop101:9092,hadoop101:9093,hadoop101:9094 \</span><br><span class="line">&gt; --topic double_happy_offset_test </span><br><span class="line">Access(201912120010,ruozedata.com,2000)</span><br><span class="line">Access(201912120010,dongqiudi.com,1000)</span><br><span class="line">Access(201912120010,dongqiudi.com,6000)</span><br><span class="line">e</span><br><span class="line">c</span><br><span class="line">Access(201912120010,ruozedata.com,4000)</span><br><span class="line">b</span><br><span class="line">e</span><br><span class="line">Access(201912120010,zhibo8.com,5000)</span><br><span class="line">c</span><br><span class="line">f</span><br></pre></td></tr></table></figure></div>
<p><strong>Sink MySQL</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * A &#123;@link org.apache.flink.api.common.functions.RichFunction&#125; version of &#123;@link SinkFunction&#125;.</span><br><span class="line"> */</span><br><span class="line">@Public</span><br><span class="line">public abstract class RichSinkFunction&lt;IN&gt; extends AbstractRichFunction implements SinkFunction&lt;IN&gt; &#123;</span><br><span class="line"></span><br><span class="line">	private static final long serialVersionUID = 1L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Interface for implementing user defined sink functionality.</span><br><span class="line"> *</span><br><span class="line"> * @param &lt;IN&gt; Input type parameter.</span><br><span class="line"> */</span><br><span class="line">@Public</span><br><span class="line">public interface SinkFunction&lt;IN&gt; extends Function, Serializable &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">所以</span><br><span class="line">IN： 表示 Input type parameter. </span><br><span class="line"></span><br><span class="line">表示sink到的 MySQL表里的 字段类型</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">class DoubleHappyMySQLSink  extends RichSinkFunction[(String,Int)]&#123;</span><br><span class="line"></span><br><span class="line">  var connection:Connection = _</span><br><span class="line">  var insertPstmt:PreparedStatement = _</span><br><span class="line">  var updatePstmt:PreparedStatement = _</span><br><span class="line"></span><br><span class="line">  // 打开connection等</span><br><span class="line">  override def open(parameters: Configuration): Unit = &#123;</span><br><span class="line">    super.open(parameters)</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">      * 这块与Spark不一样的 Spark是一个批次往下写 </span><br><span class="line">      * </span><br><span class="line">      * 而Flink是 来一条就往下写  </span><br><span class="line">      * </span><br><span class="line">      * 所以 :</span><br><span class="line">      *   这块创建两个 PreparedStatement 也可以创建一个 需要创建表的时候指定 key 即可 </span><br><span class="line">      *   </span><br><span class="line">      *   创建 两个简单些  ： 有就更新 没有就插入 </span><br><span class="line">      */</span><br><span class="line">    connection = MySQLUtils.getConnection()</span><br><span class="line">    insertPstmt = connection.prepareStatement(&quot;insert into domain(domain,traffic) values (?,?)&quot;)</span><br><span class="line">    updatePstmt = connection.prepareStatement(&quot;update domain set traffic=? where domain=?&quot;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">    * 写数据</span><br><span class="line">    */</span><br><span class="line">  override def invoke(value: (String, Int), context: SinkFunction.Context[_]): Unit = &#123;</span><br><span class="line">    // TODO   insert update</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">      * 这块并没有写错哦  要看 你的sql语句的 ？ 走的哦 </span><br><span class="line">      * </span><br><span class="line">      * 先更新 有就更新 无就插入</span><br><span class="line">      */</span><br><span class="line">    updatePstmt.setInt(1, value._2)</span><br><span class="line">    updatePstmt.setString(2, value._1)</span><br><span class="line">    updatePstmt.execute()</span><br><span class="line"></span><br><span class="line">    if(updatePstmt.getUpdateCount == 0) &#123;</span><br><span class="line">      insertPstmt.setString(1, value._1)</span><br><span class="line">      insertPstmt.setInt(2, value._2)</span><br><span class="line">      insertPstmt.execute()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // 释放资源</span><br><span class="line">  override def close(): Unit = &#123;</span><br><span class="line">    super.close()</span><br><span class="line">    if(insertPstmt != null) insertPstmt.close()</span><br><span class="line">    if(updatePstmt != null) updatePstmt.close()</span><br><span class="line">    if(connection != null) connection.close()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">这代码不严谨的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">object SinkApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;).map(x =&gt; &#123;</span><br><span class="line">      val splits = x.split(&quot;,&quot;)</span><br><span class="line">      (splits(1), splits(2).toInt)</span><br><span class="line">    &#125;).keyBy(0).sum(1)</span><br><span class="line"></span><br><span class="line">    stream.addSink(new DoubleHappyMySQLSink)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是： 我执行了两遍Flink程序  发现 结果幂等性 ok</span><br><span class="line">mysql&gt; select * from domain;</span><br><span class="line">+---------------+---------+</span><br><span class="line">| domain        | traffic |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| dongqiudi.com |    7000 |</span><br><span class="line">| ruozedata.com |    6000 |</span><br><span class="line">| zhibo8.com    |    5000 |</span><br><span class="line">+---------------+---------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from domain;</span><br><span class="line">+---------------+---------+</span><br><span class="line">| domain        | traffic |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| dongqiudi.com |    7000 |</span><br><span class="line">| ruozedata.com |    6000 |</span><br><span class="line">| zhibo8.com    |    5000 |</span><br><span class="line">+---------------+---------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="Debugging"><a href="#Debugging" class="headerlink" title="Debugging  ***"></a>Debugging  ***</h2><p>调试的手段***</p>
<p><strong>Iterator Data Sink</strong><br><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/dev/datastream_api.html#iterator-data-sink" target="_blank" rel="noopener">Iterator Data Sink</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">	你调试的时候 ：</span><br><span class="line">		1.不需要接kafka   使用 自定义Source 就可以 eg：RichParallelSourceFunction</span><br><span class="line">		2.Sink的时候 也不需要Sink 到 存储的地方去</span><br><span class="line">			eg：kudu 、Hbase等</span><br><span class="line">			这里使用 Iterator Data Sink</span><br><span class="line">这个真的很重要：</span><br><span class="line">	我封闭开发的时候 字段154个 Sink到kudu里面 </span><br><span class="line">如果使用 提供的 connecer 154个字段 你什么时候能写完 </span><br><span class="line">	一定是要写成 自动解析的 最好 </span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	刚好 我的业务场景 需要这个 Iterator Data Sink</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">官网：</span><br><span class="line">import org.apache.flink.streaming.experimental.DataStreamUtils</span><br><span class="line">import scala.collection.JavaConverters.asScalaIteratorConverter</span><br><span class="line"></span><br><span class="line">val myResult: DataStream[(String, Int)] = ...</span><br><span class="line">val myOutput: Iterator[(String, Int)] = DataStreamUtils.collect(myResult.javaStream).asScala</span><br></pre></td></tr></table></figure></div>

<p>案例：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    //测试使用</span><br><span class="line"></span><br><span class="line">    val data: DataStream[Domain.Access] = env.addSource(new AccessSource03).setParallelism(1)</span><br><span class="line"></span><br><span class="line">    import scala.collection.JavaConverters.asScalaIteratorConverter</span><br><span class="line">    val output: Iterator[Domain.Access] = DataStreamUtils.collect(data.javaStream).asScala</span><br><span class="line">    </span><br><span class="line">    output.take(1).foreach(println(_))</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">Access(1577975577015,zhibo8.cc,78)</span><br></pre></td></tr></table></figure></div>
<h2 id="Sink-redis"><a href="#Sink-redis" class="headerlink" title="Sink redis"></a>Sink redis</h2><p><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/dev/connectors/" target="_blank" rel="noopener">connector</a><br><img src="https://img-blog.csdnimg.cn/20200102225345666.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">pom 选择的 版本;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.apache.bahir&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;flink-connector-redis_2.11&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">这个版本可能下载不到 ：</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20200102225516772.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">所以下载：</span><br><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.apache.bahir/flink-connector-redis --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.bahir&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;flink-connector-redis_2.11&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></div>
<p><a href="https://bahir.apache.org/docs/flink/current/flink-streaming-redis/" target="_blank" rel="noopener">Flink Redis Connector</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class DoubleHappyRedisSink  extends RedisMapper[(String,Int)]&#123;</span><br><span class="line">  override def getCommandDescription: RedisCommandDescription = &#123;</span><br><span class="line">    new RedisCommandDescription(RedisCommand.HSET, &quot;double_happy_traffic&quot;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def getValueFromData(data: (String, Int)): String = &#123;</span><br><span class="line">    data._2 + &quot;&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def getKeyFromData(data: (String, Int)): String = &#123;</span><br><span class="line">    data._1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">object SinkApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;).map(x =&gt; &#123;</span><br><span class="line">      val splits = x.split(&quot;,&quot;)</span><br><span class="line">      (splits(1), splits(2).toInt)</span><br><span class="line">    &#125;).keyBy(0).sum(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val conf = new FlinkJedisPoolConfig.Builder().setHost(&quot;hadoop101&quot;).build()</span><br><span class="line"></span><br><span class="line">    stream.addSink(new RedisSink[(String, Int)](conf, new DoubleHappyRedisSink))</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">结果是：</span><br><span class="line">hadoop101:6379&gt; HGETALL double_happy_traffic</span><br><span class="line">1) &quot;ruozedata.com&quot;</span><br><span class="line">2) &quot;6000&quot;</span><br><span class="line">3) &quot;dongqiudi.com&quot;</span><br><span class="line">4) &quot;7000&quot;</span><br><span class="line">5) &quot;zhibo8.com&quot;</span><br><span class="line">6) &quot;5000&quot;</span><br><span class="line">hadoop101:6379&gt; </span><br><span class="line"></span><br><span class="line">与前面的MySQL 结果是一样的</span><br></pre></td></tr></table></figure></div>
<h2 id="解决前面的问题"><a href="#解决前面的问题" class="headerlink" title="***解决前面的问题"></a>***解决前面的问题</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Flink02-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/05/Flink02-double-happy/">Flink02--double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2020/01/05/Flink02-double-happy/" class="article-date">
  <time datetime="2020-01-05T15:46:29.000Z" itemprop="datePublished">2020-01-05</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Function</span><br><span class="line">    map ==&gt; MapFunction</span><br><span class="line">    filter ==&gt; FilterFunction</span><br><span class="line">    xxx ==&gt;  XxxFunction</span><br><span class="line">    RichXxxFunction  *****</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SourceFunction     non-parallel 1</span><br><span class="line">ParallelSourceFunction</span><br><span class="line">RichParallelSourceFunction  *****</span><br></pre></td></tr></table></figure></div>
<p><strong>//测试使用</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    //测试使用</span><br><span class="line">    env.fromCollection(List(</span><br><span class="line">      Access(201912120010L, &quot;ruozedata.com&quot;, 2000),</span><br><span class="line">      Access(201912120011L, &quot;ruozedata.com&quot;, 3000)</span><br><span class="line">    )</span><br><span class="line">    ).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">6&gt; Access(201912120011,ruozedata.com,3000)</span><br><span class="line">5&gt; Access(201912120010,ruozedata.com,2000)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">   * Creates a DataStream that contains the given elements. The elements must all be of the</span><br><span class="line">   * same type.</span><br><span class="line">   *</span><br><span class="line">   * Note that this operation will result in a non-parallel data source, i.e. a data source with</span><br><span class="line">   * a parallelism of one.</span><br><span class="line">   */</span><br><span class="line">  def fromElements[T: TypeInformation](data: T*): DataStream[T] = &#123;</span><br><span class="line">    fromCollection(data)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	前面的泛型 如果加上 会类型限定的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    //测试使用</span><br><span class="line">    env.fromElements(1, 2L, 3D, 4F, &quot;5&quot;).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">1&gt; 4.0</span><br><span class="line">8&gt; 3.0</span><br><span class="line">2&gt; 5</span><br><span class="line">7&gt; 2</span><br><span class="line">6&gt; 1</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	如果加上泛型  会类型限定的</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20191225232021656.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>Custom:</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env.addSource()</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.SourceFunction </span><br><span class="line">    cancel()</span><br><span class="line">    run()</span><br><span class="line">注意：</span><br><span class="line">	1.自定义数据源</span><br><span class="line">	      继承SourceFunction    要传一个泛型</span><br><span class="line">	2.实现 下面这两个方法</span><br><span class="line">		cancel()</span><br><span class="line">			用于关闭某个东西</span><br><span class="line">        run()  里面有ctx 上下文</span><br><span class="line">          用于产生数据的 </span><br><span class="line">	         因为这是SourceFunction 是数据源</span><br><span class="line">	         可以利用ctx 产生数据的</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	SourceFunction 是没有并行度可言的</span><br></pre></td></tr></table></figure></div>
<p><strong>这个很重要用于测试产生数据</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.sx.flink02</span><br><span class="line"></span><br><span class="line">import com.sx.bean.Domain.Access</span><br><span class="line">import org.apache.flink.streaming.api.functions.source.SourceFunction</span><br><span class="line"></span><br><span class="line">import scala.util.Random</span><br><span class="line"></span><br><span class="line">class AccessSource extends SourceFunction[Access]&#123;</span><br><span class="line"></span><br><span class="line">  var running = true</span><br><span class="line"></span><br><span class="line">  override def cancel(): Unit = &#123;</span><br><span class="line">    running = false</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def run(ctx: SourceFunction.SourceContext[Access]): Unit = &#123;</span><br><span class="line">    val random = new Random()</span><br><span class="line">    val domains = Array(&quot;ruozedata.com&quot;,&quot;zhibo8.cc&quot;,&quot;dongqiudi.com&quot;)</span><br><span class="line"></span><br><span class="line">    while(running) &#123;</span><br><span class="line">      val timestamp = System.currentTimeMillis()</span><br><span class="line">      1.to(10).map(x =&gt; &#123;</span><br><span class="line">        ctx.collect(Access(timestamp, domains(random.nextInt(domains.length)), random.nextInt(1000)+x))</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      // 休息下 每个5s</span><br><span class="line">      Thread.sleep(5000)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    //测试使用</span><br><span class="line">    env.addSource(new AccessSource).print()</span><br><span class="line">    </span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">7&gt; Access(1577502637884,zhibo8.cc,991)</span><br><span class="line">2&gt; Access(1577502637884,ruozedata.com,252)</span><br><span class="line">5&gt; Access(1577502637884,dongqiudi.com,428)</span><br><span class="line">8&gt; Access(1577502637884,dongqiudi.com,565)</span><br><span class="line">4&gt; Access(1577502637884,ruozedata.com,140)</span><br><span class="line">6&gt; Access(1577502637884,ruozedata.com,718)</span><br><span class="line">1&gt; Access(1577502637884,dongqiudi.com,66)</span><br><span class="line">3&gt; Access(1577502637884,dongqiudi.com,475)</span><br><span class="line">4&gt; Access(1577502637884,zhibo8.cc,694)</span><br><span class="line">3&gt; Access(1577502637884,zhibo8.cc,972)</span><br><span class="line"></span><br><span class="line">这就是每个5s发送10条数据</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">测试:</span><br><span class="line">SourceFunction 是没有并行度可言的 </span><br><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    //测试使用</span><br><span class="line"></span><br><span class="line">    env.addSource(new AccessSource).setParallelism(3).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">结果：</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Source: 1 is not a parallel source</span><br><span class="line">	at org.apache.flink.streaming.api.datastream.DataStreamSource.setParallelism(DataStreamSource.java:55)</span><br><span class="line">	at org.apache.flink.streaming.api.datastream.DataStreamSource.setParallelism(DataStreamSource.java:31)</span><br><span class="line">	at org.apache.flink.streaming.api.scala.DataStream.setParallelism(DataStream.scala:130)</span><br><span class="line">	at com.sx.flink02.SourceApp$.main(SourceApp.scala:15)</span><br><span class="line">	at com.sx.flink02.SourceApp.main(SourceApp.scala)</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">Source: 1 is not a parallel source</span><br><span class="line"></span><br><span class="line">查看源码：</span><br><span class="line">debug查看</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/201912281116240.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20191228111651840.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">所以在大数据场景下 没有并行度 这个就不能用</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">2.ParallelSourceFunction  带并行度的 </span><br><span class="line"></span><br><span class="line">class AccessSource02 extends ParallelSourceFunction[Access]&#123;</span><br><span class="line"></span><br><span class="line">  var running = true</span><br><span class="line"></span><br><span class="line">  override def cancel(): Unit = &#123;</span><br><span class="line">    running = false</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def run(ctx: SourceFunction.SourceContext[Access]): Unit = &#123;</span><br><span class="line">    val random = new Random()</span><br><span class="line">    val domains = Array(&quot;ruozedata.com&quot;,&quot;zhibo8.cc&quot;,&quot;dongqiudi.com&quot;)</span><br><span class="line"></span><br><span class="line">    while(running) &#123;</span><br><span class="line">      val timestamp = System.currentTimeMillis()</span><br><span class="line">      1.to(10).map(x =&gt; &#123;</span><br><span class="line">        ctx.collect(Access(timestamp, domains(random.nextInt(domains.length)), random.nextInt(1000)+x))</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      // 休息下</span><br><span class="line">      Thread.sleep(5000)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">代码是一样的 就换个继承</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    //测试使用</span><br><span class="line">    env.addSource(new AccessSource02).setParallelism(3).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">6&gt; Access(1577503201868,dongqiudi.com,704)</span><br><span class="line">8&gt; Access(1577503201868,zhibo8.cc,562)</span><br><span class="line">2&gt; Access(1577503201868,dongqiudi.com,526)</span><br><span class="line">7&gt; Access(1577503201868,ruozedata.com,952)</span><br><span class="line">3&gt; Access(1577503201868,ruozedata.com,525)</span><br><span class="line">2&gt; Access(1577503201868,dongqiudi.com,728)</span><br><span class="line">7&gt; Access(1577503201868,dongqiudi.com,185)</span><br><span class="line">5&gt; Access(1577503201868,ruozedata.com,737)</span><br><span class="line">2&gt; Access(1577503201868,zhibo8.cc,47)</span><br><span class="line">1&gt; Access(1577503201868,dongqiudi.com,77)</span><br><span class="line">4&gt; Access(1577503201868,ruozedata.com,275)</span><br><span class="line">5&gt; Access(1577503201868,ruozedata.com,47)</span><br><span class="line">7&gt; Access(1577503201868,dongqiudi.com,289)</span><br><span class="line">3&gt; Access(1577503201868,dongqiudi.com,934)</span><br><span class="line">8&gt; Access(1577503201868,ruozedata.com,69)</span><br><span class="line">6&gt; Access(1577503201868,dongqiudi.com,123)</span><br><span class="line">4&gt; Access(1577503201868,zhibo8.cc,719)</span><br><span class="line">1&gt; Access(1577503201868,zhibo8.cc,254)</span><br><span class="line">6&gt; Access(1577503201868,zhibo8.cc,1002)</span><br><span class="line">3&gt; Access(1577503201868,zhibo8.cc,358)</span><br><span class="line">7&gt; Access(1577503201868,dongqiudi.com,700)</span><br><span class="line">5&gt; Access(1577503201868,dongqiudi.com,692)</span><br><span class="line">6&gt; Access(1577503201868,ruozedata.com,408)</span><br><span class="line">5&gt; Access(1577503201868,ruozedata.com,986)</span><br><span class="line">1&gt; Access(1577503201868,ruozedata.com,284)</span><br><span class="line">4&gt; Access(1577503201868,zhibo8.cc,900)</span><br><span class="line">5&gt; Access(1577503201868,ruozedata.com,343)</span><br><span class="line">8&gt; Access(1577503201868,ruozedata.com,84)</span><br><span class="line">4&gt; Access(1577503201868,zhibo8.cc,967)</span><br><span class="line">8&gt; Access(1577503201868,ruozedata.com,14)</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">这就是每个5s发送10条数据 但是并行度是3的情况下 </span><br><span class="line">就是 每个5s 发送 10*3 = 30 条数据</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">3.RichParallelSourceFunction ****</span><br><span class="line">注意：</span><br><span class="line">	和上面的核心代码一样</span><br><span class="line">	但是 这个Rich里面</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Base class for implementing a parallel data source. Upon execution, the runtime will</span><br><span class="line"> * execute as many parallel instances of this function as configured parallelism</span><br><span class="line"> * of the source.</span><br><span class="line"> *</span><br><span class="line"> * &lt;p&gt;The data source has access to context information (such as the number of parallel</span><br><span class="line"> * instances of the source, and which parallel instance the current instance is)</span><br><span class="line"> * via &#123;@link #getRuntimeContext()&#125;. It also provides additional life-cycle methods</span><br><span class="line"> * (&#123;@link #open(org.apache.flink.configuration.Configuration)&#125; and &#123;@link #close()&#125;.&lt;/p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @param &lt;OUT&gt; The type of the records produced by this source.</span><br><span class="line"> */</span><br><span class="line">@Public</span><br><span class="line">public abstract class RichParallelSourceFunction&lt;OUT&gt; extends AbstractRichFunction</span><br><span class="line">		implements ParallelSourceFunction&lt;OUT&gt; &#123;</span><br><span class="line"></span><br><span class="line">	private static final long serialVersionUID = 1L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1. extends AbstractRichFunction </span><br><span class="line">而AbstractRichFunction </span><br><span class="line">是有生命周期的方法</span><br><span class="line">    open()</span><br><span class="line">    close()</span><br><span class="line"></span><br><span class="line">所以：</span><br><span class="line">	如果做一些</span><br><span class="line">	1.文件系统 </span><br><span class="line">	2.初始化</span><br><span class="line">	3.io</span><br><span class="line">	4.mysql 等等</span><br><span class="line">就得在open里和close里面获取连接 和关闭连接</span><br><span class="line"></span><br><span class="line">因为：</span><br><span class="line">	open()  close() 一个task会执行一次 （前面文章有例子）task就是并行度</span><br><span class="line">	所以要使用这个Function </span><br><span class="line">	生命周期是可以控制的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">class AccessSource03 extends RichParallelSourceFunction[Access]&#123;</span><br><span class="line"></span><br><span class="line">  var running = true</span><br><span class="line"></span><br><span class="line">  override def cancel(): Unit = &#123;</span><br><span class="line">    running = false</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def open(parameters: Configuration): Unit = &#123;</span><br><span class="line">    super.open(parameters)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def close(): Unit = &#123;</span><br><span class="line">    super.close()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  override def run(ctx: SourceFunction.SourceContext[Access]): Unit = &#123;</span><br><span class="line">    val random = new Random()</span><br><span class="line">    val domains = Array(&quot;ruozedata.com&quot;,&quot;zhibo8.cc&quot;,&quot;dongqiudi.com&quot;)</span><br><span class="line"></span><br><span class="line">    while(running) &#123;</span><br><span class="line">      val timestamp = System.currentTimeMillis()</span><br><span class="line">      1.to(10).map(x =&gt; &#123;</span><br><span class="line">        ctx.collect(Access(timestamp, domains(random.nextInt(domains.length)), random.nextInt(1000)+x))</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      // 休息下</span><br><span class="line">      Thread.sleep(5000)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">上面就是 Source的最基本的使用</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">那么现在有一个需求：</span><br><span class="line">  连接MySQL </span><br><span class="line">  查看官网 没有MySQL的Connector</span><br><span class="line"></span><br><span class="line">那么只能去github上找 或者 自己写一个Source即可</span><br><span class="line"></span><br><span class="line">需求就是：</span><br><span class="line">  把MySQL数据读取进来 </span><br><span class="line"></span><br><span class="line">操作MySQL pom里要加入MySQL依赖的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MySQL里面的数据：</span><br><span class="line">mysql&gt; select * from student;</span><br><span class="line">+----+--------+----------+-----+</span><br><span class="line">| id | name   | password | age |</span><br><span class="line">+----+--------+----------+-----+</span><br><span class="line">|  1 | kairis | wsx111   |  17 |</span><br><span class="line">|  2 | dbh    | 11       |  90 |</span><br><span class="line">|  3 | double | 44       |  12 |</span><br><span class="line">|  4 | happy  | 11       |  48 |</span><br><span class="line">+----+--------+----------+-----+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class MySQLSource extends RichSourceFunction[Student]&#123;</span><br><span class="line">  var connection:Connection = _</span><br><span class="line">  var pstmt:PreparedStatement = _</span><br><span class="line">  // 在open方法中建立连接</span><br><span class="line">  override def open(parameters: Configuration): Unit = &#123;</span><br><span class="line">    super.open(parameters)</span><br><span class="line">    connection = MySQLUtils.getConnection()</span><br><span class="line">    pstmt = connection.prepareStatement(&quot;select * from student&quot;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 释放</span><br><span class="line">  override def close(): Unit = &#123;</span><br><span class="line">    super.close()</span><br><span class="line">    MySQLUtils.closeConnection(connection, pstmt)</span><br><span class="line">  &#125;</span><br><span class="line">  override def cancel(): Unit = &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  override def run(ctx: SourceFunction.SourceContext[Student]): Unit = &#123;</span><br><span class="line">    val rs = pstmt.executeQuery()</span><br><span class="line">    while(rs.next())&#123;</span><br><span class="line">      val student = Student(rs.getInt(&quot;id&quot;), rs.getString(&quot;name&quot;), rs.getString(&quot;password&quot;),rs.getInt(&quot;age&quot;))</span><br><span class="line">      ctx.collect(student)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">	连接MySQL 生产上是有并行度的 </span><br><span class="line">	你不能在run里面建立连接   为什么呢？什么会触发run呢？主要的逻辑会触发run </span><br><span class="line">	这就类似Spark里面的 foreach 和foreachPartiion</span><br><span class="line">得借助于 open方法：</span><br><span class="line">	 去拿到连接   这个是每个task会执行一次</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line">    env.addSource(new MySQLSource).print()</span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">~~~~run~~~~~~</span><br><span class="line">5&gt; Student(4,happy,11,48)</span><br><span class="line">4&gt; Student(3,double,44,12)</span><br><span class="line">3&gt; Student(2,dbh,11,90)</span><br><span class="line">2&gt; Student(1,kairis,wsx111,17)</span><br><span class="line"></span><br><span class="line">env.addSource(new MySQLSource).setParallelism(3).print()</span><br><span class="line">会报错的：</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Source: 1 is not a parallel source</span><br><span class="line">为什么呢？</span><br><span class="line">但是这种方式 太low了 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">使用scalikjdbc： 这种方式更优雅些</span><br><span class="line">在配置文件里可以配置连接池</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">class ScalikeJDBCMySQLSource extends RichSourceFunction[Student]&#123;</span><br><span class="line"></span><br><span class="line">  override def cancel(): Unit = &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def run(ctx: SourceFunction.SourceContext[Student]): Unit = &#123;</span><br><span class="line">    println(&quot;~~~run~~~~&quot;)</span><br><span class="line">    DBs.setupAll()  // parse configuration file</span><br><span class="line"></span><br><span class="line">    DB.readOnly&#123; implicit session =&gt; &#123;</span><br><span class="line">      SQL(&quot;select * from student&quot;).map(rs =&gt; &#123;</span><br><span class="line">        val student = Student(rs.int(&quot;id&quot;),rs.string(&quot;name&quot;),rs.string(&quot;password&quot;),rs.int(&quot;age&quot;))</span><br><span class="line">        ctx.collect(student)</span><br><span class="line">      &#125;).list().apply()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">~~~run~~~~</span><br><span class="line">7&gt; Student(4,happy,11,48)</span><br><span class="line">5&gt; Student(2,dbh,11,90)</span><br><span class="line">4&gt; Student(1,kairis,wsx111,17)</span><br><span class="line">6&gt; Student(3,double,44,12)</span><br></pre></td></tr></table></figure></div>

<p><strong>读取kafka的数据</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">不同的kafka版本 Flink 使用的api不同</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20191228122121721.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">但是在 0.11之后就统一了</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20191228122438764.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我的kafka是 2.2.1系列的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">所以我使用的 pom是：</span><br><span class="line">我的flink 是 1.9.0的</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;flink-connector-kafka_2.11&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.9.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Flink’s Kafka consumer is</span><br><span class="line"> called FlinkKafkaConsumer08 (or 09 for</span><br><span class="line">  Kafka 0.9.0.x versions, etc. </span><br><span class="line"> or </span><br><span class="line"> just FlinkKafkaConsumer for Kafka &gt;= 1.0.0 versions).</span><br><span class="line">  It provides access to one or more Kafka topics.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Source：</span><br><span class="line">	Flink作为Kafka的消费者</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">	 * Creates a new Kafka streaming source consumer.</span><br><span class="line">	 *</span><br><span class="line">	 * @param topic             The name of the topic that should be consumed.</span><br><span class="line">	 * @param valueDeserializer The de-/serializer used to convert between Kafka&apos;s byte messages and Flink&apos;s objects.</span><br><span class="line">	 * @param props</span><br><span class="line">	 */</span><br><span class="line">	public FlinkKafkaConsumer(String topic, DeserializationSchema&lt;T&gt; valueDeserializer, Properties props) &#123;</span><br><span class="line">		this(Collections.singletonList(topic), valueDeserializer, props);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">1.topic</span><br><span class="line">2.DeserializationSchema   接收数据 所以是反序列化器 消费数据 所以是反序列化的</span><br><span class="line">3.Properties</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[double_happy@hadoop101 kafka]$ jps</span><br><span class="line">6544 Kafka</span><br><span class="line">7092 Kafka</span><br><span class="line">7892 Jps</span><br><span class="line">5959 QuorumPeerMain</span><br><span class="line">7723 Kafka</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">先开启：</span><br><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    val properties = new Properties()</span><br><span class="line">    properties.setProperty(&quot;bootstrap.servers&quot;, &quot;hadoop101:9092,hadoop101:9093,hadoop101:9094&quot;)</span><br><span class="line">    properties.setProperty(&quot;group.id&quot;, &quot;sxwang&quot;)</span><br><span class="line"></span><br><span class="line">    val consumer = new FlinkKafkaConsumer[String](&quot;double_happy_offset&quot;, new SimpleStringSchema(), properties)</span><br><span class="line"></span><br><span class="line">    env.addSource(consumer).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">结果：</span><br><span class="line">1&gt; b</span><br><span class="line">2&gt; d</span><br><span class="line">3&gt; d</span><br><span class="line">1&gt; c</span><br><span class="line">2&gt; f</span><br><span class="line">3&gt; b</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">往kafka发送数据：</span><br><span class="line">object DataGenerator &#123;</span><br><span class="line"></span><br><span class="line">  private val logger: Logger = LoggerFactory.getLogger(DataGenerator.getClass)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line">    val props = new Properties()</span><br><span class="line">    props.put(&quot;bootstrap.servers&quot;, &quot;hadoop101:9092,hadoop101:9093,hadoop101:9094&quot;)</span><br><span class="line">    props.put(&quot;acks&quot;, &quot;all&quot;)</span><br><span class="line">    props.put(&quot;key.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;)</span><br><span class="line">    props.put(&quot;value.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;)</span><br><span class="line">    val producer = new KafkaProducer[String, String](props)</span><br><span class="line"></span><br><span class="line">    for (i &lt;- 0 to 5) &#123;</span><br><span class="line">      Thread.sleep(100)</span><br><span class="line"></span><br><span class="line">      //拿一个abcdef</span><br><span class="line">      val word: String = String.valueOf((new Random().nextInt(6) + &apos;a&apos;).toChar)</span><br><span class="line">      val part = i % 3 //发到哪个分区 因为是三个分区</span><br><span class="line"></span><br><span class="line">      logger.error(&quot;word : &#123;&#125;&quot;, word)</span><br><span class="line"></span><br><span class="line">      val record = producer.send(new ProducerRecord[String, String](&quot;double_happy_offset&quot;, part, &quot;&quot;,word))</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    producer.close()</span><br><span class="line">    println(&quot;double_happy 数据产生完毕..........&quot;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Flink里面的kafka的offset 非常 好管理的 </span><br><span class="line">Spark里面的 是批次 每个批次的偏移量的管理 </span><br><span class="line">Flink是一条数据 进来的 一条数据进来的 </span><br><span class="line">控制偏移量就是api的使用 很简单</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">val myConsumer = new FlinkKafkaConsumer08[String](...)</span><br><span class="line">myConsumer.setStartFromEarliest()      // start from the earliest record possible</span><br><span class="line">myConsumer.setStartFromLatest()        // start from the latest record</span><br><span class="line">myConsumer.setStartFromTimestamp(...)  // start from specified epoch timestamp (milliseconds)</span><br><span class="line">myConsumer.setStartFromGroupOffsets()  // the default behaviour</span><br><span class="line"></span><br><span class="line">val stream = env.addSource(myConsumer)</span><br><span class="line"></span><br><span class="line">这是官网上的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">那么先讲使用 里面的状态和checkpoint 容错等 后续写入文章</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    val properties = new Properties()</span><br><span class="line">    properties.setProperty(&quot;bootstrap.servers&quot;, &quot;hadoop101:9092,hadoop101:9093,hadoop101:9094&quot;)</span><br><span class="line">    properties.setProperty(&quot;group.id&quot;, &quot;sxwang&quot;)</span><br><span class="line"></span><br><span class="line">    val consumer = new FlinkKafkaConsumer[String](&quot;double_happy_offset&quot;, new SimpleStringSchema(), properties)</span><br><span class="line"></span><br><span class="line">    consumer.setStartFromEarliest()</span><br><span class="line"></span><br><span class="line">    env.addSource(consumer).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">1&gt; a</span><br><span class="line">2&gt; f</span><br><span class="line">3&gt; b</span><br><span class="line">2&gt; f</span><br><span class="line">1&gt; b</span><br><span class="line">2&gt; d</span><br><span class="line">3&gt; e</span><br><span class="line">2&gt; f</span><br><span class="line">1&gt; c</span><br><span class="line">3&gt; d</span><br><span class="line">3&gt; b</span><br><span class="line"></span><br><span class="line">看 这就把我们前面写入kafka的数据读出来了</span><br><span class="line"></span><br><span class="line">所以Flink里的偏移量很简单 底层管理的很好</span><br><span class="line"></span><br><span class="line">问题：</span><br><span class="line"> 我能不能指定 一个分区 分区里面的 offset呢？</span><br></pre></td></tr></table></figure></div>

<p><img src="https://img-blog.csdnimg.cn/20191228125529931.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/dev/stream/operators/index.html#datastream-transformations" target="_blank" rel="noopener">DataStream Transformations</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">和Spark大部分都差不多 </span><br><span class="line">下面说一下 Spark里没有的</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20191228130532217.png" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">object TranformationApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">        val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;).map(x =&gt; &#123;</span><br><span class="line">          val splits = x.split(&quot;,&quot;)</span><br><span class="line">          Access(splits(0).toLong, splits(1), splits(2).toLong)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    stream.keyBy(_.domain).sum(&quot;traffic&quot;).print(&quot;sum&quot;)</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">结果是：</span><br><span class="line">sum:5&gt; Access(201912120010,ruozedata.com,2000)</span><br><span class="line">sum:6&gt; Access(201912120010,dongqiudi.com,1000)</span><br><span class="line">sum:6&gt; Access(201912120010,zhibo8.com,5000)</span><br><span class="line">sum:5&gt; Access(201912120010,ruozedata.com,6000)</span><br><span class="line">sum:6&gt; Access(201912120010,dongqiudi.com,7000)</span><br><span class="line"></span><br><span class="line">为什么结果是这样子的：</span><br><span class="line">   因为这是进来一条统计一次 </span><br><span class="line">注意和Spark的区别： Spark里是一个批次的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">object TranformationApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;).map(x =&gt; &#123;</span><br><span class="line">          val splits = x.split(&quot;,&quot;)</span><br><span class="line">          Access(splits(0).toLong, splits(1), splits(2).toLong)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        stream.keyBy(_.domain).reduce((x,y) =&gt; &#123;</span><br><span class="line">          Access(x.time, x.domain, (x.traffic+y.traffic+100))</span><br><span class="line">        &#125;).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">5&gt; Access(201912120010,ruozedata.com,4000)</span><br><span class="line">6&gt; Access(201912120010,dongqiudi.com,1000)</span><br><span class="line">6&gt; Access(201912120010,dongqiudi.com,7100)</span><br><span class="line">5&gt; Access(201912120010,ruozedata.com,6100)</span><br><span class="line">6&gt; Access(201912120010,zhibo8.com,5000)</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">1.reduce 比sum灵活   keyby之后 是把相同的domain 放到一起了</span><br><span class="line">2.为什么zhibo8.com 结果没有＋100</span><br><span class="line"></span><br><span class="line">进来一条统计一次  为什么结果没有+100呢？</span><br><span class="line">因为 就1个呀   reduce 把相邻的两个做操作 1个操作啥</span><br></pre></td></tr></table></figure></div>
<p><strong>分流：</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20191228131908308.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">这个功能 可能会用的到：</span><br><span class="line">这里使用split 后续 是使用  侧输出  因为split过时了  不过没有关系</span><br><span class="line"></span><br><span class="line">object TranformationApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;).map(x =&gt; &#123;</span><br><span class="line">      val splits = x.split(&quot;,&quot;)</span><br><span class="line">      Access(splits(0).toLong, splits(1), splits(2).toLong)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 5000 6000 7000</span><br><span class="line">    val splitStream = stream.keyBy(&quot;domain&quot;).sum(&quot;traffic&quot;).split(x =&gt; &#123;</span><br><span class="line">      if (x.traffic &gt; 6000) &#123;</span><br><span class="line">        Seq(&quot;大客户&quot;)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        Seq(&quot;一般客户&quot;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    splitStream.select(&quot;大客户&quot;).print(&quot;大客户&quot;)</span><br><span class="line">    splitStream.select(&quot;一般客户&quot;).print(&quot;一般客户&quot;)</span><br><span class="line">  </span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">一般客户:5&gt; Access(201912120010,ruozedata.com,2000)</span><br><span class="line">一般客户:6&gt; Access(201912120010,dongqiudi.com,1000)</span><br><span class="line">一般客户:6&gt; Access(201912120010,zhibo8.com,5000)</span><br><span class="line">一般客户:5&gt; Access(201912120010,ruozedata.com,6000)</span><br><span class="line">大客户:6&gt; Access(201912120010,dongqiudi.com,7000)</span><br><span class="line"></span><br><span class="line">splitStream.select(&quot;大客户&quot;, &quot;一般客户&quot;).print(&quot;ALL&quot;)</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">一般客户:5&gt; Access(201912120010,ruozedata.com,2000)</span><br><span class="line">一般客户:6&gt; Access(201912120010,dongqiudi.com,1000)</span><br><span class="line">ALL:5&gt; Access(201912120010,ruozedata.com,2000)</span><br><span class="line">ALL:6&gt; Access(201912120010,dongqiudi.com,1000)</span><br><span class="line">一般客户:6&gt; Access(201912120010,zhibo8.com,5000)</span><br><span class="line">ALL:6&gt; Access(201912120010,zhibo8.com,5000)</span><br><span class="line">一般客户:5&gt; Access(201912120010,ruozedata.com,6000)</span><br><span class="line">大客户:6&gt; Access(201912120010,dongqiudi.com,7000)</span><br><span class="line">ALL:5&gt; Access(201912120010,ruozedata.com,6000)</span><br><span class="line">ALL:6&gt; Access(201912120010,dongqiudi.com,7000)</span><br></pre></td></tr></table></figure></div>
<p><strong>合流</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">两个流是可以合的 ：</span><br><span class="line">union</span><br><span class="line">connect</span><br><span class="line"></span><br><span class="line">object TranformationApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;).map(x =&gt; &#123;</span><br><span class="line">      val splits = x.split(&quot;,&quot;)</span><br><span class="line">      Access(splits(0).toLong, splits(1), splits(2).toLong)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">        val stream1 = env.addSource(new AccessSource)</span><br><span class="line">        val stream2 = env.addSource(new AccessSource)</span><br><span class="line"></span><br><span class="line">//1.数据类型是一样的 </span><br><span class="line">        stream1.union(stream2).map(x=&gt;&#123;</span><br><span class="line">          println(&quot;接收到的数据:&quot; + x)</span><br><span class="line">          x</span><br><span class="line">        &#125;).print()</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：不重要哈 结果不重要 </span><br><span class="line">接收到的数据:Access(1577510963163,dongqiudi.com,656)</span><br><span class="line">接收到的数据:Access(1577510963163,dongqiudi.com,523)</span><br><span class="line">接收到的数据:Access(1577510963163,dongqiudi.com,340)</span><br><span class="line">接收到的数据:Access(1577510963163,ruozedata.com,450)</span><br><span class="line">接收到的数据:Access(1577510963163,ruozedata.com,790)</span><br><span class="line">2&gt; Access(1577510963163,ruozedata.com,450)</span><br><span class="line">接收到的数据:Access(1577510963163,dongqiudi.com,211)</span><br><span class="line">接收到的数据:Access(1577510963163,ruozedata.com,79)</span><br><span class="line">接收到的数据:Access(1577510963163,dongqiudi.com,673)</span><br><span class="line">4&gt; Access(1577510963163,ruozedata.com,79)</span><br><span class="line">6&gt; Access(1577510963163,dongqiudi.com,211)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  /**</span><br><span class="line">   * Creates a new DataStream by merging DataStream outputs of</span><br><span class="line">   * the same type with each other. The DataStreams merged using this operator</span><br><span class="line">   * will be transformed simultaneously.</span><br><span class="line">   *</span><br><span class="line">   */</span><br><span class="line">  def union(dataStreams: DataStream[T]*): DataStream[T] =</span><br><span class="line">    asScalaStream(stream.union(dataStreams.map(_.javaStream): _*))</span><br><span class="line">union:  he same type with each other.  要求数据类型是一样的 两个流</span><br><span class="line"></span><br><span class="line">但是生产上 要合并两个流 很少 两个流数据类型是一样的 </span><br><span class="line"></span><br><span class="line"> /**</span><br><span class="line">   * Creates a new ConnectedStreams by connecting</span><br><span class="line">   * DataStream outputs of different type with each other. The</span><br><span class="line">   * DataStreams connected using this operators can be used with CoFunctions.</span><br><span class="line">   */</span><br><span class="line">  def connect[T2](dataStream: DataStream[T2]): ConnectedStreams[T, T2] =</span><br><span class="line">    asScalaStream(stream.connect(dataStream.javaStream))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">两个流 数据类型不一样的： 使用 connect</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">两个流 数据类型不一样的：</span><br><span class="line"></span><br><span class="line">def map[R: TypeInformation](fun1: IN1 =&gt; R, fun2: IN2 =&gt; R):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">fun1: IN1 =&gt; R, fun2: IN2 =&gt; R</span><br><span class="line"></span><br><span class="line">fun1: IN1 =&gt; R   第一个流  做的操作</span><br><span class="line"> fun2: IN2 =&gt; R  第二个流 做的操作</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">object TranformationApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;).map(x =&gt; &#123;</span><br><span class="line">      val splits = x.split(&quot;,&quot;)</span><br><span class="line">      Access(splits(0).toLong, splits(1), splits(2).toLong)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    val stream1 = env.addSource(new AccessSource)</span><br><span class="line">    val stream2 = env.addSource(new AccessSource)</span><br><span class="line">   </span><br><span class="line">   val stream2New = stream2.map(x =&gt; (&quot;J哥&quot;, x))</span><br><span class="line">   </span><br><span class="line">   stream1.connect(stream2New).map(x=&gt;x,y=&gt;y).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">1&gt; Access(1577511438837,zhibo8.cc,823)</span><br><span class="line">8&gt; Access(1577511438837,zhibo8.cc,379)</span><br><span class="line">5&gt; Access(1577511438837,zhibo8.cc,176)</span><br><span class="line">5&gt; Access(1577511438837,zhibo8.cc,414)</span><br><span class="line">1&gt; (J哥,Access(1577511438837,zhibo8.cc,553))</span><br><span class="line">2&gt; Access(1577511438837,ruozedata.com,775)</span><br><span class="line">1&gt; (J哥,Access(1577511438837,ruozedata.com,561))</span><br><span class="line">6&gt; Access(1577511438837,dongqiudi.com,657)</span><br><span class="line">6&gt; Access(1577511438837,zhibo8.cc,131)</span><br><span class="line">6&gt; (J哥,Access(1577511438837,dongqiudi.com,826))</span><br><span class="line">7&gt; Access(1577511438837,ruozedata.com,153)</span><br><span class="line">7&gt; (J哥,Access(1577511438837,ruozedata.com,98))</span><br><span class="line">2&gt; (J哥,Access(1577511438837,ruozedata.com,588))</span><br><span class="line">2&gt; (J哥,Access(1577511438837,ruozedata.com,351))</span><br><span class="line">4&gt; Access(1577511438837,ruozedata.com,24)</span><br><span class="line">8&gt; (J哥,Access(1577511438837,dongqiudi.com,812))</span><br><span class="line">4&gt; (J哥,Access(1577511438837,dongqiudi.com,686))</span><br><span class="line">5&gt; (J哥,Access(1577511438837,zhibo8.cc,825))</span><br><span class="line">3&gt; Access(1577511438837,dongqiudi.com,333)</span><br><span class="line">3&gt; (J哥,Access(1577511438837,zhibo8.cc,140))</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">connect: </span><br><span class="line">     Connects  two data streams retaining their types </span><br><span class="line">     数据结构可以不同</span><br><span class="line">     two data streams  **</span><br><span class="line">union：</span><br><span class="line">       Union of two or more data streams</span><br><span class="line">        数据结构要相同</span><br><span class="line">        two or more data streams</span><br></pre></td></tr></table></figure></div>
<p><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/dev/stream/operators/#physical-partitioning" target="_blank" rel="noopener">Physical partitioning</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class DoubleHappyPartitioner extends Partitioner[String]&#123;</span><br><span class="line">  </span><br><span class="line">  override def partition(key: String, numPartitions: Int): Int = &#123;</span><br><span class="line">    println(&quot;partitions: &quot; + numPartitions)</span><br><span class="line">// 注意 scala 里面 不用使用 equals  直接 ==  即可</span><br><span class="line">    if(key == &quot;ruozedata.com&quot;)&#123;</span><br><span class="line">      0</span><br><span class="line">    &#125; else if(key == &quot;dongqiudi.com&quot;)&#123;</span><br><span class="line">      1</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      2</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">Partitioner[String]</span><br><span class="line"></span><br><span class="line">传进去的泛型 是 key的类型 </span><br><span class="line"></span><br><span class="line">分区的前提 是 kv</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">   * Partitions a tuple DataStream on the specified key fields using a custom partitioner.</span><br><span class="line">   * This method takes the key position to partition on, and a partitioner that accepts the key</span><br><span class="line">   * type.</span><br><span class="line">   *</span><br><span class="line">   * Note: This method works only on single field keys.</span><br><span class="line">   */</span><br><span class="line">  def partitionCustom[K: TypeInformation](partitioner: Partitioner[K], field: Int) : DataStream[T] =</span><br><span class="line">    asScalaStream(stream.partitionCustom(partitioner, field))</span><br><span class="line"></span><br><span class="line">field: Int  注意这个</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">object TranformationApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line">        env.setParallelism(3)</span><br><span class="line"></span><br><span class="line">        env.addSource(new AccessSource)</span><br><span class="line">          .map(x=&gt;(x.domain, x))</span><br><span class="line">          .partitionCustom(new DoubleHappyPartitioner, 0)</span><br><span class="line">          .map(x =&gt; &#123;</span><br><span class="line">            println(&quot;current thread id is: &quot; + Thread.currentThread().getId + &quot; , value is: &quot; + x)</span><br><span class="line">            x._2</span><br><span class="line">          &#125;).print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">current thread id is: 69 , value is: (zhibo8.cc,Access(1577512344598,zhibo8.cc,827))</span><br><span class="line">current thread id is: 68 , value is: (ruozedata.com,Access(1577512344598,ruozedata.com,143))</span><br><span class="line">1&gt; Access(1577512344598,ruozedata.com,143)</span><br><span class="line">3&gt; Access(1577512344598,zhibo8.cc,827)</span><br><span class="line">current thread id is: 68 , value is: (ruozedata.com,Access(1577512344598,ruozedata.com,672))</span><br><span class="line">1&gt; Access(1577512344598,ruozedata.com,672)</span><br><span class="line">current thread id is: 70 , value is: (dongqiudi.com,Access(1577512344598,dongqiudi.com,450))</span><br><span class="line">2&gt; Access(1577512344598,dongqiudi.com,450)</span><br><span class="line">current thread id is: 68 , value is: (ruozedata.com,Access(1577512344598,ruozedata.com,689))</span><br><span class="line">current thread id is: 69 , value is: (zhibo8.cc,Access(1577512344598,zhibo8.cc,608))</span><br><span class="line">current thread id is: 70 , value is: (dongqiudi.com,Access(1577512344598,dongqiudi.com,26))</span><br><span class="line">3&gt; Access(1577512344598,zhibo8.cc,608)</span><br><span class="line">2&gt; Access(1577512344598,dongqiudi.com,26)</span><br><span class="line">1&gt; Access(1577512344598,ruozedata.com,689)</span><br><span class="line">current thread id is: 69 , value is: (zhibo8.cc,Access(1577512344598,zhibo8.cc,430))</span><br><span class="line">current thread id is: 70 , value is: (dongqiudi.com,Access(1577512344598,dongqiudi.com,514))</span><br><span class="line">3&gt; Access(1577512344598,zhibo8.cc,430)</span><br><span class="line">2&gt; Access(1577512344598,dongqiudi.com,514)</span><br><span class="line">current thread id is: 69 , value is: (zhibo8.cc,Access(1577512344598,zhibo8.cc,345))</span><br><span class="line">3&gt; Access(1577512344598,zhibo8.cc,345)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">注意：线程</span><br><span class="line">1-&gt; ruozedata.com</span><br><span class="line">2-&gt;dongqiudi.com</span><br><span class="line">3&gt;zhibo8.cc  </span><br><span class="line">结果是没有问题的</span><br><span class="line"></span><br><span class="line">这就是分区器的简单使用</span><br><span class="line">让每个线程处理不同的数据</span><br></pre></td></tr></table></figure></div>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Flink01-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/05/Flink01-double-happy/">Flink01-double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2020/01/05/Flink01-double-happy/" class="article-date">
  <time datetime="2020-01-05T15:43:46.000Z" itemprop="datePublished">2020-01-05</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><img src="https://img-blog.csdnimg.cn/20191224213557490.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Stateful Computations over Data Streams</span><br><span class="line">    离线处理/批处理</span><br><span class="line">        state watermark</span><br><span class="line"></span><br><span class="line">    事件驱动：</span><br><span class="line">    	Flink ：来一条处理一条</span><br><span class="line">    	Spark：是微批次的  eg：3s     处理 3s的这些数据</span><br><span class="line">    流批一体：</span><br><span class="line"></span><br><span class="line">    Exactly-once state consistency</span><br><span class="line">    Event-time processing   ***</span><br><span class="line">    Sophisticated late data handling  延迟数据的处理（延迟数据是避免不了的）</span><br><span class="line">    	（我现在知道的 离线处理 Spark是可以解决延迟数据的问题）</span><br><span class="line"></span><br><span class="line">mvn archetype:generate                               \</span><br><span class="line">-DarchetypeGroupId=org.apache.flink              \</span><br><span class="line">-DarchetypeArtifactId=flink-quickstart-scala     \</span><br><span class="line">-DarchetypeVersion=1.9.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">set up the batch execution environment</span><br><span class="line">    ExecutionEnvironment.getExecutionEnvironment</span><br><span class="line">Start with getting some data from the environment</span><br><span class="line">then, transform the resulting DataSet[String] using operations</span><br><span class="line">execute program</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(x,...)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RichXXXFunction</span><br><span class="line">生命周期函数</span><br><span class="line">    open   初始化方法</span><br><span class="line">    close  资源释放</span><br><span class="line">    getRuntimeContext  拿到整个作业运行时上下文</span><br></pre></td></tr></table></figure></div>
<p><strong>Run Applications at any Scale</strong><br>Flink is designed to run stateful streaming applications at any scale. Applications are parallelized into possibly thousands of tasks that are distributed and concurrently executed in a cluster. Therefore, an application can leverage virtually unlimited amounts of CPUs, main memory, disk and network IO. Moreover, Flink easily maintains very large application state. Its asynchronous and incremental checkpointing algorithm ensures minimal impact on processing latencies while guaranteeing exactly-once state consistency.</p>
<p>Users reported impressive scalability numbers for Flink applications running in their production environments, such as</p>
<p><strong>applications processing multiple trillions of events per day,</strong><br><strong>applications maintaining multiple terabytes of state, and<br>applications running on thousands of cores</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> maintaining multiple terabytes of state：</span><br><span class="line"> 注意：</span><br><span class="line"> 	state维护在hdfs 有什么好处和坏处呢？</span><br><span class="line"></span><br><span class="line">Flink做的好的地方：</span><br><span class="line">	1.处理时间  eventtime等 </span><br><span class="line">	2.水印</span><br><span class="line">	3.容错机制</span><br><span class="line">	4.状态</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">pom.xml:</span><br><span class="line"></span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">    &lt;groupId&gt;com.yt&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;Flink&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;/version&gt;</span><br><span class="line">    &lt;inceptionYear&gt;2008&lt;/inceptionYear&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;flink.version&gt;1.9.0&lt;/flink.version&gt;</span><br><span class="line">        &lt;scala.binary.version&gt;2.11&lt;/scala.binary.version&gt;</span><br><span class="line">        &lt;scala.version&gt;2.11.12&lt;/scala.version&gt;</span><br><span class="line">        &lt;hadoop.version&gt;2.7.2&lt;/hadoop.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;repositories&gt;</span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">            &lt;id&gt;cloudera&lt;/id&gt;</span><br><span class="line">            &lt;url&gt;https://repository.cloudera.com/artifactory/cloudera-repos/&lt;/url&gt;</span><br><span class="line">        &lt;/repository&gt;</span><br><span class="line">    &lt;/repositories&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.7.7&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;hadoop.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--Flink依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;flink-scala_$&#123;scala.binary.version&#125;&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;flink-streaming-scala_$&#123;scala.binary.version&#125;&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;sourceDirectory&gt;src/main/scala&lt;/sourceDirectory&gt;</span><br><span class="line">        &lt;testSourceDirectory&gt;src/test/scala&lt;/testSourceDirectory&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.scala-tools&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-scala-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;compile&lt;/goal&gt;</span><br><span class="line">                            &lt;goal&gt;testCompile&lt;/goal&gt;</span><br><span class="line">                        &lt;/goals&gt;</span><br><span class="line">                    &lt;/execution&gt;</span><br><span class="line">                &lt;/executions&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;scalaVersion&gt;$&#123;scala.version&#125;&lt;/scalaVersion&gt;</span><br><span class="line">                    &lt;args&gt;</span><br><span class="line">                        &lt;arg&gt;-target:jvm-1.5&lt;/arg&gt;</span><br><span class="line">                    &lt;/args&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-eclipse-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;downloadSources&gt;true&lt;/downloadSources&gt;</span><br><span class="line">                    &lt;buildcommands&gt;</span><br><span class="line">                        &lt;buildcommand&gt;ch.epfl.lamp.sdt.core.scalabuilder&lt;/buildcommand&gt;</span><br><span class="line">                    &lt;/buildcommands&gt;</span><br><span class="line">                    &lt;additionalProjectnatures&gt;</span><br><span class="line">                        &lt;projectnature&gt;ch.epfl.lamp.sdt.core.scalanature&lt;/projectnature&gt;</span><br><span class="line">                    &lt;/additionalProjectnatures&gt;</span><br><span class="line">                    &lt;classpathContainers&gt;</span><br><span class="line">                        &lt;classpathContainer&gt;org.eclipse.jdt.launching.JRE_CONTAINER&lt;/classpathContainer&gt;</span><br><span class="line">                        &lt;classpathContainer&gt;ch.epfl.lamp.sdt.launching.SCALA_CONTAINER&lt;/classpathContainer&gt;</span><br><span class="line">                    &lt;/classpathContainers&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">    &lt;reporting&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.scala-tools&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-scala-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;scalaVersion&gt;$&#123;scala.version&#125;&lt;/scalaVersion&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/reporting&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">批处理：</span><br><span class="line">package com.sx.flink01</span><br><span class="line"></span><br><span class="line">import org.apache.flink.api.scala.&#123;DataSet, ExecutionEnvironment&#125;</span><br><span class="line">import org.apache.flink.api.scala._</span><br><span class="line">object BatchJob &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    // 获取批处理上下文 &lt;== SparkContext</span><br><span class="line">    val env = ExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    // 读取数据</span><br><span class="line">    val text: DataSet[String] = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\data.txt&quot;)</span><br><span class="line"></span><br><span class="line">    val value: DataSet[(String, Int)] = text.flatMap(_.toLowerCase.split(&quot;,&quot;))</span><br><span class="line">      .filter(_.nonEmpty)</span><br><span class="line">      .map((_, 1))</span><br><span class="line"></span><br><span class="line">    // transformation</span><br><span class="line">    val result = value.groupBy(0) // 0表示单词</span><br><span class="line">      .sum(1)</span><br><span class="line"></span><br><span class="line">    // sink  output</span><br><span class="line">    result.print()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">(double_happy,1)</span><br><span class="line">(kite,1)</span><br><span class="line">(25,2)</span><br><span class="line">(kairis,1)</span><br><span class="line">(32,1)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[double_happy@hadoop101 ~]$ nc -lk 7777</span><br><span class="line">doublehappy,1</span><br><span class="line">doublehappy,2</span><br><span class="line">doublehappy,3</span><br><span class="line">-------</span><br><span class="line"></span><br><span class="line">package com.sx.flink01</span><br><span class="line"></span><br><span class="line">import org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment&#125;</span><br><span class="line">import org.apache.flink.api.scala._</span><br><span class="line"></span><br><span class="line">object StreamingJob &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    // set up the streaming execution environment</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line">  </span><br><span class="line">    // 接收数据</span><br><span class="line">    val text: DataStream[String] = env.socketTextStream(&quot;hadoop101&quot;, 7777)</span><br><span class="line"></span><br><span class="line">    // transformation</span><br><span class="line">        val result = text.flatMap(_.toLowerCase.split(&quot;,&quot;))</span><br><span class="line">          .filter(_.nonEmpty)</span><br><span class="line">          .map((_, 1))</span><br><span class="line">          .keyBy(0).sum(1).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">2&gt; (2,1)</span><br><span class="line">4&gt; (doublehappy,1)</span><br><span class="line">4&gt; (1,1)</span><br><span class="line">4&gt; (doublehappy,2)</span><br><span class="line">4&gt; (doublehappy,3)</span><br><span class="line">3&gt; (3,1)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[double_happy@hadoop101 ~]$ nc -lk 7777</span><br><span class="line">double,double,double</span><br><span class="line">happy,happy</span><br><span class="line">------------------------</span><br><span class="line"></span><br><span class="line">package com.sx.flink01</span><br><span class="line"></span><br><span class="line">import org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment&#125;</span><br><span class="line">import org.apache.flink.api.scala._</span><br><span class="line"></span><br><span class="line">object StreamingJob &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line">    // set up the streaming execution environment</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    // 接收数据</span><br><span class="line">    val text: DataStream[String] = env.socketTextStream(&quot;hadoop101&quot;, 7777)</span><br><span class="line"></span><br><span class="line">    // transformation</span><br><span class="line">        val result = text.flatMap(_.toLowerCase.split(&quot;,&quot;))</span><br><span class="line">          .filter(_.nonEmpty)</span><br><span class="line">          .map((_, 1))</span><br><span class="line">          .keyBy(0).sum(1).print(&quot;double_happy&quot;)</span><br><span class="line">          .setParallelism(2)</span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">double_happy:1&gt; (double,2)</span><br><span class="line">double_happy:2&gt; (double,1)</span><br><span class="line">double_happy:2&gt; (double,3)</span><br><span class="line">double_happy:1&gt; (happy,1)</span><br><span class="line">double_happy:2&gt; (happy,2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">并行度为1：结果</span><br><span class="line">double_happy&gt; (double,1)</span><br><span class="line">double_happy&gt; (double,2)</span><br><span class="line">double_happy&gt; (double,3)</span><br><span class="line">double_happy&gt; (happy,1)</span><br><span class="line">double_happy&gt; (happy,2)</span><br></pre></td></tr></table></figure></div>

<p>使用字段表达式</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">package com.sx.flink01</span><br><span class="line"></span><br><span class="line">import org.apache.flink.streaming.api.scala.&#123;DataStream, StreamExecutionEnvironment&#125;</span><br><span class="line">import org.apache.flink.api.scala._</span><br><span class="line"></span><br><span class="line">object StreamingJob &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line">    // set up the streaming execution environment</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    // 接收数据</span><br><span class="line">    val text: DataStream[String] = env.socketTextStream(&quot;hadoop101&quot;, 7777)</span><br><span class="line"></span><br><span class="line">    // transformation</span><br><span class="line">//        val result = text.flatMap(_.toLowerCase.split(&quot;,&quot;))</span><br><span class="line">//          .filter(_.nonEmpty)</span><br><span class="line">//          .map((_, 1))</span><br><span class="line">//          .keyBy(0).sum(1).print(&quot;double_happy&quot;)</span><br><span class="line">//          .setParallelism(1)</span><br><span class="line"></span><br><span class="line">    val result = text.flatMap(_.toLowerCase.split(&quot;,&quot;))</span><br><span class="line">      .filter(_.nonEmpty)</span><br><span class="line">      .map(x =&gt; WC(x, 1))</span><br><span class="line">      .keyBy(_.word).sum(&quot;count&quot;).print(&quot;double_happy&quot;)</span><br><span class="line">      .setParallelism(1)</span><br><span class="line">//</span><br><span class="line">    // execute program</span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case class WC(word: String, count: Int)</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20191224232202396.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20191224232123302.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20191224232252212.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><p><img src="https://img-blog.csdnimg.cn/20191224225316454.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">At the bare minimum, the application depends on the Flink APIs. Many applications depend in addition on certain connector libraries (like Kafka, Cassandra, etc.)</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	connector libraries</span><br></pre></td></tr></table></figure></div>
<p><strong>Specifying Transformation Functions</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">package com.sx.bean</span><br><span class="line"></span><br><span class="line">object Domain &#123;</span><br><span class="line">  case class Access(time:Long, domain:String, traffic:Long)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.sx.flink01</span><br><span class="line"></span><br><span class="line">import com.sx.bean.Domain.Access</span><br><span class="line">import org.apache.flink.api.common.functions.&#123;FilterFunction, RichMapFunction, RuntimeContext&#125;</span><br><span class="line">import org.apache.flink.configuration.Configuration</span><br><span class="line">import org.apache.flink.streaming.api.scala.StreamExecutionEnvironment</span><br><span class="line">import org.apache.flink.api.scala._</span><br><span class="line"></span><br><span class="line">object SpecifyingTransformationFunctionsApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line">    env.setParallelism(1)</span><br><span class="line">    val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;)</span><br><span class="line">    val accessStream = stream.map(x =&gt; &#123;</span><br><span class="line">      val splits = x.split(&quot;,&quot;)</span><br><span class="line">      Access(splits(0).toLong, splits(1), splits(2).toLong)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    accessStream.print()</span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">Access(201912120010,ruozedata.com,2000)</span><br><span class="line">Access(201912120010,dongqiudi.com,6000)</span><br><span class="line">Access(201912120010,zhibo8.com,5000)</span><br><span class="line">Access(201912120010,ruozedata.com,4000)</span><br><span class="line">Access(201912120010,dongqiudi.com,1000)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需求1</span><br><span class="line">	过滤traffic &gt; 4000</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">方式1：Lambda Functions</span><br><span class="line">object SpecifyingTransformationFunctionsApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line">    env.setParallelism(1)</span><br><span class="line">    val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;)</span><br><span class="line">    val accessStream = stream.map(x =&gt; &#123;</span><br><span class="line">      val splits = x.split(&quot;,&quot;)</span><br><span class="line">      Access(splits(0).toLong, splits(1), splits(2).toLong)</span><br><span class="line">    &#125;)</span><br><span class="line">     // 过滤traffic &gt; 4000</span><br><span class="line">     accessStream.filter(_.traffic &gt; 4000).print()</span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">Access(201912120010,dongqiudi.com,6000)</span><br><span class="line">Access(201912120010,zhibo8.com,5000)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">方式二：</span><br><span class="line">package com.sx.flink01</span><br><span class="line"></span><br><span class="line">import com.sx.bean.Domain.Access</span><br><span class="line">import org.apache.flink.api.common.functions.&#123;FilterFunction, RichMapFunction, RuntimeContext&#125;</span><br><span class="line">import org.apache.flink.configuration.Configuration</span><br><span class="line">import org.apache.flink.streaming.api.scala.StreamExecutionEnvironment</span><br><span class="line">import org.apache.flink.api.scala._</span><br><span class="line"></span><br><span class="line">object SpecifyingTransformationFunctionsApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line">    env.setParallelism(1)</span><br><span class="line">    val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;)</span><br><span class="line">    val accessStream = stream.map(x =&gt; &#123;</span><br><span class="line">      val splits = x.split(&quot;,&quot;)</span><br><span class="line">      Access(splits(0).toLong, splits(1), splits(2).toLong)</span><br><span class="line">    &#125;)</span><br><span class="line">    accessStream.filter(new DoubleHappyFilter02(5000)).print()</span><br><span class="line">    </span><br><span class="line">    //    accessStream.filter(new FilterFunction[Access] &#123;</span><br><span class="line">    //      override def filter(value: Access): Boolean = value.traffic&gt;4000</span><br><span class="line">    //    &#125;).print()     //匿名内部类写法   别这么写  太难看了</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// XXXFunction   RichXXXFunction</span><br><span class="line">class DoubleHappyFilter extends FilterFunction[Access] &#123;</span><br><span class="line">  override def filter(value: Access): Boolean = value.traffic &gt; 4000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class DoubleHappyFilter02(traffic: Long) extends FilterFunction[Access] &#123;</span><br><span class="line">  override def filter(value: Access): Boolean = value.traffic &gt; traffic</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">Access(201912120010,dongqiudi.com,6000)</span><br></pre></td></tr></table></figure></div>

<p><img src="https://img-blog.csdnimg.cn/20191224234229488.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>这里面的生命周期函数</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RichXXXFunction</span><br><span class="line">生命周期函数</span><br><span class="line">    open   初始化方法</span><br><span class="line">    close  资源释放</span><br><span class="line">    getRuntimeContext  拿到整个作业运行时上下文</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">方式3：Rich functions</span><br><span class="line"></span><br><span class="line">package com.sx.flink01</span><br><span class="line"></span><br><span class="line">import com.sx.bean.Domain.Access</span><br><span class="line">import org.apache.flink.api.common.functions.&#123;FilterFunction, RichMapFunction, RuntimeContext&#125;</span><br><span class="line">import org.apache.flink.configuration.Configuration</span><br><span class="line">import org.apache.flink.streaming.api.scala.StreamExecutionEnvironment</span><br><span class="line">import org.apache.flink.api.scala._</span><br><span class="line"></span><br><span class="line">object SpecifyingTransformationFunctionsApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line">    env.setParallelism(2)</span><br><span class="line">    </span><br><span class="line">    val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;)</span><br><span class="line">     val accessStream = stream.map(new DoubleHappyMap)</span><br><span class="line"></span><br><span class="line">     // 过滤traffic &gt; 4000</span><br><span class="line">     accessStream.filter(_.traffic &gt; 4000).print()</span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// XXXFunction   RichXXXFunction</span><br><span class="line">class DoubleHappyFilter extends FilterFunction[Access] &#123;</span><br><span class="line">  override def filter(value: Access): Boolean = value.traffic &gt; 4000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class DoubleHappyFilter02(traffic: Long) extends FilterFunction[Access] &#123;</span><br><span class="line">  override def filter(value: Access): Boolean = value.traffic &gt; traffic</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class DoubleHappyMap extends RichMapFunction[String, Access] &#123;</span><br><span class="line">  override def map(value: String): Access = &#123;</span><br><span class="line">    val splits = value.split(&quot;,&quot;)</span><br><span class="line">    Access(splits(0).toLong, splits(1), splits(2).toLong)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def open(parameters: Configuration): Unit = &#123;</span><br><span class="line">    super.open(parameters)</span><br><span class="line">    println(&quot;~~~~~~~~~~~open~~~~~~~&quot;)</span><br><span class="line">  &#125;</span><br><span class="line">  override def close(): Unit = &#123;</span><br><span class="line">    super.close()</span><br><span class="line">  &#125;</span><br><span class="line">  override def getRuntimeContext: RuntimeContext = &#123;</span><br><span class="line">    super.getRuntimeContext</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">结果：  并行度为2的时候  </span><br><span class="line">~~~~~~~~~~~open~~~~~~~</span><br><span class="line">~~~~~~~~~~~open~~~~~~~</span><br><span class="line">1&gt; Access(201912120010,dongqiudi.com,6000)</span><br><span class="line">1&gt; Access(201912120010,zhibo8.com,5000)</span><br><span class="line"></span><br><span class="line">这块要注意 ：MySQL获取connection 放在open方法里 </span><br><span class="line">还要注意  不同的并行读  调用了几次 </span><br><span class="line"></span><br><span class="line">结果：并行度为1的时候</span><br><span class="line">~~~~~~~~~~~open~~~~~~~</span><br><span class="line">Access(201912120010,dongqiudi.com,6000)</span><br><span class="line">Access(201912120010,zhibo8.com,5000)</span><br></pre></td></tr></table></figure></div>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-tmp" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/20/tmp/">tmp</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/11/20/tmp/" class="article-date">
  <time datetime="2019-11-19T16:45:42.000Z" itemprop="datePublished">2019-11-20</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        
      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Azkaban调度-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/05/Azkaban%E8%B0%83%E5%BA%A6-double-happy/">Azkaban调度--double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/01/05/Azkaban%E8%B0%83%E5%BA%A6-double-happy/" class="article-date">
  <time datetime="2019-01-05T11:56:15.000Z" itemprop="datePublished">2019-01-05</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="安装Azkaban的坑"><a href="#安装Azkaban的坑" class="headerlink" title="安装Azkaban的坑"></a>安装Azkaban的坑</h2><p>当你使用单机模式运行azkaban时候：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">2019/09/23 22:06:53.626 +0800 ERROR [AzkabanWebServer] [Azkaban] Failed to start single server. Shutting down.</span><br><span class="line">java.io.IOException: Cannot find &apos;database.properties&apos; file in /home/double_happy/app/azkaban-solo-server/bin/sql/database.properties</span><br><span class="line">        at azkaban.database.AzkabanDatabaseSetup.loadDBProps(AzkabanDatabaseSetup.java:178)</span><br><span class="line">        at azkaban.database.AzkabanDatabaseSetup.loadTableInfo(AzkabanDatabaseSetup.java:102)</span><br><span class="line">        at azkaban.database.AzkabanDatabaseUpdater.runDatabaseUpdater(AzkabanDatabaseUpdater.java:82)</span><br><span class="line">        at azkaban.soloserver.AzkabanSingleServer.start(AzkabanSingleServer.java:93)</span><br><span class="line">        at azkaban.soloserver.AzkabanSingleServer.main(AzkabanSingleServer.java:58)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">解决方式：</span><br><span class="line"></span><br><span class="line">必须使用bin/azkaban-solo-start.sh</span><br></pre></td></tr></table></figure></div>
<h2 id="调度解决多个作业之间的依赖关系"><a href="#调度解决多个作业之间的依赖关系" class="headerlink" title="调度解决多个作业之间的依赖关系"></a>调度解决多个作业之间的依赖关系</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">nodes:</span><br><span class="line">  - name: platform_stat</span><br><span class="line">    type: command</span><br><span class="line">    dependsOn:</span><br><span class="line">      - etl</span><br><span class="line">    config:</span><br><span class="line">      command: sh /home/double_happy/ruozedata/project/hadoop-project/shell/platform_stat.sh 20190921</span><br><span class="line"></span><br><span class="line">  - name: etl</span><br><span class="line">    type: command</span><br><span class="line">    config:</span><br><span class="line">      command: sh /home/double_happy/ruozedata/project/hadoop-project/shell/etl.sh 20190921</span><br></pre></td></tr></table></figure></div>

<p><img src="https://img-blog.csdnimg.cn/20190923234758109.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">但是又一个问题呀：</span><br><span class="line">	shell 里的参数我可以不可以在 azkaban上面通过 parameters 传进来呢？</span><br><span class="line">	待续。。。。。。。</span><br></pre></td></tr></table></figure></div>
      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Zookeeper基本使用与监控-Curator" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/04/Zookeeper%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E4%B8%8E%E7%9B%91%E6%8E%A7-Curator/">Zookeeper基本使用与监控(Curator)</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/01/04/Zookeeper%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E4%B8%8E%E7%9B%91%E6%8E%A7-Curator/" class="article-date">
  <time datetime="2019-01-04T11:46:26.000Z" itemprop="datePublished">2019-01-04</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="1-Zookeeper基本使用"><a href="#1-Zookeeper基本使用" class="headerlink" title="1.Zookeeper基本使用"></a>1.Zookeeper基本使用</h2><p>(0)基本了解</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ZK核心术语</span><br><span class="line">    ZK的数据模型： 树形结构</span><br><span class="line">        /home/hadoop/app/ruozedata.txt</span><br><span class="line">    ZK每个节点znode，有一个唯一的路径标识</span><br><span class="line">    znode</span><br><span class="line">        临时的 ephemeral  临时znode下面不能有子节点</span><br><span class="line">            普通的</span><br><span class="line">            sequential</span><br><span class="line">        永久的 persistent</span><br><span class="line">            普通的</span><br><span class="line">            sequential  顺序编号目录节点</span><br><span class="line">    每个znode节点有各自的版本号</span><br><span class="line">    每个节点数据发生了变化，该节点的版本会加</span><br><span class="line">    ZK节点存储的数据量不宜过大，几K  *****</span><br><span class="line">    znode可以设置访问权限</span><br><span class="line">    znode可以设置watcher：当节点数据发生变化时，可以通过监视器获取</span><br></pre></td></tr></table></figure></div>

<p>(1)客户端命令行操作</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> 命令基本语法						功能描述</span><br><span class="line">help										显示所有操作命令</span><br><span class="line">ls path [watch]						使用 ls 命令来查看当前znode中所包含的内容</span><br><span class="line">ls2 path [watch]					查看当前节点数据并能看到更新次数等数据</span><br><span class="line">create									普通创建</span><br><span class="line">											-s  含有序列</span><br><span class="line">											-e  临时（重启或者超时消失）</span><br><span class="line">get path [watch]					获得节点的值</span><br><span class="line">set										设置节点的具体值</span><br><span class="line">stat										查看节点状态</span><br><span class="line">delete									删除节点</span><br><span class="line">rmr										递归删除节点</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">上面带[watch]  的是可以监控的  但是watcher zookeeper自身的api和命令都是一次性的 </span><br><span class="line">也就是用过了不能再用了（你懂的 ）</span><br><span class="line">解决办法 可以使用 curator 作为zkClient 来监控zookeeper的变化信息****</span><br><span class="line"></span><br><span class="line">eg：一些监控的种类</span><br><span class="line">watcher</span><br><span class="line">    zk中的watcher是一次性(*****)的</span><br><span class="line">    NodeCreated</span><br><span class="line">    NodeDataChanged</span><br><span class="line">    NodeDeleted</span><br><span class="line">    NodeChildrenChanged</span><br><span class="line">    </span><br><span class="line">四字命令 了解一下</span><br></pre></td></tr></table></figure></div>
<p>(2)CuratorApi<br>Curator是Netflix公司开源的一套zookeeper客户端框架，解决了很多Zookeeper客户端非常底层的细节开发工作，包括连接重连、反复注册Watcher和NodeExistsException异常等等。</p>
<p>版本选择：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这里我们的zookeeper的版本是3.4.x，所以api开发的时候 maven不同版本会用不同</span><br><span class="line">https://curator.apache.org/zk-compatibility.html      curator官网</span><br></pre></td></tr></table></figure></div>
<p>curator api 官网 ：<a href="https://curator.apache.org/curator-framework/index.html" target="_blank" rel="noopener">https://curator.apache.org/curator-framework/index.html</a></p>
<p>可以去官网上去学习，可以结合zookeeper api 来学习 curator api （突然手里来活了 写不了了 ）<br>这里可以借鉴：<br>    <a href="http://www.throwable.club/2018/12/16/zookeeper-curator-usage/#%E5%89%8D%E6%8F%90" target="_blank" rel="noopener">http://www.throwable.club/2018/12/16/zookeeper-curator-usage/#%E5%89%8D%E6%8F%90</a><br>英文不好的小伙伴 ，这篇文章很好的介绍Curator 使用 。</p>
<p>还有我的小组长的博客：<br><a href="https://liverrrr.fun/archives/quickstart_zookeeper" target="_blank" rel="noopener">https://liverrrr.fun/archives/quickstart_zookeeper</a><br>可以很好的学习 。</p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-SparkSQL-TextFile输出多列" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/17/SparkSQL-TextFile%E8%BE%93%E5%87%BA%E5%A4%9A%E5%88%97/">SparkSQL--TextFile输出多列</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2018/04/17/SparkSQL-TextFile%E8%BE%93%E5%87%BA%E5%A4%9A%E5%88%97/" class="article-date">
  <time datetime="2018-04-17T12:14:56.000Z" itemprop="datePublished">2018-04-17</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">这个问题我在SparkSQL001里面提出过这个问题 </span><br><span class="line">解决的方法有很多 </span><br><span class="line">我看了很多同组的同学解决思路  大部分是用RDD函数式编程解决的 </span><br><span class="line"></span><br><span class="line">但是我觉得没有必要那么做 </span><br><span class="line"></span><br><span class="line">曾经我在工作的时候 有个人问过我这个问题 我当时解决过  </span><br><span class="line"></span><br><span class="line">就在刚刚我查看我的博客时候 决定把我的解决办法给总结一下</span><br></pre></td></tr></table></figure></div>
<p><strong>数据格式和内容</strong><br><img src="https://img-blog.csdnimg.cn/20191112214900905.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">object TextFileApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val spark = SparkSession.builder().appName(&quot;TextFileApp&quot;).master(&quot;local[2]&quot;).enableHiveSupport().getOrCreate()</span><br><span class="line"></span><br><span class="line">    var df = spark.read.format(&quot;text&quot;).load(&quot;file:////Users/double_happy/Downloads/f16/data/text/man.txt&quot;)</span><br><span class="line"></span><br><span class="line">    df.printSchema()</span><br><span class="line">    df.show()</span><br><span class="line"></span><br><span class="line">    df = df.withColumn(&quot;data&quot;,UDFUtils.string2fields(df.col(&quot;value&quot;)))</span><br><span class="line">    df = df.withColumn(&quot;id&quot;,df.col(&quot;data.id&quot;))</span><br><span class="line">    df = df.withColumn(&quot;age&quot;,df.col(&quot;data.age&quot;))</span><br><span class="line"></span><br><span class="line">    df.printSchema()</span><br><span class="line">    df.show()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">root</span><br><span class="line"> |-- value: string (nullable = true)</span><br><span class="line"></span><br><span class="line">+---------------+</span><br><span class="line">|          value|</span><br><span class="line">+---------------+</span><br><span class="line">|double_happy,25|</span><br><span class="line">|      Kairis,25|</span><br><span class="line">|        Kite,32|</span><br><span class="line">+---------------+</span><br><span class="line"></span><br><span class="line">root</span><br><span class="line"> |-- value: string (nullable = true)</span><br><span class="line"> |-- data: struct (nullable = true)</span><br><span class="line"> |    |-- id: string (nullable = true)</span><br><span class="line"> |    |-- age: integer (nullable = false)</span><br><span class="line"> |-- id: string (nullable = true)</span><br><span class="line"> |-- age: integer (nullable = true)</span><br><span class="line"></span><br><span class="line">+---------------+------------------+------------+---+</span><br><span class="line">|          value|              data|          id|age|</span><br><span class="line">+---------------+------------------+------------+---+</span><br><span class="line">|double_happy,25|[double_happy, 25]|double_happy| 25|</span><br><span class="line">|      Kairis,25|      [Kairis, 25]|      Kairis| 25|</span><br><span class="line">|        Kite,32|        [Kite, 32]|        Kite| 32|</span><br><span class="line">+---------------+------------------+------------+---+</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">object UDFUtils &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  import org.apache.spark.sql.functions._</span><br><span class="line"></span><br><span class="line">  def string2fields=udf((data:String)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">    DataFormat(data.split(&quot;,&quot;)(0),data.split(&quot;,&quot;)(1).toInt)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  case class DataFormat(id:String,age:Int)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">上面的解决办法明白了吗 ？</span><br><span class="line">定义一个udf函数即可 </span><br><span class="line"></span><br><span class="line">这个代码同时也解决了 struct类型的你应该怎么处理 </span><br><span class="line">之前的文章也提到过这个问题 这里给解决了</span><br></pre></td></tr></table></figure></div>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-雅恩资源调优-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/17/%E9%9B%85%E6%81%A9%E8%B5%84%E6%BA%90%E8%B0%83%E4%BC%98-double-happy/">雅恩资源调优---double_happy</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2018/03/17/%E9%9B%85%E6%81%A9%E8%B5%84%E6%BA%90%E8%B0%83%E4%BC%98-double-happy/" class="article-date">
  <time datetime="2018-03-17T12:13:41.000Z" itemprop="datePublished">2018-03-17</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一台机器能运行多少个container 到底是由谁决定的 ？</span><br></pre></td></tr></table></figure></div>
<p><a href="https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-common/yarn-default.xml" target="_blank" rel="noopener">官网</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">生产上一台机器：</span><br><span class="line">	48G物理内存  8core--》16vcore</span><br><span class="line">	Linux系统本身要占内存+空留:  20% =9.6G</span><br><span class="line">	剩余: 80% =38.4G=38G    这些留给大数据组件</span><br><span class="line">	</span><br><span class="line">DN进程: 生产4G  </span><br><span class="line">	1000m</span><br><span class="line">	hadoop-env.sh</span><br><span class="line">	HADOOP_NAMENODE_OPTS=-Xmx1024m</span><br><span class="line">	HADOOP_DATANODE_OPTS=-Xmx1024m</span><br><span class="line">	</span><br><span class="line">NM进程: 生产4G</span><br><span class="line">	yarn-env.sh</span><br><span class="line">	export YARN_RESOURCEMANAGER_HEAPSIZE=1024</span><br><span class="line">	export YARN_NODEMANAGER_HEAPSIZE=1024</span><br><span class="line">NM 与DN 部署在同一台机器上： 数据本地化</span><br><span class="line"></span><br><span class="line">NN RM 经常性部署同一台  说白了 集群节点少</span><br><span class="line"></span><br><span class="line">*****</span><br><span class="line">资源内存: 38G-4-4=30G   这就是运行container容器 的 </span><br><span class="line">yarn.nodemanager.resource.memory-mb   30*1024   总的  </span><br><span class="line">默认配置</span><br><span class="line">yarn.scheduler.minimum-allocation-mb  1024     给容器最小的 内存     生产上 2g</span><br><span class="line">yarn.scheduler.maximum-allocation-mb  8192   给容器最大的 内存       生产上 30g</span><br><span class="line"></span><br><span class="line">按照官网默认的算：</span><br><span class="line">30G 30G/1G=30个container </span><br><span class="line">30G 30/8G=3个container ...6G    这里面 30这个值不好  30/8   还剩6g  32g 比较好 </span><br><span class="line">30个~3个</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20191108162536413.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>内存：</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">生产一: </span><br><span class="line">yarn.nodemanager.resource.memory-mb   30G</span><br><span class="line">yarn.scheduler.minimum-allocation-mb  2G</span><br><span class="line">yarn.scheduler.maximum-allocation-mb  30G</span><br><span class="line"></span><br><span class="line">2g--》  yarn给你分配的时候先给你最小的  当计算过程中发现内存不够了 yarn会给你长一个g</span><br><span class="line"></span><br><span class="line">15个~1个</span><br><span class="line"></span><br><span class="line">30G 是不是太大了 根据你作业来分的  你作业就是需要30g 你只能给30g</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">生产二：</span><br><span class="line">yarn.nodemanager.resource.memory-mb   32G</span><br><span class="line">yarn.scheduler.minimum-allocation-mb  2G</span><br><span class="line">yarn.scheduler.maximum-allocation-mb  8G</span><br><span class="line"></span><br><span class="line">16c~4c</span><br><span class="line"></span><br><span class="line">如果container  memory oom      那么调大yarn.scheduler.maximum-allocation-mb 这个 先把oom这个进程kill掉</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">生产三:</span><br><span class="line">256G:</span><br><span class="line"></span><br><span class="line">yarn.nodemanager.resource.memory-mb   168G</span><br><span class="line">yarn.scheduler.minimum-allocation-mb  4G</span><br><span class="line">yarn.scheduler.maximum-allocation-mb  24G</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">container p memory oom kill</span><br><span class="line"></span><br><span class="line">生产默认 </span><br><span class="line">yarn.nodemanager.pmem-check-enabled	true       //物理内存</span><br><span class="line">yarn.nodemanager.vmem-check-enabled	true      </span><br><span class="line">yarn.nodemanager.vmem-pmem-ratio	2.1     //物理内存 和虚拟内存的比例 </span><br><span class="line"></span><br><span class="line">物理内存 1m  虚拟内存 2.1m</span><br><span class="line"></span><br><span class="line">这两个内存超了 都会抱 oom</span><br></pre></td></tr></table></figure></div>
<p><strong>cpu</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CPU:</span><br><span class="line">yarn.nodemanager.resource.cpu-vcores	 12</span><br><span class="line">yarn.scheduler.minimum-allocation-vcores  1</span><br><span class="line">yarn.scheduler.maximum-allocation-vcores  4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">container: </span><br><span class="line">	memory 16c~4c</span><br><span class="line">	vcores 12c~3c </span><br><span class="line"></span><br><span class="line">所以这个两个变量</span><br><span class="line">cpu 和 mem  你应该怎么调 才能 资源最大化呢?  </span><br><span class="line">	到底是根据mem 来算 还是 core来算呢？ 已加密</span><br></pre></td></tr></table></figure></div>

      
    </div>
    
  </div>
  
  
</article>

  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>


</section>
        <aside id="sidebar">
  
    <div class="widget-box">
  <div class="avatar-box">
    <img class="avatar" src="/images/default-avatar.jpg" title="图片来自网络"></img>
    <h3 class="avatar-name">
      
        DoubleHappy
      
    </h3>
    <p class="avatar-slogan">
      特别耐撕的大数据，资深的打酱油攻城狮。
    </p>
  </div>
</div>


  
    

  
    

  
    
  
    
  <div class="widget-box">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li></ul>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/01/05/Kudu-Impala%E6%95%85%E9%9A%9C%E6%A1%88%E4%BE%8B01-double-happy/">Kudu+Impala故障案例01--double_happy</a>
          </li>
        
          <li>
            <a href="/2020/01/05/Flink04-double-happy/">Flink04--double_happy</a>
          </li>
        
          <li>
            <a href="/2020/01/05/Flink03-double-happy/">Flink03--double_happy</a>
          </li>
        
          <li>
            <a href="/2020/01/05/Flink02-double-happy/">Flink02--double_happy</a>
          </li>
        
          <li>
            <a href="/2020/01/05/Flink01-double-happy/">Flink01-double_happy</a>
          </li>
        
      </ul>
    </div>
  </div>

  
      <div class="widget-box">
    <h3 class="widget-title">友链</h3>
    <div class="widget">
      
        <a style="display: block;" href="https://liverrrr.fun/archives" title target='_blank'
        >一路眼瞎</a>
      
    </div>
  </div>

  
</aside>
      </div>
      <footer id="footer">
  <div class="foot-box global-width">
    &copy; 2020 DoubleHappy &nbsp;&nbsp;
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    &nbsp;|&nbsp;主题 <a href="https://github.com/yiluyanxia/hexo-theme-antiquity" target="_blank" rel="noopener">antiquity</a>
    <br>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">不蒜子告之   阁下是第<span id="busuanzi_value_site_pv"></span>个访客</span>
  </div>
</footer>
      <script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
<script>
if (!window.jQuery) {
var script = document.createElement('script');
script.src = "/js/jquery-2.0.3.min.js";
document.body.write(script);
}
</script>


<script src="/js/script.js"></script>



    </div>
    <nav id="mobile-nav" class="mobile-nav-box">
  <div class="mobile-nav-img mobile-nav-top"></div>
  
    <a href="/archives" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
  <div class="mobile-nav-img  mobile-nav-bottom"></div>
</nav>    
  </div>
</body>
</html>