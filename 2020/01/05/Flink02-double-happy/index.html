<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Flink02--double_happy | DoubleHappy or Jepson</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta name="description" content="概述12345Function    map ==&amp;gt; MapFunction    filter ==&amp;gt; FilterFunction    xxx ==&amp;gt;  XxxFunction    RichXxxFunction  *****  123SourceFunction     non-parallel 1ParallelSourceFunctionRichParallelSo">
<meta property="og:type" content="article">
<meta property="og:title" content="Flink02--double_happy">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;01&#x2F;05&#x2F;Flink02-double-happy&#x2F;index.html">
<meta property="og:site_name" content="DoubleHappy or Jepson">
<meta property="og:description" content="概述12345Function    map ==&amp;gt; MapFunction    filter ==&amp;gt; FilterFunction    xxx ==&amp;gt;  XxxFunction    RichXxxFunction  *****  123SourceFunction     non-parallel 1ParallelSourceFunctionRichParallelSo">
<meta property="og:locale" content="en">
<meta property="og:image" content="https:&#x2F;&#x2F;img-blog.csdnimg.cn&#x2F;20191225232021656.png?x-oss-process=image&#x2F;watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https:&#x2F;&#x2F;img-blog.csdnimg.cn&#x2F;201912281116240.png?x-oss-process=image&#x2F;watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https:&#x2F;&#x2F;img-blog.csdnimg.cn&#x2F;20191228111651840.png?x-oss-process=image&#x2F;watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https:&#x2F;&#x2F;img-blog.csdnimg.cn&#x2F;20191228122121721.png?x-oss-process=image&#x2F;watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https:&#x2F;&#x2F;img-blog.csdnimg.cn&#x2F;20191228122438764.png?x-oss-process=image&#x2F;watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https:&#x2F;&#x2F;img-blog.csdnimg.cn&#x2F;20191228125529931.png?x-oss-process=image&#x2F;watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https:&#x2F;&#x2F;img-blog.csdnimg.cn&#x2F;20191228130532217.png">
<meta property="og:image" content="https:&#x2F;&#x2F;img-blog.csdnimg.cn&#x2F;20191228131908308.png?x-oss-process=image&#x2F;watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70">
<meta property="og:updated_time" content="2020-01-05T15:48:07.891Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;img-blog.csdnimg.cn&#x2F;20191225232021656.png?x-oss-process=image&#x2F;watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70">
  
    <link rel="alternate" href="/atom.xml" title="DoubleHappy or Jepson" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/default-avatar.jpg">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlight.css">
</head>

<body>
  <div id="fullpage" class="mobile-nav-right">
    
      <div id="wrapper" title="图片来自网络">
    
    
      <header id="header">
  <div id="nav-toggle" class="nav-toggle"></div>
  <div class="head-box global-width">
    <nav class="nav-box nav-right">
      
        <a class="nav-item" href="/archives" title
        
        >首页</a>
      
        <a class="nav-item" href="/archives" title
        
        >归档</a>
      
    </nav>
  </div>
</header>
      <div id="middlecontent" title class="global-width sidebar-right">
        <section id="main"><article id="post-Flink02-double-happy" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 class="article-title" itemprop="name">
      Flink02--double_happy
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2020/01/05/Flink02-double-happy/" class="article-date">
  <time datetime="2020-01-05T15:46:29.000Z" itemprop="datePublished">2020-01-05</time>
</a>
    
    
  </div>
  
    <span id="busuanzi_container_page_pv">
      本文总阅读量<span id="busuanzi_value_page_pv"></span>次
    </span>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Function</span><br><span class="line">    map ==&gt; MapFunction</span><br><span class="line">    filter ==&gt; FilterFunction</span><br><span class="line">    xxx ==&gt;  XxxFunction</span><br><span class="line">    RichXxxFunction  *****</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SourceFunction     non-parallel 1</span><br><span class="line">ParallelSourceFunction</span><br><span class="line">RichParallelSourceFunction  *****</span><br></pre></td></tr></table></figure></div>
<p><strong>//测试使用</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    //测试使用</span><br><span class="line">    env.fromCollection(List(</span><br><span class="line">      Access(201912120010L, &quot;ruozedata.com&quot;, 2000),</span><br><span class="line">      Access(201912120011L, &quot;ruozedata.com&quot;, 3000)</span><br><span class="line">    )</span><br><span class="line">    ).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">6&gt; Access(201912120011,ruozedata.com,3000)</span><br><span class="line">5&gt; Access(201912120010,ruozedata.com,2000)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">   * Creates a DataStream that contains the given elements. The elements must all be of the</span><br><span class="line">   * same type.</span><br><span class="line">   *</span><br><span class="line">   * Note that this operation will result in a non-parallel data source, i.e. a data source with</span><br><span class="line">   * a parallelism of one.</span><br><span class="line">   */</span><br><span class="line">  def fromElements[T: TypeInformation](data: T*): DataStream[T] = &#123;</span><br><span class="line">    fromCollection(data)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	前面的泛型 如果加上 会类型限定的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    //测试使用</span><br><span class="line">    env.fromElements(1, 2L, 3D, 4F, &quot;5&quot;).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">1&gt; 4.0</span><br><span class="line">8&gt; 3.0</span><br><span class="line">2&gt; 5</span><br><span class="line">7&gt; 2</span><br><span class="line">6&gt; 1</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	如果加上泛型  会类型限定的</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20191225232021656.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>Custom:</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env.addSource()</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.SourceFunction </span><br><span class="line">    cancel()</span><br><span class="line">    run()</span><br><span class="line">注意：</span><br><span class="line">	1.自定义数据源</span><br><span class="line">	      继承SourceFunction    要传一个泛型</span><br><span class="line">	2.实现 下面这两个方法</span><br><span class="line">		cancel()</span><br><span class="line">			用于关闭某个东西</span><br><span class="line">        run()  里面有ctx 上下文</span><br><span class="line">          用于产生数据的 </span><br><span class="line">	         因为这是SourceFunction 是数据源</span><br><span class="line">	         可以利用ctx 产生数据的</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">	SourceFunction 是没有并行度可言的</span><br></pre></td></tr></table></figure></div>
<p><strong>这个很重要用于测试产生数据</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.sx.flink02</span><br><span class="line"></span><br><span class="line">import com.sx.bean.Domain.Access</span><br><span class="line">import org.apache.flink.streaming.api.functions.source.SourceFunction</span><br><span class="line"></span><br><span class="line">import scala.util.Random</span><br><span class="line"></span><br><span class="line">class AccessSource extends SourceFunction[Access]&#123;</span><br><span class="line"></span><br><span class="line">  var running = true</span><br><span class="line"></span><br><span class="line">  override def cancel(): Unit = &#123;</span><br><span class="line">    running = false</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def run(ctx: SourceFunction.SourceContext[Access]): Unit = &#123;</span><br><span class="line">    val random = new Random()</span><br><span class="line">    val domains = Array(&quot;ruozedata.com&quot;,&quot;zhibo8.cc&quot;,&quot;dongqiudi.com&quot;)</span><br><span class="line"></span><br><span class="line">    while(running) &#123;</span><br><span class="line">      val timestamp = System.currentTimeMillis()</span><br><span class="line">      1.to(10).map(x =&gt; &#123;</span><br><span class="line">        ctx.collect(Access(timestamp, domains(random.nextInt(domains.length)), random.nextInt(1000)+x))</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      // 休息下 每个5s</span><br><span class="line">      Thread.sleep(5000)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    //测试使用</span><br><span class="line">    env.addSource(new AccessSource).print()</span><br><span class="line">    </span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">7&gt; Access(1577502637884,zhibo8.cc,991)</span><br><span class="line">2&gt; Access(1577502637884,ruozedata.com,252)</span><br><span class="line">5&gt; Access(1577502637884,dongqiudi.com,428)</span><br><span class="line">8&gt; Access(1577502637884,dongqiudi.com,565)</span><br><span class="line">4&gt; Access(1577502637884,ruozedata.com,140)</span><br><span class="line">6&gt; Access(1577502637884,ruozedata.com,718)</span><br><span class="line">1&gt; Access(1577502637884,dongqiudi.com,66)</span><br><span class="line">3&gt; Access(1577502637884,dongqiudi.com,475)</span><br><span class="line">4&gt; Access(1577502637884,zhibo8.cc,694)</span><br><span class="line">3&gt; Access(1577502637884,zhibo8.cc,972)</span><br><span class="line"></span><br><span class="line">这就是每个5s发送10条数据</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">测试:</span><br><span class="line">SourceFunction 是没有并行度可言的 </span><br><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    //测试使用</span><br><span class="line"></span><br><span class="line">    env.addSource(new AccessSource).setParallelism(3).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">结果：</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Source: 1 is not a parallel source</span><br><span class="line">	at org.apache.flink.streaming.api.datastream.DataStreamSource.setParallelism(DataStreamSource.java:55)</span><br><span class="line">	at org.apache.flink.streaming.api.datastream.DataStreamSource.setParallelism(DataStreamSource.java:31)</span><br><span class="line">	at org.apache.flink.streaming.api.scala.DataStream.setParallelism(DataStream.scala:130)</span><br><span class="line">	at com.sx.flink02.SourceApp$.main(SourceApp.scala:15)</span><br><span class="line">	at com.sx.flink02.SourceApp.main(SourceApp.scala)</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">Source: 1 is not a parallel source</span><br><span class="line"></span><br><span class="line">查看源码：</span><br><span class="line">debug查看</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/201912281116240.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20191228111651840.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">所以在大数据场景下 没有并行度 这个就不能用</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">2.ParallelSourceFunction  带并行度的 </span><br><span class="line"></span><br><span class="line">class AccessSource02 extends ParallelSourceFunction[Access]&#123;</span><br><span class="line"></span><br><span class="line">  var running = true</span><br><span class="line"></span><br><span class="line">  override def cancel(): Unit = &#123;</span><br><span class="line">    running = false</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def run(ctx: SourceFunction.SourceContext[Access]): Unit = &#123;</span><br><span class="line">    val random = new Random()</span><br><span class="line">    val domains = Array(&quot;ruozedata.com&quot;,&quot;zhibo8.cc&quot;,&quot;dongqiudi.com&quot;)</span><br><span class="line"></span><br><span class="line">    while(running) &#123;</span><br><span class="line">      val timestamp = System.currentTimeMillis()</span><br><span class="line">      1.to(10).map(x =&gt; &#123;</span><br><span class="line">        ctx.collect(Access(timestamp, domains(random.nextInt(domains.length)), random.nextInt(1000)+x))</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      // 休息下</span><br><span class="line">      Thread.sleep(5000)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">代码是一样的 就换个继承</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    //测试使用</span><br><span class="line">    env.addSource(new AccessSource02).setParallelism(3).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">6&gt; Access(1577503201868,dongqiudi.com,704)</span><br><span class="line">8&gt; Access(1577503201868,zhibo8.cc,562)</span><br><span class="line">2&gt; Access(1577503201868,dongqiudi.com,526)</span><br><span class="line">7&gt; Access(1577503201868,ruozedata.com,952)</span><br><span class="line">3&gt; Access(1577503201868,ruozedata.com,525)</span><br><span class="line">2&gt; Access(1577503201868,dongqiudi.com,728)</span><br><span class="line">7&gt; Access(1577503201868,dongqiudi.com,185)</span><br><span class="line">5&gt; Access(1577503201868,ruozedata.com,737)</span><br><span class="line">2&gt; Access(1577503201868,zhibo8.cc,47)</span><br><span class="line">1&gt; Access(1577503201868,dongqiudi.com,77)</span><br><span class="line">4&gt; Access(1577503201868,ruozedata.com,275)</span><br><span class="line">5&gt; Access(1577503201868,ruozedata.com,47)</span><br><span class="line">7&gt; Access(1577503201868,dongqiudi.com,289)</span><br><span class="line">3&gt; Access(1577503201868,dongqiudi.com,934)</span><br><span class="line">8&gt; Access(1577503201868,ruozedata.com,69)</span><br><span class="line">6&gt; Access(1577503201868,dongqiudi.com,123)</span><br><span class="line">4&gt; Access(1577503201868,zhibo8.cc,719)</span><br><span class="line">1&gt; Access(1577503201868,zhibo8.cc,254)</span><br><span class="line">6&gt; Access(1577503201868,zhibo8.cc,1002)</span><br><span class="line">3&gt; Access(1577503201868,zhibo8.cc,358)</span><br><span class="line">7&gt; Access(1577503201868,dongqiudi.com,700)</span><br><span class="line">5&gt; Access(1577503201868,dongqiudi.com,692)</span><br><span class="line">6&gt; Access(1577503201868,ruozedata.com,408)</span><br><span class="line">5&gt; Access(1577503201868,ruozedata.com,986)</span><br><span class="line">1&gt; Access(1577503201868,ruozedata.com,284)</span><br><span class="line">4&gt; Access(1577503201868,zhibo8.cc,900)</span><br><span class="line">5&gt; Access(1577503201868,ruozedata.com,343)</span><br><span class="line">8&gt; Access(1577503201868,ruozedata.com,84)</span><br><span class="line">4&gt; Access(1577503201868,zhibo8.cc,967)</span><br><span class="line">8&gt; Access(1577503201868,ruozedata.com,14)</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">这就是每个5s发送10条数据 但是并行度是3的情况下 </span><br><span class="line">就是 每个5s 发送 10*3 = 30 条数据</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">3.RichParallelSourceFunction ****</span><br><span class="line">注意：</span><br><span class="line">	和上面的核心代码一样</span><br><span class="line">	但是 这个Rich里面</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Base class for implementing a parallel data source. Upon execution, the runtime will</span><br><span class="line"> * execute as many parallel instances of this function as configured parallelism</span><br><span class="line"> * of the source.</span><br><span class="line"> *</span><br><span class="line"> * &lt;p&gt;The data source has access to context information (such as the number of parallel</span><br><span class="line"> * instances of the source, and which parallel instance the current instance is)</span><br><span class="line"> * via &#123;@link #getRuntimeContext()&#125;. It also provides additional life-cycle methods</span><br><span class="line"> * (&#123;@link #open(org.apache.flink.configuration.Configuration)&#125; and &#123;@link #close()&#125;.&lt;/p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @param &lt;OUT&gt; The type of the records produced by this source.</span><br><span class="line"> */</span><br><span class="line">@Public</span><br><span class="line">public abstract class RichParallelSourceFunction&lt;OUT&gt; extends AbstractRichFunction</span><br><span class="line">		implements ParallelSourceFunction&lt;OUT&gt; &#123;</span><br><span class="line"></span><br><span class="line">	private static final long serialVersionUID = 1L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1. extends AbstractRichFunction </span><br><span class="line">而AbstractRichFunction </span><br><span class="line">是有生命周期的方法</span><br><span class="line">    open()</span><br><span class="line">    close()</span><br><span class="line"></span><br><span class="line">所以：</span><br><span class="line">	如果做一些</span><br><span class="line">	1.文件系统 </span><br><span class="line">	2.初始化</span><br><span class="line">	3.io</span><br><span class="line">	4.mysql 等等</span><br><span class="line">就得在open里和close里面获取连接 和关闭连接</span><br><span class="line"></span><br><span class="line">因为：</span><br><span class="line">	open()  close() 一个task会执行一次 （前面文章有例子）task就是并行度</span><br><span class="line">	所以要使用这个Function </span><br><span class="line">	生命周期是可以控制的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">class AccessSource03 extends RichParallelSourceFunction[Access]&#123;</span><br><span class="line"></span><br><span class="line">  var running = true</span><br><span class="line"></span><br><span class="line">  override def cancel(): Unit = &#123;</span><br><span class="line">    running = false</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def open(parameters: Configuration): Unit = &#123;</span><br><span class="line">    super.open(parameters)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def close(): Unit = &#123;</span><br><span class="line">    super.close()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  override def run(ctx: SourceFunction.SourceContext[Access]): Unit = &#123;</span><br><span class="line">    val random = new Random()</span><br><span class="line">    val domains = Array(&quot;ruozedata.com&quot;,&quot;zhibo8.cc&quot;,&quot;dongqiudi.com&quot;)</span><br><span class="line"></span><br><span class="line">    while(running) &#123;</span><br><span class="line">      val timestamp = System.currentTimeMillis()</span><br><span class="line">      1.to(10).map(x =&gt; &#123;</span><br><span class="line">        ctx.collect(Access(timestamp, domains(random.nextInt(domains.length)), random.nextInt(1000)+x))</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      // 休息下</span><br><span class="line">      Thread.sleep(5000)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">上面就是 Source的最基本的使用</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">那么现在有一个需求：</span><br><span class="line">  连接MySQL </span><br><span class="line">  查看官网 没有MySQL的Connector</span><br><span class="line"></span><br><span class="line">那么只能去github上找 或者 自己写一个Source即可</span><br><span class="line"></span><br><span class="line">需求就是：</span><br><span class="line">  把MySQL数据读取进来 </span><br><span class="line"></span><br><span class="line">操作MySQL pom里要加入MySQL依赖的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MySQL里面的数据：</span><br><span class="line">mysql&gt; select * from student;</span><br><span class="line">+----+--------+----------+-----+</span><br><span class="line">| id | name   | password | age |</span><br><span class="line">+----+--------+----------+-----+</span><br><span class="line">|  1 | kairis | wsx111   |  17 |</span><br><span class="line">|  2 | dbh    | 11       |  90 |</span><br><span class="line">|  3 | double | 44       |  12 |</span><br><span class="line">|  4 | happy  | 11       |  48 |</span><br><span class="line">+----+--------+----------+-----+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class MySQLSource extends RichSourceFunction[Student]&#123;</span><br><span class="line">  var connection:Connection = _</span><br><span class="line">  var pstmt:PreparedStatement = _</span><br><span class="line">  // 在open方法中建立连接</span><br><span class="line">  override def open(parameters: Configuration): Unit = &#123;</span><br><span class="line">    super.open(parameters)</span><br><span class="line">    connection = MySQLUtils.getConnection()</span><br><span class="line">    pstmt = connection.prepareStatement(&quot;select * from student&quot;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 释放</span><br><span class="line">  override def close(): Unit = &#123;</span><br><span class="line">    super.close()</span><br><span class="line">    MySQLUtils.closeConnection(connection, pstmt)</span><br><span class="line">  &#125;</span><br><span class="line">  override def cancel(): Unit = &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  override def run(ctx: SourceFunction.SourceContext[Student]): Unit = &#123;</span><br><span class="line">    val rs = pstmt.executeQuery()</span><br><span class="line">    while(rs.next())&#123;</span><br><span class="line">      val student = Student(rs.getInt(&quot;id&quot;), rs.getString(&quot;name&quot;), rs.getString(&quot;password&quot;),rs.getInt(&quot;age&quot;))</span><br><span class="line">      ctx.collect(student)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">	连接MySQL 生产上是有并行度的 </span><br><span class="line">	你不能在run里面建立连接   为什么呢？什么会触发run呢？主要的逻辑会触发run </span><br><span class="line">	这就类似Spark里面的 foreach 和foreachPartiion</span><br><span class="line">得借助于 open方法：</span><br><span class="line">	 去拿到连接   这个是每个task会执行一次</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line">    env.addSource(new MySQLSource).print()</span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">~~~~run~~~~~~</span><br><span class="line">5&gt; Student(4,happy,11,48)</span><br><span class="line">4&gt; Student(3,double,44,12)</span><br><span class="line">3&gt; Student(2,dbh,11,90)</span><br><span class="line">2&gt; Student(1,kairis,wsx111,17)</span><br><span class="line"></span><br><span class="line">env.addSource(new MySQLSource).setParallelism(3).print()</span><br><span class="line">会报错的：</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Source: 1 is not a parallel source</span><br><span class="line">为什么呢？</span><br><span class="line">但是这种方式 太low了 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">使用scalikjdbc： 这种方式更优雅些</span><br><span class="line">在配置文件里可以配置连接池</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">class ScalikeJDBCMySQLSource extends RichSourceFunction[Student]&#123;</span><br><span class="line"></span><br><span class="line">  override def cancel(): Unit = &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  override def run(ctx: SourceFunction.SourceContext[Student]): Unit = &#123;</span><br><span class="line">    println(&quot;~~~run~~~~&quot;)</span><br><span class="line">    DBs.setupAll()  // parse configuration file</span><br><span class="line"></span><br><span class="line">    DB.readOnly&#123; implicit session =&gt; &#123;</span><br><span class="line">      SQL(&quot;select * from student&quot;).map(rs =&gt; &#123;</span><br><span class="line">        val student = Student(rs.int(&quot;id&quot;),rs.string(&quot;name&quot;),rs.string(&quot;password&quot;),rs.int(&quot;age&quot;))</span><br><span class="line">        ctx.collect(student)</span><br><span class="line">      &#125;).list().apply()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">~~~run~~~~</span><br><span class="line">7&gt; Student(4,happy,11,48)</span><br><span class="line">5&gt; Student(2,dbh,11,90)</span><br><span class="line">4&gt; Student(1,kairis,wsx111,17)</span><br><span class="line">6&gt; Student(3,double,44,12)</span><br></pre></td></tr></table></figure></div>

<p><strong>读取kafka的数据</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">不同的kafka版本 Flink 使用的api不同</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20191228122121721.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">但是在 0.11之后就统一了</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20191228122438764.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我的kafka是 2.2.1系列的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">所以我使用的 pom是：</span><br><span class="line">我的flink 是 1.9.0的</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;flink-connector-kafka_2.11&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.9.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Flink’s Kafka consumer is</span><br><span class="line"> called FlinkKafkaConsumer08 (or 09 for</span><br><span class="line">  Kafka 0.9.0.x versions, etc. </span><br><span class="line"> or </span><br><span class="line"> just FlinkKafkaConsumer for Kafka &gt;= 1.0.0 versions).</span><br><span class="line">  It provides access to one or more Kafka topics.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Source：</span><br><span class="line">	Flink作为Kafka的消费者</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">	 * Creates a new Kafka streaming source consumer.</span><br><span class="line">	 *</span><br><span class="line">	 * @param topic             The name of the topic that should be consumed.</span><br><span class="line">	 * @param valueDeserializer The de-/serializer used to convert between Kafka&apos;s byte messages and Flink&apos;s objects.</span><br><span class="line">	 * @param props</span><br><span class="line">	 */</span><br><span class="line">	public FlinkKafkaConsumer(String topic, DeserializationSchema&lt;T&gt; valueDeserializer, Properties props) &#123;</span><br><span class="line">		this(Collections.singletonList(topic), valueDeserializer, props);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">1.topic</span><br><span class="line">2.DeserializationSchema   接收数据 所以是反序列化器 消费数据 所以是反序列化的</span><br><span class="line">3.Properties</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[double_happy@hadoop101 kafka]$ jps</span><br><span class="line">6544 Kafka</span><br><span class="line">7092 Kafka</span><br><span class="line">7892 Jps</span><br><span class="line">5959 QuorumPeerMain</span><br><span class="line">7723 Kafka</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">先开启：</span><br><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    val properties = new Properties()</span><br><span class="line">    properties.setProperty(&quot;bootstrap.servers&quot;, &quot;hadoop101:9092,hadoop101:9093,hadoop101:9094&quot;)</span><br><span class="line">    properties.setProperty(&quot;group.id&quot;, &quot;sxwang&quot;)</span><br><span class="line"></span><br><span class="line">    val consumer = new FlinkKafkaConsumer[String](&quot;double_happy_offset&quot;, new SimpleStringSchema(), properties)</span><br><span class="line"></span><br><span class="line">    env.addSource(consumer).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">结果：</span><br><span class="line">1&gt; b</span><br><span class="line">2&gt; d</span><br><span class="line">3&gt; d</span><br><span class="line">1&gt; c</span><br><span class="line">2&gt; f</span><br><span class="line">3&gt; b</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">往kafka发送数据：</span><br><span class="line">object DataGenerator &#123;</span><br><span class="line"></span><br><span class="line">  private val logger: Logger = LoggerFactory.getLogger(DataGenerator.getClass)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line">    val props = new Properties()</span><br><span class="line">    props.put(&quot;bootstrap.servers&quot;, &quot;hadoop101:9092,hadoop101:9093,hadoop101:9094&quot;)</span><br><span class="line">    props.put(&quot;acks&quot;, &quot;all&quot;)</span><br><span class="line">    props.put(&quot;key.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;)</span><br><span class="line">    props.put(&quot;value.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;)</span><br><span class="line">    val producer = new KafkaProducer[String, String](props)</span><br><span class="line"></span><br><span class="line">    for (i &lt;- 0 to 5) &#123;</span><br><span class="line">      Thread.sleep(100)</span><br><span class="line"></span><br><span class="line">      //拿一个abcdef</span><br><span class="line">      val word: String = String.valueOf((new Random().nextInt(6) + &apos;a&apos;).toChar)</span><br><span class="line">      val part = i % 3 //发到哪个分区 因为是三个分区</span><br><span class="line"></span><br><span class="line">      logger.error(&quot;word : &#123;&#125;&quot;, word)</span><br><span class="line"></span><br><span class="line">      val record = producer.send(new ProducerRecord[String, String](&quot;double_happy_offset&quot;, part, &quot;&quot;,word))</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    producer.close()</span><br><span class="line">    println(&quot;double_happy 数据产生完毕..........&quot;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Flink里面的kafka的offset 非常 好管理的 </span><br><span class="line">Spark里面的 是批次 每个批次的偏移量的管理 </span><br><span class="line">Flink是一条数据 进来的 一条数据进来的 </span><br><span class="line">控制偏移量就是api的使用 很简单</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">val myConsumer = new FlinkKafkaConsumer08[String](...)</span><br><span class="line">myConsumer.setStartFromEarliest()      // start from the earliest record possible</span><br><span class="line">myConsumer.setStartFromLatest()        // start from the latest record</span><br><span class="line">myConsumer.setStartFromTimestamp(...)  // start from specified epoch timestamp (milliseconds)</span><br><span class="line">myConsumer.setStartFromGroupOffsets()  // the default behaviour</span><br><span class="line"></span><br><span class="line">val stream = env.addSource(myConsumer)</span><br><span class="line"></span><br><span class="line">这是官网上的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">那么先讲使用 里面的状态和checkpoint 容错等 后续写入文章</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">object SourceApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    val properties = new Properties()</span><br><span class="line">    properties.setProperty(&quot;bootstrap.servers&quot;, &quot;hadoop101:9092,hadoop101:9093,hadoop101:9094&quot;)</span><br><span class="line">    properties.setProperty(&quot;group.id&quot;, &quot;sxwang&quot;)</span><br><span class="line"></span><br><span class="line">    val consumer = new FlinkKafkaConsumer[String](&quot;double_happy_offset&quot;, new SimpleStringSchema(), properties)</span><br><span class="line"></span><br><span class="line">    consumer.setStartFromEarliest()</span><br><span class="line"></span><br><span class="line">    env.addSource(consumer).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">1&gt; a</span><br><span class="line">2&gt; f</span><br><span class="line">3&gt; b</span><br><span class="line">2&gt; f</span><br><span class="line">1&gt; b</span><br><span class="line">2&gt; d</span><br><span class="line">3&gt; e</span><br><span class="line">2&gt; f</span><br><span class="line">1&gt; c</span><br><span class="line">3&gt; d</span><br><span class="line">3&gt; b</span><br><span class="line"></span><br><span class="line">看 这就把我们前面写入kafka的数据读出来了</span><br><span class="line"></span><br><span class="line">所以Flink里的偏移量很简单 底层管理的很好</span><br><span class="line"></span><br><span class="line">问题：</span><br><span class="line"> 我能不能指定 一个分区 分区里面的 offset呢？</span><br></pre></td></tr></table></figure></div>

<p><img src="https://img-blog.csdnimg.cn/20191228125529931.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/dev/stream/operators/index.html#datastream-transformations" target="_blank" rel="noopener">DataStream Transformations</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">和Spark大部分都差不多 </span><br><span class="line">下面说一下 Spark里没有的</span><br></pre></td></tr></table></figure></div>
<p><img src="https://img-blog.csdnimg.cn/20191228130532217.png" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">object TranformationApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">        val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;).map(x =&gt; &#123;</span><br><span class="line">          val splits = x.split(&quot;,&quot;)</span><br><span class="line">          Access(splits(0).toLong, splits(1), splits(2).toLong)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    stream.keyBy(_.domain).sum(&quot;traffic&quot;).print(&quot;sum&quot;)</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">结果是：</span><br><span class="line">sum:5&gt; Access(201912120010,ruozedata.com,2000)</span><br><span class="line">sum:6&gt; Access(201912120010,dongqiudi.com,1000)</span><br><span class="line">sum:6&gt; Access(201912120010,zhibo8.com,5000)</span><br><span class="line">sum:5&gt; Access(201912120010,ruozedata.com,6000)</span><br><span class="line">sum:6&gt; Access(201912120010,dongqiudi.com,7000)</span><br><span class="line"></span><br><span class="line">为什么结果是这样子的：</span><br><span class="line">   因为这是进来一条统计一次 </span><br><span class="line">注意和Spark的区别： Spark里是一个批次的</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">object TranformationApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;).map(x =&gt; &#123;</span><br><span class="line">          val splits = x.split(&quot;,&quot;)</span><br><span class="line">          Access(splits(0).toLong, splits(1), splits(2).toLong)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        stream.keyBy(_.domain).reduce((x,y) =&gt; &#123;</span><br><span class="line">          Access(x.time, x.domain, (x.traffic+y.traffic+100))</span><br><span class="line">        &#125;).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">5&gt; Access(201912120010,ruozedata.com,4000)</span><br><span class="line">6&gt; Access(201912120010,dongqiudi.com,1000)</span><br><span class="line">6&gt; Access(201912120010,dongqiudi.com,7100)</span><br><span class="line">5&gt; Access(201912120010,ruozedata.com,6100)</span><br><span class="line">6&gt; Access(201912120010,zhibo8.com,5000)</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">1.reduce 比sum灵活   keyby之后 是把相同的domain 放到一起了</span><br><span class="line">2.为什么zhibo8.com 结果没有＋100</span><br><span class="line"></span><br><span class="line">进来一条统计一次  为什么结果没有+100呢？</span><br><span class="line">因为 就1个呀   reduce 把相邻的两个做操作 1个操作啥</span><br></pre></td></tr></table></figure></div>
<p><strong>分流：</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20191228131908308.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9kb3VibGVoYXBweS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">这个功能 可能会用的到：</span><br><span class="line">这里使用split 后续 是使用  侧输出  因为split过时了  不过没有关系</span><br><span class="line"></span><br><span class="line">object TranformationApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;).map(x =&gt; &#123;</span><br><span class="line">      val splits = x.split(&quot;,&quot;)</span><br><span class="line">      Access(splits(0).toLong, splits(1), splits(2).toLong)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 5000 6000 7000</span><br><span class="line">    val splitStream = stream.keyBy(&quot;domain&quot;).sum(&quot;traffic&quot;).split(x =&gt; &#123;</span><br><span class="line">      if (x.traffic &gt; 6000) &#123;</span><br><span class="line">        Seq(&quot;大客户&quot;)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        Seq(&quot;一般客户&quot;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    splitStream.select(&quot;大客户&quot;).print(&quot;大客户&quot;)</span><br><span class="line">    splitStream.select(&quot;一般客户&quot;).print(&quot;一般客户&quot;)</span><br><span class="line">  </span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">一般客户:5&gt; Access(201912120010,ruozedata.com,2000)</span><br><span class="line">一般客户:6&gt; Access(201912120010,dongqiudi.com,1000)</span><br><span class="line">一般客户:6&gt; Access(201912120010,zhibo8.com,5000)</span><br><span class="line">一般客户:5&gt; Access(201912120010,ruozedata.com,6000)</span><br><span class="line">大客户:6&gt; Access(201912120010,dongqiudi.com,7000)</span><br><span class="line"></span><br><span class="line">splitStream.select(&quot;大客户&quot;, &quot;一般客户&quot;).print(&quot;ALL&quot;)</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">一般客户:5&gt; Access(201912120010,ruozedata.com,2000)</span><br><span class="line">一般客户:6&gt; Access(201912120010,dongqiudi.com,1000)</span><br><span class="line">ALL:5&gt; Access(201912120010,ruozedata.com,2000)</span><br><span class="line">ALL:6&gt; Access(201912120010,dongqiudi.com,1000)</span><br><span class="line">一般客户:6&gt; Access(201912120010,zhibo8.com,5000)</span><br><span class="line">ALL:6&gt; Access(201912120010,zhibo8.com,5000)</span><br><span class="line">一般客户:5&gt; Access(201912120010,ruozedata.com,6000)</span><br><span class="line">大客户:6&gt; Access(201912120010,dongqiudi.com,7000)</span><br><span class="line">ALL:5&gt; Access(201912120010,ruozedata.com,6000)</span><br><span class="line">ALL:6&gt; Access(201912120010,dongqiudi.com,7000)</span><br></pre></td></tr></table></figure></div>
<p><strong>合流</strong></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">两个流是可以合的 ：</span><br><span class="line">union</span><br><span class="line">connect</span><br><span class="line"></span><br><span class="line">object TranformationApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;).map(x =&gt; &#123;</span><br><span class="line">      val splits = x.split(&quot;,&quot;)</span><br><span class="line">      Access(splits(0).toLong, splits(1), splits(2).toLong)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">        val stream1 = env.addSource(new AccessSource)</span><br><span class="line">        val stream2 = env.addSource(new AccessSource)</span><br><span class="line"></span><br><span class="line">//1.数据类型是一样的 </span><br><span class="line">        stream1.union(stream2).map(x=&gt;&#123;</span><br><span class="line">          println(&quot;接收到的数据:&quot; + x)</span><br><span class="line">          x</span><br><span class="line">        &#125;).print()</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果：不重要哈 结果不重要 </span><br><span class="line">接收到的数据:Access(1577510963163,dongqiudi.com,656)</span><br><span class="line">接收到的数据:Access(1577510963163,dongqiudi.com,523)</span><br><span class="line">接收到的数据:Access(1577510963163,dongqiudi.com,340)</span><br><span class="line">接收到的数据:Access(1577510963163,ruozedata.com,450)</span><br><span class="line">接收到的数据:Access(1577510963163,ruozedata.com,790)</span><br><span class="line">2&gt; Access(1577510963163,ruozedata.com,450)</span><br><span class="line">接收到的数据:Access(1577510963163,dongqiudi.com,211)</span><br><span class="line">接收到的数据:Access(1577510963163,ruozedata.com,79)</span><br><span class="line">接收到的数据:Access(1577510963163,dongqiudi.com,673)</span><br><span class="line">4&gt; Access(1577510963163,ruozedata.com,79)</span><br><span class="line">6&gt; Access(1577510963163,dongqiudi.com,211)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  /**</span><br><span class="line">   * Creates a new DataStream by merging DataStream outputs of</span><br><span class="line">   * the same type with each other. The DataStreams merged using this operator</span><br><span class="line">   * will be transformed simultaneously.</span><br><span class="line">   *</span><br><span class="line">   */</span><br><span class="line">  def union(dataStreams: DataStream[T]*): DataStream[T] =</span><br><span class="line">    asScalaStream(stream.union(dataStreams.map(_.javaStream): _*))</span><br><span class="line">union:  he same type with each other.  要求数据类型是一样的 两个流</span><br><span class="line"></span><br><span class="line">但是生产上 要合并两个流 很少 两个流数据类型是一样的 </span><br><span class="line"></span><br><span class="line"> /**</span><br><span class="line">   * Creates a new ConnectedStreams by connecting</span><br><span class="line">   * DataStream outputs of different type with each other. The</span><br><span class="line">   * DataStreams connected using this operators can be used with CoFunctions.</span><br><span class="line">   */</span><br><span class="line">  def connect[T2](dataStream: DataStream[T2]): ConnectedStreams[T, T2] =</span><br><span class="line">    asScalaStream(stream.connect(dataStream.javaStream))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">两个流 数据类型不一样的： 使用 connect</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">两个流 数据类型不一样的：</span><br><span class="line"></span><br><span class="line">def map[R: TypeInformation](fun1: IN1 =&gt; R, fun2: IN2 =&gt; R):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">fun1: IN1 =&gt; R, fun2: IN2 =&gt; R</span><br><span class="line"></span><br><span class="line">fun1: IN1 =&gt; R   第一个流  做的操作</span><br><span class="line"> fun2: IN2 =&gt; R  第二个流 做的操作</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">object TranformationApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val stream = env.readTextFile(&quot;C:\\IdeaProjects\\flink\\data\\access.log&quot;).map(x =&gt; &#123;</span><br><span class="line">      val splits = x.split(&quot;,&quot;)</span><br><span class="line">      Access(splits(0).toLong, splits(1), splits(2).toLong)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    val stream1 = env.addSource(new AccessSource)</span><br><span class="line">    val stream2 = env.addSource(new AccessSource)</span><br><span class="line">   </span><br><span class="line">   val stream2New = stream2.map(x =&gt; (&quot;J哥&quot;, x))</span><br><span class="line">   </span><br><span class="line">   stream1.connect(stream2New).map(x=&gt;x,y=&gt;y).print()</span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">1&gt; Access(1577511438837,zhibo8.cc,823)</span><br><span class="line">8&gt; Access(1577511438837,zhibo8.cc,379)</span><br><span class="line">5&gt; Access(1577511438837,zhibo8.cc,176)</span><br><span class="line">5&gt; Access(1577511438837,zhibo8.cc,414)</span><br><span class="line">1&gt; (J哥,Access(1577511438837,zhibo8.cc,553))</span><br><span class="line">2&gt; Access(1577511438837,ruozedata.com,775)</span><br><span class="line">1&gt; (J哥,Access(1577511438837,ruozedata.com,561))</span><br><span class="line">6&gt; Access(1577511438837,dongqiudi.com,657)</span><br><span class="line">6&gt; Access(1577511438837,zhibo8.cc,131)</span><br><span class="line">6&gt; (J哥,Access(1577511438837,dongqiudi.com,826))</span><br><span class="line">7&gt; Access(1577511438837,ruozedata.com,153)</span><br><span class="line">7&gt; (J哥,Access(1577511438837,ruozedata.com,98))</span><br><span class="line">2&gt; (J哥,Access(1577511438837,ruozedata.com,588))</span><br><span class="line">2&gt; (J哥,Access(1577511438837,ruozedata.com,351))</span><br><span class="line">4&gt; Access(1577511438837,ruozedata.com,24)</span><br><span class="line">8&gt; (J哥,Access(1577511438837,dongqiudi.com,812))</span><br><span class="line">4&gt; (J哥,Access(1577511438837,dongqiudi.com,686))</span><br><span class="line">5&gt; (J哥,Access(1577511438837,zhibo8.cc,825))</span><br><span class="line">3&gt; Access(1577511438837,dongqiudi.com,333)</span><br><span class="line">3&gt; (J哥,Access(1577511438837,zhibo8.cc,140))</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">connect: </span><br><span class="line">     Connects  two data streams retaining their types </span><br><span class="line">     数据结构可以不同</span><br><span class="line">     two data streams  **</span><br><span class="line">union：</span><br><span class="line">       Union of two or more data streams</span><br><span class="line">        数据结构要相同</span><br><span class="line">        two or more data streams</span><br></pre></td></tr></table></figure></div>
<p><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.9/dev/stream/operators/#physical-partitioning" target="_blank" rel="noopener">Physical partitioning</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class DoubleHappyPartitioner extends Partitioner[String]&#123;</span><br><span class="line">  </span><br><span class="line">  override def partition(key: String, numPartitions: Int): Int = &#123;</span><br><span class="line">    println(&quot;partitions: &quot; + numPartitions)</span><br><span class="line">// 注意 scala 里面 不用使用 equals  直接 ==  即可</span><br><span class="line">    if(key == &quot;ruozedata.com&quot;)&#123;</span><br><span class="line">      0</span><br><span class="line">    &#125; else if(key == &quot;dongqiudi.com&quot;)&#123;</span><br><span class="line">      1</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      2</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">Partitioner[String]</span><br><span class="line"></span><br><span class="line">传进去的泛型 是 key的类型 </span><br><span class="line"></span><br><span class="line">分区的前提 是 kv</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">   * Partitions a tuple DataStream on the specified key fields using a custom partitioner.</span><br><span class="line">   * This method takes the key position to partition on, and a partitioner that accepts the key</span><br><span class="line">   * type.</span><br><span class="line">   *</span><br><span class="line">   * Note: This method works only on single field keys.</span><br><span class="line">   */</span><br><span class="line">  def partitionCustom[K: TypeInformation](partitioner: Partitioner[K], field: Int) : DataStream[T] =</span><br><span class="line">    asScalaStream(stream.partitionCustom(partitioner, field))</span><br><span class="line"></span><br><span class="line">field: Int  注意这个</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">object TranformationApp &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val env = StreamExecutionEnvironment.getExecutionEnvironment</span><br><span class="line">        env.setParallelism(3)</span><br><span class="line"></span><br><span class="line">        env.addSource(new AccessSource)</span><br><span class="line">          .map(x=&gt;(x.domain, x))</span><br><span class="line">          .partitionCustom(new DoubleHappyPartitioner, 0)</span><br><span class="line">          .map(x =&gt; &#123;</span><br><span class="line">            println(&quot;current thread id is: &quot; + Thread.currentThread().getId + &quot; , value is: &quot; + x)</span><br><span class="line">            x._2</span><br><span class="line">          &#125;).print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    env.execute(this.getClass.getSimpleName)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结果是：</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">partitions: 3</span><br><span class="line">current thread id is: 69 , value is: (zhibo8.cc,Access(1577512344598,zhibo8.cc,827))</span><br><span class="line">current thread id is: 68 , value is: (ruozedata.com,Access(1577512344598,ruozedata.com,143))</span><br><span class="line">1&gt; Access(1577512344598,ruozedata.com,143)</span><br><span class="line">3&gt; Access(1577512344598,zhibo8.cc,827)</span><br><span class="line">current thread id is: 68 , value is: (ruozedata.com,Access(1577512344598,ruozedata.com,672))</span><br><span class="line">1&gt; Access(1577512344598,ruozedata.com,672)</span><br><span class="line">current thread id is: 70 , value is: (dongqiudi.com,Access(1577512344598,dongqiudi.com,450))</span><br><span class="line">2&gt; Access(1577512344598,dongqiudi.com,450)</span><br><span class="line">current thread id is: 68 , value is: (ruozedata.com,Access(1577512344598,ruozedata.com,689))</span><br><span class="line">current thread id is: 69 , value is: (zhibo8.cc,Access(1577512344598,zhibo8.cc,608))</span><br><span class="line">current thread id is: 70 , value is: (dongqiudi.com,Access(1577512344598,dongqiudi.com,26))</span><br><span class="line">3&gt; Access(1577512344598,zhibo8.cc,608)</span><br><span class="line">2&gt; Access(1577512344598,dongqiudi.com,26)</span><br><span class="line">1&gt; Access(1577512344598,ruozedata.com,689)</span><br><span class="line">current thread id is: 69 , value is: (zhibo8.cc,Access(1577512344598,zhibo8.cc,430))</span><br><span class="line">current thread id is: 70 , value is: (dongqiudi.com,Access(1577512344598,dongqiudi.com,514))</span><br><span class="line">3&gt; Access(1577512344598,zhibo8.cc,430)</span><br><span class="line">2&gt; Access(1577512344598,dongqiudi.com,514)</span><br><span class="line">current thread id is: 69 , value is: (zhibo8.cc,Access(1577512344598,zhibo8.cc,345))</span><br><span class="line">3&gt; Access(1577512344598,zhibo8.cc,345)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">注意：线程</span><br><span class="line">1-&gt; ruozedata.com</span><br><span class="line">2-&gt;dongqiudi.com</span><br><span class="line">3&gt;zhibo8.cc  </span><br><span class="line">结果是没有问题的</span><br><span class="line"></span><br><span class="line">这就是分区器的简单使用</span><br><span class="line">让每个线程处理不同的数据</span><br></pre></td></tr></table></figure></div>

      
    </div>
    
      <footer class="article-footer">
        完
      </footer>
    
  </div>
  
    
<nav id="article-nav">
  <div class="article-nav-block">
    
      <a href="/2020/01/05/Flink03-double-happy/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption"></strong>
        <div class="article-nav-title">
          
            Flink03--double_happy
          
        </div>
      </a>
    
  </div>
  <div class="article-nav-block">
    
      <a href="/2020/01/05/Flink01-double-happy/" id="article-nav-older" class="article-nav-link-wrap">
        <div class="article-nav-title">Flink01-double_happy</div>
        <strong class="article-nav-caption"></strong>
      </a>
    
  </div>
</nav>

    <link rel="stylesheet" href="/css/gitment.css"> 
<script src="/js/gitment.js"></script>

<div id="gitmentContainer"></div>

<script>
var gitment = new Gitment({
  owner: '',
  repo: '',
  oauth: {
    client_id: '',
    client_secret: '',
  },
})
gitment.render('gitmentContainer')
</script>

  
  
</article>
</section>
        <aside id="sidebar">
  
    <div class="widget-box">
  <div class="avatar-box">
    <img class="avatar" src="/images/default-avatar.jpg" title="图片来自网络"></img>
    <h3 class="avatar-name">
      
        DoubleHappy
      
    </h3>
    <p class="avatar-slogan">
      特别耐撕的大数据，资深的打酱油攻城狮。
    </p>
  </div>
</div>


  
    

  
    

  
    
  
    
  <div class="widget-box">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li></ul>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/04/27/k8s-Spark-doublehappy/">k8s-Spark-doublehappy</a>
          </li>
        
          <li>
            <a href="/2020/01/05/Kudu-Impala%E6%95%85%E9%9A%9C%E6%A1%88%E4%BE%8B01-double-happy/">Kudu+Impala故障案例01--double_happy</a>
          </li>
        
          <li>
            <a href="/2020/01/05/Flink04-double-happy/">Flink04--double_happy</a>
          </li>
        
          <li>
            <a href="/2020/01/05/Flink03-double-happy/">Flink03--double_happy</a>
          </li>
        
          <li>
            <a href="/2020/01/05/Flink02-double-happy/">Flink02--double_happy</a>
          </li>
        
      </ul>
    </div>
  </div>

  
      <div class="widget-box">
    <h3 class="widget-title">友链</h3>
    <div class="widget">
      
        <a style="display: block;" href="https://liverrrr.fun/archives" title target='_blank'
        >一路眼瞎</a>
      
    </div>
  </div>

  
</aside>
      </div>
      <footer id="footer">
  <div class="foot-box global-width">
    &copy; 2020 DoubleHappy &nbsp;&nbsp;
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    &nbsp;|&nbsp;主题 <a href="https://github.com/yiluyanxia/hexo-theme-antiquity" target="_blank" rel="noopener">antiquity</a>
    <br>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">不蒜子告之   阁下是第<span id="busuanzi_value_site_pv"></span>个访客</span>
  </div>
</footer>
      <script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
<script>
if (!window.jQuery) {
var script = document.createElement('script');
script.src = "/js/jquery-2.0.3.min.js";
document.body.write(script);
}
</script>


<script src="/js/script.js"></script>



    </div>
    <nav id="mobile-nav" class="mobile-nav-box">
  <div class="mobile-nav-img mobile-nav-top"></div>
  
    <a href="/archives" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
  <div class="mobile-nav-img  mobile-nav-bottom"></div>
</nav>    
  </div>
</body>
</html>